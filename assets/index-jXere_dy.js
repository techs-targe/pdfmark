var A1=Object.defineProperty;var xy=n=>{throw TypeError(n)};var S1=(n,e,t)=>e in n?A1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var V=(n,e,t)=>S1(n,typeof e!="symbol"?e+"":e,t),vg=(n,e,t)=>e.has(n)||xy("Cannot "+t);var a=(n,e,t)=>(vg(n,e,"read from private field"),t?t.call(n):e.get(n)),b=(n,e,t)=>e.has(n)?xy("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),g=(n,e,t,s)=>(vg(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),A=(n,e,t)=>(vg(n,e,"access private method"),t);var on=(n,e,t,s)=>({set _(i){g(n,e,i,t)},get _(){return a(n,e,s)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function E1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var tb={exports:{}},Xp={},nb={exports:{}},Te={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Td=Symbol.for("react.element"),_1=Symbol.for("react.portal"),C1=Symbol.for("react.fragment"),k1=Symbol.for("react.strict_mode"),T1=Symbol.for("react.profiler"),P1=Symbol.for("react.provider"),N1=Symbol.for("react.context"),R1=Symbol.for("react.forward_ref"),M1=Symbol.for("react.suspense"),L1=Symbol.for("react.memo"),I1=Symbol.for("react.lazy"),Ay=Symbol.iterator;function D1(n){return n===null||typeof n!="object"?null:(n=Ay&&n[Ay]||n["@@iterator"],typeof n=="function"?n:null)}var sb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ib=Object.assign,rb={};function Uc(n,e,t){this.props=n,this.context=e,this.refs=rb,this.updater=t||sb}Uc.prototype.isReactComponent={};Uc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Uc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function ob(){}ob.prototype=Uc.prototype;function c0(n,e,t){this.props=n,this.context=e,this.refs=rb,this.updater=t||sb}var u0=c0.prototype=new ob;u0.constructor=c0;ib(u0,Uc.prototype);u0.isPureReactComponent=!0;var Sy=Array.isArray,ab=Object.prototype.hasOwnProperty,h0={current:null},lb={key:!0,ref:!0,__self:!0,__source:!0};function cb(n,e,t){var s,i={},r=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)ab.call(e,s)&&!lb.hasOwnProperty(s)&&(i[s]=e[s]);var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}if(n&&n.defaultProps)for(s in l=n.defaultProps,l)i[s]===void 0&&(i[s]=l[s]);return{$$typeof:Td,type:n,key:r,ref:o,props:i,_owner:h0.current}}function F1(n,e){return{$$typeof:Td,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function d0(n){return typeof n=="object"&&n!==null&&n.$$typeof===Td}function O1(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Ey=/\/+/g;function yg(n,e){return typeof n=="object"&&n!==null&&n.key!=null?O1(""+n.key):e.toString(36)}function af(n,e,t,s,i){var r=typeof n;(r==="undefined"||r==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Td:case _1:o=!0}}if(o)return o=n,i=i(o),n=s===""?"."+yg(o,0):s,Sy(i)?(t="",n!=null&&(t=n.replace(Ey,"$&/")+"/"),af(i,e,t,"",function(u){return u})):i!=null&&(d0(i)&&(i=F1(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Ey,"$&/")+"/")+n)),e.push(i)),1;if(o=0,s=s===""?".":s+":",Sy(n))for(var l=0;l<n.length;l++){r=n[l];var c=s+yg(r,l);o+=af(r,e,t,c,i)}else if(c=D1(n),typeof c=="function")for(n=c.call(n),l=0;!(r=n.next()).done;)r=r.value,c=s+yg(r,l++),o+=af(r,e,t,c,i);else if(r==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Od(n,e,t){if(n==null)return n;var s=[],i=0;return af(n,s,"","",function(r){return e.call(t,r,i++)}),s}function j1(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var vn={current:null},lf={transition:null},z1={ReactCurrentDispatcher:vn,ReactCurrentBatchConfig:lf,ReactCurrentOwner:h0};function ub(){throw Error("act(...) is not supported in production builds of React.")}Te.Children={map:Od,forEach:function(n,e,t){Od(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Od(n,function(){e++}),e},toArray:function(n){return Od(n,function(e){return e})||[]},only:function(n){if(!d0(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Te.Component=Uc;Te.Fragment=C1;Te.Profiler=T1;Te.PureComponent=c0;Te.StrictMode=k1;Te.Suspense=M1;Te.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z1;Te.act=ub;Te.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var s=ib({},n.props),i=n.key,r=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=h0.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(c in e)ab.call(e,c)&&!lb.hasOwnProperty(c)&&(s[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)s.children=t;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:Td,type:n.type,key:i,ref:r,props:s,_owner:o}};Te.createContext=function(n){return n={$$typeof:N1,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:P1,_context:n},n.Consumer=n};Te.createElement=cb;Te.createFactory=function(n){var e=cb.bind(null,n);return e.type=n,e};Te.createRef=function(){return{current:null}};Te.forwardRef=function(n){return{$$typeof:R1,render:n}};Te.isValidElement=d0;Te.lazy=function(n){return{$$typeof:I1,_payload:{_status:-1,_result:n},_init:j1}};Te.memo=function(n,e){return{$$typeof:L1,type:n,compare:e===void 0?null:e}};Te.startTransition=function(n){var e=lf.transition;lf.transition={};try{n()}finally{lf.transition=e}};Te.unstable_act=ub;Te.useCallback=function(n,e){return vn.current.useCallback(n,e)};Te.useContext=function(n){return vn.current.useContext(n)};Te.useDebugValue=function(){};Te.useDeferredValue=function(n){return vn.current.useDeferredValue(n)};Te.useEffect=function(n,e){return vn.current.useEffect(n,e)};Te.useId=function(){return vn.current.useId()};Te.useImperativeHandle=function(n,e,t){return vn.current.useImperativeHandle(n,e,t)};Te.useInsertionEffect=function(n,e){return vn.current.useInsertionEffect(n,e)};Te.useLayoutEffect=function(n,e){return vn.current.useLayoutEffect(n,e)};Te.useMemo=function(n,e){return vn.current.useMemo(n,e)};Te.useReducer=function(n,e,t){return vn.current.useReducer(n,e,t)};Te.useRef=function(n){return vn.current.useRef(n)};Te.useState=function(n){return vn.current.useState(n)};Te.useSyncExternalStore=function(n,e,t){return vn.current.useSyncExternalStore(n,e,t)};Te.useTransition=function(){return vn.current.useTransition()};Te.version="18.3.1";nb.exports=Te;var k=nb.exports;const vr=E1(k);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $1=k,H1=Symbol.for("react.element"),B1=Symbol.for("react.fragment"),U1=Object.prototype.hasOwnProperty,V1=$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,G1={key:!0,ref:!0,__self:!0,__source:!0};function hb(n,e,t){var s,i={},r=null,o=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)U1.call(e,s)&&!G1.hasOwnProperty(s)&&(i[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:H1,type:n,key:r,ref:o,props:i,_owner:V1.current}}Xp.Fragment=B1;Xp.jsx=hb;Xp.jsxs=hb;tb.exports=Xp;var S=tb.exports,Jg={},db={exports:{}},es={},fb={exports:{}},pb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(R,$){var D=R.length;R.push($);e:for(;0<D;){var Y=D-1>>>1,te=R[Y];if(0<i(te,$))R[Y]=$,R[D]=te,D=Y;else break e}}function t(R){return R.length===0?null:R[0]}function s(R){if(R.length===0)return null;var $=R[0],D=R.pop();if(D!==$){R[0]=D;e:for(var Y=0,te=R.length,Z=te>>>1;Y<Z;){var me=2*(Y+1)-1,Ge=R[me],_e=me+1,he=R[_e];if(0>i(Ge,D))_e<te&&0>i(he,Ge)?(R[Y]=he,R[_e]=D,Y=_e):(R[Y]=Ge,R[me]=D,Y=me);else if(_e<te&&0>i(he,D))R[Y]=he,R[_e]=D,Y=_e;else break e}}return $}function i(R,$){var D=R.sortIndex-$.sortIndex;return D!==0?D:R.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,y=!1,w=!1,_=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(R){for(var $=t(u);$!==null;){if($.callback===null)s(u);else if($.startTime<=R)s(u),$.sortIndex=$.expirationTime,e(c,$);else break;$=t(u)}}function x(R){if(w=!1,E(R),!y)if(t(c)!==null)y=!0,z(C);else{var $=t(u);$!==null&&T(x,$.startTime-R)}}function C(R,$){y=!1,w&&(w=!1,m(I),I=-1),p=!0;var D=f;try{for(E($),d=t(c);d!==null&&(!(d.expirationTime>$)||R&&!W());){var Y=d.callback;if(typeof Y=="function"){d.callback=null,f=d.priorityLevel;var te=Y(d.expirationTime<=$);$=n.unstable_now(),typeof te=="function"?d.callback=te:d===t(c)&&s(c),E($)}else s(c);d=t(c)}if(d!==null)var Z=!0;else{var me=t(u);me!==null&&T(x,me.startTime-$),Z=!1}return Z}finally{d=null,f=D,p=!1}}var P=!1,N=null,I=-1,L=5,U=-1;function W(){return!(n.unstable_now()-U<L)}function M(){if(N!==null){var R=n.unstable_now();U=R;var $=!0;try{$=N(!0,R)}finally{$?K():(P=!1,N=null)}}else P=!1}var K;if(typeof v=="function")K=function(){v(M)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,ee=q.port2;q.port1.onmessage=M,K=function(){ee.postMessage(null)}}else K=function(){_(M,0)};function z(R){N=R,P||(P=!0,K())}function T(R,$){I=_(function(){R(n.unstable_now())},$)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(R){R.callback=null},n.unstable_continueExecution=function(){y||p||(y=!0,z(C))},n.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<R?Math.floor(1e3/R):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(R){switch(f){case 1:case 2:case 3:var $=3;break;default:$=f}var D=f;f=$;try{return R()}finally{f=D}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(R,$){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var D=f;f=R;try{return $()}finally{f=D}},n.unstable_scheduleCallback=function(R,$,D){var Y=n.unstable_now();switch(typeof D=="object"&&D!==null?(D=D.delay,D=typeof D=="number"&&0<D?Y+D:Y):D=Y,R){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=D+te,R={id:h++,callback:$,priorityLevel:R,startTime:D,expirationTime:te,sortIndex:-1},D>Y?(R.sortIndex=D,e(u,R),t(c)===null&&R===t(u)&&(w?(m(I),I=-1):w=!0,T(x,D-Y))):(R.sortIndex=te,e(c,R),y||p||(y=!0,z(C))),R},n.unstable_shouldYield=W,n.unstable_wrapCallback=function(R){var $=f;return function(){var D=f;f=$;try{return R.apply(this,arguments)}finally{f=D}}}})(pb);fb.exports=pb;var W1=fb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X1=k,Jn=W1;function G(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gb=new Set,Ou={};function qa(n,e){Dc(n,e),Dc(n+"Capture",e)}function Dc(n,e){for(Ou[n]=e,n=0;n<e.length;n++)gb.add(e[n])}var ar=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),em=Object.prototype.hasOwnProperty,Y1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,_y={},Cy={};function K1(n){return em.call(Cy,n)?!0:em.call(_y,n)?!1:Y1.test(n)?Cy[n]=!0:(_y[n]=!0,!1)}function q1(n,e,t,s){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Q1(n,e,t,s){if(e===null||typeof e>"u"||q1(n,e,t,s))return!0;if(s)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function yn(n,e,t,s,i,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var Vt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Vt[n]=new yn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Vt[e]=new yn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Vt[n]=new yn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Vt[n]=new yn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Vt[n]=new yn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Vt[n]=new yn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Vt[n]=new yn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Vt[n]=new yn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Vt[n]=new yn(n,5,!1,n.toLowerCase(),null,!1,!1)});var f0=/[\-:]([a-z])/g;function p0(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(f0,p0);Vt[e]=new yn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(f0,p0);Vt[e]=new yn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(f0,p0);Vt[e]=new yn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Vt[n]=new yn(n,1,!1,n.toLowerCase(),null,!1,!1)});Vt.xlinkHref=new yn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Vt[n]=new yn(n,1,!1,n.toLowerCase(),null,!0,!0)});function g0(n,e,t,s){var i=Vt.hasOwnProperty(e)?Vt[e]:null;(i!==null?i.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Q1(e,t,i,s)&&(t=null),s||i===null?K1(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,s=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,s?n.setAttributeNS(s,e,t):n.setAttribute(e,t))))}var fr=X1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,jd=Symbol.for("react.element"),ll=Symbol.for("react.portal"),cl=Symbol.for("react.fragment"),m0=Symbol.for("react.strict_mode"),tm=Symbol.for("react.profiler"),mb=Symbol.for("react.provider"),vb=Symbol.for("react.context"),v0=Symbol.for("react.forward_ref"),nm=Symbol.for("react.suspense"),sm=Symbol.for("react.suspense_list"),y0=Symbol.for("react.memo"),yr=Symbol.for("react.lazy"),yb=Symbol.for("react.offscreen"),ky=Symbol.iterator;function Yc(n){return n===null||typeof n!="object"?null:(n=ky&&n[ky]||n["@@iterator"],typeof n=="function"?n:null)}var it=Object.assign,wg;function ou(n){if(wg===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);wg=e&&e[1]||""}return`
`+wg+n}var bg=!1;function xg(n,e){if(!n||bg)return"";bg=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){s=u}n.call(e.prototype)}else{try{throw Error()}catch(u){s=u}n()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),r=s.stack.split(`
`),o=i.length-1,l=r.length-1;1<=o&&0<=l&&i[o]!==r[l];)l--;for(;1<=o&&0<=l;o--,l--)if(i[o]!==r[l]){if(o!==1||l!==1)do if(o--,l--,0>l||i[o]!==r[l]){var c=`
`+i[o].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=o&&0<=l);break}}}finally{bg=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?ou(n):""}function Z1(n){switch(n.tag){case 5:return ou(n.type);case 16:return ou("Lazy");case 13:return ou("Suspense");case 19:return ou("SuspenseList");case 0:case 2:case 15:return n=xg(n.type,!1),n;case 11:return n=xg(n.type.render,!1),n;case 1:return n=xg(n.type,!0),n;default:return""}}function im(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case cl:return"Fragment";case ll:return"Portal";case tm:return"Profiler";case m0:return"StrictMode";case nm:return"Suspense";case sm:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case vb:return(n.displayName||"Context")+".Consumer";case mb:return(n._context.displayName||"Context")+".Provider";case v0:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case y0:return e=n.displayName||null,e!==null?e:im(n.type)||"Memo";case yr:e=n._payload,n=n._init;try{return im(n(e))}catch{}}return null}function J1(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return im(e);case 8:return e===m0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function uo(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function wb(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eE(n){var e=wb(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),s=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,r=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){s=""+o,r.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function zd(n){n._valueTracker||(n._valueTracker=eE(n))}function bb(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return n&&(s=wb(n)?n.checked?"true":"false":n.value),n=s,n!==t?(e.setValue(n),!0):!1}function Kf(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function rm(n,e){var t=e.checked;return it({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Ty(n,e){var t=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;t=uo(e.value!=null?e.value:t),n._wrapperState={initialChecked:s,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function xb(n,e){e=e.checked,e!=null&&g0(n,"checked",e,!1)}function om(n,e){xb(n,e);var t=uo(e.value),s=e.type;if(t!=null)s==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(s==="submit"||s==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?am(n,e.type,t):e.hasOwnProperty("defaultValue")&&am(n,e.type,uo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Py(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function am(n,e,t){(e!=="number"||Kf(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var au=Array.isArray;function Al(n,e,t,s){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&s&&(n[t].defaultSelected=!0)}else{for(t=""+uo(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,s&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function lm(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(G(91));return it({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Ny(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(G(92));if(au(t)){if(1<t.length)throw Error(G(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:uo(t)}}function Ab(n,e){var t=uo(e.value),s=uo(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),s!=null&&(n.defaultValue=""+s)}function Ry(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Sb(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cm(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Sb(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var $d,Eb=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,s,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,s,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for($d=$d||document.createElement("div"),$d.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=$d.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function ju(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Cu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tE=["Webkit","ms","Moz","O"];Object.keys(Cu).forEach(function(n){tE.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Cu[e]=Cu[n]})});function _b(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Cu.hasOwnProperty(n)&&Cu[n]?(""+e).trim():e+"px"}function Cb(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var s=t.indexOf("--")===0,i=_b(t,e[t],s);t==="float"&&(t="cssFloat"),s?n.setProperty(t,i):n[t]=i}}var nE=it({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function um(n,e){if(e){if(nE[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(G(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(G(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(G(61))}if(e.style!=null&&typeof e.style!="object")throw Error(G(62))}}function hm(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dm=null;function w0(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var fm=null,Sl=null,El=null;function My(n){if(n=Rd(n)){if(typeof fm!="function")throw Error(G(280));var e=n.stateNode;e&&(e=Zp(e),fm(n.stateNode,n.type,e))}}function kb(n){Sl?El?El.push(n):El=[n]:Sl=n}function Tb(){if(Sl){var n=Sl,e=El;if(El=Sl=null,My(n),e)for(n=0;n<e.length;n++)My(e[n])}}function Pb(n,e){return n(e)}function Nb(){}var Ag=!1;function Rb(n,e,t){if(Ag)return n(e,t);Ag=!0;try{return Pb(n,e,t)}finally{Ag=!1,(Sl!==null||El!==null)&&(Nb(),Tb())}}function zu(n,e){var t=n.stateNode;if(t===null)return null;var s=Zp(t);if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(n=n.type,s=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!s;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(G(231,e,typeof t));return t}var pm=!1;if(ar)try{var Kc={};Object.defineProperty(Kc,"passive",{get:function(){pm=!0}}),window.addEventListener("test",Kc,Kc),window.removeEventListener("test",Kc,Kc)}catch{pm=!1}function sE(n,e,t,s,i,r,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var ku=!1,qf=null,Qf=!1,gm=null,iE={onError:function(n){ku=!0,qf=n}};function rE(n,e,t,s,i,r,o,l,c){ku=!1,qf=null,sE.apply(iE,arguments)}function oE(n,e,t,s,i,r,o,l,c){if(rE.apply(this,arguments),ku){if(ku){var u=qf;ku=!1,qf=null}else throw Error(G(198));Qf||(Qf=!0,gm=u)}}function Qa(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Mb(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Ly(n){if(Qa(n)!==n)throw Error(G(188))}function aE(n){var e=n.alternate;if(!e){if(e=Qa(n),e===null)throw Error(G(188));return e!==n?null:n}for(var t=n,s=e;;){var i=t.return;if(i===null)break;var r=i.alternate;if(r===null){if(s=i.return,s!==null){t=s;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===t)return Ly(i),n;if(r===s)return Ly(i),e;r=r.sibling}throw Error(G(188))}if(t.return!==s.return)t=i,s=r;else{for(var o=!1,l=i.child;l;){if(l===t){o=!0,t=i,s=r;break}if(l===s){o=!0,s=i,t=r;break}l=l.sibling}if(!o){for(l=r.child;l;){if(l===t){o=!0,t=r,s=i;break}if(l===s){o=!0,s=r,t=i;break}l=l.sibling}if(!o)throw Error(G(189))}}if(t.alternate!==s)throw Error(G(190))}if(t.tag!==3)throw Error(G(188));return t.stateNode.current===t?n:e}function Lb(n){return n=aE(n),n!==null?Ib(n):null}function Ib(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Ib(n);if(e!==null)return e;n=n.sibling}return null}var Db=Jn.unstable_scheduleCallback,Iy=Jn.unstable_cancelCallback,lE=Jn.unstable_shouldYield,cE=Jn.unstable_requestPaint,dt=Jn.unstable_now,uE=Jn.unstable_getCurrentPriorityLevel,b0=Jn.unstable_ImmediatePriority,Fb=Jn.unstable_UserBlockingPriority,Zf=Jn.unstable_NormalPriority,hE=Jn.unstable_LowPriority,Ob=Jn.unstable_IdlePriority,Yp=null,vi=null;function dE(n){if(vi&&typeof vi.onCommitFiberRoot=="function")try{vi.onCommitFiberRoot(Yp,n,void 0,(n.current.flags&128)===128)}catch{}}var zs=Math.clz32?Math.clz32:gE,fE=Math.log,pE=Math.LN2;function gE(n){return n>>>=0,n===0?32:31-(fE(n)/pE|0)|0}var Hd=64,Bd=4194304;function lu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Jf(n,e){var t=n.pendingLanes;if(t===0)return 0;var s=0,i=n.suspendedLanes,r=n.pingedLanes,o=t&268435455;if(o!==0){var l=o&~i;l!==0?s=lu(l):(r&=o,r!==0&&(s=lu(r)))}else o=t&~i,o!==0?s=lu(o):r!==0&&(s=lu(r));if(s===0)return 0;if(e!==0&&e!==s&&!(e&i)&&(i=s&-s,r=e&-e,i>=r||i===16&&(r&4194240)!==0))return e;if(s&4&&(s|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=s;0<e;)t=31-zs(e),i=1<<t,s|=n[t],e&=~i;return s}function mE(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vE(n,e){for(var t=n.suspendedLanes,s=n.pingedLanes,i=n.expirationTimes,r=n.pendingLanes;0<r;){var o=31-zs(r),l=1<<o,c=i[o];c===-1?(!(l&t)||l&s)&&(i[o]=mE(l,e)):c<=e&&(n.expiredLanes|=l),r&=~l}}function mm(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function jb(){var n=Hd;return Hd<<=1,!(Hd&4194240)&&(Hd=64),n}function Sg(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Pd(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-zs(e),n[e]=t}function yE(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var s=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-zs(t),r=1<<i;e[i]=0,s[i]=-1,n[i]=-1,t&=~r}}function x0(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var s=31-zs(t),i=1<<s;i&e|n[s]&e&&(n[s]|=e),t&=~i}}var je=0;function zb(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var $b,A0,Hb,Bb,Ub,vm=!1,Ud=[],to=null,no=null,so=null,$u=new Map,Hu=new Map,br=[],wE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dy(n,e){switch(n){case"focusin":case"focusout":to=null;break;case"dragenter":case"dragleave":no=null;break;case"mouseover":case"mouseout":so=null;break;case"pointerover":case"pointerout":$u.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hu.delete(e.pointerId)}}function qc(n,e,t,s,i,r){return n===null||n.nativeEvent!==r?(n={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:r,targetContainers:[i]},e!==null&&(e=Rd(e),e!==null&&A0(e)),n):(n.eventSystemFlags|=s,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function bE(n,e,t,s,i){switch(e){case"focusin":return to=qc(to,n,e,t,s,i),!0;case"dragenter":return no=qc(no,n,e,t,s,i),!0;case"mouseover":return so=qc(so,n,e,t,s,i),!0;case"pointerover":var r=i.pointerId;return $u.set(r,qc($u.get(r)||null,n,e,t,s,i)),!0;case"gotpointercapture":return r=i.pointerId,Hu.set(r,qc(Hu.get(r)||null,n,e,t,s,i)),!0}return!1}function Vb(n){var e=No(n.target);if(e!==null){var t=Qa(e);if(t!==null){if(e=t.tag,e===13){if(e=Mb(t),e!==null){n.blockedOn=e,Ub(n.priority,function(){Hb(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function cf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=ym(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var s=new t.constructor(t.type,t);dm=s,t.target.dispatchEvent(s),dm=null}else return e=Rd(t),e!==null&&A0(e),n.blockedOn=t,!1;e.shift()}return!0}function Fy(n,e,t){cf(n)&&t.delete(e)}function xE(){vm=!1,to!==null&&cf(to)&&(to=null),no!==null&&cf(no)&&(no=null),so!==null&&cf(so)&&(so=null),$u.forEach(Fy),Hu.forEach(Fy)}function Qc(n,e){n.blockedOn===e&&(n.blockedOn=null,vm||(vm=!0,Jn.unstable_scheduleCallback(Jn.unstable_NormalPriority,xE)))}function Bu(n){function e(i){return Qc(i,n)}if(0<Ud.length){Qc(Ud[0],n);for(var t=1;t<Ud.length;t++){var s=Ud[t];s.blockedOn===n&&(s.blockedOn=null)}}for(to!==null&&Qc(to,n),no!==null&&Qc(no,n),so!==null&&Qc(so,n),$u.forEach(e),Hu.forEach(e),t=0;t<br.length;t++)s=br[t],s.blockedOn===n&&(s.blockedOn=null);for(;0<br.length&&(t=br[0],t.blockedOn===null);)Vb(t),t.blockedOn===null&&br.shift()}var _l=fr.ReactCurrentBatchConfig,ep=!0;function AE(n,e,t,s){var i=je,r=_l.transition;_l.transition=null;try{je=1,S0(n,e,t,s)}finally{je=i,_l.transition=r}}function SE(n,e,t,s){var i=je,r=_l.transition;_l.transition=null;try{je=4,S0(n,e,t,s)}finally{je=i,_l.transition=r}}function S0(n,e,t,s){if(ep){var i=ym(n,e,t,s);if(i===null)Lg(n,e,s,tp,t),Dy(n,s);else if(bE(i,n,e,t,s))s.stopPropagation();else if(Dy(n,s),e&4&&-1<wE.indexOf(n)){for(;i!==null;){var r=Rd(i);if(r!==null&&$b(r),r=ym(n,e,t,s),r===null&&Lg(n,e,s,tp,t),r===i)break;i=r}i!==null&&s.stopPropagation()}else Lg(n,e,s,null,t)}}var tp=null;function ym(n,e,t,s){if(tp=null,n=w0(s),n=No(n),n!==null)if(e=Qa(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Mb(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return tp=n,null}function Gb(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uE()){case b0:return 1;case Fb:return 4;case Zf:case hE:return 16;case Ob:return 536870912;default:return 16}default:return 16}}var Jr=null,E0=null,uf=null;function Wb(){if(uf)return uf;var n,e=E0,t=e.length,s,i="value"in Jr?Jr.value:Jr.textContent,r=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(s=1;s<=o&&e[t-s]===i[r-s];s++);return uf=i.slice(n,1<s?1-s:void 0)}function hf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Vd(){return!0}function Oy(){return!1}function ts(n){function e(t,s,i,r,o){this._reactName=t,this._targetInst=i,this.type=s,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(t=n[l],this[l]=t?t(r):r[l]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?Vd:Oy,this.isPropagationStopped=Oy,this}return it(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Vd)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Vd)},persist:function(){},isPersistent:Vd}),e}var Vc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_0=ts(Vc),Nd=it({},Vc,{view:0,detail:0}),EE=ts(Nd),Eg,_g,Zc,Kp=it({},Nd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:C0,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Zc&&(Zc&&n.type==="mousemove"?(Eg=n.screenX-Zc.screenX,_g=n.screenY-Zc.screenY):_g=Eg=0,Zc=n),Eg)},movementY:function(n){return"movementY"in n?n.movementY:_g}}),jy=ts(Kp),_E=it({},Kp,{dataTransfer:0}),CE=ts(_E),kE=it({},Nd,{relatedTarget:0}),Cg=ts(kE),TE=it({},Vc,{animationName:0,elapsedTime:0,pseudoElement:0}),PE=ts(TE),NE=it({},Vc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),RE=ts(NE),ME=it({},Vc,{data:0}),zy=ts(ME),LE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},DE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FE(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=DE[n])?!!e[n]:!1}function C0(){return FE}var OE=it({},Nd,{key:function(n){if(n.key){var e=LE[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=hf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?IE[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:C0,charCode:function(n){return n.type==="keypress"?hf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?hf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),jE=ts(OE),zE=it({},Kp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$y=ts(zE),$E=it({},Nd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:C0}),HE=ts($E),BE=it({},Vc,{propertyName:0,elapsedTime:0,pseudoElement:0}),UE=ts(BE),VE=it({},Kp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),GE=ts(VE),WE=[9,13,27,32],k0=ar&&"CompositionEvent"in window,Tu=null;ar&&"documentMode"in document&&(Tu=document.documentMode);var XE=ar&&"TextEvent"in window&&!Tu,Xb=ar&&(!k0||Tu&&8<Tu&&11>=Tu),Hy=" ",By=!1;function Yb(n,e){switch(n){case"keyup":return WE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Kb(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ul=!1;function YE(n,e){switch(n){case"compositionend":return Kb(e);case"keypress":return e.which!==32?null:(By=!0,Hy);case"textInput":return n=e.data,n===Hy&&By?null:n;default:return null}}function KE(n,e){if(ul)return n==="compositionend"||!k0&&Yb(n,e)?(n=Wb(),uf=E0=Jr=null,ul=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Xb&&e.locale!=="ko"?null:e.data;default:return null}}var qE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Uy(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!qE[n.type]:e==="textarea"}function qb(n,e,t,s){kb(s),e=np(e,"onChange"),0<e.length&&(t=new _0("onChange","change",null,t,s),n.push({event:t,listeners:e}))}var Pu=null,Uu=null;function QE(n){ax(n,0)}function qp(n){var e=fl(n);if(bb(e))return n}function ZE(n,e){if(n==="change")return e}var Qb=!1;if(ar){var kg;if(ar){var Tg="oninput"in document;if(!Tg){var Vy=document.createElement("div");Vy.setAttribute("oninput","return;"),Tg=typeof Vy.oninput=="function"}kg=Tg}else kg=!1;Qb=kg&&(!document.documentMode||9<document.documentMode)}function Gy(){Pu&&(Pu.detachEvent("onpropertychange",Zb),Uu=Pu=null)}function Zb(n){if(n.propertyName==="value"&&qp(Uu)){var e=[];qb(e,Uu,n,w0(n)),Rb(QE,e)}}function JE(n,e,t){n==="focusin"?(Gy(),Pu=e,Uu=t,Pu.attachEvent("onpropertychange",Zb)):n==="focusout"&&Gy()}function e_(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return qp(Uu)}function t_(n,e){if(n==="click")return qp(e)}function n_(n,e){if(n==="input"||n==="change")return qp(e)}function s_(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Hs=typeof Object.is=="function"?Object.is:s_;function Vu(n,e){if(Hs(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var i=t[s];if(!em.call(e,i)||!Hs(n[i],e[i]))return!1}return!0}function Wy(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Xy(n,e){var t=Wy(n);n=0;for(var s;t;){if(t.nodeType===3){if(s=n+t.textContent.length,n<=e&&s>=e)return{node:t,offset:e-n};n=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Wy(t)}}function Jb(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Jb(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function ex(){for(var n=window,e=Kf();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Kf(n.document)}return e}function T0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function i_(n){var e=ex(),t=n.focusedElem,s=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Jb(t.ownerDocument.documentElement,t)){if(s!==null&&T0(t)){if(e=s.start,n=s.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,r=Math.min(s.start,i);s=s.end===void 0?r:Math.min(s.end,i),!n.extend&&r>s&&(i=s,s=r,r=i),i=Xy(t,r);var o=Xy(t,s);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),r>s?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var r_=ar&&"documentMode"in document&&11>=document.documentMode,hl=null,wm=null,Nu=null,bm=!1;function Yy(n,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;bm||hl==null||hl!==Kf(s)||(s=hl,"selectionStart"in s&&T0(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Nu&&Vu(Nu,s)||(Nu=s,s=np(wm,"onSelect"),0<s.length&&(e=new _0("onSelect","select",null,e,t),n.push({event:e,listeners:s}),e.target=hl)))}function Gd(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var dl={animationend:Gd("Animation","AnimationEnd"),animationiteration:Gd("Animation","AnimationIteration"),animationstart:Gd("Animation","AnimationStart"),transitionend:Gd("Transition","TransitionEnd")},Pg={},tx={};ar&&(tx=document.createElement("div").style,"AnimationEvent"in window||(delete dl.animationend.animation,delete dl.animationiteration.animation,delete dl.animationstart.animation),"TransitionEvent"in window||delete dl.transitionend.transition);function Qp(n){if(Pg[n])return Pg[n];if(!dl[n])return n;var e=dl[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in tx)return Pg[n]=e[t];return n}var nx=Qp("animationend"),sx=Qp("animationiteration"),ix=Qp("animationstart"),rx=Qp("transitionend"),ox=new Map,Ky="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mo(n,e){ox.set(n,e),qa(e,[n])}for(var Ng=0;Ng<Ky.length;Ng++){var Rg=Ky[Ng],o_=Rg.toLowerCase(),a_=Rg[0].toUpperCase()+Rg.slice(1);mo(o_,"on"+a_)}mo(nx,"onAnimationEnd");mo(sx,"onAnimationIteration");mo(ix,"onAnimationStart");mo("dblclick","onDoubleClick");mo("focusin","onFocus");mo("focusout","onBlur");mo(rx,"onTransitionEnd");Dc("onMouseEnter",["mouseout","mouseover"]);Dc("onMouseLeave",["mouseout","mouseover"]);Dc("onPointerEnter",["pointerout","pointerover"]);Dc("onPointerLeave",["pointerout","pointerover"]);qa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qa("onBeforeInput",["compositionend","keypress","textInput","paste"]);qa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),l_=new Set("cancel close invalid load scroll toggle".split(" ").concat(cu));function qy(n,e,t){var s=n.type||"unknown-event";n.currentTarget=t,oE(s,e,void 0,n),n.currentTarget=null}function ax(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var s=n[t],i=s.event;s=s.listeners;e:{var r=void 0;if(e)for(var o=s.length-1;0<=o;o--){var l=s[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==r&&i.isPropagationStopped())break e;qy(i,l,u),r=c}else for(o=0;o<s.length;o++){if(l=s[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==r&&i.isPropagationStopped())break e;qy(i,l,u),r=c}}}if(Qf)throw n=gm,Qf=!1,gm=null,n}function We(n,e){var t=e[_m];t===void 0&&(t=e[_m]=new Set);var s=n+"__bubble";t.has(s)||(lx(e,n,2,!1),t.add(s))}function Mg(n,e,t){var s=0;e&&(s|=4),lx(t,n,s,e)}var Wd="_reactListening"+Math.random().toString(36).slice(2);function Gu(n){if(!n[Wd]){n[Wd]=!0,gb.forEach(function(t){t!=="selectionchange"&&(l_.has(t)||Mg(t,!1,n),Mg(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Wd]||(e[Wd]=!0,Mg("selectionchange",!1,e))}}function lx(n,e,t,s){switch(Gb(e)){case 1:var i=AE;break;case 4:i=SE;break;default:i=S0}t=i.bind(null,e,t,n),i=void 0,!pm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),s?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Lg(n,e,t,s,i){var r=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var l=s.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(o===4)for(o=s.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;l!==null;){if(o=No(l),o===null)return;if(c=o.tag,c===5||c===6){s=r=o;continue e}l=l.parentNode}}s=s.return}Rb(function(){var u=r,h=w0(t),d=[];e:{var f=ox.get(n);if(f!==void 0){var p=_0,y=n;switch(n){case"keypress":if(hf(t)===0)break e;case"keydown":case"keyup":p=jE;break;case"focusin":y="focus",p=Cg;break;case"focusout":y="blur",p=Cg;break;case"beforeblur":case"afterblur":p=Cg;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=jy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=CE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=HE;break;case nx:case sx:case ix:p=PE;break;case rx:p=UE;break;case"scroll":p=EE;break;case"wheel":p=GE;break;case"copy":case"cut":case"paste":p=RE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=$y}var w=(e&4)!==0,_=!w&&n==="scroll",m=w?f!==null?f+"Capture":null:f;w=[];for(var v=u,E;v!==null;){E=v;var x=E.stateNode;if(E.tag===5&&x!==null&&(E=x,m!==null&&(x=zu(v,m),x!=null&&w.push(Wu(v,x,E)))),_)break;v=v.return}0<w.length&&(f=new p(f,y,null,t,h),d.push({event:f,listeners:w}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",f&&t!==dm&&(y=t.relatedTarget||t.fromElement)&&(No(y)||y[lr]))break e;if((p||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,p?(y=t.relatedTarget||t.toElement,p=u,y=y?No(y):null,y!==null&&(_=Qa(y),y!==_||y.tag!==5&&y.tag!==6)&&(y=null)):(p=null,y=u),p!==y)){if(w=jy,x="onMouseLeave",m="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(w=$y,x="onPointerLeave",m="onPointerEnter",v="pointer"),_=p==null?f:fl(p),E=y==null?f:fl(y),f=new w(x,v+"leave",p,t,h),f.target=_,f.relatedTarget=E,x=null,No(h)===u&&(w=new w(m,v+"enter",y,t,h),w.target=E,w.relatedTarget=_,x=w),_=x,p&&y)t:{for(w=p,m=y,v=0,E=w;E;E=el(E))v++;for(E=0,x=m;x;x=el(x))E++;for(;0<v-E;)w=el(w),v--;for(;0<E-v;)m=el(m),E--;for(;v--;){if(w===m||m!==null&&w===m.alternate)break t;w=el(w),m=el(m)}w=null}else w=null;p!==null&&Qy(d,f,p,w,!1),y!==null&&_!==null&&Qy(d,_,y,w,!0)}}e:{if(f=u?fl(u):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var C=ZE;else if(Uy(f))if(Qb)C=n_;else{C=e_;var P=JE}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=t_);if(C&&(C=C(n,u))){qb(d,C,t,h);break e}P&&P(n,f,u),n==="focusout"&&(P=f._wrapperState)&&P.controlled&&f.type==="number"&&am(f,"number",f.value)}switch(P=u?fl(u):window,n){case"focusin":(Uy(P)||P.contentEditable==="true")&&(hl=P,wm=u,Nu=null);break;case"focusout":Nu=wm=hl=null;break;case"mousedown":bm=!0;break;case"contextmenu":case"mouseup":case"dragend":bm=!1,Yy(d,t,h);break;case"selectionchange":if(r_)break;case"keydown":case"keyup":Yy(d,t,h)}var N;if(k0)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else ul?Yb(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(Xb&&t.locale!=="ko"&&(ul||I!=="onCompositionStart"?I==="onCompositionEnd"&&ul&&(N=Wb()):(Jr=h,E0="value"in Jr?Jr.value:Jr.textContent,ul=!0)),P=np(u,I),0<P.length&&(I=new zy(I,n,null,t,h),d.push({event:I,listeners:P}),N?I.data=N:(N=Kb(t),N!==null&&(I.data=N)))),(N=XE?YE(n,t):KE(n,t))&&(u=np(u,"onBeforeInput"),0<u.length&&(h=new zy("onBeforeInput","beforeinput",null,t,h),d.push({event:h,listeners:u}),h.data=N))}ax(d,e)})}function Wu(n,e,t){return{instance:n,listener:e,currentTarget:t}}function np(n,e){for(var t=e+"Capture",s=[];n!==null;){var i=n,r=i.stateNode;i.tag===5&&r!==null&&(i=r,r=zu(n,t),r!=null&&s.unshift(Wu(n,r,i)),r=zu(n,e),r!=null&&s.push(Wu(n,r,i))),n=n.return}return s}function el(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Qy(n,e,t,s,i){for(var r=e._reactName,o=[];t!==null&&t!==s;){var l=t,c=l.alternate,u=l.stateNode;if(c!==null&&c===s)break;l.tag===5&&u!==null&&(l=u,i?(c=zu(t,r),c!=null&&o.unshift(Wu(t,c,l))):i||(c=zu(t,r),c!=null&&o.push(Wu(t,c,l)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var c_=/\r\n?/g,u_=/\u0000|\uFFFD/g;function Zy(n){return(typeof n=="string"?n:""+n).replace(c_,`
`).replace(u_,"")}function Xd(n,e,t){if(e=Zy(e),Zy(n)!==e&&t)throw Error(G(425))}function sp(){}var xm=null,Am=null;function Sm(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Em=typeof setTimeout=="function"?setTimeout:void 0,h_=typeof clearTimeout=="function"?clearTimeout:void 0,Jy=typeof Promise=="function"?Promise:void 0,d_=typeof queueMicrotask=="function"?queueMicrotask:typeof Jy<"u"?function(n){return Jy.resolve(null).then(n).catch(f_)}:Em;function f_(n){setTimeout(function(){throw n})}function Ig(n,e){var t=e,s=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(s===0){n.removeChild(i),Bu(e);return}s--}else t!=="$"&&t!=="$?"&&t!=="$!"||s++;t=i}while(t);Bu(e)}function io(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function ew(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Gc=Math.random().toString(36).slice(2),gi="__reactFiber$"+Gc,Xu="__reactProps$"+Gc,lr="__reactContainer$"+Gc,_m="__reactEvents$"+Gc,p_="__reactListeners$"+Gc,g_="__reactHandles$"+Gc;function No(n){var e=n[gi];if(e)return e;for(var t=n.parentNode;t;){if(e=t[lr]||t[gi]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=ew(n);n!==null;){if(t=n[gi])return t;n=ew(n)}return e}n=t,t=n.parentNode}return null}function Rd(n){return n=n[gi]||n[lr],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function fl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(G(33))}function Zp(n){return n[Xu]||null}var Cm=[],pl=-1;function vo(n){return{current:n}}function Ye(n){0>pl||(n.current=Cm[pl],Cm[pl]=null,pl--)}function Ve(n,e){pl++,Cm[pl]=n.current,n.current=e}var ho={},sn=vo(ho),Nn=vo(!1),Ha=ho;function Fc(n,e){var t=n.type.contextTypes;if(!t)return ho;var s=n.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var i={},r;for(r in t)i[r]=e[r];return s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Rn(n){return n=n.childContextTypes,n!=null}function ip(){Ye(Nn),Ye(sn)}function tw(n,e,t){if(sn.current!==ho)throw Error(G(168));Ve(sn,e),Ve(Nn,t)}function cx(n,e,t){var s=n.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return t;s=s.getChildContext();for(var i in s)if(!(i in e))throw Error(G(108,J1(n)||"Unknown",i));return it({},t,s)}function rp(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ho,Ha=sn.current,Ve(sn,n),Ve(Nn,Nn.current),!0}function nw(n,e,t){var s=n.stateNode;if(!s)throw Error(G(169));t?(n=cx(n,e,Ha),s.__reactInternalMemoizedMergedChildContext=n,Ye(Nn),Ye(sn),Ve(sn,n)):Ye(Nn),Ve(Nn,t)}var Pi=null,Jp=!1,Dg=!1;function ux(n){Pi===null?Pi=[n]:Pi.push(n)}function m_(n){Jp=!0,ux(n)}function yo(){if(!Dg&&Pi!==null){Dg=!0;var n=0,e=je;try{var t=Pi;for(je=1;n<t.length;n++){var s=t[n];do s=s(!0);while(s!==null)}Pi=null,Jp=!1}catch(i){throw Pi!==null&&(Pi=Pi.slice(n+1)),Db(b0,yo),i}finally{je=e,Dg=!1}}return null}var gl=[],ml=0,op=null,ap=0,hs=[],ds=0,Ba=null,nr=1,sr="";function xo(n,e){gl[ml++]=ap,gl[ml++]=op,op=n,ap=e}function hx(n,e,t){hs[ds++]=nr,hs[ds++]=sr,hs[ds++]=Ba,Ba=n;var s=nr;n=sr;var i=32-zs(s)-1;s&=~(1<<i),t+=1;var r=32-zs(e)+i;if(30<r){var o=i-i%5;r=(s&(1<<o)-1).toString(32),s>>=o,i-=o,nr=1<<32-zs(e)+i|t<<i|s,sr=r+n}else nr=1<<r|t<<i|s,sr=n}function P0(n){n.return!==null&&(xo(n,1),hx(n,1,0))}function N0(n){for(;n===op;)op=gl[--ml],gl[ml]=null,ap=gl[--ml],gl[ml]=null;for(;n===Ba;)Ba=hs[--ds],hs[ds]=null,sr=hs[--ds],hs[ds]=null,nr=hs[--ds],hs[ds]=null}var Qn=null,qn=null,Ze=!1,Os=null;function dx(n,e){var t=gs(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function sw(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Qn=n,qn=io(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Qn=n,qn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ba!==null?{id:nr,overflow:sr}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=gs(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Qn=n,qn=null,!0):!1;default:return!1}}function km(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Tm(n){if(Ze){var e=qn;if(e){var t=e;if(!sw(n,e)){if(km(n))throw Error(G(418));e=io(t.nextSibling);var s=Qn;e&&sw(n,e)?dx(s,t):(n.flags=n.flags&-4097|2,Ze=!1,Qn=n)}}else{if(km(n))throw Error(G(418));n.flags=n.flags&-4097|2,Ze=!1,Qn=n}}}function iw(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Qn=n}function Yd(n){if(n!==Qn)return!1;if(!Ze)return iw(n),Ze=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Sm(n.type,n.memoizedProps)),e&&(e=qn)){if(km(n))throw fx(),Error(G(418));for(;e;)dx(n,e),e=io(e.nextSibling)}if(iw(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(G(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){qn=io(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}qn=null}}else qn=Qn?io(n.stateNode.nextSibling):null;return!0}function fx(){for(var n=qn;n;)n=io(n.nextSibling)}function Oc(){qn=Qn=null,Ze=!1}function R0(n){Os===null?Os=[n]:Os.push(n)}var v_=fr.ReactCurrentBatchConfig;function Jc(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(G(309));var s=t.stateNode}if(!s)throw Error(G(147,n));var i=s,r=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var l=i.refs;o===null?delete l[r]:l[r]=o},e._stringRef=r,e)}if(typeof n!="string")throw Error(G(284));if(!t._owner)throw Error(G(290,n))}return n}function Kd(n,e){throw n=Object.prototype.toString.call(e),Error(G(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function rw(n){var e=n._init;return e(n._payload)}function px(n){function e(m,v){if(n){var E=m.deletions;E===null?(m.deletions=[v],m.flags|=16):E.push(v)}}function t(m,v){if(!n)return null;for(;v!==null;)e(m,v),v=v.sibling;return null}function s(m,v){for(m=new Map;v!==null;)v.key!==null?m.set(v.key,v):m.set(v.index,v),v=v.sibling;return m}function i(m,v){return m=lo(m,v),m.index=0,m.sibling=null,m}function r(m,v,E){return m.index=E,n?(E=m.alternate,E!==null?(E=E.index,E<v?(m.flags|=2,v):E):(m.flags|=2,v)):(m.flags|=1048576,v)}function o(m){return n&&m.alternate===null&&(m.flags|=2),m}function l(m,v,E,x){return v===null||v.tag!==6?(v=Bg(E,m.mode,x),v.return=m,v):(v=i(v,E),v.return=m,v)}function c(m,v,E,x){var C=E.type;return C===cl?h(m,v,E.props.children,x,E.key):v!==null&&(v.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===yr&&rw(C)===v.type)?(x=i(v,E.props),x.ref=Jc(m,v,E),x.return=m,x):(x=yf(E.type,E.key,E.props,null,m.mode,x),x.ref=Jc(m,v,E),x.return=m,x)}function u(m,v,E,x){return v===null||v.tag!==4||v.stateNode.containerInfo!==E.containerInfo||v.stateNode.implementation!==E.implementation?(v=Ug(E,m.mode,x),v.return=m,v):(v=i(v,E.children||[]),v.return=m,v)}function h(m,v,E,x,C){return v===null||v.tag!==7?(v=ja(E,m.mode,x,C),v.return=m,v):(v=i(v,E),v.return=m,v)}function d(m,v,E){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Bg(""+v,m.mode,E),v.return=m,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case jd:return E=yf(v.type,v.key,v.props,null,m.mode,E),E.ref=Jc(m,null,v),E.return=m,E;case ll:return v=Ug(v,m.mode,E),v.return=m,v;case yr:var x=v._init;return d(m,x(v._payload),E)}if(au(v)||Yc(v))return v=ja(v,m.mode,E,null),v.return=m,v;Kd(m,v)}return null}function f(m,v,E,x){var C=v!==null?v.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return C!==null?null:l(m,v,""+E,x);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case jd:return E.key===C?c(m,v,E,x):null;case ll:return E.key===C?u(m,v,E,x):null;case yr:return C=E._init,f(m,v,C(E._payload),x)}if(au(E)||Yc(E))return C!==null?null:h(m,v,E,x,null);Kd(m,E)}return null}function p(m,v,E,x,C){if(typeof x=="string"&&x!==""||typeof x=="number")return m=m.get(E)||null,l(v,m,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case jd:return m=m.get(x.key===null?E:x.key)||null,c(v,m,x,C);case ll:return m=m.get(x.key===null?E:x.key)||null,u(v,m,x,C);case yr:var P=x._init;return p(m,v,E,P(x._payload),C)}if(au(x)||Yc(x))return m=m.get(E)||null,h(v,m,x,C,null);Kd(v,x)}return null}function y(m,v,E,x){for(var C=null,P=null,N=v,I=v=0,L=null;N!==null&&I<E.length;I++){N.index>I?(L=N,N=null):L=N.sibling;var U=f(m,N,E[I],x);if(U===null){N===null&&(N=L);break}n&&N&&U.alternate===null&&e(m,N),v=r(U,v,I),P===null?C=U:P.sibling=U,P=U,N=L}if(I===E.length)return t(m,N),Ze&&xo(m,I),C;if(N===null){for(;I<E.length;I++)N=d(m,E[I],x),N!==null&&(v=r(N,v,I),P===null?C=N:P.sibling=N,P=N);return Ze&&xo(m,I),C}for(N=s(m,N);I<E.length;I++)L=p(N,m,I,E[I],x),L!==null&&(n&&L.alternate!==null&&N.delete(L.key===null?I:L.key),v=r(L,v,I),P===null?C=L:P.sibling=L,P=L);return n&&N.forEach(function(W){return e(m,W)}),Ze&&xo(m,I),C}function w(m,v,E,x){var C=Yc(E);if(typeof C!="function")throw Error(G(150));if(E=C.call(E),E==null)throw Error(G(151));for(var P=C=null,N=v,I=v=0,L=null,U=E.next();N!==null&&!U.done;I++,U=E.next()){N.index>I?(L=N,N=null):L=N.sibling;var W=f(m,N,U.value,x);if(W===null){N===null&&(N=L);break}n&&N&&W.alternate===null&&e(m,N),v=r(W,v,I),P===null?C=W:P.sibling=W,P=W,N=L}if(U.done)return t(m,N),Ze&&xo(m,I),C;if(N===null){for(;!U.done;I++,U=E.next())U=d(m,U.value,x),U!==null&&(v=r(U,v,I),P===null?C=U:P.sibling=U,P=U);return Ze&&xo(m,I),C}for(N=s(m,N);!U.done;I++,U=E.next())U=p(N,m,I,U.value,x),U!==null&&(n&&U.alternate!==null&&N.delete(U.key===null?I:U.key),v=r(U,v,I),P===null?C=U:P.sibling=U,P=U);return n&&N.forEach(function(M){return e(m,M)}),Ze&&xo(m,I),C}function _(m,v,E,x){if(typeof E=="object"&&E!==null&&E.type===cl&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case jd:e:{for(var C=E.key,P=v;P!==null;){if(P.key===C){if(C=E.type,C===cl){if(P.tag===7){t(m,P.sibling),v=i(P,E.props.children),v.return=m,m=v;break e}}else if(P.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===yr&&rw(C)===P.type){t(m,P.sibling),v=i(P,E.props),v.ref=Jc(m,P,E),v.return=m,m=v;break e}t(m,P);break}else e(m,P);P=P.sibling}E.type===cl?(v=ja(E.props.children,m.mode,x,E.key),v.return=m,m=v):(x=yf(E.type,E.key,E.props,null,m.mode,x),x.ref=Jc(m,v,E),x.return=m,m=x)}return o(m);case ll:e:{for(P=E.key;v!==null;){if(v.key===P)if(v.tag===4&&v.stateNode.containerInfo===E.containerInfo&&v.stateNode.implementation===E.implementation){t(m,v.sibling),v=i(v,E.children||[]),v.return=m,m=v;break e}else{t(m,v);break}else e(m,v);v=v.sibling}v=Ug(E,m.mode,x),v.return=m,m=v}return o(m);case yr:return P=E._init,_(m,v,P(E._payload),x)}if(au(E))return y(m,v,E,x);if(Yc(E))return w(m,v,E,x);Kd(m,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,v!==null&&v.tag===6?(t(m,v.sibling),v=i(v,E),v.return=m,m=v):(t(m,v),v=Bg(E,m.mode,x),v.return=m,m=v),o(m)):t(m,v)}return _}var jc=px(!0),gx=px(!1),lp=vo(null),cp=null,vl=null,M0=null;function L0(){M0=vl=cp=null}function I0(n){var e=lp.current;Ye(lp),n._currentValue=e}function Pm(n,e,t){for(;n!==null;){var s=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),n===t)break;n=n.return}}function Cl(n,e){cp=n,M0=vl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Pn=!0),n.firstContext=null)}function ys(n){var e=n._currentValue;if(M0!==n)if(n={context:n,memoizedValue:e,next:null},vl===null){if(cp===null)throw Error(G(308));vl=n,cp.dependencies={lanes:0,firstContext:n}}else vl=vl.next=n;return e}var Ro=null;function D0(n){Ro===null?Ro=[n]:Ro.push(n)}function mx(n,e,t,s){var i=e.interleaved;return i===null?(t.next=t,D0(e)):(t.next=i.next,i.next=t),e.interleaved=t,cr(n,s)}function cr(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var wr=!1;function F0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vx(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ir(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function ro(n,e,t){var s=n.updateQueue;if(s===null)return null;if(s=s.shared,Re&2){var i=s.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),s.pending=e,cr(n,t)}return i=s.interleaved,i===null?(e.next=e,D0(s)):(e.next=i.next,i.next=e),s.interleaved=e,cr(n,t)}function df(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,x0(n,t)}}function ow(n,e){var t=n.updateQueue,s=n.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var i=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};r===null?i=r=o:r=r.next=o,t=t.next}while(t!==null);r===null?i=r=e:r=r.next=e}else i=r=e;t={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:s.shared,effects:s.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function up(n,e,t,s){var i=n.updateQueue;wr=!1;var r=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?r=u:o.next=u,o=c;var h=n.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==o&&(l===null?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(r!==null){var d=i.baseState;o=0,h=u=c=null,l=r;do{var f=l.lane,p=l.eventTime;if((s&f)===f){h!==null&&(h=h.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=n,w=l;switch(f=e,p=t,w.tag){case 1:if(y=w.payload,typeof y=="function"){d=y.call(p,d,f);break e}d=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=w.payload,f=typeof y=="function"?y.call(p,d,f):y,f==null)break e;d=it({},d,f);break e;case 2:wr=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[l]:f.push(l))}else p={eventTime:p,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(u=h=p,c=d):h=h.next=p,o|=f;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;f=l,l=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(h===null&&(c=d),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else r===null&&(i.shared.lanes=0);Va|=o,n.lanes=o,n.memoizedState=d}}function aw(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var s=n[e],i=s.callback;if(i!==null){if(s.callback=null,s=t,typeof i!="function")throw Error(G(191,i));i.call(s)}}}var Md={},yi=vo(Md),Yu=vo(Md),Ku=vo(Md);function Mo(n){if(n===Md)throw Error(G(174));return n}function O0(n,e){switch(Ve(Ku,e),Ve(Yu,n),Ve(yi,Md),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:cm(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=cm(e,n)}Ye(yi),Ve(yi,e)}function zc(){Ye(yi),Ye(Yu),Ye(Ku)}function yx(n){Mo(Ku.current);var e=Mo(yi.current),t=cm(e,n.type);e!==t&&(Ve(Yu,n),Ve(yi,t))}function j0(n){Yu.current===n&&(Ye(yi),Ye(Yu))}var tt=vo(0);function hp(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Fg=[];function z0(){for(var n=0;n<Fg.length;n++)Fg[n]._workInProgressVersionPrimary=null;Fg.length=0}var ff=fr.ReactCurrentDispatcher,Og=fr.ReactCurrentBatchConfig,Ua=0,st=null,St=null,It=null,dp=!1,Ru=!1,qu=0,y_=0;function Gt(){throw Error(G(321))}function $0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Hs(n[t],e[t]))return!1;return!0}function H0(n,e,t,s,i,r){if(Ua=r,st=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ff.current=n===null||n.memoizedState===null?A_:S_,n=t(s,i),Ru){r=0;do{if(Ru=!1,qu=0,25<=r)throw Error(G(301));r+=1,It=St=null,e.updateQueue=null,ff.current=E_,n=t(s,i)}while(Ru)}if(ff.current=fp,e=St!==null&&St.next!==null,Ua=0,It=St=st=null,dp=!1,e)throw Error(G(300));return n}function B0(){var n=qu!==0;return qu=0,n}function Qs(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return It===null?st.memoizedState=It=n:It=It.next=n,It}function ws(){if(St===null){var n=st.alternate;n=n!==null?n.memoizedState:null}else n=St.next;var e=It===null?st.memoizedState:It.next;if(e!==null)It=e,St=n;else{if(n===null)throw Error(G(310));St=n,n={memoizedState:St.memoizedState,baseState:St.baseState,baseQueue:St.baseQueue,queue:St.queue,next:null},It===null?st.memoizedState=It=n:It=It.next=n}return It}function Qu(n,e){return typeof e=="function"?e(n):e}function jg(n){var e=ws(),t=e.queue;if(t===null)throw Error(G(311));t.lastRenderedReducer=n;var s=St,i=s.baseQueue,r=t.pending;if(r!==null){if(i!==null){var o=i.next;i.next=r.next,r.next=o}s.baseQueue=i=r,t.pending=null}if(i!==null){r=i.next,s=s.baseState;var l=o=null,c=null,u=r;do{var h=u.lane;if((Ua&h)===h)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:n(s,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=d,o=s):c=c.next=d,st.lanes|=h,Va|=h}u=u.next}while(u!==null&&u!==r);c===null?o=s:c.next=l,Hs(s,e.memoizedState)||(Pn=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=c,t.lastRenderedState=s}if(n=t.interleaved,n!==null){i=n;do r=i.lane,st.lanes|=r,Va|=r,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function zg(n){var e=ws(),t=e.queue;if(t===null)throw Error(G(311));t.lastRenderedReducer=n;var s=t.dispatch,i=t.pending,r=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do r=n(r,o.action),o=o.next;while(o!==i);Hs(r,e.memoizedState)||(Pn=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,s]}function wx(){}function bx(n,e){var t=st,s=ws(),i=e(),r=!Hs(s.memoizedState,i);if(r&&(s.memoizedState=i,Pn=!0),s=s.queue,U0(Sx.bind(null,t,s,n),[n]),s.getSnapshot!==e||r||It!==null&&It.memoizedState.tag&1){if(t.flags|=2048,Zu(9,Ax.bind(null,t,s,i,e),void 0,null),Dt===null)throw Error(G(349));Ua&30||xx(t,e,i)}return i}function xx(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=st.updateQueue,e===null?(e={lastEffect:null,stores:null},st.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Ax(n,e,t,s){e.value=t,e.getSnapshot=s,Ex(e)&&_x(n)}function Sx(n,e,t){return t(function(){Ex(e)&&_x(n)})}function Ex(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Hs(n,t)}catch{return!0}}function _x(n){var e=cr(n,1);e!==null&&$s(e,n,1,-1)}function lw(n){var e=Qs();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qu,lastRenderedState:n},e.queue=n,n=n.dispatch=x_.bind(null,st,n),[e.memoizedState,n]}function Zu(n,e,t,s){return n={tag:n,create:e,destroy:t,deps:s,next:null},e=st.updateQueue,e===null?(e={lastEffect:null,stores:null},st.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(s=t.next,t.next=n,n.next=s,e.lastEffect=n)),n}function Cx(){return ws().memoizedState}function pf(n,e,t,s){var i=Qs();st.flags|=n,i.memoizedState=Zu(1|e,t,void 0,s===void 0?null:s)}function eg(n,e,t,s){var i=ws();s=s===void 0?null:s;var r=void 0;if(St!==null){var o=St.memoizedState;if(r=o.destroy,s!==null&&$0(s,o.deps)){i.memoizedState=Zu(e,t,r,s);return}}st.flags|=n,i.memoizedState=Zu(1|e,t,r,s)}function cw(n,e){return pf(8390656,8,n,e)}function U0(n,e){return eg(2048,8,n,e)}function kx(n,e){return eg(4,2,n,e)}function Tx(n,e){return eg(4,4,n,e)}function Px(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Nx(n,e,t){return t=t!=null?t.concat([n]):null,eg(4,4,Px.bind(null,e,n),t)}function V0(){}function Rx(n,e){var t=ws();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&$0(e,s[1])?s[0]:(t.memoizedState=[n,e],n)}function Mx(n,e){var t=ws();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&$0(e,s[1])?s[0]:(n=n(),t.memoizedState=[n,e],n)}function Lx(n,e,t){return Ua&21?(Hs(t,e)||(t=jb(),st.lanes|=t,Va|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Pn=!0),n.memoizedState=t)}function w_(n,e){var t=je;je=t!==0&&4>t?t:4,n(!0);var s=Og.transition;Og.transition={};try{n(!1),e()}finally{je=t,Og.transition=s}}function Ix(){return ws().memoizedState}function b_(n,e,t){var s=ao(n);if(t={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null},Dx(n))Fx(e,t);else if(t=mx(n,e,t,s),t!==null){var i=fn();$s(t,n,s,i),Ox(t,e,s)}}function x_(n,e,t){var s=ao(n),i={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null};if(Dx(n))Fx(e,i);else{var r=n.alternate;if(n.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,l=r(o,t);if(i.hasEagerState=!0,i.eagerState=l,Hs(l,o)){var c=e.interleaved;c===null?(i.next=i,D0(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}t=mx(n,e,i,s),t!==null&&(i=fn(),$s(t,n,s,i),Ox(t,e,s))}}function Dx(n){var e=n.alternate;return n===st||e!==null&&e===st}function Fx(n,e){Ru=dp=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Ox(n,e,t){if(t&4194240){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,x0(n,t)}}var fp={readContext:ys,useCallback:Gt,useContext:Gt,useEffect:Gt,useImperativeHandle:Gt,useInsertionEffect:Gt,useLayoutEffect:Gt,useMemo:Gt,useReducer:Gt,useRef:Gt,useState:Gt,useDebugValue:Gt,useDeferredValue:Gt,useTransition:Gt,useMutableSource:Gt,useSyncExternalStore:Gt,useId:Gt,unstable_isNewReconciler:!1},A_={readContext:ys,useCallback:function(n,e){return Qs().memoizedState=[n,e===void 0?null:e],n},useContext:ys,useEffect:cw,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,pf(4194308,4,Px.bind(null,e,n),t)},useLayoutEffect:function(n,e){return pf(4194308,4,n,e)},useInsertionEffect:function(n,e){return pf(4,2,n,e)},useMemo:function(n,e){var t=Qs();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var s=Qs();return e=t!==void 0?t(e):e,s.memoizedState=s.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},s.queue=n,n=n.dispatch=b_.bind(null,st,n),[s.memoizedState,n]},useRef:function(n){var e=Qs();return n={current:n},e.memoizedState=n},useState:lw,useDebugValue:V0,useDeferredValue:function(n){return Qs().memoizedState=n},useTransition:function(){var n=lw(!1),e=n[0];return n=w_.bind(null,n[1]),Qs().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var s=st,i=Qs();if(Ze){if(t===void 0)throw Error(G(407));t=t()}else{if(t=e(),Dt===null)throw Error(G(349));Ua&30||xx(s,e,t)}i.memoizedState=t;var r={value:t,getSnapshot:e};return i.queue=r,cw(Sx.bind(null,s,r,n),[n]),s.flags|=2048,Zu(9,Ax.bind(null,s,r,t,e),void 0,null),t},useId:function(){var n=Qs(),e=Dt.identifierPrefix;if(Ze){var t=sr,s=nr;t=(s&~(1<<32-zs(s)-1)).toString(32)+t,e=":"+e+"R"+t,t=qu++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=y_++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},S_={readContext:ys,useCallback:Rx,useContext:ys,useEffect:U0,useImperativeHandle:Nx,useInsertionEffect:kx,useLayoutEffect:Tx,useMemo:Mx,useReducer:jg,useRef:Cx,useState:function(){return jg(Qu)},useDebugValue:V0,useDeferredValue:function(n){var e=ws();return Lx(e,St.memoizedState,n)},useTransition:function(){var n=jg(Qu)[0],e=ws().memoizedState;return[n,e]},useMutableSource:wx,useSyncExternalStore:bx,useId:Ix,unstable_isNewReconciler:!1},E_={readContext:ys,useCallback:Rx,useContext:ys,useEffect:U0,useImperativeHandle:Nx,useInsertionEffect:kx,useLayoutEffect:Tx,useMemo:Mx,useReducer:zg,useRef:Cx,useState:function(){return zg(Qu)},useDebugValue:V0,useDeferredValue:function(n){var e=ws();return St===null?e.memoizedState=n:Lx(e,St.memoizedState,n)},useTransition:function(){var n=zg(Qu)[0],e=ws().memoizedState;return[n,e]},useMutableSource:wx,useSyncExternalStore:bx,useId:Ix,unstable_isNewReconciler:!1};function As(n,e){if(n&&n.defaultProps){e=it({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Nm(n,e,t,s){e=n.memoizedState,t=t(s,e),t=t==null?e:it({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var tg={isMounted:function(n){return(n=n._reactInternals)?Qa(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var s=fn(),i=ao(n),r=ir(s,i);r.payload=e,t!=null&&(r.callback=t),e=ro(n,r,i),e!==null&&($s(e,n,i,s),df(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var s=fn(),i=ao(n),r=ir(s,i);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=ro(n,r,i),e!==null&&($s(e,n,i,s),df(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=fn(),s=ao(n),i=ir(t,s);i.tag=2,e!=null&&(i.callback=e),e=ro(n,i,s),e!==null&&($s(e,n,s,t),df(e,n,s))}};function uw(n,e,t,s,i,r,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(s,r,o):e.prototype&&e.prototype.isPureReactComponent?!Vu(t,s)||!Vu(i,r):!0}function jx(n,e,t){var s=!1,i=ho,r=e.contextType;return typeof r=="object"&&r!==null?r=ys(r):(i=Rn(e)?Ha:sn.current,s=e.contextTypes,r=(s=s!=null)?Fc(n,i):ho),e=new e(t,r),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=tg,n.stateNode=e,e._reactInternals=n,s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=r),e}function hw(n,e,t,s){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==n&&tg.enqueueReplaceState(e,e.state,null)}function Rm(n,e,t,s){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},F0(n);var r=e.contextType;typeof r=="object"&&r!==null?i.context=ys(r):(r=Rn(e)?Ha:sn.current,i.context=Fc(n,r)),i.state=n.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(Nm(n,e,r,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&tg.enqueueReplaceState(i,i.state,null),up(n,t,i,s),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function $c(n,e){try{var t="",s=e;do t+=Z1(s),s=s.return;while(s);var i=t}catch(r){i=`
Error generating stack: `+r.message+`
`+r.stack}return{value:n,source:e,stack:i,digest:null}}function $g(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Mm(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var __=typeof WeakMap=="function"?WeakMap:Map;function zx(n,e,t){t=ir(-1,t),t.tag=3,t.payload={element:null};var s=e.value;return t.callback=function(){gp||(gp=!0,Bm=s),Mm(n,e)},t}function $x(n,e,t){t=ir(-1,t),t.tag=3;var s=n.type.getDerivedStateFromError;if(typeof s=="function"){var i=e.value;t.payload=function(){return s(i)},t.callback=function(){Mm(n,e)}}var r=n.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){Mm(n,e),typeof s!="function"&&(oo===null?oo=new Set([this]):oo.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function dw(n,e,t){var s=n.pingCache;if(s===null){s=n.pingCache=new __;var i=new Set;s.set(e,i)}else i=s.get(e),i===void 0&&(i=new Set,s.set(e,i));i.has(t)||(i.add(t),n=z_.bind(null,n,e,t),e.then(n,n))}function fw(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function pw(n,e,t,s,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ir(-1,1),e.tag=2,ro(t,e,1))),t.lanes|=1),n)}var C_=fr.ReactCurrentOwner,Pn=!1;function dn(n,e,t,s){e.child=n===null?gx(e,null,t,s):jc(e,n.child,t,s)}function gw(n,e,t,s,i){t=t.render;var r=e.ref;return Cl(e,i),s=H0(n,e,t,s,r,i),t=B0(),n!==null&&!Pn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ur(n,e,i)):(Ze&&t&&P0(e),e.flags|=1,dn(n,e,s,i),e.child)}function mw(n,e,t,s,i){if(n===null){var r=t.type;return typeof r=="function"&&!Z0(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,Hx(n,e,r,s,i)):(n=yf(t.type,null,s,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(r=n.child,!(n.lanes&i)){var o=r.memoizedProps;if(t=t.compare,t=t!==null?t:Vu,t(o,s)&&n.ref===e.ref)return ur(n,e,i)}return e.flags|=1,n=lo(r,s),n.ref=e.ref,n.return=e,e.child=n}function Hx(n,e,t,s,i){if(n!==null){var r=n.memoizedProps;if(Vu(r,s)&&n.ref===e.ref)if(Pn=!1,e.pendingProps=s=r,(n.lanes&i)!==0)n.flags&131072&&(Pn=!0);else return e.lanes=n.lanes,ur(n,e,i)}return Lm(n,e,t,s,i)}function Bx(n,e,t){var s=e.pendingProps,i=s.children,r=n!==null?n.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ve(wl,Xn),Xn|=t;else{if(!(t&1073741824))return n=r!==null?r.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ve(wl,Xn),Xn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=r!==null?r.baseLanes:t,Ve(wl,Xn),Xn|=s}else r!==null?(s=r.baseLanes|t,e.memoizedState=null):s=t,Ve(wl,Xn),Xn|=s;return dn(n,e,i,t),e.child}function Ux(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Lm(n,e,t,s,i){var r=Rn(t)?Ha:sn.current;return r=Fc(e,r),Cl(e,i),t=H0(n,e,t,s,r,i),s=B0(),n!==null&&!Pn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ur(n,e,i)):(Ze&&s&&P0(e),e.flags|=1,dn(n,e,t,i),e.child)}function vw(n,e,t,s,i){if(Rn(t)){var r=!0;rp(e)}else r=!1;if(Cl(e,i),e.stateNode===null)gf(n,e),jx(e,t,s),Rm(e,t,s,i),s=!0;else if(n===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=ys(u):(u=Rn(t)?Ha:sn.current,u=Fc(e,u));var h=t.getDerivedStateFromProps,d=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==s||c!==u)&&hw(e,o,s,u),wr=!1;var f=e.memoizedState;o.state=f,up(e,s,o,i),c=e.memoizedState,l!==s||f!==c||Nn.current||wr?(typeof h=="function"&&(Nm(e,t,h,s),c=e.memoizedState),(l=wr||uw(e,t,l,s,f,c,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=c),o.props=s,o.state=c,o.context=u,s=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,vx(n,e),l=e.memoizedProps,u=e.type===e.elementType?l:As(e.type,l),o.props=u,d=e.pendingProps,f=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=ys(c):(c=Rn(t)?Ha:sn.current,c=Fc(e,c));var p=t.getDerivedStateFromProps;(h=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==d||f!==c)&&hw(e,o,s,c),wr=!1,f=e.memoizedState,o.state=f,up(e,s,o,i);var y=e.memoizedState;l!==d||f!==y||Nn.current||wr?(typeof p=="function"&&(Nm(e,t,p,s),y=e.memoizedState),(u=wr||uw(e,t,u,s,f,y,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,y,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,y,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=y),o.props=s,o.state=y,o.context=c,s=u):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),s=!1)}return Im(n,e,t,s,r,i)}function Im(n,e,t,s,i,r){Ux(n,e);var o=(e.flags&128)!==0;if(!s&&!o)return i&&nw(e,t,!1),ur(n,e,r);s=e.stateNode,C_.current=e;var l=o&&typeof t.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,n!==null&&o?(e.child=jc(e,n.child,null,r),e.child=jc(e,null,l,r)):dn(n,e,l,r),e.memoizedState=s.state,i&&nw(e,t,!0),e.child}function Vx(n){var e=n.stateNode;e.pendingContext?tw(n,e.pendingContext,e.pendingContext!==e.context):e.context&&tw(n,e.context,!1),O0(n,e.containerInfo)}function yw(n,e,t,s,i){return Oc(),R0(i),e.flags|=256,dn(n,e,t,s),e.child}var Dm={dehydrated:null,treeContext:null,retryLane:0};function Fm(n){return{baseLanes:n,cachePool:null,transitions:null}}function Gx(n,e,t){var s=e.pendingProps,i=tt.current,r=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=n!==null&&n.memoizedState===null?!1:(i&2)!==0),l?(r=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Ve(tt,i&1),n===null)return Tm(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,n=s.fallback,r?(s=e.mode,r=e.child,o={mode:"hidden",children:o},!(s&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=ig(o,s,0,null),n=ja(n,s,t,null),r.return=e,n.return=e,r.sibling=n,e.child=r,e.child.memoizedState=Fm(t),e.memoizedState=Dm,n):G0(e,o));if(i=n.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return k_(n,e,o,s,l,i,t);if(r){r=s.fallback,o=e.mode,i=n.child,l=i.sibling;var c={mode:"hidden",children:s.children};return!(o&1)&&e.child!==i?(s=e.child,s.childLanes=0,s.pendingProps=c,e.deletions=null):(s=lo(i,c),s.subtreeFlags=i.subtreeFlags&14680064),l!==null?r=lo(l,r):(r=ja(r,o,t,null),r.flags|=2),r.return=e,s.return=e,s.sibling=r,e.child=s,s=r,r=e.child,o=n.child.memoizedState,o=o===null?Fm(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=n.childLanes&~t,e.memoizedState=Dm,s}return r=n.child,n=r.sibling,s=lo(r,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=t),s.return=e,s.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=s,e.memoizedState=null,s}function G0(n,e){return e=ig({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function qd(n,e,t,s){return s!==null&&R0(s),jc(e,n.child,null,t),n=G0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function k_(n,e,t,s,i,r,o){if(t)return e.flags&256?(e.flags&=-257,s=$g(Error(G(422))),qd(n,e,o,s)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(r=s.fallback,i=e.mode,s=ig({mode:"visible",children:s.children},i,0,null),r=ja(r,i,o,null),r.flags|=2,s.return=e,r.return=e,s.sibling=r,e.child=s,e.mode&1&&jc(e,n.child,null,o),e.child.memoizedState=Fm(o),e.memoizedState=Dm,r);if(!(e.mode&1))return qd(n,e,o,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var l=s.dgst;return s=l,r=Error(G(419)),s=$g(r,s,void 0),qd(n,e,o,s)}if(l=(o&n.childLanes)!==0,Pn||l){if(s=Dt,s!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|o)?0:i,i!==0&&i!==r.retryLane&&(r.retryLane=i,cr(n,i),$s(s,n,i,-1))}return Q0(),s=$g(Error(G(421))),qd(n,e,o,s)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=$_.bind(null,n),i._reactRetry=e,null):(n=r.treeContext,qn=io(i.nextSibling),Qn=e,Ze=!0,Os=null,n!==null&&(hs[ds++]=nr,hs[ds++]=sr,hs[ds++]=Ba,nr=n.id,sr=n.overflow,Ba=e),e=G0(e,s.children),e.flags|=4096,e)}function ww(n,e,t){n.lanes|=e;var s=n.alternate;s!==null&&(s.lanes|=e),Pm(n.return,e,t)}function Hg(n,e,t,s,i){var r=n.memoizedState;r===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:i}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=t,r.tailMode=i)}function Wx(n,e,t){var s=e.pendingProps,i=s.revealOrder,r=s.tail;if(dn(n,e,s.children,t),s=tt.current,s&2)s=s&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&ww(n,t,e);else if(n.tag===19)ww(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}s&=1}if(Ve(tt,s),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&hp(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Hg(e,!1,i,t,r);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&hp(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}Hg(e,!0,t,null,r);break;case"together":Hg(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function gf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ur(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Va|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(G(153));if(e.child!==null){for(n=e.child,t=lo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=lo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function T_(n,e,t){switch(e.tag){case 3:Vx(e),Oc();break;case 5:yx(e);break;case 1:Rn(e.type)&&rp(e);break;case 4:O0(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,i=e.memoizedProps.value;Ve(lp,s._currentValue),s._currentValue=i;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(Ve(tt,tt.current&1),e.flags|=128,null):t&e.child.childLanes?Gx(n,e,t):(Ve(tt,tt.current&1),n=ur(n,e,t),n!==null?n.sibling:null);Ve(tt,tt.current&1);break;case 19:if(s=(t&e.childLanes)!==0,n.flags&128){if(s)return Wx(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ve(tt,tt.current),s)break;return null;case 22:case 23:return e.lanes=0,Bx(n,e,t)}return ur(n,e,t)}var Xx,Om,Yx,Kx;Xx=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Om=function(){};Yx=function(n,e,t,s){var i=n.memoizedProps;if(i!==s){n=e.stateNode,Mo(yi.current);var r=null;switch(t){case"input":i=rm(n,i),s=rm(n,s),r=[];break;case"select":i=it({},i,{value:void 0}),s=it({},s,{value:void 0}),r=[];break;case"textarea":i=lm(n,i),s=lm(n,s),r=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(n.onclick=sp)}um(t,s);var o;t=null;for(u in i)if(!s.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ou.hasOwnProperty(u)?r||(r=[]):(r=r||[]).push(u,null));for(u in s){var c=s[u];if(l=i!=null?i[u]:void 0,s.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(r||(r=[]),r.push(u,t)),t=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(r=r||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(r=r||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ou.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&We("scroll",n),r||l===c||(r=[])):(r=r||[]).push(u,c))}t&&(r=r||[]).push("style",t);var u=r;(e.updateQueue=u)&&(e.flags|=4)}};Kx=function(n,e,t,s){t!==s&&(e.flags|=4)};function eu(n,e){if(!Ze)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:s.sibling=null}}function Wt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,s=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=s,n.childLanes=t,e}function P_(n,e,t){var s=e.pendingProps;switch(N0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(e),null;case 1:return Rn(e.type)&&ip(),Wt(e),null;case 3:return s=e.stateNode,zc(),Ye(Nn),Ye(sn),z0(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(n===null||n.child===null)&&(Yd(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Os!==null&&(Gm(Os),Os=null))),Om(n,e),Wt(e),null;case 5:j0(e);var i=Mo(Ku.current);if(t=e.type,n!==null&&e.stateNode!=null)Yx(n,e,t,s,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(G(166));return Wt(e),null}if(n=Mo(yi.current),Yd(e)){s=e.stateNode,t=e.type;var r=e.memoizedProps;switch(s[gi]=e,s[Xu]=r,n=(e.mode&1)!==0,t){case"dialog":We("cancel",s),We("close",s);break;case"iframe":case"object":case"embed":We("load",s);break;case"video":case"audio":for(i=0;i<cu.length;i++)We(cu[i],s);break;case"source":We("error",s);break;case"img":case"image":case"link":We("error",s),We("load",s);break;case"details":We("toggle",s);break;case"input":Ty(s,r),We("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!r.multiple},We("invalid",s);break;case"textarea":Ny(s,r),We("invalid",s)}um(t,r),i=null;for(var o in r)if(r.hasOwnProperty(o)){var l=r[o];o==="children"?typeof l=="string"?s.textContent!==l&&(r.suppressHydrationWarning!==!0&&Xd(s.textContent,l,n),i=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(r.suppressHydrationWarning!==!0&&Xd(s.textContent,l,n),i=["children",""+l]):Ou.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&We("scroll",s)}switch(t){case"input":zd(s),Py(s,r,!0);break;case"textarea":zd(s),Ry(s);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(s.onclick=sp)}s=i,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Sb(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof s.is=="string"?n=o.createElement(t,{is:s.is}):(n=o.createElement(t),t==="select"&&(o=n,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):n=o.createElementNS(n,t),n[gi]=e,n[Xu]=s,Xx(n,e,!1,!1),e.stateNode=n;e:{switch(o=hm(t,s),t){case"dialog":We("cancel",n),We("close",n),i=s;break;case"iframe":case"object":case"embed":We("load",n),i=s;break;case"video":case"audio":for(i=0;i<cu.length;i++)We(cu[i],n);i=s;break;case"source":We("error",n),i=s;break;case"img":case"image":case"link":We("error",n),We("load",n),i=s;break;case"details":We("toggle",n),i=s;break;case"input":Ty(n,s),i=rm(n,s),We("invalid",n);break;case"option":i=s;break;case"select":n._wrapperState={wasMultiple:!!s.multiple},i=it({},s,{value:void 0}),We("invalid",n);break;case"textarea":Ny(n,s),i=lm(n,s),We("invalid",n);break;default:i=s}um(t,i),l=i;for(r in l)if(l.hasOwnProperty(r)){var c=l[r];r==="style"?Cb(n,c):r==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Eb(n,c)):r==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&ju(n,c):typeof c=="number"&&ju(n,""+c):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(Ou.hasOwnProperty(r)?c!=null&&r==="onScroll"&&We("scroll",n):c!=null&&g0(n,r,c,o))}switch(t){case"input":zd(n),Py(n,s,!1);break;case"textarea":zd(n),Ry(n);break;case"option":s.value!=null&&n.setAttribute("value",""+uo(s.value));break;case"select":n.multiple=!!s.multiple,r=s.value,r!=null?Al(n,!!s.multiple,r,!1):s.defaultValue!=null&&Al(n,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=sp)}switch(t){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Wt(e),null;case 6:if(n&&e.stateNode!=null)Kx(n,e,n.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(G(166));if(t=Mo(Ku.current),Mo(yi.current),Yd(e)){if(s=e.stateNode,t=e.memoizedProps,s[gi]=e,(r=s.nodeValue!==t)&&(n=Qn,n!==null))switch(n.tag){case 3:Xd(s.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Xd(s.nodeValue,t,(n.mode&1)!==0)}r&&(e.flags|=4)}else s=(t.nodeType===9?t:t.ownerDocument).createTextNode(s),s[gi]=e,e.stateNode=s}return Wt(e),null;case 13:if(Ye(tt),s=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ze&&qn!==null&&e.mode&1&&!(e.flags&128))fx(),Oc(),e.flags|=98560,r=!1;else if(r=Yd(e),s!==null&&s.dehydrated!==null){if(n===null){if(!r)throw Error(G(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(G(317));r[gi]=e}else Oc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Wt(e),r=!1}else Os!==null&&(Gm(Os),Os=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(s=s!==null,s!==(n!==null&&n.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(n===null||tt.current&1?Et===0&&(Et=3):Q0())),e.updateQueue!==null&&(e.flags|=4),Wt(e),null);case 4:return zc(),Om(n,e),n===null&&Gu(e.stateNode.containerInfo),Wt(e),null;case 10:return I0(e.type._context),Wt(e),null;case 17:return Rn(e.type)&&ip(),Wt(e),null;case 19:if(Ye(tt),r=e.memoizedState,r===null)return Wt(e),null;if(s=(e.flags&128)!==0,o=r.rendering,o===null)if(s)eu(r,!1);else{if(Et!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=hp(n),o!==null){for(e.flags|=128,eu(r,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=t,t=e.child;t!==null;)r=t,n=s,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=n,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,n=o.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ve(tt,tt.current&1|2),e.child}n=n.sibling}r.tail!==null&&dt()>Hc&&(e.flags|=128,s=!0,eu(r,!1),e.lanes=4194304)}else{if(!s)if(n=hp(o),n!==null){if(e.flags|=128,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),eu(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!Ze)return Wt(e),null}else 2*dt()-r.renderingStartTime>Hc&&t!==1073741824&&(e.flags|=128,s=!0,eu(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(t=r.last,t!==null?t.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=dt(),e.sibling=null,t=tt.current,Ve(tt,s?t&1|2:t&1),e):(Wt(e),null);case 22:case 23:return q0(),s=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?Xn&1073741824&&(Wt(e),e.subtreeFlags&6&&(e.flags|=8192)):Wt(e),null;case 24:return null;case 25:return null}throw Error(G(156,e.tag))}function N_(n,e){switch(N0(e),e.tag){case 1:return Rn(e.type)&&ip(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return zc(),Ye(Nn),Ye(sn),z0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return j0(e),null;case 13:if(Ye(tt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(G(340));Oc()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Ye(tt),null;case 4:return zc(),null;case 10:return I0(e.type._context),null;case 22:case 23:return q0(),null;case 24:return null;default:return null}}var Qd=!1,tn=!1,R_=typeof WeakSet=="function"?WeakSet:Set,re=null;function yl(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(s){lt(n,e,s)}else t.current=null}function jm(n,e,t){try{t()}catch(s){lt(n,e,s)}}var bw=!1;function M_(n,e){if(xm=ep,n=ex(),T0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var i=s.anchorOffset,r=s.focusNode;s=s.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=n,f=null;t:for(;;){for(var p;d!==t||i!==0&&d.nodeType!==3||(l=o+i),d!==r||s!==0&&d.nodeType!==3||(c=o+s),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===n)break t;if(f===t&&++u===i&&(l=o),f===r&&++h===s&&(c=o),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}t=l===-1||c===-1?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(Am={focusedElem:n,selectionRange:t},ep=!1,re=e;re!==null;)if(e=re,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,re=n;else for(;re!==null;){e=re;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var w=y.memoizedProps,_=y.memoizedState,m=e.stateNode,v=m.getSnapshotBeforeUpdate(e.elementType===e.type?w:As(e.type,w),_);m.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(G(163))}}catch(x){lt(e,e.return,x)}if(n=e.sibling,n!==null){n.return=e.return,re=n;break}re=e.return}return y=bw,bw=!1,y}function Mu(n,e,t){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&n)===n){var r=i.destroy;i.destroy=void 0,r!==void 0&&jm(e,t,r)}i=i.next}while(i!==s)}}function ng(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var s=t.create;t.destroy=s()}t=t.next}while(t!==e)}}function zm(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function qx(n){var e=n.alternate;e!==null&&(n.alternate=null,qx(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[gi],delete e[Xu],delete e[_m],delete e[p_],delete e[g_])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Qx(n){return n.tag===5||n.tag===3||n.tag===4}function xw(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Qx(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function $m(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=sp));else if(s!==4&&(n=n.child,n!==null))for($m(n,e,t),n=n.sibling;n!==null;)$m(n,e,t),n=n.sibling}function Hm(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(s!==4&&(n=n.child,n!==null))for(Hm(n,e,t),n=n.sibling;n!==null;)Hm(n,e,t),n=n.sibling}var Ht=null,Fs=!1;function gr(n,e,t){for(t=t.child;t!==null;)Zx(n,e,t),t=t.sibling}function Zx(n,e,t){if(vi&&typeof vi.onCommitFiberUnmount=="function")try{vi.onCommitFiberUnmount(Yp,t)}catch{}switch(t.tag){case 5:tn||yl(t,e);case 6:var s=Ht,i=Fs;Ht=null,gr(n,e,t),Ht=s,Fs=i,Ht!==null&&(Fs?(n=Ht,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Ht.removeChild(t.stateNode));break;case 18:Ht!==null&&(Fs?(n=Ht,t=t.stateNode,n.nodeType===8?Ig(n.parentNode,t):n.nodeType===1&&Ig(n,t),Bu(n)):Ig(Ht,t.stateNode));break;case 4:s=Ht,i=Fs,Ht=t.stateNode.containerInfo,Fs=!0,gr(n,e,t),Ht=s,Fs=i;break;case 0:case 11:case 14:case 15:if(!tn&&(s=t.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var r=i,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&jm(t,e,o),i=i.next}while(i!==s)}gr(n,e,t);break;case 1:if(!tn&&(yl(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=t.memoizedProps,s.state=t.memoizedState,s.componentWillUnmount()}catch(l){lt(t,e,l)}gr(n,e,t);break;case 21:gr(n,e,t);break;case 22:t.mode&1?(tn=(s=tn)||t.memoizedState!==null,gr(n,e,t),tn=s):gr(n,e,t);break;default:gr(n,e,t)}}function Aw(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new R_),e.forEach(function(s){var i=H_.bind(null,n,s);t.has(s)||(t.add(s),s.then(i,i))})}}function bs(n,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var i=t[s];try{var r=n,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:Ht=l.stateNode,Fs=!1;break e;case 3:Ht=l.stateNode.containerInfo,Fs=!0;break e;case 4:Ht=l.stateNode.containerInfo,Fs=!0;break e}l=l.return}if(Ht===null)throw Error(G(160));Zx(r,o,i),Ht=null,Fs=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(u){lt(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Jx(e,n),e=e.sibling}function Jx(n,e){var t=n.alternate,s=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(bs(e,n),Xs(n),s&4){try{Mu(3,n,n.return),ng(3,n)}catch(w){lt(n,n.return,w)}try{Mu(5,n,n.return)}catch(w){lt(n,n.return,w)}}break;case 1:bs(e,n),Xs(n),s&512&&t!==null&&yl(t,t.return);break;case 5:if(bs(e,n),Xs(n),s&512&&t!==null&&yl(t,t.return),n.flags&32){var i=n.stateNode;try{ju(i,"")}catch(w){lt(n,n.return,w)}}if(s&4&&(i=n.stateNode,i!=null)){var r=n.memoizedProps,o=t!==null?t.memoizedProps:r,l=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{l==="input"&&r.type==="radio"&&r.name!=null&&xb(i,r),hm(l,o);var u=hm(l,r);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];h==="style"?Cb(i,d):h==="dangerouslySetInnerHTML"?Eb(i,d):h==="children"?ju(i,d):g0(i,h,d,u)}switch(l){case"input":om(i,r);break;case"textarea":Ab(i,r);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!r.multiple;var p=r.value;p!=null?Al(i,!!r.multiple,p,!1):f!==!!r.multiple&&(r.defaultValue!=null?Al(i,!!r.multiple,r.defaultValue,!0):Al(i,!!r.multiple,r.multiple?[]:"",!1))}i[Xu]=r}catch(w){lt(n,n.return,w)}}break;case 6:if(bs(e,n),Xs(n),s&4){if(n.stateNode===null)throw Error(G(162));i=n.stateNode,r=n.memoizedProps;try{i.nodeValue=r}catch(w){lt(n,n.return,w)}}break;case 3:if(bs(e,n),Xs(n),s&4&&t!==null&&t.memoizedState.isDehydrated)try{Bu(e.containerInfo)}catch(w){lt(n,n.return,w)}break;case 4:bs(e,n),Xs(n);break;case 13:bs(e,n),Xs(n),i=n.child,i.flags&8192&&(r=i.memoizedState!==null,i.stateNode.isHidden=r,!r||i.alternate!==null&&i.alternate.memoizedState!==null||(Y0=dt())),s&4&&Aw(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(tn=(u=tn)||h,bs(e,n),tn=u):bs(e,n),Xs(n),s&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(re=n,h=n.child;h!==null;){for(d=re=h;re!==null;){switch(f=re,p=f.child,f.tag){case 0:case 11:case 14:case 15:Mu(4,f,f.return);break;case 1:yl(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){s=f,t=f.return;try{e=s,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(w){lt(s,t,w)}}break;case 5:yl(f,f.return);break;case 22:if(f.memoizedState!==null){Ew(d);continue}}p!==null?(p.return=f,re=p):Ew(d)}h=h.sibling}e:for(h=null,d=n;;){if(d.tag===5){if(h===null){h=d;try{i=d.stateNode,u?(r=i.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(l=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=_b("display",o))}catch(w){lt(n,n.return,w)}}}else if(d.tag===6){if(h===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(w){lt(n,n.return,w)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:bs(e,n),Xs(n),s&4&&Aw(n);break;case 21:break;default:bs(e,n),Xs(n)}}function Xs(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Qx(t)){var s=t;break e}t=t.return}throw Error(G(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(ju(i,""),s.flags&=-33);var r=xw(n);Hm(n,r,i);break;case 3:case 4:var o=s.stateNode.containerInfo,l=xw(n);$m(n,l,o);break;default:throw Error(G(161))}}catch(c){lt(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function L_(n,e,t){re=n,eA(n)}function eA(n,e,t){for(var s=(n.mode&1)!==0;re!==null;){var i=re,r=i.child;if(i.tag===22&&s){var o=i.memoizedState!==null||Qd;if(!o){var l=i.alternate,c=l!==null&&l.memoizedState!==null||tn;l=Qd;var u=tn;if(Qd=o,(tn=c)&&!u)for(re=i;re!==null;)o=re,c=o.child,o.tag===22&&o.memoizedState!==null?_w(i):c!==null?(c.return=o,re=c):_w(i);for(;r!==null;)re=r,eA(r),r=r.sibling;re=i,Qd=l,tn=u}Sw(n)}else i.subtreeFlags&8772&&r!==null?(r.return=i,re=r):Sw(n)}}function Sw(n){for(;re!==null;){var e=re;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:tn||ng(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!tn)if(t===null)s.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:As(e.type,t.memoizedProps);s.componentDidUpdate(i,t.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&aw(e,r,s);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}aw(e,o,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var d=h.dehydrated;d!==null&&Bu(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(G(163))}tn||e.flags&512&&zm(e)}catch(f){lt(e,e.return,f)}}if(e===n){re=null;break}if(t=e.sibling,t!==null){t.return=e.return,re=t;break}re=e.return}}function Ew(n){for(;re!==null;){var e=re;if(e===n){re=null;break}var t=e.sibling;if(t!==null){t.return=e.return,re=t;break}re=e.return}}function _w(n){for(;re!==null;){var e=re;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{ng(4,e)}catch(c){lt(e,t,c)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var i=e.return;try{s.componentDidMount()}catch(c){lt(e,i,c)}}var r=e.return;try{zm(e)}catch(c){lt(e,r,c)}break;case 5:var o=e.return;try{zm(e)}catch(c){lt(e,o,c)}}}catch(c){lt(e,e.return,c)}if(e===n){re=null;break}var l=e.sibling;if(l!==null){l.return=e.return,re=l;break}re=e.return}}var I_=Math.ceil,pp=fr.ReactCurrentDispatcher,W0=fr.ReactCurrentOwner,ms=fr.ReactCurrentBatchConfig,Re=0,Dt=null,gt=null,Ut=0,Xn=0,wl=vo(0),Et=0,Ju=null,Va=0,sg=0,X0=0,Lu=null,Tn=null,Y0=0,Hc=1/0,Ci=null,gp=!1,Bm=null,oo=null,Zd=!1,eo=null,mp=0,Iu=0,Um=null,mf=-1,vf=0;function fn(){return Re&6?dt():mf!==-1?mf:mf=dt()}function ao(n){return n.mode&1?Re&2&&Ut!==0?Ut&-Ut:v_.transition!==null?(vf===0&&(vf=jb()),vf):(n=je,n!==0||(n=window.event,n=n===void 0?16:Gb(n.type)),n):1}function $s(n,e,t,s){if(50<Iu)throw Iu=0,Um=null,Error(G(185));Pd(n,t,s),(!(Re&2)||n!==Dt)&&(n===Dt&&(!(Re&2)&&(sg|=t),Et===4&&xr(n,Ut)),Mn(n,s),t===1&&Re===0&&!(e.mode&1)&&(Hc=dt()+500,Jp&&yo()))}function Mn(n,e){var t=n.callbackNode;vE(n,e);var s=Jf(n,n===Dt?Ut:0);if(s===0)t!==null&&Iy(t),n.callbackNode=null,n.callbackPriority=0;else if(e=s&-s,n.callbackPriority!==e){if(t!=null&&Iy(t),e===1)n.tag===0?m_(Cw.bind(null,n)):ux(Cw.bind(null,n)),d_(function(){!(Re&6)&&yo()}),t=null;else{switch(zb(s)){case 1:t=b0;break;case 4:t=Fb;break;case 16:t=Zf;break;case 536870912:t=Ob;break;default:t=Zf}t=lA(t,tA.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function tA(n,e){if(mf=-1,vf=0,Re&6)throw Error(G(327));var t=n.callbackNode;if(kl()&&n.callbackNode!==t)return null;var s=Jf(n,n===Dt?Ut:0);if(s===0)return null;if(s&30||s&n.expiredLanes||e)e=vp(n,s);else{e=s;var i=Re;Re|=2;var r=sA();(Dt!==n||Ut!==e)&&(Ci=null,Hc=dt()+500,Oa(n,e));do try{O_();break}catch(l){nA(n,l)}while(!0);L0(),pp.current=r,Re=i,gt!==null?e=0:(Dt=null,Ut=0,e=Et)}if(e!==0){if(e===2&&(i=mm(n),i!==0&&(s=i,e=Vm(n,i))),e===1)throw t=Ju,Oa(n,0),xr(n,s),Mn(n,dt()),t;if(e===6)xr(n,s);else{if(i=n.current.alternate,!(s&30)&&!D_(i)&&(e=vp(n,s),e===2&&(r=mm(n),r!==0&&(s=r,e=Vm(n,r))),e===1))throw t=Ju,Oa(n,0),xr(n,s),Mn(n,dt()),t;switch(n.finishedWork=i,n.finishedLanes=s,e){case 0:case 1:throw Error(G(345));case 2:Ao(n,Tn,Ci);break;case 3:if(xr(n,s),(s&130023424)===s&&(e=Y0+500-dt(),10<e)){if(Jf(n,0)!==0)break;if(i=n.suspendedLanes,(i&s)!==s){fn(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=Em(Ao.bind(null,n,Tn,Ci),e);break}Ao(n,Tn,Ci);break;case 4:if(xr(n,s),(s&4194240)===s)break;for(e=n.eventTimes,i=-1;0<s;){var o=31-zs(s);r=1<<o,o=e[o],o>i&&(i=o),s&=~r}if(s=i,s=dt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*I_(s/1960))-s,10<s){n.timeoutHandle=Em(Ao.bind(null,n,Tn,Ci),s);break}Ao(n,Tn,Ci);break;case 5:Ao(n,Tn,Ci);break;default:throw Error(G(329))}}}return Mn(n,dt()),n.callbackNode===t?tA.bind(null,n):null}function Vm(n,e){var t=Lu;return n.current.memoizedState.isDehydrated&&(Oa(n,e).flags|=256),n=vp(n,e),n!==2&&(e=Tn,Tn=t,e!==null&&Gm(e)),n}function Gm(n){Tn===null?Tn=n:Tn.push.apply(Tn,n)}function D_(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var s=0;s<t.length;s++){var i=t[s],r=i.getSnapshot;i=i.value;try{if(!Hs(r(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function xr(n,e){for(e&=~X0,e&=~sg,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-zs(e),s=1<<t;n[t]=-1,e&=~s}}function Cw(n){if(Re&6)throw Error(G(327));kl();var e=Jf(n,0);if(!(e&1))return Mn(n,dt()),null;var t=vp(n,e);if(n.tag!==0&&t===2){var s=mm(n);s!==0&&(e=s,t=Vm(n,s))}if(t===1)throw t=Ju,Oa(n,0),xr(n,e),Mn(n,dt()),t;if(t===6)throw Error(G(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Ao(n,Tn,Ci),Mn(n,dt()),null}function K0(n,e){var t=Re;Re|=1;try{return n(e)}finally{Re=t,Re===0&&(Hc=dt()+500,Jp&&yo())}}function Ga(n){eo!==null&&eo.tag===0&&!(Re&6)&&kl();var e=Re;Re|=1;var t=ms.transition,s=je;try{if(ms.transition=null,je=1,n)return n()}finally{je=s,ms.transition=t,Re=e,!(Re&6)&&yo()}}function q0(){Xn=wl.current,Ye(wl)}function Oa(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,h_(t)),gt!==null)for(t=gt.return;t!==null;){var s=t;switch(N0(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&ip();break;case 3:zc(),Ye(Nn),Ye(sn),z0();break;case 5:j0(s);break;case 4:zc();break;case 13:Ye(tt);break;case 19:Ye(tt);break;case 10:I0(s.type._context);break;case 22:case 23:q0()}t=t.return}if(Dt=n,gt=n=lo(n.current,null),Ut=Xn=e,Et=0,Ju=null,X0=sg=Va=0,Tn=Lu=null,Ro!==null){for(e=0;e<Ro.length;e++)if(t=Ro[e],s=t.interleaved,s!==null){t.interleaved=null;var i=s.next,r=t.pending;if(r!==null){var o=r.next;r.next=i,s.next=o}t.pending=s}Ro=null}return n}function nA(n,e){do{var t=gt;try{if(L0(),ff.current=fp,dp){for(var s=st.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}dp=!1}if(Ua=0,It=St=st=null,Ru=!1,qu=0,W0.current=null,t===null||t.return===null){Et=1,Ju=e,gt=null;break}e:{var r=n,o=t.return,l=t,c=e;if(e=Ut,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,h=l,d=h.tag;if(!(h.mode&1)&&(d===0||d===11||d===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=fw(o);if(p!==null){p.flags&=-257,pw(p,o,l,r,e),p.mode&1&&dw(r,u,e),e=p,c=u;var y=e.updateQueue;if(y===null){var w=new Set;w.add(c),e.updateQueue=w}else y.add(c);break e}else{if(!(e&1)){dw(r,u,e),Q0();break e}c=Error(G(426))}}else if(Ze&&l.mode&1){var _=fw(o);if(_!==null){!(_.flags&65536)&&(_.flags|=256),pw(_,o,l,r,e),R0($c(c,l));break e}}r=c=$c(c,l),Et!==4&&(Et=2),Lu===null?Lu=[r]:Lu.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var m=zx(r,c,e);ow(r,m);break e;case 1:l=c;var v=r.type,E=r.stateNode;if(!(r.flags&128)&&(typeof v.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(oo===null||!oo.has(E)))){r.flags|=65536,e&=-e,r.lanes|=e;var x=$x(r,l,e);ow(r,x);break e}}r=r.return}while(r!==null)}rA(t)}catch(C){e=C,gt===t&&t!==null&&(gt=t=t.return);continue}break}while(!0)}function sA(){var n=pp.current;return pp.current=fp,n===null?fp:n}function Q0(){(Et===0||Et===3||Et===2)&&(Et=4),Dt===null||!(Va&268435455)&&!(sg&268435455)||xr(Dt,Ut)}function vp(n,e){var t=Re;Re|=2;var s=sA();(Dt!==n||Ut!==e)&&(Ci=null,Oa(n,e));do try{F_();break}catch(i){nA(n,i)}while(!0);if(L0(),Re=t,pp.current=s,gt!==null)throw Error(G(261));return Dt=null,Ut=0,Et}function F_(){for(;gt!==null;)iA(gt)}function O_(){for(;gt!==null&&!lE();)iA(gt)}function iA(n){var e=aA(n.alternate,n,Xn);n.memoizedProps=n.pendingProps,e===null?rA(n):gt=e,W0.current=null}function rA(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=N_(t,e),t!==null){t.flags&=32767,gt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Et=6,gt=null;return}}else if(t=P_(t,e,Xn),t!==null){gt=t;return}if(e=e.sibling,e!==null){gt=e;return}gt=e=n}while(e!==null);Et===0&&(Et=5)}function Ao(n,e,t){var s=je,i=ms.transition;try{ms.transition=null,je=1,j_(n,e,t,s)}finally{ms.transition=i,je=s}return null}function j_(n,e,t,s){do kl();while(eo!==null);if(Re&6)throw Error(G(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(G(177));n.callbackNode=null,n.callbackPriority=0;var r=t.lanes|t.childLanes;if(yE(n,r),n===Dt&&(gt=Dt=null,Ut=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Zd||(Zd=!0,lA(Zf,function(){return kl(),null})),r=(t.flags&15990)!==0,t.subtreeFlags&15990||r){r=ms.transition,ms.transition=null;var o=je;je=1;var l=Re;Re|=4,W0.current=null,M_(n,t),Jx(t,n),i_(Am),ep=!!xm,Am=xm=null,n.current=t,L_(t),cE(),Re=l,je=o,ms.transition=r}else n.current=t;if(Zd&&(Zd=!1,eo=n,mp=i),r=n.pendingLanes,r===0&&(oo=null),dE(t.stateNode),Mn(n,dt()),e!==null)for(s=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],s(i.value,{componentStack:i.stack,digest:i.digest});if(gp)throw gp=!1,n=Bm,Bm=null,n;return mp&1&&n.tag!==0&&kl(),r=n.pendingLanes,r&1?n===Um?Iu++:(Iu=0,Um=n):Iu=0,yo(),null}function kl(){if(eo!==null){var n=zb(mp),e=ms.transition,t=je;try{if(ms.transition=null,je=16>n?16:n,eo===null)var s=!1;else{if(n=eo,eo=null,mp=0,Re&6)throw Error(G(331));var i=Re;for(Re|=4,re=n.current;re!==null;){var r=re,o=r.child;if(re.flags&16){var l=r.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(re=u;re!==null;){var h=re;switch(h.tag){case 0:case 11:case 15:Mu(8,h,r)}var d=h.child;if(d!==null)d.return=h,re=d;else for(;re!==null;){h=re;var f=h.sibling,p=h.return;if(qx(h),h===u){re=null;break}if(f!==null){f.return=p,re=f;break}re=p}}}var y=r.alternate;if(y!==null){var w=y.child;if(w!==null){y.child=null;do{var _=w.sibling;w.sibling=null,w=_}while(w!==null)}}re=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,re=o;else e:for(;re!==null;){if(r=re,r.flags&2048)switch(r.tag){case 0:case 11:case 15:Mu(9,r,r.return)}var m=r.sibling;if(m!==null){m.return=r.return,re=m;break e}re=r.return}}var v=n.current;for(re=v;re!==null;){o=re;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,re=E;else e:for(o=v;re!==null;){if(l=re,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:ng(9,l)}}catch(C){lt(l,l.return,C)}if(l===o){re=null;break e}var x=l.sibling;if(x!==null){x.return=l.return,re=x;break e}re=l.return}}if(Re=i,yo(),vi&&typeof vi.onPostCommitFiberRoot=="function")try{vi.onPostCommitFiberRoot(Yp,n)}catch{}s=!0}return s}finally{je=t,ms.transition=e}}return!1}function kw(n,e,t){e=$c(t,e),e=zx(n,e,1),n=ro(n,e,1),e=fn(),n!==null&&(Pd(n,1,e),Mn(n,e))}function lt(n,e,t){if(n.tag===3)kw(n,n,t);else for(;e!==null;){if(e.tag===3){kw(e,n,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(oo===null||!oo.has(s))){n=$c(t,n),n=$x(e,n,1),e=ro(e,n,1),n=fn(),e!==null&&(Pd(e,1,n),Mn(e,n));break}}e=e.return}}function z_(n,e,t){var s=n.pingCache;s!==null&&s.delete(e),e=fn(),n.pingedLanes|=n.suspendedLanes&t,Dt===n&&(Ut&t)===t&&(Et===4||Et===3&&(Ut&130023424)===Ut&&500>dt()-Y0?Oa(n,0):X0|=t),Mn(n,e)}function oA(n,e){e===0&&(n.mode&1?(e=Bd,Bd<<=1,!(Bd&130023424)&&(Bd=4194304)):e=1);var t=fn();n=cr(n,e),n!==null&&(Pd(n,e,t),Mn(n,t))}function $_(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),oA(n,t)}function H_(n,e){var t=0;switch(n.tag){case 13:var s=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:s=n.stateNode;break;default:throw Error(G(314))}s!==null&&s.delete(e),oA(n,t)}var aA;aA=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Nn.current)Pn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Pn=!1,T_(n,e,t);Pn=!!(n.flags&131072)}else Pn=!1,Ze&&e.flags&1048576&&hx(e,ap,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;gf(n,e),n=e.pendingProps;var i=Fc(e,sn.current);Cl(e,t),i=H0(null,e,s,n,i,t);var r=B0();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Rn(s)?(r=!0,rp(e)):r=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,F0(e),i.updater=tg,e.stateNode=i,i._reactInternals=e,Rm(e,s,n,t),e=Im(null,e,s,!0,r,t)):(e.tag=0,Ze&&r&&P0(e),dn(null,e,i,t),e=e.child),e;case 16:s=e.elementType;e:{switch(gf(n,e),n=e.pendingProps,i=s._init,s=i(s._payload),e.type=s,i=e.tag=U_(s),n=As(s,n),i){case 0:e=Lm(null,e,s,n,t);break e;case 1:e=vw(null,e,s,n,t);break e;case 11:e=gw(null,e,s,n,t);break e;case 14:e=mw(null,e,s,As(s.type,n),t);break e}throw Error(G(306,s,""))}return e;case 0:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:As(s,i),Lm(n,e,s,i,t);case 1:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:As(s,i),vw(n,e,s,i,t);case 3:e:{if(Vx(e),n===null)throw Error(G(387));s=e.pendingProps,r=e.memoizedState,i=r.element,vx(n,e),up(e,s,null,t);var o=e.memoizedState;if(s=o.element,r.isDehydrated)if(r={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){i=$c(Error(G(423)),e),e=yw(n,e,s,t,i);break e}else if(s!==i){i=$c(Error(G(424)),e),e=yw(n,e,s,t,i);break e}else for(qn=io(e.stateNode.containerInfo.firstChild),Qn=e,Ze=!0,Os=null,t=gx(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Oc(),s===i){e=ur(n,e,t);break e}dn(n,e,s,t)}e=e.child}return e;case 5:return yx(e),n===null&&Tm(e),s=e.type,i=e.pendingProps,r=n!==null?n.memoizedProps:null,o=i.children,Sm(s,i)?o=null:r!==null&&Sm(s,r)&&(e.flags|=32),Ux(n,e),dn(n,e,o,t),e.child;case 6:return n===null&&Tm(e),null;case 13:return Gx(n,e,t);case 4:return O0(e,e.stateNode.containerInfo),s=e.pendingProps,n===null?e.child=jc(e,null,s,t):dn(n,e,s,t),e.child;case 11:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:As(s,i),gw(n,e,s,i,t);case 7:return dn(n,e,e.pendingProps,t),e.child;case 8:return dn(n,e,e.pendingProps.children,t),e.child;case 12:return dn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(s=e.type._context,i=e.pendingProps,r=e.memoizedProps,o=i.value,Ve(lp,s._currentValue),s._currentValue=o,r!==null)if(Hs(r.value,o)){if(r.children===i.children&&!Nn.current){e=ur(n,e,t);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var l=r.dependencies;if(l!==null){o=r.child;for(var c=l.firstContext;c!==null;){if(c.context===s){if(r.tag===1){c=ir(-1,t&-t),c.tag=2;var u=r.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}r.lanes|=t,c=r.alternate,c!==null&&(c.lanes|=t),Pm(r.return,t,e),l.lanes|=t;break}c=c.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(G(341));o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),Pm(o,t,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}dn(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps.children,Cl(e,t),i=ys(i),s=s(i),e.flags|=1,dn(n,e,s,t),e.child;case 14:return s=e.type,i=As(s,e.pendingProps),i=As(s.type,i),mw(n,e,s,i,t);case 15:return Hx(n,e,e.type,e.pendingProps,t);case 17:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:As(s,i),gf(n,e),e.tag=1,Rn(s)?(n=!0,rp(e)):n=!1,Cl(e,t),jx(e,s,i),Rm(e,s,i,t),Im(null,e,s,!0,n,t);case 19:return Wx(n,e,t);case 22:return Bx(n,e,t)}throw Error(G(156,e.tag))};function lA(n,e){return Db(n,e)}function B_(n,e,t,s){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gs(n,e,t,s){return new B_(n,e,t,s)}function Z0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function U_(n){if(typeof n=="function")return Z0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===v0)return 11;if(n===y0)return 14}return 2}function lo(n,e){var t=n.alternate;return t===null?(t=gs(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function yf(n,e,t,s,i,r){var o=2;if(s=n,typeof n=="function")Z0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case cl:return ja(t.children,i,r,e);case m0:o=8,i|=8;break;case tm:return n=gs(12,t,e,i|2),n.elementType=tm,n.lanes=r,n;case nm:return n=gs(13,t,e,i),n.elementType=nm,n.lanes=r,n;case sm:return n=gs(19,t,e,i),n.elementType=sm,n.lanes=r,n;case yb:return ig(t,i,r,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case mb:o=10;break e;case vb:o=9;break e;case v0:o=11;break e;case y0:o=14;break e;case yr:o=16,s=null;break e}throw Error(G(130,n==null?n:typeof n,""))}return e=gs(o,t,e,i),e.elementType=n,e.type=s,e.lanes=r,e}function ja(n,e,t,s){return n=gs(7,n,s,e),n.lanes=t,n}function ig(n,e,t,s){return n=gs(22,n,s,e),n.elementType=yb,n.lanes=t,n.stateNode={isHidden:!1},n}function Bg(n,e,t){return n=gs(6,n,null,e),n.lanes=t,n}function Ug(n,e,t){return e=gs(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function V_(n,e,t,s,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Sg(0),this.expirationTimes=Sg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Sg(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function J0(n,e,t,s,i,r,o,l,c){return n=new V_(n,e,t,l,c),e===1?(e=1,r===!0&&(e|=8)):e=0,r=gs(3,null,null,e),n.current=r,r.stateNode=n,r.memoizedState={element:s,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},F0(r),n}function G_(n,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ll,key:s==null?null:""+s,children:n,containerInfo:e,implementation:t}}function cA(n){if(!n)return ho;n=n._reactInternals;e:{if(Qa(n)!==n||n.tag!==1)throw Error(G(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Rn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(G(171))}if(n.tag===1){var t=n.type;if(Rn(t))return cx(n,t,e)}return e}function uA(n,e,t,s,i,r,o,l,c){return n=J0(t,s,!0,n,i,r,o,l,c),n.context=cA(null),t=n.current,s=fn(),i=ao(t),r=ir(s,i),r.callback=e??null,ro(t,r,i),n.current.lanes=i,Pd(n,i,s),Mn(n,s),n}function rg(n,e,t,s){var i=e.current,r=fn(),o=ao(i);return t=cA(t),e.context===null?e.context=t:e.pendingContext=t,e=ir(r,o),e.payload={element:n},s=s===void 0?null:s,s!==null&&(e.callback=s),n=ro(i,e,o),n!==null&&($s(n,i,o,r),df(n,i,o)),o}function yp(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Tw(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function ey(n,e){Tw(n,e),(n=n.alternate)&&Tw(n,e)}function W_(){return null}var hA=typeof reportError=="function"?reportError:function(n){console.error(n)};function ty(n){this._internalRoot=n}og.prototype.render=ty.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(G(409));rg(n,e,null,null)};og.prototype.unmount=ty.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Ga(function(){rg(null,n,null,null)}),e[lr]=null}};function og(n){this._internalRoot=n}og.prototype.unstable_scheduleHydration=function(n){if(n){var e=Bb();n={blockedOn:null,target:n,priority:e};for(var t=0;t<br.length&&e!==0&&e<br[t].priority;t++);br.splice(t,0,n),t===0&&Vb(n)}};function ny(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function ag(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Pw(){}function X_(n,e,t,s,i){if(i){if(typeof s=="function"){var r=s;s=function(){var u=yp(o);r.call(u)}}var o=uA(e,s,n,0,null,!1,!1,"",Pw);return n._reactRootContainer=o,n[lr]=o.current,Gu(n.nodeType===8?n.parentNode:n),Ga(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof s=="function"){var l=s;s=function(){var u=yp(c);l.call(u)}}var c=J0(n,0,!1,null,null,!1,!1,"",Pw);return n._reactRootContainer=c,n[lr]=c.current,Gu(n.nodeType===8?n.parentNode:n),Ga(function(){rg(e,c,t,s)}),c}function lg(n,e,t,s,i){var r=t._reactRootContainer;if(r){var o=r;if(typeof i=="function"){var l=i;i=function(){var c=yp(o);l.call(c)}}rg(e,o,n,i)}else o=X_(t,e,n,i,s);return yp(o)}$b=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=lu(e.pendingLanes);t!==0&&(x0(e,t|1),Mn(e,dt()),!(Re&6)&&(Hc=dt()+500,yo()))}break;case 13:Ga(function(){var s=cr(n,1);if(s!==null){var i=fn();$s(s,n,1,i)}}),ey(n,1)}};A0=function(n){if(n.tag===13){var e=cr(n,134217728);if(e!==null){var t=fn();$s(e,n,134217728,t)}ey(n,134217728)}};Hb=function(n){if(n.tag===13){var e=ao(n),t=cr(n,e);if(t!==null){var s=fn();$s(t,n,e,s)}ey(n,e)}};Bb=function(){return je};Ub=function(n,e){var t=je;try{return je=n,e()}finally{je=t}};fm=function(n,e,t){switch(e){case"input":if(om(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==n&&s.form===n.form){var i=Zp(s);if(!i)throw Error(G(90));bb(s),om(s,i)}}}break;case"textarea":Ab(n,t);break;case"select":e=t.value,e!=null&&Al(n,!!t.multiple,e,!1)}};Pb=K0;Nb=Ga;var Y_={usingClientEntryPoint:!1,Events:[Rd,fl,Zp,kb,Tb,K0]},tu={findFiberByHostInstance:No,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},K_={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:fr.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Lb(n),n===null?null:n.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||W_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Jd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jd.isDisabled&&Jd.supportsFiber)try{Yp=Jd.inject(K_),vi=Jd}catch{}}es.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Y_;es.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ny(e))throw Error(G(200));return G_(n,e,null,t)};es.createRoot=function(n,e){if(!ny(n))throw Error(G(299));var t=!1,s="",i=hA;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=J0(n,1,!1,null,null,t,!1,s,i),n[lr]=e.current,Gu(n.nodeType===8?n.parentNode:n),new ty(e)};es.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(G(188)):(n=Object.keys(n).join(","),Error(G(268,n)));return n=Lb(e),n=n===null?null:n.stateNode,n};es.flushSync=function(n){return Ga(n)};es.hydrate=function(n,e,t){if(!ag(e))throw Error(G(200));return lg(null,n,e,!0,t)};es.hydrateRoot=function(n,e,t){if(!ny(n))throw Error(G(405));var s=t!=null&&t.hydratedSources||null,i=!1,r="",o=hA;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=uA(e,null,n,1,t??null,i,!1,r,o),n[lr]=e.current,Gu(n),s)for(n=0;n<s.length;n++)t=s[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new og(e)};es.render=function(n,e,t){if(!ag(e))throw Error(G(200));return lg(null,n,e,!1,t)};es.unmountComponentAtNode=function(n){if(!ag(n))throw Error(G(40));return n._reactRootContainer?(Ga(function(){lg(null,null,n,!1,function(){n._reactRootContainer=null,n[lr]=null})}),!0):!1};es.unstable_batchedUpdates=K0;es.unstable_renderSubtreeIntoContainer=function(n,e,t,s){if(!ag(t))throw Error(G(200));if(n==null||n._reactInternals===void 0)throw Error(G(38));return lg(n,e,t,!1,s)};es.version="18.3.1-next-f1338f8080-20240426";function dA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(dA)}catch(n){console.error(n)}}dA(),db.exports=es;var q_=db.exports,Nw=q_;Jg.createRoot=Nw.createRoot,Jg.hydrateRoot=Nw.hydrateRoot;function fA(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=fA(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function wt(){for(var n,e,t=0,s="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=fA(n))&&(s&&(s+=" "),s+=e);return s}const Q_=({tabs:n,activeTabId:e,onTabChange:t,onTabAdd:s,onTabRemove:i,onTabRename:r,onFileSelect:o})=>{const[l,c]=k.useState(null),[u,h]=k.useState(""),[d,f]=k.useState(null),p=k.useCallback(_=>{c(_.id),h(_.name)},[]),y=k.useCallback(()=>{l&&u.trim()&&r(l,u.trim()),c(null),h("")},[l,u,r]),w=k.useCallback(_=>{_.key==="Enter"?y():_.key==="Escape"&&(c(null),h(""))},[y]);return S.jsxs("div",{className:"flex items-center bg-tab-bg border-b border-gray-700 h-tabs overflow-x-auto",children:[S.jsxs("div",{className:"flex items-center",children:[n.map(_=>S.jsx("div",{className:wt("tab-item relative group",{active:_.id===e}),onClick:()=>t(_.id),children:l===_.id?S.jsx("input",{type:"text",value:u,onChange:m=>h(m.target.value),onBlur:y,onKeyDown:w,className:"bg-gray-700 text-white px-2 py-1 rounded text-sm",autoFocus:!0,onClick:m=>m.stopPropagation()}):S.jsxs(S.Fragment,{children:[S.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",onMouseEnter:()=>f(_.id),onMouseLeave:()=>f(null),onDoubleClick:()=>p(_),children:[S.jsx("span",{className:"text-sm text-white whitespace-nowrap",children:_.currentPage}),S.jsx("span",{className:"text-sm text-gray-400",children:"-"}),S.jsx("div",{className:"overflow-hidden max-w-[150px]",children:S.jsx("span",{className:wt("text-sm text-white whitespace-nowrap inline-block",d===_.id&&"animate-scroll"),children:_.fileName||_.name})})]}),n.length>1&&S.jsx("button",{onClick:m=>{m.stopPropagation(),i(_.id)},className:"ml-2 opacity-0 group-hover:opacity-100 transition-opacity text-white",children:""})]})},_.id)),n.length<10&&S.jsx("button",{onClick:s,className:"px-4 py-2 hover:bg-gray-600 transition-colors",title:"Add new tab (Max 10)",children:"+"})]}),S.jsxs("div",{className:"ml-auto px-4 text-xs text-gray-400",children:[n.length,"/10 tabs"]})]})};var Du={};Du.d=(n,e)=>{for(var t in e)Du.o(e,t)&&!Du.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};Du.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var ye=globalThis.pdfjsLib={};Du.d(ye,{AbortException:()=>fo,AnnotationEditorLayer:()=>e0,AnnotationEditorParamsType:()=>Ne,AnnotationEditorType:()=>Ae,AnnotationEditorUIManager:()=>Xa,AnnotationLayer:()=>Wk,AnnotationMode:()=>Ar,ColorPicker:()=>Ep,DOMSVGFactory:()=>hy,DrawLayer:()=>s0,FeatureTest:()=>pn,GlobalWorkerOptions:()=>tr,ImageKind:()=>wf,InvalidPDFException:()=>Xm,MissingPDFException:()=>eh,OPS:()=>Ss,OutputScale:()=>Km,PDFDataRangeTransport:()=>gS,PDFDateString:()=>ay,PDFWorker:()=>Pl,PasswordResponses:()=>tC,PermissionFlag:()=>eC,PixelsPerInch:()=>po,RenderingCancelledException:()=>ry,TextLayer:()=>th,TouchManager:()=>Ap,UnexpectedResponseException:()=>wp,Util:()=>ue,VerbosityLevel:()=>cg,XfaLayer:()=>vS,build:()=>Ck,createValidAbsoluteUrl:()=>rC,fetchData:()=>fg,getDocument:()=>vk,getFilenameFromUrl:()=>pC,getPdfFilenameFromUrl:()=>gC,getXfaPageViewport:()=>mC,isDataScheme:()=>pg,isPdfFile:()=>oy,noContextMenu:()=>Bs,normalizeUnicode:()=>hC,setLayerDimensions:()=>Wa,shadow:()=>ke,stopEvent:()=>Kn,version:()=>_k});const nn=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),pA=[1,0,0,1,0,0],Wm=[.001,0,0,.001,0,0],Z_=1e7,Vg=1.35,Wn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ar={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},J_="pdfjs_internal_editor_",Ae={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Ne={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},eC={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Xt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},wf={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},yt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},nu={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},cg={ERRORS:0,WARNINGS:1,INFOS:5},Ss={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},tC={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let ug=cg.WARNINGS;function nC(n){Number.isInteger(n)&&(ug=n)}function sC(){return ug}function hg(n){ug>=cg.INFOS&&console.log(`Info: ${n}`)}function Se(n){ug>=cg.WARNINGS&&console.log(`Warning: ${n}`)}function Be(n){throw new Error(n)}function mt(n,e){n||Be(e)}function iC(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function rC(n,e=null,t=null){if(!n)return null;try{if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const i=n.match(/\./g);(i==null?void 0:i.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=uC(n)}catch{}}const s=e?new URL(n,e):new URL(n);if(iC(s))return s}catch{}return null}function ke(n,e,t,s=!1){return Object.defineProperty(n,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const wo=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class Rw extends wo{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Gg extends wo{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Xm extends wo{constructor(e){super(e,"InvalidPDFException")}}class eh extends wo{constructor(e){super(e,"MissingPDFException")}}class wp extends wo{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class oC extends wo{constructor(e){super(e,"FormatError")}}class fo extends wo{constructor(e){super(e,"AbortException")}}function gA(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&Be("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const s=[];for(let i=0;i<e;i+=t){const r=Math.min(i+t,e),o=n.subarray(i,r);s.push(String.fromCharCode.apply(null,o))}return s.join("")}function dg(n){typeof n!="string"&&Be("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=n.charCodeAt(s)&255;return t}function aC(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function sy(n){const e=Object.create(null);for(const[t,s]of n)e[t]=s;return e}function lC(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function cC(){try{return new Function(""),!0}catch{return!1}}class pn{static get isLittleEndian(){return ke(this,"isLittleEndian",lC())}static get isEvalSupported(){return ke(this,"isEvalSupported",cC())}static get isOffscreenCanvasSupported(){return ke(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return ke(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?ke(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):ke(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return ke(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Wg=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var rr,bf,Ym;class ue{static makeHexColor(e,t,s){return`#${Wg[e]}${Wg[t]}${Wg[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const s=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[s,i]}static applyInverseTransform(e,t){const s=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/s,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/s;return[i,r]}static getAxialAlignedBoundingBox(e,t){const s=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),r=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(s[0],i[0],r[0],o[0]),Math.min(s[1],i[1],r[1],o[1]),Math.max(s[0],i[0],r[0],o[0]),Math.max(s[1],i[1],r[1],o[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],s=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],l=(s+o)/2,c=Math.sqrt((s+o)**2-4*(s*o-r*i))/2,u=l+c||1,h=l-c||1;return[Math.sqrt(u),Math.sqrt(h)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[s,r,i,o]}static bezierBoundingBox(e,t,s,i,r,o,l,c,u){return u?(u[0]=Math.min(u[0],e,l),u[1]=Math.min(u[1],t,c),u[2]=Math.max(u[2],e,l),u[3]=Math.max(u[3],t,c)):u=[Math.min(e,l),Math.min(t,c),Math.max(e,l),Math.max(t,c)],A(this,rr,Ym).call(this,e,s,r,l,t,i,o,c,3*(-e+3*(s-r)+l),6*(e-2*s+r),3*(s-e),u),A(this,rr,Ym).call(this,e,s,r,l,t,i,o,c,3*(-t+3*(i-o)+c),6*(t-2*i+o),3*(i-t),u),u}}rr=new WeakSet,bf=function(e,t,s,i,r,o,l,c,u,h){if(u<=0||u>=1)return;const d=1-u,f=u*u,p=f*u,y=d*(d*(d*e+3*u*t)+3*f*s)+p*i,w=d*(d*(d*r+3*u*o)+3*f*l)+p*c;h[0]=Math.min(h[0],y),h[1]=Math.min(h[1],w),h[2]=Math.max(h[2],y),h[3]=Math.max(h[3],w)},Ym=function(e,t,s,i,r,o,l,c,u,h,d,f){if(Math.abs(u)<1e-12){Math.abs(h)>=1e-12&&A(this,rr,bf).call(this,e,t,s,i,r,o,l,c,-d/h,f);return}const p=h**2-4*d*u;if(p<0)return;const y=Math.sqrt(p),w=2*u;A(this,rr,bf).call(this,e,t,s,i,r,o,l,c,(-h+y)/w,f),A(this,rr,bf).call(this,e,t,s,i,r,o,l,c,(-h-y)/w,f)},b(ue,rr);function uC(n){return decodeURIComponent(escape(n))}let Xg=null,Mw=null;function hC(n){return Xg||(Xg=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Mw=new Map([["","t"]])),n.replaceAll(Xg,(e,t,s)=>t?t.normalize("NFKC"):Mw.get(s))}function dC(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),gA(n)}const iy="pdfjs_internal_id_";function fC(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(gA(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});const Si="http://www.w3.org/2000/svg",Co=class Co{};V(Co,"CSS",96),V(Co,"PDF",72),V(Co,"PDF_TO_CSS_UNITS",Co.CSS/Co.PDF);let po=Co;async function fg(n,e="text"){if(uu(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class Ld{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:r=0,offsetY:o=0,dontFlip:l=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=r,this.offsetY=o,s*=t;const c=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let h,d,f,p;switch(i%=360,i<0&&(i+=360),i){case 180:h=-1,d=0,f=0,p=1;break;case 90:h=0,d=1,f=1,p=0;break;case 270:h=0,d=-1,f=-1,p=0;break;case 0:h=1,d=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(f=-f,p=-p);let y,w,_,m;h===0?(y=Math.abs(u-e[1])*s+r,w=Math.abs(c-e[0])*s+o,_=(e[3]-e[1])*s,m=(e[2]-e[0])*s):(y=Math.abs(c-e[0])*s+r,w=Math.abs(u-e[1])*s+o,_=(e[2]-e[0])*s,m=(e[3]-e[1])*s),this.transform=[h*s,d*s,f*s,p*s,y-h*s*c-f*s*u,w-d*s*c-p*s*u],this.width=_,this.height=m}get rawDims(){const{userUnit:e,viewBox:t}=this,s=t.map(i=>i*e);return ke(this,"rawDims",{pageWidth:s[2]-s[0],pageHeight:s[3]-s[1],pageX:s[0],pageY:s[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new Ld({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){return ue.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=ue.applyTransform([e[0],e[1]],this.transform),s=ue.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){return ue.applyInverseTransform([e,t],this.transform)}}class ry extends wo{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function pg(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function oy(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function pC(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function gC(n,e="document.pdf"){if(typeof n!="string")return e;if(pg(n))return Se('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(n);let r=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(r&&(r=r[0],r.includes("%")))try{r=s.exec(decodeURIComponent(r))[0]}catch{}return r||e}class Lw{constructor(){V(this,"started",Object.create(null));V(this,"times",[])}time(e){e in this.started&&Se(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Se(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:r}of this.times)e.push(`${s.padEnd(t)} ${r-i}ms
`);return e.join("")}}function uu(n,e){try{const{protocol:t}=e?new URL(n,e):new URL(n);return t==="http:"||t==="https:"}catch{return!1}}function Bs(n){n.preventDefault()}function Kn(n){n.preventDefault(),n.stopPropagation()}var sh;class ay{static toDateObject(e){if(!e||typeof e!="string")return null;a(this,sh)||g(this,sh,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=a(this,sh).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let l=parseInt(t[5],10);l=l>=0&&l<=59?l:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const u=t[7]||"Z";let h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,u==="-"?(o+=h,l+=d):u==="+"&&(o-=h,l-=d),new Date(Date.UTC(s,i,r,o,l,c))}}sh=new WeakMap,b(ay,sh);function mC(n,{scale:e=1,rotation:t=0}){const{width:s,height:i}=n.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new Ld({viewBox:r,userUnit:1,scale:e,rotation:t})}function ly(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Se(`Not a valid color format: "${n}"`),[0,0,0])}function vC(n){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of n.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;n.set(t,ly(s))}e.remove()}function qe(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform();return[e,t,s,i,r,o]}function Ys(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform().invertSelf();return[e,t,s,i,r,o]}function Wa(n,e,t=!1,s=!0){if(e instanceof Ld){const{pageWidth:i,pageHeight:r}=e.rawDims,{style:o}=n,l=pn.isCSSRoundSupported,c=`var(--scale-factor) * ${i}px`,u=`var(--scale-factor) * ${r}px`,h=l?`round(down, ${c}, var(--scale-round-x, 1px))`:`calc(${c})`,d=l?`round(down, ${u}, var(--scale-round-y, 1px))`:`calc(${u})`;!t||e.rotation%180===0?(o.width=h,o.height=d):(o.width=d,o.height=h)}s&&n.setAttribute("data-main-rotation",e.rotation)}class Km{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var Sr,Lo,Es,Io,ih,rh,Tp,mA,gn,vA,yA,xf,wA,Qm;const ki=class ki{constructor(e){b(this,gn);b(this,Sr,null);b(this,Lo,null);b(this,Es);b(this,Io,null);b(this,ih,null);g(this,Es,e),a(ki,rh)||g(ki,rh,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=g(this,Sr,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=a(this,Es)._uiManager._signal;e.addEventListener("contextmenu",Bs,{signal:t}),e.addEventListener("pointerdown",A(ki,Tp,mA),{signal:t});const s=g(this,Io,document.createElement("div"));s.className="buttons",e.append(s);const i=a(this,Es).toolbarPosition;if(i){const{style:r}=e,o=a(this,Es)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return A(this,gn,wA).call(this),e}get div(){return a(this,Sr)}hide(){var e;a(this,Sr).classList.add("hidden"),(e=a(this,Lo))==null||e.hideDropdown()}show(){var e;a(this,Sr).classList.remove("hidden"),(e=a(this,ih))==null||e.shown()}async addAltText(e){const t=await e.render();A(this,gn,xf).call(this,t),a(this,Io).prepend(t,a(this,gn,Qm)),g(this,ih,e)}addColorPicker(e){g(this,Lo,e);const t=e.renderButton();A(this,gn,xf).call(this,t),a(this,Io).prepend(t,a(this,gn,Qm))}remove(){var e;a(this,Sr).remove(),(e=a(this,Lo))==null||e.destroy(),g(this,Lo,null)}};Sr=new WeakMap,Lo=new WeakMap,Es=new WeakMap,Io=new WeakMap,ih=new WeakMap,rh=new WeakMap,Tp=new WeakSet,mA=function(e){e.stopPropagation()},gn=new WeakSet,vA=function(e){a(this,Es)._focusEventsAllowed=!1,Kn(e)},yA=function(e){a(this,Es)._focusEventsAllowed=!0,Kn(e)},xf=function(e){const t=a(this,Es)._uiManager._signal;e.addEventListener("focusin",A(this,gn,vA).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",A(this,gn,yA).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Bs,{signal:t})},wA=function(){const{editorType:e,_uiManager:t}=a(this,Es),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",a(ki,rh)[e]),A(this,gn,xf).call(this,s),s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),a(this,Io).append(s)},Qm=function(){const e=document.createElement("div");return e.className="divider",e},b(ki,Tp),b(ki,rh,null);let qm=ki;var oh,Do,Fo,go,bA,xA,AA;class yC{constructor(e){b(this,go);b(this,oh,null);b(this,Do,null);b(this,Fo);g(this,Fo,e)}show(e,t,s){const[i,r]=A(this,go,xA).call(this,t,s),{style:o}=a(this,Do)||g(this,Do,A(this,go,bA).call(this));e.append(a(this,Do)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){a(this,Do).remove()}}oh=new WeakMap,Do=new WeakMap,Fo=new WeakMap,go=new WeakSet,bA=function(){const e=g(this,Do,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Bs,{signal:a(this,Fo)._signal});const t=g(this,oh,document.createElement("div"));return t.className="buttons",e.append(t),A(this,go,AA).call(this),e},xA=function(e,t){let s=0,i=0;for(const r of e){const o=r.y+r.height;if(o<s)continue;const l=r.x+(t?r.width:0);if(o>s){i=l,s=o;continue}t?l>i&&(i=l):l<i&&(i=l)}return[t?1-i:i,s]},AA=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=a(this,Fo)._signal;e.addEventListener("contextmenu",Bs,{signal:s}),e.addEventListener("click",()=>{a(this,Fo).highlightSelection("floating_button")},{signal:s}),a(this,oh).append(e)};function bp(n,e,t){for(const s of t)e.addEventListener(s,n[s].bind(n))}var Pp;class wC{constructor(){b(this,Pp,0)}get id(){return`${J_}${on(this,Pp)._++}`}}Pp=new WeakMap;var Nl,ah,qt,Rl,Af;const fy=class fy{constructor(){b(this,Rl);b(this,Nl,dC());b(this,ah,0);b(this,qt,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return ke(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:r}=e;return A(this,Rl,Af).call(this,`${t}_${s}_${i}_${r}`,e)}async getFromUrl(e){return A(this,Rl,Af).call(this,e,e)}async getFromBlob(e,t){const s=await t;return A(this,Rl,Af).call(this,e,s)}async getFromId(e){a(this,qt)||g(this,qt,new Map);const t=a(this,qt).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){a(this,qt)||g(this,qt,new Map);let s=a(this,qt).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${a(this,Nl)}_${on(this,ah)._++}`,refCounter:1,isSvg:!1},a(this,qt).set(e,s),a(this,qt).set(s.id,s),s}getSvgUrl(e){const t=a(this,qt).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;a(this,qt)||g(this,qt,new Map);const t=a(this,qt).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(s.width,s.height);r.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=r.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${a(this,Nl)}_`)}};Nl=new WeakMap,ah=new WeakMap,qt=new WeakMap,Rl=new WeakSet,Af=async function(e,t){a(this,qt)||g(this,qt,new Map);let s=a(this,qt).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${a(this,Nl)}_${on(this,ah)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await fg(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const r=fy._isSVGFittingCanvas,o=new FileReader,l=new Image,c=new Promise((u,h)=>{l.onload=()=>{s.bitmap=l,s.isSvg=!0,u()},o.onload=async()=>{const d=s.svgUrl=o.result;l.src=await r?`${d}#svgView(preserveAspectRatio(none))`:d},l.onerror=o.onerror=h});o.readAsDataURL(i),await c}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){Se(i),s=null}return a(this,qt).set(e,s),s&&a(this,qt).set(s.id,s),s};let Zm=fy;var ut,Er,lh,Je;class bC{constructor(e=128){b(this,ut,[]);b(this,Er,!1);b(this,lh);b(this,Je,-1);g(this,lh,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:l=!1}){if(i&&e(),a(this,Er))return;const c={cmd:e,undo:t,post:s,type:r};if(a(this,Je)===-1){a(this,ut).length>0&&(a(this,ut).length=0),g(this,Je,0),a(this,ut).push(c);return}if(o&&a(this,ut)[a(this,Je)].type===r){l&&(c.undo=a(this,ut)[a(this,Je)].undo),a(this,ut)[a(this,Je)]=c;return}const u=a(this,Je)+1;u===a(this,lh)?a(this,ut).splice(0,1):(g(this,Je,u),u<a(this,ut).length&&a(this,ut).splice(u)),a(this,ut).push(c)}undo(){if(a(this,Je)===-1)return;g(this,Er,!0);const{undo:e,post:t}=a(this,ut)[a(this,Je)];e(),t==null||t(),g(this,Er,!1),g(this,Je,a(this,Je)-1)}redo(){if(a(this,Je)<a(this,ut).length-1){g(this,Je,a(this,Je)+1),g(this,Er,!0);const{cmd:e,post:t}=a(this,ut)[a(this,Je)];e(),t==null||t(),g(this,Er,!1)}}hasSomethingToUndo(){return a(this,Je)!==-1}hasSomethingToRedo(){return a(this,Je)<a(this,ut).length-1}cleanType(e){if(a(this,Je)!==-1){for(let t=a(this,Je);t>=0;t--)if(a(this,ut)[t].type!==e){a(this,ut).splice(t+1,a(this,Je)-t),g(this,Je,t);return}a(this,ut).length=0,g(this,Je,-1)}}destroy(){g(this,ut,null)}}ut=new WeakMap,Er=new WeakMap,lh=new WeakMap,Je=new WeakMap;var Np,SA;class Id{constructor(e){b(this,Np);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=pn.platform;for(const[s,i,r={}]of e)for(const o of s){const l=o.startsWith("mac+");t&&l?(this.callbacks.set(o.slice(4),{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!l&&(this.callbacks.set(o,{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(A(this,Np,SA).call(this,t));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:o=[],checker:l=null}}=s;l&&!l(e,t)||(i.bind(e,...o,t)(),r||Kn(t))}}Np=new WeakSet,SA=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Rp=class Rp{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return vC(e),ke(this,"_colors",e)}convert(e){const t=ly(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((r,o)=>r===t[o]))return Rp._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?ue.makeHexColor(...t):e}};V(Rp,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Jm=Rp;var Ml,In,xt,Ft,Ll,Ni,Il,is,_r,Oo,Dl,jo,Zs,_s,zo,ch,uh,Fl,hh,Js,Cr,Ol,kr,ei,Mp,Tr,dh,Pr,$o,fh,ph,Tt,Fe,Ri,Ho,gh,mh,Nr,ti,Mi,vh,rs,J,Sf,ev,EA,_A,Ef,CA,kA,TA,tv,PA,nv,sv,NA,an,Ei,RA,MA,iv,LA,hu,rv;const bl=class bl{constructor(e,t,s,i,r,o,l,c,u,h,d,f,p){b(this,J);b(this,Ml,new AbortController);b(this,In,null);b(this,xt,new Map);b(this,Ft,new Map);b(this,Ll,null);b(this,Ni,null);b(this,Il,null);b(this,is,new bC);b(this,_r,null);b(this,Oo,null);b(this,Dl,0);b(this,jo,new Set);b(this,Zs,null);b(this,_s,null);b(this,zo,new Set);V(this,"_editorUndoBar",null);b(this,ch,!1);b(this,uh,!1);b(this,Fl,!1);b(this,hh,null);b(this,Js,null);b(this,Cr,null);b(this,Ol,null);b(this,kr,!1);b(this,ei,null);b(this,Mp,new wC);b(this,Tr,!1);b(this,dh,!1);b(this,Pr,null);b(this,$o,null);b(this,fh,null);b(this,ph,null);b(this,Tt,Ae.NONE);b(this,Fe,new Set);b(this,Ri,null);b(this,Ho,null);b(this,gh,null);b(this,mh,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});b(this,Nr,[0,0]);b(this,ti,null);b(this,Mi,null);b(this,vh,null);b(this,rs,null);const y=this._signal=a(this,Ml).signal;g(this,Mi,e),g(this,vh,t),g(this,Ll,s),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:y}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),i._on("setpreference",this.onSetPreference.bind(this),{signal:y}),i._on("switchannotationeditorparams",w=>this.updateParams(w.type,w.value),{signal:y}),A(this,J,CA).call(this),A(this,J,NA).call(this),A(this,J,tv).call(this),g(this,Ni,r.annotationStorage),g(this,hh,r.filterFactory),g(this,Ho,o),g(this,Ol,l||null),g(this,ch,c),g(this,uh,u),g(this,Fl,h),g(this,ph,d||null),this.viewParameters={realScale:po.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=p!==!1}static get _keyboardManager(){const e=bl.prototype,t=o=>a(o,Mi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:l})=>{if(l instanceof HTMLInputElement){const{type:c}=l;return c!=="text"&&c!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return ke(this,"_keyboardManager",new Id([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&a(o,Mi).contains(l)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&a(o,Mi).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,s,i,r;(e=a(this,rs))==null||e.resolve(),g(this,rs,null),(t=a(this,Ml))==null||t.abort(),g(this,Ml,null),this._signal=null;for(const o of a(this,Ft).values())o.destroy();a(this,Ft).clear(),a(this,xt).clear(),a(this,zo).clear(),g(this,In,null),a(this,Fe).clear(),a(this,is).destroy(),(s=a(this,Ll))==null||s.destroy(),(i=a(this,ei))==null||i.hide(),g(this,ei,null),a(this,Js)&&(clearTimeout(a(this,Js)),g(this,Js,null)),a(this,ti)&&(clearTimeout(a(this,ti)),g(this,ti,null)),(r=this._editorUndoBar)==null||r.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return a(this,ph)}get useNewAltTextFlow(){return a(this,uh)}get useNewAltTextWhenAddingImage(){return a(this,Fl)}get hcmFilter(){return ke(this,"hcmFilter",a(this,Ho)?a(this,hh).addHCMFilter(a(this,Ho).foreground,a(this,Ho).background):"none")}get direction(){return ke(this,"direction",getComputedStyle(a(this,Mi)).direction)}get highlightColors(){return ke(this,"highlightColors",a(this,Ol)?new Map(a(this,Ol).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return ke(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),g(this,Oo,e)}setMainHighlightColorPicker(e){g(this,fh,e)}editAltText(e,t=!1){var s;(s=a(this,Ll))==null||s.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":g(this,Fl,t);break}}onPageChanging({pageNumber:e}){g(this,Dl,e-1)}focusMainContainer(){a(this,Mi).focus()}findParent(e,t){for(const s of a(this,Ft).values()){const{x:i,y:r,width:o,height:l}=s.div.getBoundingClientRect();if(e>=i&&e<=i+o&&t>=r&&t<=r+l)return s}return null}disableUserSelect(e=!1){a(this,vh).classList.toggle("noUserSelect",e)}addShouldRescale(e){a(this,zo).add(e)}removeShouldRescale(e){a(this,zo).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*po.PDF_TO_CSS_UNITS;for(const s of a(this,zo))s.onScaleChanging();(t=a(this,Oo))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:o}=t,l=t.toString(),u=A(this,J,Sf).call(this,t).closest(".textLayer"),h=this.getSelectionBoxes(u);if(!h)return;t.empty();const d=A(this,J,ev).call(this,u),f=a(this,Tt)===Ae.NONE,p=()=>{d==null||d.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:h,anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:o,text:l}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(Ae.HIGHLIGHT,p);return}p()}addToAnnotationStorage(e){!e.isEmpty()&&a(this,Ni)&&!a(this,Ni).has(e.id)&&a(this,Ni).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,a(this,kr)&&(g(this,kr,!1),A(this,J,Ef).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of a(this,Fe))if(t.div.contains(e)){g(this,$o,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!a(this,$o))return;const[e,t]=a(this,$o);g(this,$o,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){A(this,J,tv).call(this),A(this,J,nv).call(this)}removeEditListeners(){A(this,J,PA).call(this),A(this,J,sv).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of a(this,_s))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of a(this,_s))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=a(this,In))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of a(this,Fe)){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const o of a(this,_s))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){Se(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const c of s){const u=await i.deserialize(c);if(!u)return;r.push(u)}const o=()=>{for(const c of r)A(this,J,iv).call(this,c);A(this,J,rv).call(this,r)},l=()=>{for(const c of r)c.remove()};this.addCommands({cmd:o,undo:l,mustExec:!0})}catch(r){Se(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),a(this,Tt)!==Ae.NONE&&!this.isEditorHandlingKeyboard&&bl._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,a(this,kr)&&(g(this,kr,!1),A(this,J,Ef).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(A(this,J,kA).call(this),A(this,J,nv).call(this),A(this,J,an).call(this,{isEditing:a(this,Tt)!==Ae.NONE,isEmpty:A(this,J,hu).call(this),hasSomethingToUndo:a(this,is).hasSomethingToUndo(),hasSomethingToRedo:a(this,is).hasSomethingToRedo(),hasSelectedEditor:!1})):(A(this,J,TA).call(this),A(this,J,sv).call(this),A(this,J,an).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!a(this,_s)){g(this,_s,e);for(const t of a(this,_s))A(this,J,Ei).call(this,t.defaultPropertiesToUpdate)}}getId(){return a(this,Mp).id}get currentLayer(){return a(this,Ft).get(a(this,Dl))}getLayer(e){return a(this,Ft).get(e)}get currentPageIndex(){return a(this,Dl)}addLayer(e){a(this,Ft).set(e.pageIndex,e),a(this,Tr)?e.enable():e.disable()}removeLayer(e){a(this,Ft).delete(e.pageIndex)}async updateMode(e,t=null,s=!1){var i;if(a(this,Tt)!==e&&!(a(this,rs)&&(await a(this,rs).promise,!a(this,rs)))){if(g(this,rs,Promise.withResolvers()),g(this,Tt,e),e===Ae.NONE){this.setEditingState(!1),A(this,J,MA).call(this),(i=this._editorUndoBar)==null||i.hide(),a(this,rs).resolve();return}this.setEditingState(!0),await A(this,J,RA).call(this),this.unselectAll();for(const r of a(this,Ft).values())r.updateMode(e);if(!t){s&&this.addNewEditorFromKeyboard(),a(this,rs).resolve();return}for(const r of a(this,xt).values())r.annotationElementId===t?(this.setSelected(r),r.enterInEditMode()):r.unselect();a(this,rs).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==a(this,Tt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var s;if(a(this,_s)){switch(e){case Ne.CREATE:this.currentLayer.addNewEditor();return;case Ne.HIGHLIGHT_DEFAULT_COLOR:(s=a(this,fh))==null||s.updateColor(t);break;case Ne.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(a(this,gh)||g(this,gh,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const i of a(this,Fe))i.updateParams(e,t);for(const i of a(this,_s))i.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var r;for(const o of a(this,xt).values())o.editorType===e&&o.show(t);(((r=a(this,gh))==null?void 0:r.get(Ne.HIGHLIGHT_SHOW_ALL))??!0)!==t&&A(this,J,Ei).call(this,[[Ne.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(a(this,dh)!==e){g(this,dh,e);for(const t of a(this,Ft).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const s of a(this,xt).values())s.pageIndex===e&&t.push(s);return t}getEditor(e){return a(this,xt).get(e)}addEditor(e){a(this,xt).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(a(this,Js)&&clearTimeout(a(this,Js)),g(this,Js,setTimeout(()=>{this.focusMainContainer(),g(this,Js,null)},0))),a(this,xt).delete(e.id),this.unselect(e),(!e.annotationElementId||!a(this,jo).has(e.annotationElementId))&&((t=a(this,Ni))==null||t.remove(e.id))}addDeletedAnnotationElement(e){a(this,jo).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return a(this,jo).has(e)}removeDeletedAnnotationElement(e){a(this,jo).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){a(this,In)!==e&&(g(this,In,e),e&&A(this,J,Ei).call(this,e.propertiesToUpdate))}updateUI(e){a(this,J,LA)===e&&A(this,J,Ei).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){A(this,J,Ei).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(a(this,Fe).has(e)){a(this,Fe).delete(e),e.unselect(),A(this,J,an).call(this,{hasSelectedEditor:this.hasSelection});return}a(this,Fe).add(e),e.select(),A(this,J,Ei).call(this,e.propertiesToUpdate),A(this,J,an).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=a(this,Oo))==null||t.commitOrRemove();for(const s of a(this,Fe))s!==e&&s.unselect();a(this,Fe).clear(),a(this,Fe).add(e),e.select(),A(this,J,Ei).call(this,e.propertiesToUpdate),A(this,J,an).call(this,{hasSelectedEditor:!0})}isSelected(e){return a(this,Fe).has(e)}get firstSelectedEditor(){return a(this,Fe).values().next().value}unselect(e){e.unselect(),a(this,Fe).delete(e),A(this,J,an).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return a(this,Fe).size!==0}get isEnterHandled(){return a(this,Fe).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;a(this,is).undo(),A(this,J,an).call(this,{hasSomethingToUndo:a(this,is).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:A(this,J,hu).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){a(this,is).redo(),A(this,J,an).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:a(this,is).hasSomethingToRedo(),isEmpty:A(this,J,hu).call(this)})}addCommands(e){a(this,is).add(e),A(this,J,an).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:A(this,J,hu).call(this)})}cleanUndoStack(e){a(this,is).cleanType(e)}delete(){var r;this.commitOrRemove();const e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...a(this,Fe)],s=()=>{var o;(o=this._editorUndoBar)==null||o.show(i,t.length===1?t[0].editorType:t.length);for(const l of t)l.remove()},i=()=>{for(const o of t)A(this,J,iv).call(this,o)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=a(this,In))==null||e.commitOrRemove()}hasSomethingToControl(){return a(this,In)||this.hasSelection}selectAll(){for(const e of a(this,Fe))e.commit();A(this,J,rv).call(this,a(this,xt).values())}unselectAll(){var e;if(!(a(this,In)&&(a(this,In).commitOrRemove(),a(this,Tt)!==Ae.NONE))&&!((e=a(this,Oo))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of a(this,Fe))t.unselect();a(this,Fe).clear(),A(this,J,an).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;a(this,Nr)[0]+=e,a(this,Nr)[1]+=t;const[i,r]=a(this,Nr),o=[...a(this,Fe)],l=1e3;a(this,ti)&&clearTimeout(a(this,ti)),g(this,ti,setTimeout(()=>{g(this,ti,null),a(this,Nr)[0]=a(this,Nr)[1]=0,this.addCommands({cmd:()=>{for(const c of o)a(this,xt).has(c.id)&&c.translateInPage(i,r)},undo:()=>{for(const c of o)a(this,xt).has(c.id)&&c.translateInPage(-i,-r)},mustExec:!1})},l));for(const c of o)c.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),g(this,Zs,new Map);for(const e of a(this,Fe))a(this,Zs).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!a(this,Zs))return!1;this.disableUserSelect(!1);const e=a(this,Zs);g(this,Zs,null);let t=!1;for(const[{x:i,y:r,pageIndex:o},l]of e)l.newX=i,l.newY=r,l.newPageIndex=o,t||(t=i!==l.savedX||r!==l.savedY||o!==l.savedPageIndex);if(!t)return!1;const s=(i,r,o,l)=>{if(a(this,xt).has(i.id)){const c=a(this,Ft).get(l);c?i._setParentAndPosition(c,r,o):(i.pageIndex=l,i.x=r,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:o,newPageIndex:l}]of e)s(i,r,o,l)},undo:()=>{for(const[i,{savedX:r,savedY:o,savedPageIndex:l}]of e)s(i,r,o,l)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(a(this,Zs))for(const s of a(this,Zs).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||a(this,Fe).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return a(this,In)===e}getActive(){return a(this,In)}getMode(){return a(this,Tt)}get imageManager(){return ke(this,"imageManager",new Zm)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,h=t.rangeCount;u<h;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:o}=e.getBoundingClientRect();let l;switch(e.getAttribute("data-main-rotation")){case"90":l=(u,h,d,f)=>({x:(h-i)/o,y:1-(u+d-s)/r,width:f/o,height:d/r});break;case"180":l=(u,h,d,f)=>({x:1-(u+d-s)/r,y:1-(h+f-i)/o,width:d/r,height:f/o});break;case"270":l=(u,h,d,f)=>({x:1-(h+f-i)/o,y:(u-s)/r,width:f/o,height:d/r});break;default:l=(u,h,d,f)=>({x:(u-s)/r,y:(h-i)/o,width:d/r,height:f/o});break}const c=[];for(let u=0,h=t.rangeCount;u<h;u++){const d=t.getRangeAt(u);if(!d.collapsed)for(const{x:f,y:p,width:y,height:w}of d.getClientRects())y===0||w===0||c.push(l(f,p,y,w))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:t}){(a(this,Il)||g(this,Il,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=a(this,Il))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=a(this,Il))==null?void 0:i.get(e.data.id);if(!t)return;const s=a(this,Ni).getRawValue(t);s&&(a(this,Tt)===Ae.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}};Ml=new WeakMap,In=new WeakMap,xt=new WeakMap,Ft=new WeakMap,Ll=new WeakMap,Ni=new WeakMap,Il=new WeakMap,is=new WeakMap,_r=new WeakMap,Oo=new WeakMap,Dl=new WeakMap,jo=new WeakMap,Zs=new WeakMap,_s=new WeakMap,zo=new WeakMap,ch=new WeakMap,uh=new WeakMap,Fl=new WeakMap,hh=new WeakMap,Js=new WeakMap,Cr=new WeakMap,Ol=new WeakMap,kr=new WeakMap,ei=new WeakMap,Mp=new WeakMap,Tr=new WeakMap,dh=new WeakMap,Pr=new WeakMap,$o=new WeakMap,fh=new WeakMap,ph=new WeakMap,Tt=new WeakMap,Fe=new WeakMap,Ri=new WeakMap,Ho=new WeakMap,gh=new WeakMap,mh=new WeakMap,Nr=new WeakMap,ti=new WeakMap,Mi=new WeakMap,vh=new WeakMap,rs=new WeakMap,J=new WeakSet,Sf=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},ev=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of a(this,Ft).values())if(s.hasTextLayer(e))return s;return null},EA=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=A(this,J,Sf).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(a(this,ei)||g(this,ei,new yC(this)),a(this,ei).show(s,i,this.direction==="ltr"))},_A=function(){var r,o,l;const e=document.getSelection();if(!e||e.isCollapsed){a(this,Ri)&&((r=a(this,ei))==null||r.hide(),g(this,Ri,null),A(this,J,an).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===a(this,Ri))return;const i=A(this,J,Sf).call(this,e).closest(".textLayer");if(!i){a(this,Ri)&&((o=a(this,ei))==null||o.hide(),g(this,Ri,null),A(this,J,an).call(this,{hasSelectedText:!1}));return}if((l=a(this,ei))==null||l.hide(),g(this,Ri,t),A(this,J,an).call(this,{hasSelectedText:!0}),!(a(this,Tt)!==Ae.HIGHLIGHT&&a(this,Tt)!==Ae.NONE)&&(a(this,Tt)===Ae.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),g(this,kr,this.isShiftKeyDown),!this.isShiftKeyDown)){const c=a(this,Tt)===Ae.HIGHLIGHT?A(this,J,ev).call(this,i):null;c==null||c.toggleDrawing();const u=new AbortController,h=this.combinedSignal(u),d=f=>{f.type==="pointerup"&&f.button!==0||(u.abort(),c==null||c.toggleDrawing(!0),f.type==="pointerup"&&A(this,J,Ef).call(this,"main_toolbar"))};window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("blur",d,{signal:h})}},Ef=function(e=""){a(this,Tt)===Ae.HIGHLIGHT?this.highlightSelection(e):a(this,ch)&&A(this,J,EA).call(this)},CA=function(){document.addEventListener("selectionchange",A(this,J,_A).bind(this),{signal:this._signal})},kA=function(){if(a(this,Cr))return;g(this,Cr,new AbortController);const e=this.combinedSignal(a(this,Cr));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},TA=function(){var e;(e=a(this,Cr))==null||e.abort(),g(this,Cr,null)},tv=function(){if(a(this,Pr))return;g(this,Pr,new AbortController);const e=this.combinedSignal(a(this,Pr));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},PA=function(){var e;(e=a(this,Pr))==null||e.abort(),g(this,Pr,null)},nv=function(){if(a(this,_r))return;g(this,_r,new AbortController);const e=this.combinedSignal(a(this,_r));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},sv=function(){var e;(e=a(this,_r))==null||e.abort(),g(this,_r,null)},NA=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},an=function(e){Object.entries(e).some(([s,i])=>a(this,mh)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(a(this,mh),e)}),a(this,Tt)===Ae.HIGHLIGHT&&e.hasSelectedEditor===!1&&A(this,J,Ei).call(this,[[Ne.HIGHLIGHT_FREE,!0]]))},Ei=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},RA=async function(){if(!a(this,Tr)){g(this,Tr,!0);const e=[];for(const t of a(this,Ft).values())e.push(t.enable());await Promise.all(e);for(const t of a(this,xt).values())t.enable()}},MA=function(){if(this.unselectAll(),a(this,Tr)){g(this,Tr,!1);for(const e of a(this,Ft).values())e.disable();for(const e of a(this,xt).values())e.disable()}},iv=function(e){const t=a(this,Ft).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},LA=function(){let e=null;for(e of a(this,Fe));return e},hu=function(){if(a(this,xt).size===0)return!0;if(a(this,xt).size===1)for(const e of a(this,xt).values())return e.isEmpty();return!1},rv=function(e){for(const t of a(this,Fe))t.unselect();a(this,Fe).clear();for(const t of e)t.isEmpty()||(a(this,Fe).add(t),t.select());A(this,J,an).call(this,{hasSelectedEditor:this.hasSelection})},V(bl,"TRANSLATE_SMALL",1),V(bl,"TRANSLATE_BIG",10);let Xa=bl;var Pt,ni,Cs,jl,si,Dn,zl,ii,Sn,Li,Bo,ri,Rr,js,du,_f;const ln=class ln{constructor(e){b(this,js);b(this,Pt,null);b(this,ni,!1);b(this,Cs,null);b(this,jl,null);b(this,si,null);b(this,Dn,null);b(this,zl,!1);b(this,ii,null);b(this,Sn,null);b(this,Li,null);b(this,Bo,null);b(this,ri,!1);g(this,Sn,e),g(this,ri,e._uiManager.useNewAltTextFlow),a(ln,Rr)||g(ln,Rr,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){ln._l10n??(ln._l10n=e)}async render(){const e=g(this,Cs,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=g(this,jl,document.createElement("span"));e.append(t),a(this,ri)?(e.classList.add("new"),e.setAttribute("data-l10n-id",a(ln,Rr).missing),t.setAttribute("data-l10n-id",a(ln,Rr)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=a(this,Sn)._uiManager._signal;e.addEventListener("contextmenu",Bs,{signal:s}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),a(this,Sn)._uiManager.editAltText(a(this,Sn)),a(this,ri)&&a(this,Sn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:a(this,js,du)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(g(this,zl,!0),i(r))},{signal:s}),await A(this,js,_f).call(this),e}finish(){a(this,Cs)&&(a(this,Cs).focus({focusVisible:a(this,zl)}),g(this,zl,!1))}isEmpty(){return a(this,ri)?a(this,Pt)===null:!a(this,Pt)&&!a(this,ni)}hasData(){return a(this,ri)?a(this,Pt)!==null||!!a(this,Li):this.isEmpty()}get guessedText(){return a(this,Li)}async setGuessedText(e){a(this,Pt)===null&&(g(this,Li,e),g(this,Bo,await ln._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),A(this,js,_f).call(this))}toggleAltTextBadge(e=!1){var t;if(!a(this,ri)||a(this,Pt)){(t=a(this,ii))==null||t.remove(),g(this,ii,null);return}if(!a(this,ii)){const s=g(this,ii,document.createElement("div"));s.className="noAltTextBadge",a(this,Sn).div.append(s)}a(this,ii).classList.toggle("hidden",!e)}serialize(e){let t=a(this,Pt);return!e&&a(this,Li)===t&&(t=a(this,Bo)),{altText:t,decorative:a(this,ni),guessedText:a(this,Li),textWithDisclaimer:a(this,Bo)}}get data(){return{altText:a(this,Pt),decorative:a(this,ni)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(g(this,Li,s),g(this,Bo,i)),!(a(this,Pt)===e&&a(this,ni)===t)&&(r||(g(this,Pt,e),g(this,ni,t)),A(this,js,_f).call(this))}toggle(e=!1){a(this,Cs)&&(!e&&a(this,Dn)&&(clearTimeout(a(this,Dn)),g(this,Dn,null)),a(this,Cs).disabled=!e)}shown(){a(this,Sn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:a(this,js,du)}})}destroy(){var e,t;(e=a(this,Cs))==null||e.remove(),g(this,Cs,null),g(this,jl,null),g(this,si,null),(t=a(this,ii))==null||t.remove(),g(this,ii,null)}};Pt=new WeakMap,ni=new WeakMap,Cs=new WeakMap,jl=new WeakMap,si=new WeakMap,Dn=new WeakMap,zl=new WeakMap,ii=new WeakMap,Sn=new WeakMap,Li=new WeakMap,Bo=new WeakMap,ri=new WeakMap,Rr=new WeakMap,js=new WeakSet,du=function(){return a(this,Pt)&&"added"||a(this,Pt)===null&&this.guessedText&&"review"||"missing"},_f=async function(){var i,r,o;const e=a(this,Cs);if(!e)return;if(a(this,ri)){if(e.classList.toggle("done",!!a(this,Pt)),e.setAttribute("data-l10n-id",a(ln,Rr)[a(this,js,du)]),(i=a(this,jl))==null||i.setAttribute("data-l10n-id",a(ln,Rr)[`${a(this,js,du)}-label`]),!a(this,Pt)){(r=a(this,si))==null||r.remove();return}}else{if(!a(this,Pt)&&!a(this,ni)){e.classList.remove("done"),(o=a(this,si))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=a(this,si);if(!t){g(this,si,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${a(this,Sn).id}`;const l=100,c=a(this,Sn)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(a(this,Dn)),g(this,Dn,null)},{once:!0}),e.addEventListener("mouseenter",()=>{g(this,Dn,setTimeout(()=>{g(this,Dn,null),a(this,si).classList.add("show"),a(this,Sn)._reportTelemetry({action:"alt_text_tooltip"})},l))},{signal:c}),e.addEventListener("mouseleave",()=>{var u;a(this,Dn)&&(clearTimeout(a(this,Dn)),g(this,Dn,null)),(u=a(this,si))==null||u.classList.remove("show")},{signal:c})}a(this,ni)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=a(this,Pt)),t.parentNode||e.append(t);const s=a(this,Sn).getImageForAltText();s==null||s.setAttribute("aria-describedby",t.id)},b(ln,Rr,null),V(ln,"_l10n",null);let xp=ln;var yh,Uo,wh,bh,xh,Ah,Sh,$l,Ii,Vo,Mr,hr,IA,DA,ov;const py=class py{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:o=null,signal:l}){b(this,hr);b(this,yh);b(this,Uo,!1);b(this,wh,null);b(this,bh);b(this,xh);b(this,Ah);b(this,Sh);b(this,$l);b(this,Ii,null);b(this,Vo);b(this,Mr,null);g(this,yh,e),g(this,wh,s),g(this,bh,t),g(this,xh,i),g(this,Ah,r),g(this,Sh,o),g(this,Vo,new AbortController),g(this,$l,AbortSignal.any([l,a(this,Vo).signal])),e.addEventListener("touchstart",A(this,hr,IA).bind(this),{passive:!1,signal:a(this,$l)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return ke(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=a(this,Vo))==null||e.abort(),g(this,Vo,null)}};yh=new WeakMap,Uo=new WeakMap,wh=new WeakMap,bh=new WeakMap,xh=new WeakMap,Ah=new WeakMap,Sh=new WeakMap,$l=new WeakMap,Ii=new WeakMap,Vo=new WeakMap,Mr=new WeakMap,hr=new WeakSet,IA=function(e){var i,r,o;if((i=a(this,bh))!=null&&i.call(this)||e.touches.length<2)return;if(!a(this,Mr)){g(this,Mr,new AbortController);const l=AbortSignal.any([a(this,$l),a(this,Mr).signal]),c=a(this,yh),u={signal:l,passive:!1};c.addEventListener("touchmove",A(this,hr,DA).bind(this),u),c.addEventListener("touchend",A(this,hr,ov).bind(this),u),c.addEventListener("touchcancel",A(this,hr,ov).bind(this),u),(r=a(this,xh))==null||r.call(this)}if(Kn(e),e.touches.length!==2||(o=a(this,wh))!=null&&o.call(this)){g(this,Ii,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),g(this,Ii,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},DA=function(e){var x;if(!a(this,Ii)||e.touches.length!==2)return;let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:r}=t,{screenX:o,screenY:l}=s,c=a(this,Ii),{touch0X:u,touch0Y:h,touch1X:d,touch1Y:f}=c,p=d-u,y=f-h,w=o-i,_=l-r,m=Math.hypot(w,_)||1,v=Math.hypot(p,y)||1;if(!a(this,Uo)&&Math.abs(v-m)<=py.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=i,c.touch0Y=r,c.touch1X=o,c.touch1Y=l,e.preventDefault(),!a(this,Uo)){g(this,Uo,!0);return}const E=[(i+o)/2,(r+l)/2];(x=a(this,Ah))==null||x.call(this,E,v,m)},ov=function(e){var t;a(this,Mr).abort(),g(this,Mr,null),(t=a(this,Sh))==null||t.call(this),a(this,Ii)&&(e.preventDefault(),g(this,Ii,null),g(this,Uo,!1))};let Ap=py;var Go,ks,Xe,Hl,Lr,Eh,Wo,Ot,Xo,Di,Ir,_h,Yo,Fn,Ch,Ko,Fi,oi,Bl,Ul,os,qo,kh,Lp,pe,av,Th,lv,Cf,FA,OA,cv,kf,uv,jA,zA,$A,hv,HA,dv,BA,UA,VA,fv,fu;const Ee=class Ee{constructor(e){b(this,pe);b(this,Go,null);b(this,ks,null);b(this,Xe,null);b(this,Hl,!1);b(this,Lr,null);b(this,Eh,"");b(this,Wo,!1);b(this,Ot,null);b(this,Xo,null);b(this,Di,null);b(this,Ir,null);b(this,_h,"");b(this,Yo,!1);b(this,Fn,null);b(this,Ch,!1);b(this,Ko,!1);b(this,Fi,!1);b(this,oi,null);b(this,Bl,0);b(this,Ul,0);b(this,os,null);b(this,qo,null);V(this,"_editToolbar",null);V(this,"_initialOptions",Object.create(null));V(this,"_initialData",null);V(this,"_isVisible",!0);V(this,"_uiManager",null);V(this,"_focusEventsAllowed",!0);b(this,kh,!1);b(this,Lp,Ee._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,o];const[l,c]=this.parentDimensions;this.x=e.x/l,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=Ee.prototype._resizeWithKeyboard,t=Xa.TRANSLATE_SMALL,s=Xa.TRANSLATE_BIG;return ke(this,"_resizerKeyboardManager",new Id([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],Ee.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return ke(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new xC({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Ee._l10n??(Ee._l10n=e),Ee._l10nResizer||(Ee._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Ee._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);Ee._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Be("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return a(this,kh)}set _isDraggable(e){var t;g(this,kh,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=a(this,Lp)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):A(this,pe,fu).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(a(this,Yo)?g(this,Yo,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[r,o]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/r,this.y=(t+i)/o,this.fixAndSetPosition()}translate(e,t){A(this,pe,av).call(this,this.parentDimensions,e,t)}translateInPage(e,t){a(this,Fn)||g(this,Fn,[this.x,this.y,this.width,this.height]),A(this,pe,av).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){a(this,Fn)||g(this,Fn,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,r]}=this;if(this.x+=e/i,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:l}=this;const[c,u]=this.getBaseTranslation();o+=c,l+=u;const{style:h}=s;h.left=`${(100*o).toFixed(2)}%`,h.top=`${(100*l).toFixed(2)}%`,this._onTranslating(o,l),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!a(this,Fn)&&(a(this,Fn)[0]!==this.x||a(this,Fn)[1]!==this.y)}get _hasBeenResized(){return!!a(this,Fn)&&(a(this,Fn)[2]!==this.width||a(this,Fn)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=Ee,i=s/e,r=s/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:r,y:o,width:l,height:c}=this;if(l*=s,c*=i,r*=s,o*=i,this._mustFixPosition)switch(e){case 0:r=Math.max(0,Math.min(s-l,r)),o=Math.max(0,Math.min(i-c,o));break;case 90:r=Math.max(0,Math.min(s-c,r)),o=Math.min(i,Math.max(l,o));break;case 180:r=Math.min(s,Math.max(l,r)),o=Math.min(i,Math.max(c,o));break;case 270:r=Math.min(s,Math.max(c,r)),o=Math.max(0,Math.min(i-l,o));break}this.x=r/=s,this.y=o/=i;const[u,h]=this.getBaseTranslation();r+=u,o+=h,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return A(s=Ee,Th,lv).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return A(s=Ee,Th,lv).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){const[s,i]=this.parentDimensions,{style:r}=this.div;r.width=`${(100*e/s).toFixed(2)}%`,a(this,Wo)||(r.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:s}=e,i=s.endsWith("%"),r=!a(this,Wo)&&t.endsWith("%");if(i&&r)return;const[o,l]=this.parentDimensions;i||(e.width=`${(100*parseFloat(s)/o).toFixed(2)}%`),!a(this,Wo)&&!r&&(e.height=`${(100*parseFloat(t)/l).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=a(this,Xe))==null||e.finish()}async addEditToolbar(){return this._editToolbar||a(this,Ko)?this._editToolbar:(this._editToolbar=new qm(this),this.div.append(this._editToolbar.render()),a(this,Xe)&&await this._editToolbar.addAltText(a(this,Xe)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=a(this,Xe))==null||e.destroy())}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){a(this,Xe)||(xp.initialize(Ee._l10n),g(this,Xe,new xp(this)),a(this,Go)&&(a(this,Xe).data=a(this,Go),g(this,Go,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=a(this,Xe))==null?void 0:e.data}set altTextData(e){a(this,Xe)&&(a(this,Xe).data=e)}get guessedAltText(){var e;return(e=a(this,Xe))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=a(this,Xe))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=a(this,Xe))==null?void 0:t.serialize(e)}hasAltText(){return!!a(this,Xe)&&!a(this,Xe).isEmpty()}hasAltTextData(){var e;return((e=a(this,Xe))==null?void 0:e.hasData())??!1}render(){var r;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=a(this,Hl)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),A(this,pe,dv).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[s,i]=this.getInitialTranslation();return this.translate(s,i),bp(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(a(this,qo)||g(this,qo,new Ap({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:A(this,pe,jA).bind(this),onPinching:A(this,pe,zA).bind(this),onPinchEnd:A(this,pe,$A).bind(this),signal:this._uiManager._signal}))),(r=this._uiManager._editorUndoBar)==null||r.hide(),this.div}pointerdown(e){const{isMac:t}=pn.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(g(this,Yo,!0),this._isDraggable){A(this,pe,HA).call(this,e);return}A(this,pe,hv).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){a(this,oi)&&clearTimeout(a(this,oi)),g(this,oi,setTimeout(()=>{var e;g(this,oi,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[r,o]=this.pageDimensions,[l,c]=this.pageTranslation,u=e/i,h=t/i,d=this.x*r,f=this.y*o,p=this.width*r,y=this.height*o;switch(s){case 0:return[d+u+l,o-f-h-y+c,d+u+p+l,o-f-h+c];case 90:return[d+h+l,o-f+u+c,d+h+y+l,o-f+u+p+c];case 180:return[d-u-p+l,o-f+h+c,d-u+l,o-f+h+y+c];case 270:return[d-h-y+l,o-f-u-p+c,d-h+l,o-f-u+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,r,o]=e,l=r-s,c=o-i;switch(this.rotation){case 0:return[s,t-o,l,c];case 90:return[s,t-i,c,l];case 180:return[r,t-i,l,c];case 270:return[r,t-o,c,l];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){g(this,Ko,!0)}disableEditMode(){g(this,Ko,!1)}isInEditMode(){return a(this,Ko)}shouldGetKeyboardEvents(){return a(this,Fi)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&i>0&&e<r&&s>0}rebuild(){A(this,pe,dv).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){Be("An editor must be serializable")}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});i.rotation=e.rotation,g(i,Go,e.accessibilityData);const[r,o]=i.pageDimensions,[l,c,u,h]=i.getRectInCurrentCoords(e.rect,o);return i.x=l/r,i.y=c/o,i.width=u/r,i.height=h/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=a(this,Ir))==null||e.abort(),g(this,Ir,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),a(this,oi)&&(clearTimeout(a(this,oi)),g(this,oi,null)),A(this,pe,fu).call(this),this.removeEditToolbar(),a(this,os)){for(const s of a(this,os).values())clearTimeout(s);g(this,os,null)}this.parent=null,(t=a(this,qo))==null||t.destroy(),g(this,qo,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(A(this,pe,FA).call(this),a(this,Ot).classList.remove("hidden"),bp(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),g(this,Di,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=a(this,Ot).children;if(!a(this,ks)){g(this,ks,Array.from(t));const o=A(this,pe,BA).bind(this),l=A(this,pe,UA).bind(this),c=this._uiManager._signal;for(const u of a(this,ks)){const h=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",o,{signal:c}),u.addEventListener("blur",l,{signal:c}),u.addEventListener("focus",A(this,pe,VA).bind(this,h),{signal:c}),u.setAttribute("data-l10n-id",Ee._l10nResizer[h])}}const s=a(this,ks)[0];let i=0;for(const o of t){if(o===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(a(this,ks).length/4);if(r!==i){if(r<i)for(let l=0;l<i-r;l++)a(this,Ot).append(a(this,Ot).firstChild);else if(r>i)for(let l=0;l<r-i;l++)a(this,Ot).firstChild.before(a(this,Ot).lastChild);let o=0;for(const l of t){const u=a(this,ks)[o++].getAttribute("data-resizer-name");l.setAttribute("data-l10n-id",Ee._l10nResizer[u])}}A(this,pe,fv).call(this,0),g(this,Fi,!0),a(this,Ot).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){a(this,Fi)&&A(this,pe,uv).call(this,a(this,_h),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){A(this,pe,fu).call(this),this.div.focus()}select(){var e,t,s;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(s=a(this,Xe))==null||s.toggleAltTextBadge(!1)}unselect(){var e,t,s,i,r;(e=a(this,Ot))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=a(this,Xe))==null||r.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return a(this,Ch)}set isEditing(e){g(this,Ch,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){g(this,Wo,!0);const s=e/t,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){a(this,os)||g(this,os,new Map);const{action:s}=e;let i=a(this,os).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),a(this,os).delete(s),a(this,os).size===0&&g(this,os,null)},Ee._telemetryTimeout),a(this,os).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),g(this,Hl,!1)}disable(){this.div&&(this.div.tabIndex=-1),g(this,Hl,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Go=new WeakMap,ks=new WeakMap,Xe=new WeakMap,Hl=new WeakMap,Lr=new WeakMap,Eh=new WeakMap,Wo=new WeakMap,Ot=new WeakMap,Xo=new WeakMap,Di=new WeakMap,Ir=new WeakMap,_h=new WeakMap,Yo=new WeakMap,Fn=new WeakMap,Ch=new WeakMap,Ko=new WeakMap,Fi=new WeakMap,oi=new WeakMap,Bl=new WeakMap,Ul=new WeakMap,os=new WeakMap,qo=new WeakMap,kh=new WeakMap,Lp=new WeakMap,pe=new WeakSet,av=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Th=new WeakSet,lv=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Cf=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},FA=function(){if(a(this,Ot))return;g(this,Ot,document.createElement("div")),a(this,Ot).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");a(this,Ot).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",A(this,pe,OA).bind(this,s),{signal:t}),i.addEventListener("contextmenu",Bs,{signal:t}),i.tabIndex=-1}this.div.prepend(a(this,Ot))},OA=function(e,t){var h;t.preventDefault();const{isMac:s}=pn.platform;if(t.button!==0||t.ctrlKey&&s)return;(h=a(this,Xe))==null||h.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,g(this,Xo,[t.screenX,t.screenY]);const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",A(this,pe,uv).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",Kn,{passive:!1,signal:o}),window.addEventListener("contextmenu",Bs,{signal:o}),g(this,Di,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const l=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{var d;r.abort(),this.parent.togglePointerEvents(!0),(d=a(this,Xe))==null||d.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=l,this.div.style.cursor=c,A(this,pe,kf).call(this)};window.addEventListener("pointerup",u,{signal:o}),window.addEventListener("blur",u,{signal:o})},cv=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t;const[r,o]=this.parentDimensions;this.setDims(r*s,o*i),this.fixAndSetPosition(),this._onResized()},kf=function(){if(!a(this,Di))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=a(this,Di);g(this,Di,null);const r=this.x,o=this.y,l=this.width,c=this.height;r===e&&o===t&&l===s&&c===i||this.addCommands({cmd:A(this,pe,cv).bind(this,r,o,l,c),undo:A(this,pe,cv).bind(this,e,t,s,i),mustExec:!0})},uv=function(e,t){const[s,i]=this.parentDimensions,r=this.x,o=this.y,l=this.width,c=this.height,u=Ee.MIN_SIZE/s,h=Ee.MIN_SIZE/i,d=A(this,pe,Cf).call(this,this.rotation),f=(z,T)=>[d[0]*z+d[2]*T,d[1]*z+d[3]*T],p=A(this,pe,Cf).call(this,360-this.rotation),y=(z,T)=>[p[0]*z+p[2]*T,p[1]*z+p[3]*T];let w,_,m=!1,v=!1;switch(e){case"topLeft":m=!0,w=(z,T)=>[0,0],_=(z,T)=>[z,T];break;case"topMiddle":w=(z,T)=>[z/2,0],_=(z,T)=>[z/2,T];break;case"topRight":m=!0,w=(z,T)=>[z,0],_=(z,T)=>[0,T];break;case"middleRight":v=!0,w=(z,T)=>[z,T/2],_=(z,T)=>[0,T/2];break;case"bottomRight":m=!0,w=(z,T)=>[z,T],_=(z,T)=>[0,0];break;case"bottomMiddle":w=(z,T)=>[z/2,T],_=(z,T)=>[z/2,0];break;case"bottomLeft":m=!0,w=(z,T)=>[0,T],_=(z,T)=>[z,0];break;case"middleLeft":v=!0,w=(z,T)=>[0,T/2],_=(z,T)=>[z,T/2];break}const E=w(l,c),x=_(l,c);let C=f(...x);const P=Ee._round(r+C[0]),N=Ee._round(o+C[1]);let I=1,L=1,U,W;if(t.fromKeyboard)({deltaX:U,deltaY:W}=t);else{const{screenX:z,screenY:T}=t,[R,$]=a(this,Xo);[U,W]=this.screenToPageTranslation(z-R,T-$),a(this,Xo)[0]=z,a(this,Xo)[1]=T}if([U,W]=y(U/s,W/i),m){const z=Math.hypot(l,c);I=L=Math.max(Math.min(Math.hypot(x[0]-E[0]-U,x[1]-E[1]-W)/z,1/l,1/c),u/l,h/c)}else v?I=Math.max(u,Math.min(1,Math.abs(x[0]-E[0]-U)))/l:L=Math.max(h,Math.min(1,Math.abs(x[1]-E[1]-W)))/c;const M=Ee._round(l*I),K=Ee._round(c*L);C=f(..._(M,K));const q=P-C[0],ee=N-C[1];a(this,Fn)||g(this,Fn,[this.x,this.y,this.width,this.height]),this.width=M,this.height=K,this.x=q,this.y=ee,this.setDims(s*M,i*K),this.fixAndSetPosition(),this._onResizing()},jA=function(){var e;g(this,Di,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=a(this,Xe))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},zA=function(e,t,s){let r=.7*(s/t)+1-.7;if(r===1)return;const o=A(this,pe,Cf).call(this,this.rotation),l=(P,N)=>[o[0]*P+o[2]*N,o[1]*P+o[3]*N],[c,u]=this.parentDimensions,h=this.x,d=this.y,f=this.width,p=this.height,y=Ee.MIN_SIZE/c,w=Ee.MIN_SIZE/u;r=Math.max(Math.min(r,1/f,1/p),y/f,w/p);const _=Ee._round(f*r),m=Ee._round(p*r);if(_===f&&m===p)return;a(this,Fn)||g(this,Fn,[h,d,f,p]);const v=l(f/2,p/2),E=Ee._round(h+v[0]),x=Ee._round(d+v[1]),C=l(_/2,m/2);this.x=E-C[0],this.y=x-C[1],this.width=_,this.height=m,this.setDims(c*_,u*m),this.fixAndSetPosition(),this._onResizing()},$A=function(){var e;(e=a(this,Xe))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),A(this,pe,kf).call(this)},hv=function(e){const{isMac:t}=pn.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},HA=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:r},l=u=>{i.abort(),g(this,Lr,null),g(this,Yo,!1),this._uiManager.endDragSession()||A(this,pe,hv).call(this,u),s&&this._onStopDragging()};t&&(g(this,Bl,e.clientX),g(this,Ul,e.clientY),g(this,Lr,e.pointerId),g(this,Eh,e.pointerType),window.addEventListener("pointermove",u=>{s||(s=!0,this._onStartDragging());const{clientX:h,clientY:d,pointerId:f}=u;if(f!==a(this,Lr)){Kn(u);return}const[p,y]=this.screenToPageTranslation(h-a(this,Bl),d-a(this,Ul));g(this,Bl,h),g(this,Ul,d),this._uiManager.dragSelectedEditors(p,y)},o),window.addEventListener("touchmove",Kn,o),window.addEventListener("pointerdown",u=>{u.pointerType===a(this,Eh)&&(a(this,qo)||u.isPrimary)&&l(u),Kn(u)},o));const c=u=>{if(!a(this,Lr)||a(this,Lr)===u.pointerId){l(u);return}Kn(u)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})},dv=function(){if(a(this,Ir)||!this.div)return;g(this,Ir,new AbortController);const e=this._uiManager.combinedSignal(a(this,Ir));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},BA=function(e){Ee._resizerKeyboardManager.exec(this,e)},UA=function(e){var t;a(this,Fi)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==a(this,Ot)&&A(this,pe,fu).call(this)},VA=function(e){g(this,_h,a(this,Fi)?e:"")},fv=function(e){if(a(this,ks))for(const t of a(this,ks))t.tabIndex=e},fu=function(){g(this,Fi,!1),A(this,pe,fv).call(this,-1),A(this,pe,kf).call(this)},b(Ee,Th),V(Ee,"_l10n",null),V(Ee,"_l10nResizer",null),V(Ee,"_borderLineWidth",-1),V(Ee,"_colorManager",new Jm),V(Ee,"_zIndex",1),V(Ee,"_telemetryTimeout",1e3);let nt=Ee;class xC extends nt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Iw=3285377520,ss=4294901760,Ks=65535;class GA{constructor(e){this.h1=e?e&4294967295:Iw,this.h2=e?e&4294967295:Iw}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let w=0,_=e.length;w<_;w++){const m=e.charCodeAt(w);m<=255?t[s++]=m:(t[s++]=m>>>8,t[s++]=m&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,o=new Uint32Array(t.buffer,0,i);let l=0,c=0,u=this.h1,h=this.h2;const d=3432918353,f=461845907,p=d&Ks,y=f&Ks;for(let w=0;w<i;w++)w&1?(l=o[w],l=l*d&ss|l*p&Ks,l=l<<15|l>>>17,l=l*f&ss|l*y&Ks,u^=l,u=u<<13|u>>>19,u=u*5+3864292196):(c=o[w],c=c*d&ss|c*p&Ks,c=c<<15|c>>>17,c=c*f&ss|c*y&Ks,h^=c,h=h<<13|h>>>19,h=h*5+3864292196);switch(l=0,r){case 3:l^=t[i*4+2]<<16;case 2:l^=t[i*4+1]<<8;case 1:l^=t[i*4],l=l*d&ss|l*p&Ks,l=l<<15|l>>>17,l=l*f&ss|l*y&Ks,i&1?u^=l:h^=l}this.h1=u,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&ss|e*36045&Ks,t=t*4283543511&ss|((t<<16|e>>>16)*2950163797&ss)>>>16,e^=t>>>1,e=e*444984403&ss|e*60499&Ks,t=t*3301882366&ss|((t<<16|e>>>16)*3120437893&ss)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const pv=Object.freeze({map:null,hash:"",transfer:void 0});var Qo,Zo,Nt,Ip,WA;class cy{constructor(){b(this,Ip);b(this,Qo,!1);b(this,Zo,null);b(this,Nt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=a(this,Nt).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return a(this,Nt).get(e)}remove(e){if(a(this,Nt).delete(e),a(this,Nt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of a(this,Nt).values())if(t instanceof nt)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=a(this,Nt).get(e);let i=!1;if(s!==void 0)for(const[r,o]of Object.entries(t))s[r]!==o&&(i=!0,s[r]=o);else i=!0,a(this,Nt).set(e,t);i&&A(this,Ip,WA).call(this),t instanceof nt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return a(this,Nt).has(e)}getAll(){return a(this,Nt).size>0?sy(a(this,Nt)):null}setAll(e){for(const[t,s]of Object.entries(e))this.setValue(t,s)}get size(){return a(this,Nt).size}resetModified(){a(this,Qo)&&(g(this,Qo,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new XA(this)}get serializable(){if(a(this,Nt).size===0)return pv;const e=new Map,t=new GA,s=[],i=Object.create(null);let r=!1;for(const[o,l]of a(this,Nt)){const c=l instanceof nt?l.serialize(!1,i):l;c&&(e.set(o,c),t.update(`${o}:${JSON.stringify(c)}`),r||(r=!!c.bitmap))}if(r)for(const o of e.values())o.bitmap&&s.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:pv}get editorStats(){let e=null;const t=new Map;for(const s of a(this,Nt).values()){if(!(s instanceof nt))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:r}=i;t.has(r)||t.set(r,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));const o=e[r]||(e[r]=new Map);for(const[l,c]of Object.entries(i)){if(l==="type")continue;let u=o.get(l);u||(u=new Map,o.set(l,u));const h=u.get(c)??0;u.set(c,h+1)}}for(const[s,i]of t)e[s]=i.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){g(this,Zo,null)}get modifiedIds(){if(a(this,Zo))return a(this,Zo);const e=[];for(const t of a(this,Nt).values())!(t instanceof nt)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return g(this,Zo,{ids:new Set(e),hash:e.join(",")})}}Qo=new WeakMap,Zo=new WeakMap,Nt=new WeakMap,Ip=new WeakSet,WA=function(){a(this,Qo)||(g(this,Qo,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Ph;class XA extends cy{constructor(t){super();b(this,Ph);const{map:s,hash:i,transfer:r}=t.serializable,o=structuredClone(s,r?{transfer:r}:null);g(this,Ph,{map:o,hash:i,transfer:r})}get print(){Be("Should not call PrintAnnotationStorage.print")}get serializable(){return a(this,Ph)}get modifiedIds(){return ke(this,"modifiedIds",{ids:new Set,hash:""})}}Ph=new WeakMap;var Vl;class AC{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){b(this,Vl,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),a(this,Vl).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||a(this,Vl).has(e.loadedName))){if(mt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:i,style:r}=e,o=new FontFace(s,i,r);this.addNativeFontFace(o);try{await o.load(),a(this,Vl).add(s),t==null||t(e)}catch{Se(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}Be("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw Se(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return ke(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(nn||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),ke(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(mt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return ke(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(x,C){return x.charCodeAt(C)<<24|x.charCodeAt(C+1)<<16|x.charCodeAt(C+2)<<8|x.charCodeAt(C+3)&255}function i(x,C,P,N){const I=x.substring(0,C),L=x.substring(C+P);return I+N+L}let r,o;const l=this._document.createElement("canvas");l.width=1,l.height=1;const c=l.getContext("2d");let u=0;function h(x,C){if(++u>30){Se("Load test font never loaded."),C();return}if(c.font="30px "+x,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){C();return}setTimeout(h.bind(null,x,C))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,d.length,d);const y=16,w=1482184792;let _=s(f,y);for(r=0,o=d.length-3;r<o;r+=4)_=_-w+s(d,r)|0;r<d.length&&(_=_-w+s(d+"XXX",r)|0),f=i(f,y,4,aC(_));const m=`url(data:font/opentype;base64,${btoa(f)});`,v=`@font-face {font-family:"${d}";src:${m}}`;this.insertRule(v);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const x of[e.loadedName,d]){const C=this._document.createElement("span");C.textContent="Hi",C.style.fontFamily=x,E.append(C)}this._document.body.append(E),h(d,()=>{E.remove(),t.complete()})}}Vl=new WeakMap;class SC{constructor(e,{disableFontFace:t=!1,fontExtraProperties:s=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(const r in e)this[r]=e[r];this.disableFontFace=t===!0,this.fontExtraProperties=s===!0,this._inspectFont=i}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${fC(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(o){Se(`getPathGenerator - ignoring character: "${o}".`)}const r=new Path2D(i||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=r}}const ef={DATA:1,ERROR:2},pt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Dw(){}function xn(n){if(n instanceof fo||n instanceof Xm||n instanceof eh||n instanceof Rw||n instanceof wp||n instanceof Gg)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||Be('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new fo(n.message);case"InvalidPDFException":return new Xm(n.message);case"MissingPDFException":return new eh(n.message);case"PasswordException":return new Rw(n.message,n.code);case"UnexpectedResponseException":return new wp(n.message,n.status);case"UnknownErrorException":return new Gg(n.message,n.details)}return new Gg(n.message,n.toString())}var Gl,vs,YA,KA,qA,Tf;class pu{constructor(e,t,s){b(this,vs);b(this,Gl,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",A(this,vs,YA).bind(this),{signal:a(this,Gl).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,s,i){const r=this.streamId++,o=this.sourceName,l=this.targetName,c=this.comObj;return new ReadableStream({start:u=>{const h=Promise.withResolvers();return this.streamControllers[r]={controller:u,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:l,action:e,streamId:r,data:t,desiredSize:u.desiredSize},i),h.promise},pull:u=>{const h=Promise.withResolvers();return this.streamControllers[r].pullCall=h,c.postMessage({sourceName:o,targetName:l,stream:pt.PULL,streamId:r,desiredSize:u.desiredSize}),h.promise},cancel:u=>{mt(u instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[r].cancelCall=h,this.streamControllers[r].isClosed=!0,c.postMessage({sourceName:o,targetName:l,stream:pt.CANCEL,streamId:r,reason:xn(u)}),h.promise}},s)}destroy(){var e;(e=a(this,Gl))==null||e.abort(),g(this,Gl,null)}}Gl=new WeakMap,vs=new WeakSet,YA=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){A(this,vs,qA).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===ef.DATA)i.resolve(e.data);else if(e.callback===ef.ERROR)i.reject(xn(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:s,targetName:i,callback:ef.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:s,targetName:i,callback:ef.ERROR,callbackId:e.callbackId,reason:xn(o)})});return}if(e.streamId){A(this,vs,KA).call(this,e);return}t(e.data)},KA=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this,l=this.actionHandler[e.action],c={enqueue(u,h=1,d){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=h,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:pt.ENQUEUE,streamId:t,chunk:u},d)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:pt.CLOSE,streamId:t}),delete o.streamSinks[t])},error(u){mt(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:pt.ERROR,streamId:t,reason:xn(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,Promise.try(l,e.data,c).then(function(){r.postMessage({sourceName:s,targetName:i,stream:pt.START_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:s,targetName:i,stream:pt.START_COMPLETE,streamId:t,reason:xn(u)})})},qA=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case pt.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(xn(e.reason));break;case pt.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(xn(e.reason));break;case pt.PULL:if(!l){r.postMessage({sourceName:s,targetName:i,stream:pt.PULL_COMPLETE,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,Promise.try(l.onPull||Dw).then(function(){r.postMessage({sourceName:s,targetName:i,stream:pt.PULL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:s,targetName:i,stream:pt.PULL_COMPLETE,streamId:t,reason:xn(u)})});break;case pt.ENQUEUE:if(mt(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case pt.CLOSE:if(mt(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),A(this,vs,Tf).call(this,o,t);break;case pt.ERROR:mt(o,"error should have stream controller"),o.controller.error(xn(e.reason)),A(this,vs,Tf).call(this,o,t);break;case pt.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(xn(e.reason)),A(this,vs,Tf).call(this,o,t);break;case pt.CANCEL:if(!l)break;const c=xn(e.reason);Promise.try(l.onCancel||Dw,c).then(function(){r.postMessage({sourceName:s,targetName:i,stream:pt.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:s,targetName:i,stream:pt.CANCEL_COMPLETE,streamId:t,reason:xn(u)})}),l.sinkCapability.reject(c),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Tf=async function(e,t){var s,i,r;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var Nh;class QA{constructor({enableHWA:e=!1}){b(this,Nh,!1);g(this,Nh,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!a(this,Nh)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Be("Abstract method `_createCanvas` called.")}}Nh=new WeakMap;class EC extends QA{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class ZA{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Be("Abstract method `_fetch` called.")}}class JA extends ZA{async _fetch(e){const t=await fg(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):dg(t)}}class eS{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,r){return"none"}destroy(e=!1){}}var Jo,Wl,Oi,ji,Qt,ea,ta,se,Yt,gu,tl,Pf,nl,tS,gv,sl,mu,vu,mv,yu;class _C extends eS{constructor({docId:t,ownerDocument:s=globalThis.document}){super();b(this,se);b(this,Jo);b(this,Wl);b(this,Oi);b(this,ji);b(this,Qt);b(this,ea);b(this,ta,0);g(this,ji,t),g(this,Qt,s)}addFilter(t){if(!t)return"none";let s=a(this,se,Yt).get(t);if(s)return s;const[i,r,o]=A(this,se,Pf).call(this,t),l=t.length===1?i:`${i}${r}${o}`;if(s=a(this,se,Yt).get(l),s)return a(this,se,Yt).set(t,s),s;const c=`g_${a(this,ji)}_transfer_map_${on(this,ta)._++}`,u=A(this,se,nl).call(this,c);a(this,se,Yt).set(t,u),a(this,se,Yt).set(l,u);const h=A(this,se,sl).call(this,c);return A(this,se,vu).call(this,i,r,o,h),u}addHCMFilter(t,s){var y;const i=`${t}-${s}`,r="base";let o=a(this,se,gu).get(r);if((o==null?void 0:o.key)===i||(o?((y=o.filter)==null||y.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},a(this,se,gu).set(r,o)),!t||!s))return o.url;const l=A(this,se,yu).call(this,t);t=ue.makeHexColor(...l);const c=A(this,se,yu).call(this,s);if(s=ue.makeHexColor(...c),a(this,se,tl).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return o.url;const u=new Array(256);for(let w=0;w<=255;w++){const _=w/255;u[w]=_<=.03928?_/12.92:((_+.055)/1.055)**2.4}const h=u.join(","),d=`g_${a(this,ji)}_hcm_filter`,f=o.filter=A(this,se,sl).call(this,d);A(this,se,vu).call(this,h,h,h,f),A(this,se,gv).call(this,f);const p=(w,_)=>{const m=l[w]/255,v=c[w]/255,E=new Array(_+1);for(let x=0;x<=_;x++)E[x]=m+x/_*(v-m);return E.join(",")};return A(this,se,vu).call(this,p(0,5),p(1,5),p(2,5),f),o.url=A(this,se,nl).call(this,d),o.url}addAlphaFilter(t){let s=a(this,se,Yt).get(t);if(s)return s;const[i]=A(this,se,Pf).call(this,[t]),r=`alpha_${i}`;if(s=a(this,se,Yt).get(r),s)return a(this,se,Yt).set(t,s),s;const o=`g_${a(this,ji)}_alpha_map_${on(this,ta)._++}`,l=A(this,se,nl).call(this,o);a(this,se,Yt).set(t,l),a(this,se,Yt).set(r,l);const c=A(this,se,sl).call(this,o);return A(this,se,mv).call(this,i,c),l}addLuminosityFilter(t){let s=a(this,se,Yt).get(t||"luminosity");if(s)return s;let i,r;if(t?([i]=A(this,se,Pf).call(this,[t]),r=`luminosity_${i}`):r="luminosity",s=a(this,se,Yt).get(r),s)return a(this,se,Yt).set(t,s),s;const o=`g_${a(this,ji)}_luminosity_map_${on(this,ta)._++}`,l=A(this,se,nl).call(this,o);a(this,se,Yt).set(t,l),a(this,se,Yt).set(r,l);const c=A(this,se,sl).call(this,o);return A(this,se,tS).call(this,c),t&&A(this,se,mv).call(this,i,c),l}addHighlightHCMFilter(t,s,i,r,o){var v;const l=`${s}-${i}-${r}-${o}`;let c=a(this,se,gu).get(t);if((c==null?void 0:c.key)===l||(c?((v=c.filter)==null||v.remove(),c.key=l,c.url="none",c.filter=null):(c={key:l,url:"none",filter:null},a(this,se,gu).set(t,c)),!s||!i))return c.url;const[u,h]=[s,i].map(A(this,se,yu).bind(this));let d=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),f=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[p,y]=[r,o].map(A(this,se,yu).bind(this));f<d&&([d,f,p,y]=[f,d,y,p]),a(this,se,tl).style.color="";const w=(E,x,C)=>{const P=new Array(256),N=(f-d)/C,I=E/255,L=(x-E)/(255*C);let U=0;for(let W=0;W<=C;W++){const M=Math.round(d+W*N),K=I+W*L;for(let q=U;q<=M;q++)P[q]=K;U=M+1}for(let W=U;W<256;W++)P[W]=P[U-1];return P.join(",")},_=`g_${a(this,ji)}_hcm_${t}_filter`,m=c.filter=A(this,se,sl).call(this,_);return A(this,se,gv).call(this,m),A(this,se,vu).call(this,w(p[0],y[0],5),w(p[1],y[1],5),w(p[2],y[2],5),m),c.url=A(this,se,nl).call(this,_),c.url}destroy(t=!1){var s,i,r,o;t&&((s=a(this,ea))!=null&&s.size)||((i=a(this,Oi))==null||i.parentNode.parentNode.remove(),g(this,Oi,null),(r=a(this,Wl))==null||r.clear(),g(this,Wl,null),(o=a(this,ea))==null||o.clear(),g(this,ea,null),g(this,ta,0))}}Jo=new WeakMap,Wl=new WeakMap,Oi=new WeakMap,ji=new WeakMap,Qt=new WeakMap,ea=new WeakMap,ta=new WeakMap,se=new WeakSet,Yt=function(){return a(this,Wl)||g(this,Wl,new Map)},gu=function(){return a(this,ea)||g(this,ea,new Map)},tl=function(){if(!a(this,Oi)){const t=a(this,Qt).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=a(this,Qt).createElementNS(Si,"svg");i.setAttribute("width",0),i.setAttribute("height",0),g(this,Oi,a(this,Qt).createElementNS(Si,"defs")),t.append(i),i.append(a(this,Oi)),a(this,Qt).body.append(t)}return a(this,Oi)},Pf=function(t){if(t.length===1){const u=t[0],h=new Array(256);for(let f=0;f<256;f++)h[f]=u[f]/255;const d=h.join(",");return[d,d,d]}const[s,i,r]=t,o=new Array(256),l=new Array(256),c=new Array(256);for(let u=0;u<256;u++)o[u]=s[u]/255,l[u]=i[u]/255,c[u]=r[u]/255;return[o.join(","),l.join(","),c.join(",")]},nl=function(t){if(a(this,Jo)===void 0){g(this,Jo,"");const s=a(this,Qt).URL;s!==a(this,Qt).baseURI&&(pg(s)?Se('#createUrl: ignore "data:"-URL for performance reasons.'):g(this,Jo,s.split("#",1)[0]))}return`url(${a(this,Jo)}#${t})`},tS=function(t){const s=a(this,Qt).createElementNS(Si,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},gv=function(t){const s=a(this,Qt).createElementNS(Si,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},sl=function(t){const s=a(this,Qt).createElementNS(Si,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),a(this,se,tl).append(s),s},mu=function(t,s,i){const r=a(this,Qt).createElementNS(Si,s);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},vu=function(t,s,i,r){const o=a(this,Qt).createElementNS(Si,"feComponentTransfer");r.append(o),A(this,se,mu).call(this,o,"feFuncR",t),A(this,se,mu).call(this,o,"feFuncG",s),A(this,se,mu).call(this,o,"feFuncB",i)},mv=function(t,s){const i=a(this,Qt).createElementNS(Si,"feComponentTransfer");s.append(i),A(this,se,mu).call(this,i,"feFuncA",t)},yu=function(t){return a(this,se,tl).style.color=t,ly(getComputedStyle(a(this,se,tl)).getPropertyValue("color"))};class nS{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Be("Abstract method `_fetch` called.")}}class sS extends nS{async _fetch(e){const t=await fg(e,"arraybuffer");return new Uint8Array(t)}}nn&&Se("Please use the `legacy` build in Node.js environments.");async function iS(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class CC extends eS{}class kC extends QA{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class TC extends ZA{async _fetch(e){return iS(e)}}class PC extends nS{async _fetch(e){return iS(e)}}const en={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function vv(n,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),n.clip(i)}class uy{getPattern(){Be("Abstract method `getPattern` called.")}}class NC extends uy{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let r;if(i===en.STROKE||i===en.FILL){const o=t.current.getClippedPathBoundingBox(i,qe(e))||[0,0,0,0],l=Math.ceil(o[2]-o[0])||1,c=Math.ceil(o[3]-o[1])||1,u=t.cachedCanvases.getCanvas("pattern",l,c),h=u.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-o[0],-o[1]),s=ue.transform(s,[1,0,0,1,o[0],o[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),vv(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),r=e.createPattern(u.canvas,"no-repeat");const d=new DOMMatrix(s);r.setTransform(d)}else vv(e,this._bbox),r=this._createGradient(e);return r}}function Yg(n,e,t,s,i,r,o,l){const c=e.coords,u=e.colors,h=n.data,d=n.width*4;let f;c[t+1]>c[s+1]&&(f=t,t=s,s=f,f=r,r=o,o=f),c[s+1]>c[i+1]&&(f=s,s=i,i=f,f=o,o=l,l=f),c[t+1]>c[s+1]&&(f=t,t=s,s=f,f=r,r=o,o=f);const p=(c[t]+e.offsetX)*e.scaleX,y=(c[t+1]+e.offsetY)*e.scaleY,w=(c[s]+e.offsetX)*e.scaleX,_=(c[s+1]+e.offsetY)*e.scaleY,m=(c[i]+e.offsetX)*e.scaleX,v=(c[i+1]+e.offsetY)*e.scaleY;if(y>=v)return;const E=u[r],x=u[r+1],C=u[r+2],P=u[o],N=u[o+1],I=u[o+2],L=u[l],U=u[l+1],W=u[l+2],M=Math.round(y),K=Math.round(v);let q,ee,z,T,R,$,D,Y;for(let te=M;te<=K;te++){if(te<_){const he=te<y?0:(y-te)/(y-_);q=p-(p-w)*he,ee=E-(E-P)*he,z=x-(x-N)*he,T=C-(C-I)*he}else{let he;te>v?he=1:_===v?he=0:he=(_-te)/(_-v),q=w-(w-m)*he,ee=P-(P-L)*he,z=N-(N-U)*he,T=I-(I-W)*he}let Z;te<y?Z=0:te>v?Z=1:Z=(y-te)/(y-v),R=p-(p-m)*Z,$=E-(E-L)*Z,D=x-(x-U)*Z,Y=C-(C-W)*Z;const me=Math.round(Math.min(q,R)),Ge=Math.round(Math.max(q,R));let _e=d*te+me*4;for(let he=me;he<=Ge;he++)Z=(q-he)/(q-R),Z<0?Z=0:Z>1&&(Z=1),h[_e++]=ee-(ee-$)*Z|0,h[_e++]=z-(z-D)*Z|0,h[_e++]=T-(T-Y)*Z|0,h[_e++]=255}}function RC(n,e,t){const s=e.coords,i=e.colors;let r,o;switch(e.type){case"lattice":const l=e.verticesPerRow,c=Math.floor(s.length/l)-1,u=l-1;for(r=0;r<c;r++){let h=r*l;for(let d=0;d<u;d++,h++)Yg(n,t,s[h],s[h+1],s[h+l],i[h],i[h+1],i[h+l]),Yg(n,t,s[h+l+1],s[h+1],s[h+l],i[h+l+1],i[h+1],i[h+l])}break;case"triangles":for(r=0,o=s.length;r<o;r+=3)Yg(n,t,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class MC extends uy{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,s){const l=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-l,h=Math.ceil(this._bounds[3])-c,d=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(h*e[1]*1.1)),3e3),p=u/d,y=h/f,w={coords:this._coords,colors:this._colors,offsetX:-l,offsetY:-c,scaleX:1/p,scaleY:1/y},_=d+2*2,m=f+2*2,v=s.getCanvas("mesh",_,m),E=v.context,x=E.createImageData(d,f);if(t){const P=x.data;for(let N=0,I=P.length;N<I;N+=4)P[N]=t[0],P[N+1]=t[1],P[N+2]=t[2],P[N+3]=255}for(const P of this._figures)RC(x,P,w);return E.putImageData(x,2,2),{canvas:v.canvas,offsetX:l-2*p,offsetY:c-2*y,scaleX:p,scaleY:y}}getPattern(e,t,s,i){vv(e,this._bbox);let r;if(i===en.SHADING)r=ue.singularValueDecompose2dScale(qe(e));else if(r=ue.singularValueDecompose2dScale(t.baseTransform),this.matrix){const l=ue.singularValueDecompose2dScale(this.matrix);r=[r[0]*l[0],r[1]*l[1]]}const o=this._createMeshCanvas(r,i===en.SHADING?null:this._background,t.cachedCanvases);return i!==en.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class LC extends uy{getPattern(){return"hotpink"}}function IC(n){switch(n[0]){case"RadialAxial":return new NC(n);case"Mesh":return new MC(n);case"Dummy":return new LC}throw new Error(`Unknown IR type: ${n[0]}`)}const Fw={COLORED:1,UNCOLORED:2},Dp=class Dp{constructor(e,t,s,i,r){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=s,this.canvasGraphicsFactory=i,this.baseTransform=r}createPatternCanvas(e){const{bbox:t,operatorList:s,paintType:i,tilingType:r,color:o,canvasGraphicsFactory:l}=this;let{xstep:c,ystep:u}=this;c=Math.abs(c),u=Math.abs(u),hg("TilingType: "+r);const h=t[0],d=t[1],f=t[2],p=t[3],y=f-h,w=p-d,_=ue.singularValueDecompose2dScale(this.matrix),m=ue.singularValueDecompose2dScale(this.baseTransform),v=_[0]*m[0],E=_[1]*m[1];let x=y,C=w,P=!1,N=!1;const I=Math.ceil(c*v),L=Math.ceil(u*E),U=Math.ceil(y*v),W=Math.ceil(w*E);I>=U?x=c:P=!0,L>=W?C=u:N=!0;const M=this.getSizeAndScale(x,this.ctx.canvas.width,v),K=this.getSizeAndScale(C,this.ctx.canvas.height,E),q=e.cachedCanvases.getCanvas("pattern",M.size,K.size),ee=q.context,z=l.createCanvasGraphics(ee);if(z.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(z,i,o),ee.translate(-M.scale*h,-K.scale*d),z.transform(M.scale,0,0,K.scale,0,0),ee.save(),this.clipBbox(z,h,d,f,p),z.baseTransform=qe(z.ctx),z.executeOperatorList(s),z.endDrawing(),ee.restore(),P||N){const T=q.canvas;P&&(x=c),N&&(C=u);const R=this.getSizeAndScale(x,this.ctx.canvas.width,v),$=this.getSizeAndScale(C,this.ctx.canvas.height,E),D=R.size,Y=$.size,te=e.cachedCanvases.getCanvas("pattern-workaround",D,Y),Z=te.context,me=P?Math.floor(y/c):0,Ge=N?Math.floor(w/u):0;for(let _e=0;_e<=me;_e++)for(let he=0;he<=Ge;he++)Z.drawImage(T,D*_e,Y*he,D,Y,0,0,D,Y);return{canvas:te.canvas,scaleX:R.scale,scaleY:$.scale,offsetX:h,offsetY:d}}return{canvas:q.canvas,scaleX:M.scale,scaleY:K.scale,offsetX:h,offsetY:d}}getSizeAndScale(e,t,s){const i=Math.max(Dp.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*s);return r>=i?r=i:s=r/e,{scale:s,size:r}}clipBbox(e,t,s,i,r){const o=i-t,l=r-s;e.ctx.rect(t,s,o,l),e.current.updateRectMinMax(qe(e.ctx),[t,s,i,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,r=e.current;switch(t){case Fw.COLORED:const o=this.ctx;i.fillStyle=o.fillStyle,i.strokeStyle=o.strokeStyle,r.fillColor=o.fillStyle,r.strokeColor=o.strokeStyle;break;case Fw.UNCOLORED:const l=ue.makeHexColor(s[0],s[1],s[2]);i.fillStyle=l,i.strokeStyle=l,r.fillColor=l,r.strokeColor=l;break;default:throw new oC(`Unsupported paint type: ${t}`)}}getPattern(e,t,s,i){let r=s;i!==en.SHADING&&(r=ue.transform(r,t.baseTransform),this.matrix&&(r=ue.transform(r,this.matrix)));const o=this.createPatternCanvas(t);let l=new DOMMatrix(r);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);const c=e.createPattern(o.canvas,"repeat");return c.setTransform(l),c}};V(Dp,"MAX_PATTERN_SIZE",3e3);let yv=Dp;function DC({src:n,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const l=pn.isLittleEndian?4278190080:255,[c,u]=o?[r,l]:[l,r],h=s>>3,d=s&7,f=n.length;t=new Uint32Array(t.buffer);let p=0;for(let y=0;y<i;y++){for(const _=e+h;e<_;e++){const m=e<f?n[e]:255;t[p++]=m&128?u:c,t[p++]=m&64?u:c,t[p++]=m&32?u:c,t[p++]=m&16?u:c,t[p++]=m&8?u:c,t[p++]=m&4?u:c,t[p++]=m&2?u:c,t[p++]=m&1?u:c}if(d===0)continue;const w=e<f?n[e++]:255;for(let _=0;_<d;_++)t[p++]=w&1<<7-_?u:c}return{srcPos:e,destPos:p}}const Ow=16,jw=100,FC=15,zw=10,$w=1e3,Cn=16;function OC(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(s,i){e.translate(s,i),this.__originalTranslate(s,i)},n.scale=function(s,i){e.scale(s,i),this.__originalScale(s,i)},n.transform=function(s,i,r,o,l,c){e.transform(s,i,r,o,l,c),this.__originalTransform(s,i,r,o,l,c)},n.setTransform=function(s,i,r,o,l,c){e.setTransform(s,i,r,o,l,c),this.__originalSetTransform(s,i,r,o,l,c)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(s){e.rotate(s),this.__originalRotate(s)},n.clip=function(s){e.clip(s),this.__originalClip(s)},n.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},n.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},n.bezierCurveTo=function(t,s,i,r,o,l){e.bezierCurveTo(t,s,i,r,o,l),this.__originalBezierCurveTo(t,s,i,r,o,l)},n.rect=function(t,s,i,r){e.rect(t,s,i,r),this.__originalRect(t,s,i,r)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class jC{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function tf(n,e,t,s,i,r,o,l,c,u){const[h,d,f,p,y,w]=qe(n);if(d===0&&f===0){const v=o*h+y,E=Math.round(v),x=l*p+w,C=Math.round(x),P=(o+c)*h+y,N=Math.abs(Math.round(P)-E)||1,I=(l+u)*p+w,L=Math.abs(Math.round(I)-C)||1;return n.setTransform(Math.sign(h),0,0,Math.sign(p),E,C),n.drawImage(e,t,s,i,r,0,0,N,L),n.setTransform(h,d,f,p,y,w),[N,L]}if(h===0&&p===0){const v=l*f+y,E=Math.round(v),x=o*d+w,C=Math.round(x),P=(l+u)*f+y,N=Math.abs(Math.round(P)-E)||1,I=(o+c)*d+w,L=Math.abs(Math.round(I)-C)||1;return n.setTransform(0,Math.sign(d),Math.sign(f),0,E,C),n.drawImage(e,t,s,i,r,0,0,L,N),n.setTransform(h,d,f,p,y,w),[L,N]}n.drawImage(e,t,s,i,r,o,l,c,u);const _=Math.hypot(h,d),m=Math.hypot(f,p);return[_*c,m*u]}function zC(n){const{width:e,height:t}=n;if(e>$w||t>$w)return null;const s=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1;let o=new Uint8Array(r*(t+1)),l,c,u;const h=e+7&-8;let d=new Uint8Array(h*t),f=0;for(const m of n.data){let v=128;for(;v>0;)d[f++]=m&v?0:255,v>>=1}let p=0;for(f=0,d[f]!==0&&(o[0]=1,++p),c=1;c<e;c++)d[f]!==d[f+1]&&(o[c]=d[f]?2:1,++p),f++;for(d[f]!==0&&(o[c]=2,++p),l=1;l<t;l++){f=l*h,u=l*r,d[f-h]!==d[f]&&(o[u]=d[f]?1:8,++p);let m=(d[f]?4:0)+(d[f-h]?8:0);for(c=1;c<e;c++)m=(m>>2)+(d[f+1]?4:0)+(d[f-h+1]?8:0),i[m]&&(o[u+c]=i[m],++p),f++;if(d[f-h]!==d[f]&&(o[u+c]=d[f]?2:4,++p),p>s)return null}for(f=h*(t-1),u=l*r,d[f]!==0&&(o[u]=8,++p),c=1;c<e;c++)d[f]!==d[f+1]&&(o[u+c]=d[f]?4:8,++p),f++;if(d[f]!==0&&(o[u+c]=4,++p),p>s)return null;const y=new Int32Array([0,r,-1,0,-r,0,0,0,1]),w=new Path2D;for(l=0;p&&l<=t;l++){let m=l*r;const v=m+e;for(;m<v&&!o[m];)m++;if(m===v)continue;w.moveTo(m%r,l);const E=m;let x=o[m];do{const C=y[x];do m+=C;while(!o[m]);const P=o[m];P!==5&&P!==10?(x=P,o[m]=0):(x=P&51*x>>4,o[m]&=x>>2|x<<2),w.lineTo(m%r,m/r|0),o[m]||--p}while(E!==m);--l}return d=null,o=null,function(m){m.save(),m.scale(1/e,-1/t),m.translate(0,-t),m.fill(w),m.beginPath(),m.restore()}}class Hw{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=pA,this.textMatrixScale=1,this.fontMatrix=Wm,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Xt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,s){[t,s]=ue.applyTransform([t,s],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(e,t){const s=ue.applyTransform(t,e),i=ue.applyTransform(t.slice(2),e),r=ue.applyTransform([t[0],t[3]],e),o=ue.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,s[0],i[0],r[0],o[0]),this.minY=Math.min(this.minY,s[1],i[1],r[1],o[1]),this.maxX=Math.max(this.maxX,s[0],i[0],r[0],o[0]),this.maxY=Math.max(this.maxY,s[1],i[1],r[1],o[1])}updateScalingPathMinMax(e,t){ue.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,s,i,r,o,l,c,u,h){const d=ue.bezierBoundingBox(t,s,i,r,o,l,c,u,h);h||this.updateRectMinMax(e,d)}getPathBoundingBox(e=en.FILL,t=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(e===en.STROKE){t||Be("Stroke bounding box must include transform.");const i=ue.singularValueDecompose2dScale(t),r=i[0]*this.lineWidth/2,o=i[1]*this.lineWidth/2;s[0]-=r,s[1]-=o,s[2]+=r,s[3]+=o}return s}updateClipFromPath(){const e=ue.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=en.FILL,t=null){return ue.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Bw(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%Cn,r=(t-i)/Cn,o=i===0?r:r+1,l=n.createImageData(s,Cn);let c=0,u;const h=e.data,d=l.data;let f,p,y,w;if(e.kind===wf.GRAYSCALE_1BPP){const _=h.byteLength,m=new Uint32Array(d.buffer,0,d.byteLength>>2),v=m.length,E=s+7>>3,x=4294967295,C=pn.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(y=f<r?Cn:i,u=0,p=0;p<y;p++){const P=_-c;let N=0;const I=P>E?s:P*8-7,L=I&-8;let U=0,W=0;for(;N<L;N+=8)W=h[c++],m[u++]=W&128?x:C,m[u++]=W&64?x:C,m[u++]=W&32?x:C,m[u++]=W&16?x:C,m[u++]=W&8?x:C,m[u++]=W&4?x:C,m[u++]=W&2?x:C,m[u++]=W&1?x:C;for(;N<I;N++)U===0&&(W=h[c++],U=128),m[u++]=W&U?x:C,U>>=1}for(;u<v;)m[u++]=0;n.putImageData(l,0,f*Cn)}}else if(e.kind===wf.RGBA_32BPP){for(p=0,w=s*Cn*4,f=0;f<r;f++)d.set(h.subarray(c,c+w)),c+=w,n.putImageData(l,0,p),p+=Cn;f<o&&(w=s*i*4,d.set(h.subarray(c,c+w)),n.putImageData(l,0,p))}else if(e.kind===wf.RGB_24BPP)for(y=Cn,w=s*y,f=0;f<o;f++){for(f>=r&&(y=i,w=s*y),u=0,p=w;p--;)d[u++]=h[c++],d[u++]=h[c++],d[u++]=h[c++],d[u++]=255;n.putImageData(l,0,f*Cn)}else throw new Error(`bad image kind: ${e.kind}`)}function Uw(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%Cn,r=(t-i)/Cn,o=i===0?r:r+1,l=n.createImageData(s,Cn);let c=0;const u=e.data,h=l.data;for(let d=0;d<o;d++){const f=d<r?Cn:i;({srcPos:c}=DC({src:u,srcPos:c,dest:h,width:s,height:f,nonBlackColor:0})),n.putImageData(l,0,d*Cn)}}function su(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)n[s]!==void 0&&(e[s]=n[s]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function nf(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!nn){const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}}function Vw(n,e){if(e)return!0;const t=ue.singularValueDecompose2dScale(n);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*po.PDF_TO_CSS_UNITS);return t[0]<=s&&t[1]<=s}const $C=["butt","round","square"],HC=["miter","round","bevel"],BC={},Gw={};var Us,wv,bv,xv;const gy=class gy{constructor(e,t,s,i,r,{optionalContentConfig:o,markedContentStack:l=null},c,u){b(this,Us);this.ctx=e,this.current=new Hw(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new jC(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,l=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=l,s){const c=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...qe(this.compositeCtx))}this.ctx.save(),nf(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=qe(this.ctx)}executeOperatorList(e,t,s,i){const r=e.argsArray,o=e.fnArray;let l=t||0;const c=r.length;if(c===l)return l;const u=c-l>zw&&typeof s=="function",h=u?Date.now()+FC:0;let d=0;const f=this.commonObjs,p=this.objs;let y;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,s),l;if(y=o[l],y!==Ss.dependency)this[y].apply(this,r[l]);else for(const w of r[l]){const _=w.startsWith("g_")?f:p;if(!_.has(w))return _.get(w,s),l}if(l++,l===c)return l;if(u&&++d>zw){if(Date.now()>h)return s(),l;d=0}}}endDrawing(){A(this,Us,wv).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),A(this,Us,bv).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=s,c=i,u="prescale1",h,d;for(;r>2&&l>1||o>2&&c>1;){let f=l,p=c;r>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),r/=l/f),o>2&&c>1&&(p=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/p),h=this.cachedCanvases.getCanvas(u,f,p),d=h.context,d.clearRect(0,0,f,p),d.drawImage(e,0,0,l,c,0,0,f,p),e=h.canvas,l=f,c=p,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e){const t=this.ctx,{width:s,height:i}=e,r=this.current.fillColor,o=this.current.patternFill,l=qe(t);let c,u,h,d;if((e.bitmap||e.data)&&e.count>1){const I=e.bitmap||e.data.buffer;u=JSON.stringify(o?l:[l.slice(0,4),r]),c=this._cachedBitmapsMap.get(I),c||(c=new Map,this._cachedBitmapsMap.set(I,c));const L=c.get(u);if(L&&!o){const U=Math.round(Math.min(l[0],l[2])+l[4]),W=Math.round(Math.min(l[1],l[3])+l[5]);return{canvas:L,offsetX:U,offsetY:W}}h=L}h||(d=this.cachedCanvases.getCanvas("maskCanvas",s,i),Uw(d.context,e));let f=ue.transform(l,[1/s,0,0,-1/i,0,0]);f=ue.transform(f,[1,0,0,1,0,-i]);const[p,y,w,_]=ue.getAxialAlignedBoundingBox([0,0,s,i],f),m=Math.round(w-p)||1,v=Math.round(_-y)||1,E=this.cachedCanvases.getCanvas("fillCanvas",m,v),x=E.context,C=p,P=y;x.translate(-C,-P),x.transform(...f),h||(h=this._scaleImage(d.canvas,Ys(x)),h=h.img,c&&o&&c.set(u,h)),x.imageSmoothingEnabled=Vw(qe(x),e.interpolate),tf(x,h,0,0,h.width,h.height,0,0,s,i),x.globalCompositeOperation="source-in";const N=ue.transform(Ys(x),[1,0,0,1,-C,-P]);return x.fillStyle=o?r.getPattern(t,this,N,en.FILL):r,x.fillRect(0,0,s,i),c&&!o&&(this.cachedCanvases.delete("fillCanvas"),c.set(u,E.canvas)),{canvas:E.canvas,offsetX:Math.round(C),offsetY:Math.round(P)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=$C[e]}setLineJoin(e){this.ctx.lineJoin=HC[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;const r=this.ctx;r.setTransform(...qe(this.suspendedCtx)),su(this.suspendedCtx,r),OC(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),su(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const r=i[0],o=i[1],l=i[2]-r,c=i[3]-o;l===0||c===0||(this.genericComposeSMask(t.context,s,l,c,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,r,o,l,c,u,h,d){let f=e.canvas,p=c-h,y=u-d;if(o){const _=ue.makeHexColor(...o);if(p<0||y<0||p+s>f.width||y+i>f.height){const m=this.cachedCanvases.getCanvas("maskExtension",s,i),v=m.context;v.drawImage(f,-p,-y),v.globalCompositeOperation="destination-atop",v.fillStyle=_,v.fillRect(0,0,s,i),v.globalCompositeOperation="source-over",f=m.canvas,p=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const m=new Path2D;m.rect(p,y,s,i),e.clip(m),e.globalCompositeOperation="destination-atop",e.fillStyle=_,e.fillRect(p,y,s,i),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&l?t.filter=this.filterFactory.addAlphaFilter(l):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(l));const w=new Path2D;w.rect(c,u,s,i),t.clip(w),t.globalCompositeOperation="destination-in",t.drawImage(f,p,y,s,i,c,u,s,i),t.restore()}save(){this.inSMaskMode?(su(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),su(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,s,i,r,o){this.ctx.transform(e,t,s,i,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){const i=this.ctx,r=this.current;let o=r.x,l=r.y,c,u;const h=qe(i),d=h[0]===0&&h[3]===0||h[1]===0&&h[2]===0,f=d?s.slice(0):null;for(let p=0,y=0,w=e.length;p<w;p++)switch(e[p]|0){case Ss.rectangle:o=t[y++],l=t[y++];const _=t[y++],m=t[y++],v=o+_,E=l+m;i.moveTo(o,l),_===0||m===0?i.lineTo(v,E):(i.lineTo(v,l),i.lineTo(v,E),i.lineTo(o,E)),d||r.updateRectMinMax(h,[o,l,v,E]),i.closePath();break;case Ss.moveTo:o=t[y++],l=t[y++],i.moveTo(o,l),d||r.updatePathMinMax(h,o,l);break;case Ss.lineTo:o=t[y++],l=t[y++],i.lineTo(o,l),d||r.updatePathMinMax(h,o,l);break;case Ss.curveTo:c=o,u=l,o=t[y+4],l=t[y+5],i.bezierCurveTo(t[y],t[y+1],t[y+2],t[y+3],o,l),r.updateCurvePathMinMax(h,c,u,t[y],t[y+1],t[y+2],t[y+3],o,l,f),y+=6;break;case Ss.curveTo2:c=o,u=l,i.bezierCurveTo(o,l,t[y],t[y+1],t[y+2],t[y+3]),r.updateCurvePathMinMax(h,c,u,o,l,t[y],t[y+1],t[y+2],t[y+3],f),o=t[y+2],l=t[y+3],y+=4;break;case Ss.curveTo3:c=o,u=l,o=t[y+2],l=t[y+3],i.bezierCurveTo(t[y],t[y+1],o,l,o,l),r.updateCurvePathMinMax(h,c,u,t[y],t[y+1],o,l,o,l,f),y+=4;break;case Ss.closePath:i.closePath();break}d&&r.updateScalingPathMinMax(h,f),r.setCurrentPoint(o,l)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,s=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(t.save(),t.strokeStyle=s.getPattern(t,this,Ys(t),en.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;let r=!1;i&&(t.save(),t.fillStyle=s.getPattern(t,this,Ys(t),en.FILL),r=!0);const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=BC}eoClip(){this.pendingClip=Gw}beginText(){this.current.textMatrix=pA,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const s=new Path2D,i=t.getTransform().invertSelf();for(const{transform:r,x:o,y:l,fontSize:c,path:u}of e)s.addPath(u,new DOMMatrix(r).preMultiplySelf(i).translate(o,l).scale(c,-c));t.clip(s),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var h;const s=this.commonObjs.get(e),i=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=s.fontMatrix||Wm,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&Se("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const r=s.loadedName||"sans-serif",o=((h=s.systemFontInfo)==null?void 0:h.css)||`"${r}", ${s.fallbackName}`;let l="normal";s.black?l="900":s.bold&&(l="bold");const c=s.italic?"italic":"normal";let u=t;t<Ow?u=Ow:t>jw&&(u=jw),this.current.fontSizeScale=t/u,this.ctx.font=`${c} ${l} ${u}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,s,i,r,o){this.current.textMatrix=[e,t,s,i,r,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,s,i,r){const o=this.ctx,l=this.current,c=l.font,u=l.textRenderingMode,h=l.fontSize/l.fontSizeScale,d=u&Xt.FILL_STROKE_MASK,f=!!(u&Xt.ADD_TO_PATH_FLAG),p=l.patternFill&&!c.missingFile,y=l.patternStroke&&!c.missingFile;let w;if((c.disableFontFace||f||p||y)&&(w=c.getPathGenerator(this.commonObjs,e)),c.disableFontFace||p||y){if(o.save(),o.translate(t,s),o.scale(h,-h),d===Xt.FILL||d===Xt.FILL_STROKE)if(i){const _=o.getTransform();o.setTransform(...i),o.fill(A(this,Us,xv).call(this,w,_,i))}else o.fill(w);if(d===Xt.STROKE||d===Xt.FILL_STROKE)if(r){const _=o.getTransform();o.setTransform(...r),o.stroke(A(this,Us,xv).call(this,w,_,r))}else o.lineWidth/=h,o.stroke(w);o.restore()}else(d===Xt.FILL||d===Xt.FILL_STROKE)&&o.fillText(e,t,s),(d===Xt.STROKE||d===Xt.FILL_STROKE)&&o.strokeText(e,t,s);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:qe(o),x:t,y:s,fontSize:h,path:w})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return ke(this,"isFontSubpixelAAEnabled",s)}showText(e){const t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);const i=t.fontSize;if(i===0)return;const r=this.ctx,o=t.fontSizeScale,l=t.charSpacing,c=t.wordSpacing,u=t.fontDirection,h=t.textHScale*u,d=e.length,f=s.vertical,p=f?1:-1,y=s.defaultVMetrics,w=i*t.fontMatrix[0],_=t.textRenderingMode===Xt.FILL&&!s.disableFontFace&&!t.patternFill;r.save(),r.transform(...t.textMatrix),r.translate(t.x,t.y+t.textRise),u>0?r.scale(h,-1):r.scale(h,1);let m,v;if(t.patternFill){r.save();const N=t.fillColor.getPattern(r,this,Ys(r),en.FILL);m=qe(r),r.restore(),r.fillStyle=N}if(t.patternStroke){r.save();const N=t.strokeColor.getPattern(r,this,Ys(r),en.STROKE);v=qe(r),r.restore(),r.strokeStyle=N}let E=t.lineWidth;const x=t.textMatrixScale;if(x===0||E===0){const N=t.textRenderingMode&Xt.FILL_STROKE_MASK;(N===Xt.STROKE||N===Xt.FILL_STROKE)&&(E=this.getSinglePixelWidth())}else E/=x;if(o!==1&&(r.scale(o,o),E/=o),r.lineWidth=E,s.isInvalidPDFjsFont){const N=[];let I=0;for(const L of e)N.push(L.unicode),I+=L.width;r.fillText(N.join(""),0,0),t.x+=I*w*h,r.restore(),this.compose();return}let C=0,P;for(P=0;P<d;++P){const N=e[P];if(typeof N=="number"){C+=p*N*i/1e3;continue}let I=!1;const L=(N.isSpace?c:0)+l,U=N.fontChar,W=N.accent;let M,K,q=N.width;if(f){const z=N.vmetric||y,T=-(N.vmetric?z[1]:q*.5)*w,R=z[2]*w;q=z?-z[0]:q,M=T/o,K=(C+R)/o}else M=C/o,K=0;if(s.remeasure&&q>0){const z=r.measureText(U).width*1e3/i*o;if(q<z&&this.isFontSubpixelAAEnabled){const T=q/z;I=!0,r.save(),r.scale(T,1),M/=T}else q!==z&&(M+=(q-z)/2e3*i/o)}if(this.contentVisible&&(N.isInFont||s.missingFile)){if(_&&!W)r.fillText(U,M,K);else if(this.paintChar(U,M,K,m,v),W){const z=M+i*W.offset.x/o,T=K-i*W.offset.y/o;this.paintChar(W.fontChar,z,T,m,v)}}const ee=f?q*w-L*u:q*w+L*u;C+=ee,I&&r.restore()}f?t.y-=C:t.x+=C*h,r.restore(),this.compose()}showType3Text(e){const t=this.ctx,s=this.current,i=s.font,r=s.fontSize,o=s.fontDirection,l=i.vertical?1:-1,c=s.charSpacing,u=s.wordSpacing,h=s.textHScale*o,d=s.fontMatrix||Wm,f=e.length,p=s.textRenderingMode===Xt.INVISIBLE;let y,w,_,m;if(!(p||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...s.textMatrix),t.translate(s.x,s.y),t.scale(h,o),y=0;y<f;++y){if(w=e[y],typeof w=="number"){m=l*w*r/1e3,this.ctx.translate(m,0),s.x+=m*h;continue}const v=(w.isSpace?u:0)+c,E=i.charProcOperatorList[w.operatorListId];if(!E){Se(`Type3 character "${w.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=w,this.save(),t.scale(r,r),t.transform(...d),this.executeOperatorList(E),this.restore()),_=ue.applyTransform([w.width,0],d)[0]*r+v,t.translate(_,0),s.x+=_*h}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,i,r,o){this.ctx.rect(s,i,r-s,o-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const s=e[1],i=this.baseTransform||qe(this.ctx),r={createCanvasGraphics:o=>new gy(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new yv(e,s,this.ctx,r,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,s){this.ctx.strokeStyle=this.current.strokeColor=ue.makeHexColor(e,t,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,s){this.ctx.fillStyle=this.current.fillColor=ue.makeHexColor(e,t,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=IC(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,Ys(t),en.SHADING);const i=Ys(t);if(i){const{width:r,height:o}=t.canvas,[l,c,u,h]=ue.getAxialAlignedBoundingBox([0,0,r,o],i);this.ctx.fillRect(l,c,u-l,h-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Be("Should not call beginInlineImage")}beginImageData(){Be("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=qe(this.ctx),t)){const s=t[2]-t[0],i=t[3]-t[1];this.ctx.rect(t[0],t[1],s,i),this.current.updateRectMinMax(qe(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||hg("TODO: Support non-isolated groups."),e.knockout&&Se("Knockout groups not supported.");const s=qe(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=ue.getAxialAlignedBoundingBox(e.bbox,qe(t));const r=[0,0,t.canvas.width,t.canvas.height];i=ue.intersect(i,r)||[0,0,0,0];const o=Math.floor(i[0]),l=Math.floor(i[1]),c=Math.max(Math.ceil(i[2])-o,1),u=Math.max(Math.ceil(i[3])-l,1);this.current.startNewPathAndClipBox([0,0,c,u]);let h="groupAt"+this.groupLevel;e.smask&&(h+="_smask_"+this.smaskCounter++%2);const d=this.cachedCanvases.getCanvas(h,c,u),f=d.context;f.translate(-o,-l),f.transform(...s),e.smask?this.smaskStack.push({canvas:d.canvas,context:f,offsetX:o,offsetY:l,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,l),t.save()),su(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=qe(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const r=ue.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,s,i,r){if(A(this,Us,wv).call(this),nf(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const o=t[2]-t[0],l=t[3]-t[1];if(r&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=l;const[c,u]=ue.singularValueDecompose2dScale(qe(this.ctx)),{viewportScale:h}=this,d=Math.ceil(o*this.outputScaleX*h),f=Math.ceil(l*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(d,f);const{canvas:p,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(c,0,0,-u,0,l*u),nf(this.ctx)}else nf(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,l),this.ctx.clip(),this.ctx.beginPath()}this.current=new Hw(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),A(this,Us,bv).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const s=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=zC(e)),i.compiled)){i.compiled(s);return}const r=this._createMaskCanvas(e),o=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(o,r.offsetX,r.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,i=0,r,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);const l=this.ctx;l.save();const c=qe(l);l.transform(t,s,i,r,0,0);const u=this._createMaskCanvas(e);l.setTransform(1,0,0,1,u.offsetX-c[4],u.offsetY-c[5]);for(let h=0,d=o.length;h<d;h+=2){const f=ue.transform(c,[t,s,i,r,o[h],o[h+1]]),[p,y]=ue.applyTransform([0,0],f);l.drawImage(u.canvas,p,y)}l.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const r of e){const{data:o,width:l,height:c,transform:u}=r,h=this.cachedCanvases.getCanvas("maskCanvas",l,c),d=h.context;d.save();const f=this.getObject(o,r);Uw(d,f),d.globalCompositeOperation="source-in",d.fillStyle=i?s.getPattern(d,this,Ys(t),en.FILL):s,d.fillRect(0,0,l,c),d.restore(),t.save(),t.transform(...u),t.scale(1,-1),tf(t,h.canvas,0,0,l,c,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Se("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,i){if(!this.contentVisible)return;const r=this.getObject(e);if(!r){Se("Dependent image isn't ready yet");return}const o=r.width,l=r.height,c=[];for(let u=0,h=i.length;u<h;u+=2)c.push({transform:[t,0,0,s,i[u],i[u+1]],x:0,y:0,w:o,h:l});this.paintInlineImageXObjectGroup(r,c)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",s,i),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,s=e.height,i=this.ctx;if(this.save(),!nn){const{filter:l}=i;l!=="none"&&l!==""&&(i.filter="none")}i.scale(1/t,-1/s);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{const c=this.cachedCanvases.getCanvas("inlineImage",t,s).context;Bw(c,e),r=this.applyTransferMapsToCanvas(c)}const o=this._scaleImage(r,Ys(i));i.imageSmoothingEnabled=Vw(qe(i),e.interpolate),tf(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const r=e.width,o=e.height,c=this.cachedCanvases.getCanvas("inlineImage",r,o).context;Bw(c,e),i=this.applyTransferMapsToCanvas(c)}for(const r of t)s.save(),s.transform(...r.transform),s.scale(1,-1),tf(s,i,r.x,r.y,r.w,r.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(t||(this.pendingClip===Gw?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=qe(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:r}=this.ctx.getTransform();let o,l;if(s===0&&i===0){const c=Math.abs(t),u=Math.abs(r);if(c===u)if(e===0)o=l=1/c;else{const h=c*e;o=l=h<1?1/h:1}else if(e===0)o=1/c,l=1/u;else{const h=c*e,d=u*e;o=h<1?1/h:1,l=d<1?1/d:1}}else{const c=Math.abs(t*r-s*i),u=Math.hypot(t,s),h=Math.hypot(i,r);if(e===0)o=h/c,l=u/c;else{const d=e*c;o=h>d?h/d:1,l=u>d?u/d:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=l}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:s}=this.current,[i,r]=this.getScaleForStroking();if(t.lineWidth=s||1,i===1&&r===1){t.stroke();return}const o=t.getLineDash();if(e&&t.save(),t.scale(i,r),o.length>0){const l=Math.max(i,r);t.setLineDash(o.map(c=>c/l)),t.lineDashOffset/=l}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Us=new WeakSet,wv=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},bv=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},xv=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let Tl=gy;for(const n in Ss)Tl.prototype[n]!==void 0&&(Tl.prototype[Ss[n]]=Tl.prototype[n]);var Rh,Mh;class tr{static get workerPort(){return a(this,Rh)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");g(this,Rh,e)}static get workerSrc(){return a(this,Mh)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");g(this,Mh,e)}}Rh=new WeakMap,Mh=new WeakMap,b(tr,Rh,null),b(tr,Mh,"");var na,Lh;class UC{constructor({parsedData:e,rawData:t}){b(this,na);b(this,Lh);g(this,na,e),g(this,Lh,t)}getRaw(){return a(this,Lh)}get(e){return a(this,na).get(e)??null}getAll(){return sy(a(this,na))}has(e){return a(this,na).has(e)}}na=new WeakMap,Lh=new WeakMap;const il=Symbol("INTERNAL");var Ih,Dh,Fh,Xl;class VC{constructor(e,{name:t,intent:s,usage:i,rbGroups:r}){b(this,Ih,!1);b(this,Dh,!1);b(this,Fh,!1);b(this,Xl,!0);g(this,Ih,!!(e&Wn.DISPLAY)),g(this,Dh,!!(e&Wn.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(a(this,Fh))return a(this,Xl);if(!a(this,Xl))return!1;const{print:e,view:t}=this.usage;return a(this,Ih)?(t==null?void 0:t.viewState)!=="OFF":a(this,Dh)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==il&&Be("Internal method `_setVisible` called."),g(this,Fh,s),g(this,Xl,t)}}Ih=new WeakMap,Dh=new WeakMap,Fh=new WeakMap,Xl=new WeakMap;var Dr,Oe,Yl,Kl,Oh,Av;class GC{constructor(e,t=Wn.DISPLAY){b(this,Oh);b(this,Dr,null);b(this,Oe,new Map);b(this,Yl,null);b(this,Kl,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,g(this,Kl,e.order);for(const s of e.groups)a(this,Oe).set(s.id,new VC(t,s));if(e.baseState==="OFF")for(const s of a(this,Oe).values())s._setVisible(il,!1);for(const s of e.on)a(this,Oe).get(s)._setVisible(il,!0);for(const s of e.off)a(this,Oe).get(s)._setVisible(il,!1);g(this,Yl,this.getHash())}}isVisible(e){if(a(this,Oe).size===0)return!0;if(!e)return hg("Optional content group not defined."),!0;if(e.type==="OCG")return a(this,Oe).has(e.id)?a(this,Oe).get(e.id).visible:(Se(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return A(this,Oh,Av).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!a(this,Oe).has(t))return Se(`Optional content group not found: ${t}`),!0;if(a(this,Oe).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!a(this,Oe).has(t))return Se(`Optional content group not found: ${t}`),!0;if(!a(this,Oe).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!a(this,Oe).has(t))return Se(`Optional content group not found: ${t}`),!0;if(!a(this,Oe).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!a(this,Oe).has(t))return Se(`Optional content group not found: ${t}`),!0;if(a(this,Oe).get(t).visible)return!1}return!0}return Se(`Unknown optional content policy ${e.policy}.`),!0}return Se(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var r;const i=a(this,Oe).get(e);if(!i){Se(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const o of i.rbGroups)for(const l of o)l!==e&&((r=a(this,Oe).get(l))==null||r._setVisible(il,!1,!0));i._setVisible(il,!!t,!0),g(this,Dr,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=a(this,Oe).get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}g(this,Dr,null)}get hasInitialVisibility(){return a(this,Yl)===null||this.getHash()===a(this,Yl)}getOrder(){return a(this,Oe).size?a(this,Kl)?a(this,Kl).slice():[...a(this,Oe).keys()]:null}getGroups(){return a(this,Oe).size>0?sy(a(this,Oe)):null}getGroup(e){return a(this,Oe).get(e)||null}getHash(){if(a(this,Dr)!==null)return a(this,Dr);const e=new GA;for(const[t,s]of a(this,Oe))e.update(`${t}:${s.visible}`);return g(this,Dr,e.hexdigest())}}Dr=new WeakMap,Oe=new WeakMap,Yl=new WeakMap,Kl=new WeakMap,Oh=new WeakSet,Av=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const r=e[i];let o;if(Array.isArray(r))o=A(this,Oh,Av).call(this,r);else if(a(this,Oe).has(r))o=a(this,Oe).get(r).visible;else return Se(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return s==="And"};class WC{constructor(e,{disableRange:t=!1,disableStream:s=!1}){mt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:o,contentDispositionFilename:l}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=l,(r==null?void 0:r.length)>0){const c=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,u)=>{this._onReceiveData({begin:c,chunk:u})}),e.addProgressListener((c,u)=>{this._onProgress({loaded:c,total:u})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(s),!0)});mt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,r;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(r=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||r.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){mt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new XC(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new YC(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class XC{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=oy(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class YC{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function KC(n){let e=!0,t=s("filename\\*","i").exec(n);if(t){t=t[1];let h=l(t);return h=unescape(h),h=c(h),h=u(h),r(h)}if(t=o(n),t){const h=u(t);return r(h)}if(t=s("filename","i").exec(n),t){t=t[1];let h=l(t);return h=u(h),r(h)}function s(h,d){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(h,d){if(h){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const f=new TextDecoder(h,{fatal:!0}),p=dg(d);d=f.decode(p),e=!1}catch{}}return d}function r(h){return e&&/[\x80-\xff]/.test(h)&&(h=i("utf-8",h),e&&(h=i("iso-8859-1",h))),h}function o(h){const d=[];let f;const p=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(h))!==null;){let[,w,_,m]=f;if(w=parseInt(w,10),w in d){if(w===0)break;continue}d[w]=[_,m]}const y=[];for(let w=0;w<d.length&&w in d;++w){let[_,m]=d[w];m=l(m),_&&(m=unescape(m),w===0&&(m=c(m))),y.push(m)}return y.join("")}function l(h){if(h.startsWith('"')){const d=h.slice(1).split('\\"');for(let f=0;f<d.length;++f){const p=d[f].indexOf('"');p!==-1&&(d[f]=d[f].slice(0,p),d.length=f+1),d[f]=d[f].replaceAll(/\\(.)/g,"$1")}h=d.join('"')}return h}function c(h){const d=h.indexOf("'");if(d===-1)return h;const f=h.slice(0,d),y=h.slice(d+1).replace(/^[^']*'/,"");return i(f,y)}function u(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,f,p,y){if(p==="q"||p==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(w,_){return String.fromCharCode(parseInt(_,16))}),i(f,y);try{y=atob(y)}catch{}return i(f,y)})}return""}function rS(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function gg(n){try{return new URL(n).origin}catch{}return null}function oS({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||s||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function aS(n){const e=n.get("Content-Disposition");if(e){let t=KC(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(oy(t))return t}return null}function mg(n,e){return n===404||n===0&&e.startsWith("file:")?new eh('Missing PDF "'+e+'".'):new wp(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n)}function lS(n){return n===200||n===206}function cS(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function uS(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(Se(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class Ww{constructor(e){V(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=rS(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return mt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new qC(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new QC(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class qC{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,cS(s,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=gg(r.url),!lS(r.status))throw mg(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:l,suggestedLength:c}=oS({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=l,this._contentLength=c||this._contentLength,this._filename=aS(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new fo("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:uS(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class QC{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${s-1}`);const o=i.url;fetch(o,cS(r,this._withCredentials,this._abortController)).then(l=>{const c=gg(l.url);if(c!==e._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${e._responseOrigin}".`);if(!lS(l.status))throw mg(l.status,o);this._readCapability.resolve(),this._reader=l.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:uS(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Kg=200,qg=206;function ZC(n){const e=n.response;return typeof e!="string"?e:dg(e).buffer}class JC{constructor({url:e,httpHeaders:t,withCredentials:s}){V(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=rS(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=qg):i.expectedStatus=Kg,t.responseType="arraybuffer",mt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const r=i.status||Kg;if(!(r===Kg&&s.expectedStatus===qg)&&r!==s.expectedStatus){s.onError(i.status);return}const l=ZC(i);if(r===qg){const c=i.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);u?s.onDone({begin:parseInt(u[1],10),chunk:l}):(Se('Missing or invalid "Content-Range" header.'),s.onError(0))}else l?s.onDone({begin:0,chunk:l}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class ek{constructor(e){this._source=e,this._manager=new JC(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return mt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new tk(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new nk(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class tk{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=gg(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(l=>{const[c,...u]=l.split(": ");return[c,u.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=oS({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=aS(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=mg(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class nk{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=gg((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=mg(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const sk=/^[a-z][a-z0-9\-+.]+:/i;function ik(n){if(sk.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class rk{constructor(e){this.source=e,this.url=ik(e.url),mt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return mt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new ok(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new ak(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class ok{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new eh(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new fo("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class ak{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const lk=1e5,bn=30,ck=.8;var Jw,Fr,En,jh,zh,sa,zi,$h,Hh,ia,ql,Ql,Or,Zl,Bh,Jl,ra,Uh,Vh,oa,aa,Gh,jr,ec,dr,hS,dS,Sv,Zn,Nf,Ev,fS,pS;const bt=class bt{constructor({textContentSource:e,container:t,viewport:s}){b(this,dr);b(this,Fr,Promise.withResolvers());b(this,En,null);b(this,jh,!1);b(this,zh,!!((Jw=globalThis.FontInspector)!=null&&Jw.enabled));b(this,sa,null);b(this,zi,null);b(this,$h,0);b(this,Hh,0);b(this,ia,null);b(this,ql,null);b(this,Ql,0);b(this,Or,0);b(this,Zl,Object.create(null));b(this,Bh,[]);b(this,Jl,null);b(this,ra,[]);b(this,Uh,new WeakMap);b(this,Vh,null);var c;if(e instanceof ReadableStream)g(this,Jl,e);else if(typeof e=="object")g(this,Jl,new ReadableStream({start(u){u.enqueue(e),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');g(this,En,g(this,ql,t)),g(this,Or,s.scale*(globalThis.devicePixelRatio||1)),g(this,Ql,s.rotation),g(this,zi,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:o,pageY:l}=s.rawDims;g(this,Vh,[1,0,0,-1,-o,l+r]),g(this,Hh,i),g(this,$h,r),A(c=bt,Zn,fS).call(c),Wa(t,s),a(this,Fr).promise.finally(()=>{a(bt,ec).delete(this),g(this,zi,null),g(this,Zl,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=pn.platform;return ke(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{a(this,ia).read().then(({value:t,done:s})=>{if(s){a(this,Fr).resolve();return}a(this,sa)??g(this,sa,t.lang),Object.assign(a(this,Zl),t.styles),A(this,dr,hS).call(this,t.items),e()},a(this,Fr).reject)};return g(this,ia,a(this,Jl).getReader()),a(bt,ec).add(this),e(),a(this,Fr).promise}update({viewport:e,onBefore:t=null}){var r;const s=e.scale*(globalThis.devicePixelRatio||1),i=e.rotation;if(i!==a(this,Ql)&&(t==null||t(),g(this,Ql,i),Wa(a(this,ql),{rotation:i})),s!==a(this,Or)){t==null||t(),g(this,Or,s);const o={div:null,properties:null,ctx:A(r=bt,Zn,Nf).call(r,a(this,sa))};for(const l of a(this,ra))o.properties=a(this,Uh).get(l),o.div=l,A(this,dr,Sv).call(this,o)}}cancel(){var t;const e=new fo("TextLayer task cancelled.");(t=a(this,ia))==null||t.cancel(e).catch(()=>{}),g(this,ia,null),a(this,Fr).reject(e)}get textDivs(){return a(this,ra)}get textContentItemsStr(){return a(this,Bh)}static cleanup(){if(!(a(this,ec).size>0)){a(this,oa).clear();for(const{canvas:e}of a(this,aa).values())e.remove();a(this,aa).clear()}}};Fr=new WeakMap,En=new WeakMap,jh=new WeakMap,zh=new WeakMap,sa=new WeakMap,zi=new WeakMap,$h=new WeakMap,Hh=new WeakMap,ia=new WeakMap,ql=new WeakMap,Ql=new WeakMap,Or=new WeakMap,Zl=new WeakMap,Bh=new WeakMap,Jl=new WeakMap,ra=new WeakMap,Uh=new WeakMap,Vh=new WeakMap,oa=new WeakMap,aa=new WeakMap,Gh=new WeakMap,jr=new WeakMap,ec=new WeakMap,dr=new WeakSet,hS=function(e){var i,r;if(a(this,jh))return;(r=a(this,zi)).ctx??(r.ctx=A(i=bt,Zn,Nf).call(i,a(this,sa)));const t=a(this,ra),s=a(this,Bh);for(const o of e){if(t.length>lk){Se("Ignoring additional textDivs for performance reasons."),g(this,jh,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const l=a(this,En);g(this,En,document.createElement("span")),a(this,En).classList.add("markedContent"),o.id!==null&&a(this,En).setAttribute("id",`${o.id}`),l.append(a(this,En))}else o.type==="endMarkedContent"&&g(this,En,a(this,En).parentNode);continue}s.push(o.str),A(this,dr,dS).call(this,o)}},dS=function(e){var w;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};a(this,ra).push(t);const i=ue.transform(a(this,Vh),e.transform);let r=Math.atan2(i[1],i[0]);const o=a(this,Zl)[e.fontName];o.vertical&&(r+=Math.PI/2);let l=a(this,zh)&&o.fontSubstitution||o.fontFamily;l=bt.fontFamilyMap.get(l)||l;const c=Math.hypot(i[2],i[3]),u=c*A(w=bt,Zn,pS).call(w,l,a(this,sa));let h,d;r===0?(h=i[4],d=i[5]-u):(h=i[4]+u*Math.sin(r),d=i[5]-u*Math.cos(r));const f="calc(var(--scale-factor)*",p=t.style;a(this,En)===a(this,ql)?(p.left=`${(100*h/a(this,Hh)).toFixed(2)}%`,p.top=`${(100*d/a(this,$h)).toFixed(2)}%`):(p.left=`${f}${h.toFixed(2)}px)`,p.top=`${f}${d.toFixed(2)}px)`),p.fontSize=`${f}${(a(bt,jr)*c).toFixed(2)}px)`,p.fontFamily=l,s.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,a(this,zh)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(s.angle=r*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const _=Math.abs(e.transform[0]),m=Math.abs(e.transform[3]);_!==m&&Math.max(_,m)/Math.min(_,m)>1.5&&(y=!0)}if(y&&(s.canvasWidth=o.vertical?e.height:e.width),a(this,Uh).set(t,s),a(this,zi).div=t,a(this,zi).properties=s,A(this,dr,Sv).call(this,a(this,zi)),s.hasText&&a(this,En).append(t),s.hasEOL){const _=document.createElement("br");_.setAttribute("role","presentation"),a(this,En).append(_)}},Sv=function(e){var l;const{div:t,properties:s,ctx:i}=e,{style:r}=t;let o="";if(a(bt,jr)>1&&(o=`scale(${1/a(bt,jr)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:c}=r,{canvasWidth:u,fontSize:h}=s;A(l=bt,Zn,Ev).call(l,i,h*a(this,Or),c);const{width:d}=i.measureText(t.textContent);d>0&&(o=`scaleX(${u*a(this,Or)/d}) ${o}`)}s.angle!==0&&(o=`rotate(${s.angle}deg) ${o}`),o.length>0&&(r.transform=o)},Zn=new WeakSet,Nf=function(e=null){let t=a(this,aa).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),a(this,aa).set(e,t),a(this,Gh).set(t,{size:0,family:""})}return t},Ev=function(e,t,s){const i=a(this,Gh).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},fS=function(){if(a(this,jr)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),g(this,jr,e.getBoundingClientRect().height),e.remove()},pS=function(e,t){const s=a(this,oa).get(e);if(s)return s;const i=A(this,Zn,Nf).call(this,t);i.canvas.width=i.canvas.height=bn,A(this,Zn,Ev).call(this,i,bn,e);const r=i.measureText("");let o=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);if(o){const h=o/(o+l);return a(this,oa).set(e,h),i.canvas.width=i.canvas.height=0,h}i.strokeStyle="red",i.clearRect(0,0,bn,bn),i.strokeText("g",0,0);let c=i.getImageData(0,0,bn,bn).data;l=0;for(let h=c.length-1-3;h>=0;h-=4)if(c[h]>0){l=Math.ceil(h/4/bn);break}i.clearRect(0,0,bn,bn),i.strokeText("A",0,bn),c=i.getImageData(0,0,bn,bn).data,o=0;for(let h=0,d=c.length;h<d;h+=4)if(c[h]>0){o=bn-Math.floor(h/4/bn);break}i.canvas.width=i.canvas.height=0;const u=o?o/(o+l):ck;return a(this,oa).set(e,u),u},b(bt,Zn),b(bt,oa,new Map),b(bt,aa,new Map),b(bt,Gh,new WeakMap),b(bt,jr,null),b(bt,ec,new Set);let th=bt;class nh{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(r){var c;if(!r)return;let o=null;const l=r.name;if(l==="#text")o=r.value;else if(nh.shouldBuildText(l))(c=r==null?void 0:r.attributes)!=null&&c.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(const u of r.children)i(u)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const uk=65536,hk=100,dk=5e3,fk=nn?kC:EC,pk=nn?TC:JA,gk=nn?CC:_C,mk=nn?PC:sS;function vk(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new _v,{docId:t}=e,s=n.url?yk(n.url):null,i=n.data?wk(n.data):null,r=n.httpHeaders||null,o=n.withCredentials===!0,l=n.password??null,c=n.range instanceof gS?n.range:null,u=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:uk;let h=n.worker instanceof Pl?n.worker:null;const d=n.verbosity,f=typeof n.docBaseUrl=="string"&&!pg(n.docBaseUrl)?n.docBaseUrl:null,p=typeof n.cMapUrl=="string"?n.cMapUrl:null,y=n.cMapPacked!==!1,w=n.CMapReaderFactory||pk,_=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,m=n.StandardFontDataFactory||mk,v=n.stopAtErrors!==!0,E=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,x=n.isEvalSupported!==!1,C=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!nn,P=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!nn&&(pn.platform.isFirefox||!globalThis.chrome),N=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,I=typeof n.disableFontFace=="boolean"?n.disableFontFace:nn,L=n.fontExtraProperties===!0,U=n.enableXfa===!0,W=n.ownerDocument||globalThis.document,M=n.disableRange===!0,K=n.disableStream===!0,q=n.disableAutoFetch===!0,ee=n.pdfBug===!0,z=n.CanvasFactory||fk,T=n.FilterFactory||gk,R=n.enableHWA===!0,$=c?c.length:n.length??NaN,D=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!nn&&!I,Y=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:w===JA&&m===sS&&p&&_&&uu(p,document.baseURI)&&uu(_,document.baseURI),te=null;nC(d);const Z={canvasFactory:new z({ownerDocument:W,enableHWA:R}),filterFactory:new T({docId:t,ownerDocument:W}),cMapReaderFactory:Y?null:new w({baseUrl:p,isCompressed:y}),standardFontDataFactory:Y?null:new m({baseUrl:_})};if(!h){const _e={verbosity:d,port:tr.workerPort};h=_e.port?Pl.fromPort(_e):new Pl(_e),e._worker=h}const me={docId:t,apiVersion:"4.10.38",data:i,password:l,disableAutoFetch:q,rangeChunkSize:u,length:$,docBaseUrl:f,enableXfa:U,evaluatorOptions:{maxImageSize:E,disableFontFace:I,ignoreErrors:v,isEvalSupported:x,isOffscreenCanvasSupported:C,isImageDecoderSupported:P,canvasMaxAreaInBytes:N,fontExtraProperties:L,useSystemFonts:D,cMapUrl:Y?p:null,standardFontDataUrl:Y?_:null}},Ge={disableFontFace:I,fontExtraProperties:L,ownerDocument:W,pdfBug:ee,styleElement:te,loadingParams:{disableAutoFetch:q,enableXfa:U}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const _e=h.messageHandler.sendWithPromise("GetDocRequest",me,i?[i.buffer]:null);let he;if(c)he=new WC(c,{disableRange:M,disableStream:K});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");let we;if(nn)if(uu(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");we=Ww}else we=rk;else we=uu(s)?Ww:ek;he=new we({url:s,length:$,httpHeaders:r,withCredentials:o,rangeChunkSize:u,disableRange:M,disableStream:K})}return _e.then(we=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const rt=new pu(t,we,h.port),wn=new Sk(rt,e,he,Ge,Z);e._transport=wn,rt.send("Ready",null)})}).catch(e._capability.reject),e}function yk(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(nn&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function wk(n){if(nn&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return dg(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Xw(n){return typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0}var Fp;const Op=class Op{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${on(Op,Fp)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,r}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}};Fp=new WeakMap,b(Op,Fp,0);let _v=Op;class gS{constructor(e,t,s=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const s of this._rangeListeners)s(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){Be("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class bk{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ke(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var zr,$i,fs,rl,Rf;class xk{constructor(e,t,s,i=!1){b(this,fs);b(this,zr,null);b(this,$i,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new Lw:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new mS,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new Ld({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ke(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:i=Ar.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:u=null,printAnnotationStorage:h=null,isEditing:d=!1}){var x,C;(x=this._stats)==null||x.time("Overall");const f=this._transport.getRenderingIntent(s,i,h,d),{renderingIntent:p,cacheKey:y}=f;g(this,$i,!1),A(this,fs,Rf).call(this),l||(l=this._transport.getOptionalContentConfig(p));let w=this._intentStates.get(y);w||(w=Object.create(null),this._intentStates.set(y,w)),w.streamReaderCancelTimeout&&(clearTimeout(w.streamReaderCancelTimeout),w.streamReaderCancelTimeout=null);const _=!!(p&Wn.PRINT);w.displayReadyCapability||(w.displayReadyCapability=Promise.withResolvers(),w.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(C=this._stats)==null||C.time("Page Request"),this._pumpOperatorList(f));const m=P=>{var N;w.renderTasks.delete(v),(this._maybeCleanupAfterRender||_)&&g(this,$i,!0),A(this,fs,rl).call(this,!_),P?(v.capability.reject(P),this._abortOperatorList({intentState:w,reason:P instanceof Error?P:new Error(P)})):v.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(N=globalThis.Stats)!=null&&N.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},v=new kv({callback:m,params:{canvasContext:e,viewport:t,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:w.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!_,pdfBug:this._pdfBug,pageColors:u});(w.renderTasks||(w.renderTasks=new Set)).add(v);const E=v.task;return Promise.all([w.displayReadyCapability.promise,l]).then(([P,N])=>{var I;if(this.destroyed){m();return}if((I=this._stats)==null||I.time("Rendering"),!(N.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");v.initializeGraphics({transparency:P,optionalContentConfig:N}),v.operatorListChanged()}).catch(m),E}getOperatorList({intent:e="display",annotationMode:t=Ar.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var u;function r(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(c))}const o=this._transport.getRenderingIntent(e,t,s,i,!0);let l=this._intentStates.get(o.cacheKey);l||(l=Object.create(null),this._intentStates.set(o.cacheKey,l));let c;return l.opListReadCapability||(c=Object.create(null),c.operatorListChanged=r,l.opListReadCapability=Promise.withResolvers(),(l.renderTasks||(l.renderTasks=new Set)).add(c),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(o)),l.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>nh.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function r(){o.read().then(function({value:c,done:u}){if(u){s(l);return}l.lang??(l.lang=c.lang),Object.assign(l.styles,c.styles),l.items.push(...c.items),r()},i)}const o=t.getReader(),l={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),g(this,$i,!1),A(this,fs,Rf).call(this),Promise.all(e)}cleanup(e=!1){g(this,$i,!0);const t=A(this,fs,rl).call(this,!1);return e&&t&&this._stats&&(this._stats=new Lw),t}_startRenderPage(e,t){var i,r;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=s.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&A(this,fs,rl).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:o}=s,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},o).getReader(),u=this._intentStates.get(t);u.streamReader=c;const h=()=>{c.read().then(({value:d,done:f})=>{if(f){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,u),h())},d=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const f of u.renderTasks)f.operatorListChanged();A(this,fs,rl).call(this,!0)}if(u.displayReadyCapability)u.displayReadyCapability.reject(d);else if(u.opListReadCapability)u.opListReadCapability.reject(d);else throw d}})};h()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof ry){let i=hk;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new fo(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}zr=new WeakMap,$i=new WeakMap,fs=new WeakSet,rl=function(e=!1){if(A(this,fs,Rf).call(this),!a(this,$i)||this.destroyed)return!1;if(e)return g(this,zr,setTimeout(()=>{g(this,zr,null),A(this,fs,rl).call(this,!1)},dk)),!1;for(const{renderTasks:t,operatorList:s}of this._intentStates.values())if(t.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),g(this,$i,!1),!0},Rf=function(){a(this,zr)&&(clearTimeout(a(this,zr)),g(this,zr,null))};var Hi,jp;class Ak{constructor(){b(this,Hi,new Map);b(this,jp,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};a(this,jp).then(()=>{for(const[i]of a(this,Hi))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:r}=s;if(r.aborted){Se("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}a(this,Hi).set(t,i)}removeEventListener(e,t){const s=a(this,Hi).get(t);s==null||s(),a(this,Hi).delete(t)}terminate(){for(const[,e]of a(this,Hi))e==null||e();a(this,Hi).clear()}}Hi=new WeakMap,jp=new WeakMap;var zp,la,ca,tc,Mf,nc,Lf;const Ke=class Ke{constructor({name:e=null,port:t=null,verbosity:s=sC()}={}){b(this,tc);var i;if(this.name=e,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((i=a(Ke,ca))!=null&&i.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(a(Ke,ca)||g(Ke,ca,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new pu("main","worker",e),this._messageHandler.on("ready",function(){}),A(this,tc,Mf).call(this)}_initialize(){if(a(Ke,la)||a(Ke,nc,Lf)){this._setupFakeWorker();return}let{workerSrc:e}=Ke;try{Ke._isSameOrigin(window.location.href,e)||(e=Ke._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new pu("main","worker",t),i=()=>{r.abort(),s.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;t.addEventListener("error",()=>{this._webWorker||i()},{signal:r.signal}),s.on("test",l=>{if(r.abort(),this.destroyed||!l){i();return}this._messageHandler=s,this._port=t,this._webWorker=t,A(this,tc,Mf).call(this)}),s.on("ready",l=>{if(r.abort(),this.destroyed){i();return}try{o()}catch{this._setupFakeWorker()}});const o=()=>{const l=new Uint8Array;s.send("test",l,[l.buffer])};o();return}catch{hg("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){a(Ke,la)||(Se("Setting up fake worker."),g(Ke,la,!0)),Ke._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new Ak;this._port=t;const s=`fake${on(Ke,zp)._++}`,i=new pu(s+"_worker",s,t);e.setup(i,t),this._messageHandler=new pu(s,s+"_worker",t),A(this,tc,Mf).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,s;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=a(Ke,ca))==null||t.delete(this._port),this._port=null,(s=this._messageHandler)==null||s.destroy(),this._messageHandler=null}static fromPort(e){var s;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(s=a(this,ca))==null?void 0:s.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Ke(e)}static get workerSrc(){if(tr.workerSrc)return tr.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return ke(this,"_setupFakeWorkerGlobal",(async()=>a(this,nc,Lf)?a(this,nc,Lf):(await import(this.workerSrc)).WorkerMessageHandler)())}};zp=new WeakMap,la=new WeakMap,ca=new WeakMap,tc=new WeakSet,Mf=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},nc=new WeakSet,Lf=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},b(Ke,nc),b(Ke,zp,0),b(Ke,la,!1),b(Ke,ca),nn&&(g(Ke,la,!0),tr.workerSrc||(tr.workerSrc="./pdf.worker.mjs")),Ke._isSameOrigin=(e,t)=>{let s;try{if(s=new URL(e),!s.origin||s.origin==="null")return!1}catch{return!1}const i=new URL(t,s);return s.origin===i.origin},Ke._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let Pl=Ke;var Bi,ai,sc,ic,Ui,ua,wu;class Sk{constructor(e,t,s,i,r){b(this,ua);b(this,Bi,new Map);b(this,ai,new Map);b(this,sc,new Map);b(this,ic,new Map);b(this,Ui,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new mS,this.fontLoader=new AC({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return ke(this,"annotationStorage",new cy)}getRenderingIntent(e,t=Ar.ENABLE,s=null,i=!1,r=!1){let o=Wn.DISPLAY,l=pv;switch(e){case"any":o=Wn.ANY;break;case"display":break;case"print":o=Wn.PRINT;break;default:Se(`getRenderingIntent - invalid intent: ${e}`)}const c=o&Wn.PRINT&&s instanceof XA?s:this.annotationStorage;switch(t){case Ar.DISABLE:o+=Wn.ANNOTATIONS_DISABLE;break;case Ar.ENABLE:break;case Ar.ENABLE_FORMS:o+=Wn.ANNOTATIONS_FORMS;break;case Ar.ENABLE_STORAGE:o+=Wn.ANNOTATIONS_STORAGE,l=c.serializable;break;default:Se(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=Wn.IS_EDITING),r&&(o+=Wn.OPLIST);const{ids:u,hash:h}=c.modifiedIds,d=[o,l.hash,h];return{renderingIntent:o,cacheKey:d.join("_"),annotationStorageSerializable:l,modifiedIds:u}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=a(this,Ui))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of a(this,ai).values())e.push(i._destroy());a(this,ai).clear(),a(this,sc).clear(),a(this,ic).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,r;this.commonObjs.clear(),this.fontLoader.clear(),a(this,Bi).clear(),this.filterFactory.destroy(),th.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new fo("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{mt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){i.close();return}mt(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async s=>{var l;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:o}=this._fullReader;return(!i||!r)&&(this._lastProgress&&((l=t.onProgress)==null||l.call(t,this._lastProgress)),this._fullReader.onProgress=c=>{var u;(u=t.onProgress)==null||u.call(t,{loaded:c.loaded,total:c.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(s,i)=>{mt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:o,done:l}){if(l){i.close();return}mt(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{r.cancel(o),i.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new bk(s,this))}),e.on("DocException",s=>{t._capability.reject(xn(s))}),e.on("PasswordRequest",s=>{g(this,Ui,Promise.withResolvers());try{if(!t.onPassword)throw xn(s);const i=r=>{r instanceof Error?a(this,Ui).reject(r):a(this,Ui).resolve({password:r})};t.onPassword(i,s.code)}catch(i){a(this,Ui).reject(i)}return a(this,Ui).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;a(this,ai).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,r])=>{var o;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":const{disableFontFace:l,fontExtraProperties:c,pdfBug:u}=this._params;if("error"in r){const p=r.error;Se(`Error during font loading: ${p}`),this.commonObjs.resolve(s,p);break}const h=u&&((o=globalThis.FontInspector)!=null&&o.enabled)?(p,y)=>globalThis.FontInspector.fontAdded(p,y):null,d=new SC(r,{disableFontFace:l,fontExtraProperties:c,inspectFont:h});this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!c&&d.data&&(d.data=null),this.commonObjs.resolve(s,d)});break;case"CopyLocalImage":const{imageRef:f}=r;mt(f,"The imageRef must be defined.");for(const p of a(this,ai).values())for(const[,y]of p.objs)if((y==null?void 0:y.ref)===f)return y.dataLen?(this.commonObjs.resolve(s,structuredClone(y)),y.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,r);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,r,o])=>{var c;if(this.destroyed)return;const l=a(this,ai).get(i);if(!l.objs.has(s)){if(l._intentStates.size===0){(c=o==null?void 0:o.bitmap)==null||c.close();return}switch(r){case"Image":l.objs.resolve(s,o),(o==null?void 0:o.dataLen)>Z_&&(l._maybeCleanupAfterRender=!0);break;case"Pattern":l.objs.resolve(s,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBuiltInCMap",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(s)}),e.on("FetchStandardFontData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&Se("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=a(this,sc).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&a(this,ic).set(r.refStr,e);const o=new xk(t,r,this,this._params.pdfBug);return a(this,ai).set(t,o),o});return a(this,sc).set(t,i),i}getPageIndex(e){return Xw(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return A(this,ua,wu).call(this,"GetFieldObjects")}hasJSActions(){return A(this,ua,wu).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return A(this,ua,wu).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return A(this,ua,wu).call(this,"GetOptionalContentConfig").then(t=>new GC(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=a(this,Bi).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var r,o;return{info:i[0],metadata:i[1]?new UC(i[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return a(this,Bi).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of a(this,ai).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),a(this,Bi).clear(),this.filterFactory.destroy(!0),th.cleanup()}}cachedPageNumber(e){if(!Xw(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return a(this,ic).get(t)??null}}Bi=new WeakMap,ai=new WeakMap,sc=new WeakMap,ic=new WeakMap,Ui=new WeakMap,ua=new WeakSet,wu=function(e,t=null){const s=a(this,Bi).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return a(this,Bi).set(e,i),i};const iu=Symbol("INITIAL_DATA");var On,Wh,Cv;class mS{constructor(){b(this,Wh);b(this,On,Object.create(null))}get(e,t=null){if(t){const i=A(this,Wh,Cv).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=a(this,On)[e];if(!s||s.data===iu)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=a(this,On)[e];return!!t&&t.data!==iu}delete(e){const t=a(this,On)[e];return!t||t.data===iu?!1:(delete a(this,On)[e],!0)}resolve(e,t=null){const s=A(this,Wh,Cv).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in a(this,On)){const{data:s}=a(this,On)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}g(this,On,Object.create(null))}*[Symbol.iterator](){for(const e in a(this,On)){const{data:t}=a(this,On)[e];t!==iu&&(yield[e,t])}}}On=new WeakMap,Wh=new WeakSet,Cv=function(e){var t;return(t=a(this,On))[e]||(t[e]={...Promise.withResolvers(),data:iu})};var $r;class Ek{constructor(e){b(this,$r,null);g(this,$r,e),this.onContinue=null}get promise(){return a(this,$r).capability.promise}cancel(e=0){a(this,$r).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=a(this,$r).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=a(this,$r);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}$r=new WeakMap;var Hr,ha;const ko=class ko{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:o,pageIndex:l,canvasFactory:c,filterFactory:u,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:f=null}){b(this,Hr,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=c,this.filterFactory=u,this._pdfBug=d,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Ek(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var l,c;if(this.cancelled)return;if(this._canvas){if(a(ko,ha).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");a(ko,ha).add(this._canvas)}this._pdfBug&&((l=globalThis.StepperManager)!=null&&l.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:i,transform:r,background:o}=this.params;this.gfx=new Tl(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:i,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,(c=this.graphicsReadyCallback)==null||c.call(this)}cancel(e=null,t=0){var s;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),a(this,Hr)&&(window.cancelAnimationFrame(a(this,Hr)),g(this,Hr,null)),a(ko,ha).delete(this._canvas),this.callback(e||new ry(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?g(this,Hr,window.requestAnimationFrame(()=>{g(this,Hr,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),a(ko,ha).delete(this._canvas),this.callback())))}};Hr=new WeakMap,ha=new WeakMap,b(ko,ha,new WeakSet);let kv=ko;const _k="4.10.38",Ck="f9bea397f";function Yw(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function ru(n){return Math.max(0,Math.min(255,255*n))}class Kw{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=ru(e),[e,e,e]}static G_HTML([e]){const t=Yw(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(ru)}static RGB_HTML(e){return`#${e.map(Yw).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[ru(1-Math.min(1,e+i)),ru(1-Math.min(1,s+i)),ru(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,r=1-t,o=1-s,l=Math.min(i,r,o);return["CMYK",i,r,o,l]}}class kk{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Be("Abstract method `_createSVG` called.")}}class hy extends kk{_createSVG(e){return document.createElementNS(Si,e)}}class vS{static setupStorage(e,t,s,i,r){const o=i.getValue(t,{value:null});switch(s.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",l=>{i.setValue(t,{value:l.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(o.value===s.attributes.xfaOn?e.setAttribute("checked",!0):o.value===s.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",l=>{i.setValue(t,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",l=>{i.setValue(t,{value:l.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const l of s.children)l.attributes.value===o.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}e.addEventListener("input",l=>{const c=l.target.options,u=c.selectedIndex===-1?"":c[c.selectedIndex].value;i.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:r}){const{attributes:o}=t,l=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[c,u]of Object.entries(o))if(u!=null)switch(c){case"class":u.length&&e.setAttribute(c,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!l||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,u)}l&&r.addLinkAttributes(e,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(e,o.dataId,t,s)}static render(e){var d,f;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,r=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:r,linkService:s});const l=r!=="richText",c=e.div;if(c.append(o),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=p}l&&c.setAttribute("class","xfaLayer xfaFont");const u=[];if(i.children.length===0){if(i.value){const p=document.createTextNode(i.value);o.append(p),l&&nh.shouldBuildText(i.name)&&u.push(p)}return{textDivs:u}}const h=[[i,-1,o]];for(;h.length>0;){const[p,y,w]=h.at(-1);if(y+1===p.children.length){h.pop();continue}const _=p.children[++h.at(-1)[1]];if(_===null)continue;const{name:m}=_;if(m==="#text"){const E=document.createTextNode(_.value);u.push(E),w.append(E);continue}const v=(d=_==null?void 0:_.attributes)!=null&&d.xmlns?document.createElementNS(_.attributes.xmlns,m):document.createElement(m);if(w.append(v),_.attributes&&this.setAttributes({html:v,element:_,storage:t,intent:r,linkService:s}),((f=_.children)==null?void 0:f.length)>0)h.push([_,-1,v]);else if(_.value){const E=document.createTextNode(_.value);l&&nh.shouldBuildText(m)&&u.push(E),v.append(E)}}for(const p of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Dd=1e3,Tk=9,Ya=new WeakSet;function co(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class Pk{static create(e){switch(e.data.annotationType){case yt.LINK:return new yS(e);case yt.TEXT:return new Nk(e);case yt.WIDGET:switch(e.data.fieldType){case"Tx":return new Rk(e);case"Btn":return e.data.radioButton?new xS(e):e.data.checkBox?new Lk(e):new Ik(e);case"Ch":return new Dk(e);case"Sig":return new Mk(e)}return new Za(e);case yt.POPUP:return new Pv(e);case yt.FREETEXT:return new CS(e);case yt.LINE:return new Ok(e);case yt.SQUARE:return new jk(e);case yt.CIRCLE:return new zk(e);case yt.POLYLINE:return new kS(e);case yt.CARET:return new Hk(e);case yt.INK:return new dy(e);case yt.POLYGON:return new $k(e);case yt.HIGHLIGHT:return new TS(e);case yt.UNDERLINE:return new Bk(e);case yt.SQUIGGLY:return new Uk(e);case yt.STRIKEOUT:return new Vk(e);case yt.STAMP:return new PS(e);case yt.FILEATTACHMENT:return new Gk(e);default:return new ft(e)}}}var da,rc,oc,Xh,Tv;const my=class my{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){b(this,Xh);b(this,da,null);b(this,rc,!1);b(this,oc,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e!=null&&e.str||t!=null&&t.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return my._hasPopupData(this.data)}updateEdited(e){var s;if(!this.container)return;a(this,da)||g(this,da,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&A(this,Xh,Tv).call(this,t),(s=a(this,oc))==null||s.popup.updateEdited(e)}resetEdited(){var e;a(this,da)&&(A(this,Xh,Tv).call(this,a(this,da).rect),(e=a(this,oc))==null||e.popup.resetEdited(),g(this,da,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),this instanceof Za||(r.tabIndex=Dd);const{style:o}=r;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof Pv){const{rotation:w}=t;return!t.hasOwnCanvas&&w!==0&&this.setRotation(w,r),r}const{width:l,height:c}=co(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const w=t.borderStyle.horizontalCornerRadius,_=t.borderStyle.verticalCornerRadius;if(w>0||_>0){const v=`calc(${w}px * var(--scale-factor)) / calc(${_}px * var(--scale-factor))`;o.borderRadius=v}else if(this instanceof xS){const v=`calc(${l}px * var(--scale-factor)) / calc(${c}px * var(--scale-factor))`;o.borderRadius=v}switch(t.borderStyle.style){case nu.SOLID:o.borderStyle="solid";break;case nu.DASHED:o.borderStyle="dashed";break;case nu.BEVELED:Se("Unimplemented border style: beveled");break;case nu.INSET:Se("Unimplemented border style: inset");break;case nu.UNDERLINE:o.borderBottomStyle="solid";break}const m=t.borderColor||null;m?(g(this,rc,!0),o.borderColor=ue.makeHexColor(m[0]|0,m[1]|0,m[2]|0)):o.borderWidth=0}const u=ue.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:h,pageHeight:d,pageX:f,pageY:p}=i.rawDims;o.left=`${100*(u[0]-f)/h}%`,o.top=`${100*(u[1]-p)/d}%`;const{rotation:y}=t;return t.hasOwnCanvas||y===0?(o.width=`${100*l/h}%`,o.height=`${100*c/d}%`):this.setRotation(y,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims,{width:r,height:o}=co(this.data.rect);let l,c;e%180===0?(l=100*r/s,c=100*o/i):(l=100*o/s,c=100*r/i),t.style.width=`${l}%`,t.style.height=`${c}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const r=i.detail[t],o=r[0],l=r.slice(1);i.target.style[s]=Kw[`${o}_HTML`](l),this.annotationStorage.setValue(this.data.id,{[s]:Kw[`${o}_rgb`](l)})};return ke(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||s[i];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,r]of Object.entries(t)){const o=s[i];if(o){const l={detail:{[i]:r},target:e};o(l),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,r]=this.data.rect.map(w=>Math.fround(w));if(e.length===8){const[w,_,m,v]=e.subarray(2,6);if(i===w&&r===_&&t===m&&s===v)return}const{style:o}=this.container;let l;if(a(this,rc)){const{borderColor:w,borderWidth:_}=o;o.borderWidth=0,l=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${w}" stroke-width="${_}">`],this.container.classList.add("hasBorder")}const c=i-t,u=r-s,{svgFactory:h}=this,d=h.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);const f=h.createElement("defs");d.append(f);const p=h.createElement("clipPath"),y=`clippath_${this.data.id}`;p.setAttribute("id",y),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let w=2,_=e.length;w<_;w+=8){const m=e[w],v=e[w+1],E=e[w+2],x=e[w+3],C=h.createElement("rect"),P=(E-t)/c,N=(r-v)/u,I=(m-E)/c,L=(v-x)/u;C.setAttribute("x",P),C.setAttribute("y",N),C.setAttribute("width",I),C.setAttribute("height",L),p.append(C),l==null||l.push(`<rect vector-effect="non-scaling-stroke" x="${P}" y="${N}" width="${I}" height="${L}"/>`)}a(this,rc)&&(l.push("</g></svg>')"),o.backgroundImage=l.join("")),this.container.append(d),this.container.style.clipPath=`url(#${y})`}_createPopup(){const{data:e}=this,t=g(this,oc,new Pv({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){Be("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:r,id:o,exportValues:l}of i){if(r===-1||o===t)continue;const c=typeof l=="string"?l:null,u=document.querySelector(`[data-element-id="${o}"]`);if(u&&!Ya.has(u)){Se(`_getElementsByName - element not allowed: ${o}`);continue}s.push({id:o,exportValue:c,domElement:u})}return s}for(const i of document.getElementsByName(e)){const{exportValue:r}=i,o=i.getAttribute("data-element-id");o!==t&&Ya.has(i)&&s.push({id:o,exportValue:r,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};da=new WeakMap,rc=new WeakMap,oc=new WeakMap,Xh=new WeakSet,Tv=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:l,pageY:c}}}}=this;s==null||s.splice(0,4,...e);const{width:u,height:h}=co(e);t.left=`${100*(e[0]-l)/r}%`,t.top=`${100*(o-e[3]+c)/o}%`,i===0?(t.width=`${100*u/r}%`,t.height=`${100*h/o}%`):this.setRotation(i)};let ft=my;var Yn,So,wS,bS;class yS extends ft{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});b(this,Yn);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action),r=!0):t.attachment?(A(this,Yn,wS).call(this,i,t.attachment,t.attachmentDest),r=!0):t.setOCGState?(A(this,Yn,bS).call(this,i,t.setOCGState),r=!0):t.dest?(this._bindLink(i,t.dest),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(i),this.container}_bindLink(t,s){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&A(this,Yn,So).call(this)}_bindNamedAction(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),A(this,Yn,So).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(s.actions)){const o=i.get(r);o&&(t[o]=()=>{var l;return(l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:r}}),!1})}t.onclick||(t.onclick=()=>!1),A(this,Yn,So).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),A(this,Yn,So).call(this),!this._fieldObjects){Se('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var d;i==null||i();const{fields:r,refs:o,include:l}=s,c=[];if(r.length!==0||o.length!==0){const f=new Set(o);for(const p of r){const y=this._fieldObjects[p]||[];for(const{id:w}of y)f.add(w)}for(const p of Object.values(this._fieldObjects))for(const y of p)f.has(y.id)===l&&c.push(y)}else for(const f of Object.values(this._fieldObjects))c.push(...f);const u=this.annotationStorage,h=[];for(const f of c){const{id:p}=f;switch(h.push(p),f.type){case"text":{const w=f.defaultValue||"";u.setValue(p,{value:w});break}case"checkbox":case"radiobutton":{const w=f.defaultValue===f.exportValues;u.setValue(p,{value:w});break}case"combobox":case"listbox":{const w=f.defaultValue||"";u.setValue(p,{value:w});break}default:continue}const y=document.querySelector(`[data-element-id="${p}"]`);if(y){if(!Ya.has(y)){Se(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((d=this.linkService.eventBus)==null||d.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})),!1}}}Yn=new WeakSet,So=function(){this.container.setAttribute("data-internal-link","")},wS=function(t,s,i=null){t.href=this.linkService.getAnchorUrl(""),s.description&&(t.title=s.description),t.onclick=()=>{var r;return(r=this.downloadManager)==null||r.openOrDownloadData(s.content,s.filename,i),!1},A(this,Yn,So).call(this)},bS=function(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),A(this,Yn,So).call(this)};class Nk extends ft{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Za extends ft{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return pn.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,r){s.includes("mouse")?e.addEventListener(s,o=>{var l;(l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(s,o=>{var l;if(s==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}r&&((l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o)}}))})}_setEventListeners(e,t,s,i){var r,o,l;for(const[c,u]of s)(u==="Action"||(r=this.data.actions)!=null&&r[u])&&((u==="Focus"||u==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,c,u,i),u==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):u==="Blur"&&!((l=this.data.actions)!=null&&l.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":ue.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Tk,r=e.style;let o;const l=2,c=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-l),h=Math.round(u/(Vg*i))||1,d=u/h;o=Math.min(i,c(d/Vg))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-l);o=Math.min(i,c(u/Vg))}r.fontSize=`calc(${o}px * var(--scale-factor))`,r.color=ue.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Rk extends Za{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const r=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=s),r.setValue(o.id,{[i]:s})}render(){var i,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let l=o.value||"";const c=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;c&&l.length>c&&(l=l.slice(0,c));let u=o.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const h={userValue:l,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=u??l,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",u??l),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Ya.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=Dd,this._setRequired(s,this.data.required),c&&(s.maxLength=c),s.addEventListener("input",f=>{e.setValue(t,{value:f.target.value}),this.setPropertyOnSiblings(s,"value",f.target.value,"value"),h.formattedValue=null}),s.addEventListener("resetform",f=>{const p=this.data.defaultFieldValue??"";s.value=h.userValue=p,h.formattedValue=null});let d=f=>{const{formattedValue:p}=h;p!=null&&(f.target.value=p),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",p=>{var w;if(h.focused)return;const{target:y}=p;h.userValue&&(y.value=h.userValue),h.lastCommittedValue=y.value,h.commitKey=1,(w=this.data.actions)!=null&&w.Focus||(h.focused=!0)}),s.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const y={value(w){h.userValue=w.detail.value??"",e.setValue(t,{value:h.userValue.toString()}),w.target.value=h.userValue},formattedValue(w){const{formattedValue:_}=w.detail;h.formattedValue=_,_!=null&&w.target!==document.activeElement&&(w.target.value=_),e.setValue(t,{formattedValue:_})},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{var E;const{charLimit:_}=w.detail,{target:m}=w;if(_===0){m.removeAttribute("maxLength");return}m.setAttribute("maxLength",_);let v=h.userValue;!v||v.length<=_||(v=v.slice(0,_),m.value=h.userValue=v,e.setValue(t,{value:v}),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,willCommit:!0,commitKey:1,selStart:m.selectionStart,selEnd:m.selectionEnd}}))}};this._dispatchEventFromSandbox(y,p)}),s.addEventListener("keydown",p=>{var _;h.commitKey=1;let y=-1;if(p.key==="Escape"?y=0:p.key==="Enter"&&!this.data.multiLine?y=2:p.key==="Tab"&&(h.commitKey=3),y===-1)return;const{value:w}=p.target;h.lastCommittedValue!==w&&(h.lastCommittedValue=w,h.userValue=w,(_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:y,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const f=d;d=null,s.addEventListener("blur",p=>{var w,_;if(!h.focused||!p.relatedTarget)return;(w=this.data.actions)!=null&&w.Blur||(h.focused=!1);const{value:y}=p.target;h.userValue=y,h.lastCommittedValue!==y&&((_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:h.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}})),f(p)}),(r=this.data.actions)!=null&&r.Keystroke&&s.addEventListener("beforeinput",p=>{var C;h.lastCommittedValue=null;const{data:y,target:w}=p,{value:_,selectionStart:m,selectionEnd:v}=w;let E=m,x=v;switch(p.inputType){case"deleteWordBackward":{const P=_.substring(0,m).match(/\w*[^\w]*$/);P&&(E-=P[0].length);break}case"deleteWordForward":{const P=_.substring(m).match(/^[^\w]*\w*/);P&&(x+=P[0].length);break}case"deleteContentBackward":m===v&&(E-=1);break;case"deleteContentForward":m===v&&(x+=1);break}p.preventDefault(),(C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,change:y||"",willCommit:!1,selStart:E,selEnd:x}})}),this._setEventListeners(s,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(d&&s.addEventListener("blur",d),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/c;s.classList.add("comb"),s.style.letterSpacing=`calc(${p}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Mk extends Za{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Lk extends Za{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Ya.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=Dd,r.addEventListener("change",o=>{const{name:l,checked:c}=o.target;for(const u of this._getElementsByName(l,s)){const h=c&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=h),e.setValue(u.id,{value:h})}e.setValue(s,{value:c})}),r.addEventListener("resetform",o=>{const l=t.defaultFieldValue||"Off";o.target.checked=l===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const l={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(s,{value:c.target.checked})}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class xS extends Za{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const o of this._getElementsByName(t.fieldName,s))e.setValue(o.id,{value:!1});const r=document.createElement("input");if(Ya.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=Dd,r.addEventListener("change",o=>{const{name:l,checked:c}=o.target;for(const u of this._getElementsByName(l,s))e.setValue(u.id,{value:!1});e.setValue(s,{value:c})}),r.addEventListener("resetform",o=>{const l=t.defaultFieldValue;o.target.checked=l!=null&&l===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;r.addEventListener("updatefromsandbox",l=>{const c={value:u=>{const h=o===u.detail.value;for(const d of this._getElementsByName(u.target.name)){const f=h&&d.id===s;d.domElement&&(d.domElement.checked=f),e.setValue(d.id,{value:f})}}};this._dispatchEventFromSandbox(c,l)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Ik extends yS{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class Dk extends Za{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Ya.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Dd;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",h=>{const d=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===d});for(const h of this.data.options){const d=document.createElement("option");d.textContent=h.displayValue,d.value=h.exportValue,s.value.includes(h.exportValue)&&(d.setAttribute("selected",!0),r=!1),i.append(d)}let o=null;if(r){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),i.prepend(h),o=()=>{h.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const l=h=>{const d=h?"value":"textContent",{options:f,multiple:p}=i;return p?Array.prototype.filter.call(f,y=>y.selected).map(y=>y[d]):f.selectedIndex===-1?null:f[f.selectedIndex][d]};let c=l(!1);const u=h=>{const d=h.target.options;return Array.prototype.map.call(d,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",h=>{const d={value(f){o==null||o();const p=f.detail.value,y=new Set(Array.isArray(p)?p:[p]);for(const w of i.options)w.selected=y.has(w.value);e.setValue(t,{value:l(!0)}),c=l(!1)},multipleSelection(f){i.multiple=!0},remove(f){const p=i.options,y=f.detail.remove;p[y].selected=!1,i.remove(y),p.length>0&&Array.prototype.findIndex.call(p,_=>_.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:l(!0),items:u(f)}),c=l(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),c=l(!1)},insert(f){const{index:p,displayValue:y,exportValue:w}=f.detail.insert,_=i.children[p],m=document.createElement("option");m.textContent=y,m.value=w,_?_.before(m):i.append(m),e.setValue(t,{value:l(!0),items:u(f)}),c=l(!1)},items(f){const{items:p}=f.detail;for(;i.length!==0;)i.remove(0);for(const y of p){const{displayValue:w,exportValue:_}=y,m=document.createElement("option");m.textContent=w,m.value=_,i.append(m)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:l(!0),items:u(f)}),c=l(!1)},indices(f){const p=new Set(f.detail.indices);for(const y of f.target.options)y.selected=p.has(y.index);e.setValue(t,{value:l(!0)}),c=l(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(d,h)}),i.addEventListener("input",h=>{var p;const d=l(!0),f=l(!1);e.setValue(t,{value:d}),h.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:f,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):i.addEventListener("input",function(h){e.setValue(t,{value:l(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Pv extends ft{constructor(e){const{data:t,elements:s}=e;super(e,{isRenderable:ft._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new Fk({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${iy}${s}`).join(",")),this.container}}var ac,$p,Hp,lc,fa,at,Vi,cc,Yh,Kh,uc,Gi,Ts,Wi,qh,Xi,Qh,pa,ga,He,If,Nv,AS,SS,ES,_S,Df,Ff,Rv;class Fk{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:r,contentsObj:o,richText:l,parent:c,rect:u,parentRect:h,open:d}){b(this,He);b(this,ac,A(this,He,ES).bind(this));b(this,$p,A(this,He,Rv).bind(this));b(this,Hp,A(this,He,Ff).bind(this));b(this,lc,A(this,He,Df).bind(this));b(this,fa,null);b(this,at,null);b(this,Vi,null);b(this,cc,null);b(this,Yh,null);b(this,Kh,null);b(this,uc,null);b(this,Gi,!1);b(this,Ts,null);b(this,Wi,null);b(this,qh,null);b(this,Xi,null);b(this,Qh,null);b(this,pa,null);b(this,ga,!1);var f;g(this,at,e),g(this,Qh,i),g(this,Vi,o),g(this,Xi,l),g(this,Kh,c),g(this,fa,t),g(this,qh,u),g(this,uc,h),g(this,Yh,s),g(this,cc,ay.toDateObject(r)),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",a(this,lc)),p.addEventListener("mouseenter",a(this,Hp)),p.addEventListener("mouseleave",a(this,$p)),p.classList.add("popupTriggerArea");for(const p of s)(f=p.container)==null||f.addEventListener("keydown",a(this,ac));a(this,at).hidden=!0,d&&A(this,He,Df).call(this)}render(){if(a(this,Ts))return;const e=g(this,Ts,document.createElement("div"));if(e.className="popup",a(this,fa)){const r=e.style.outlineColor=ue.makeHexColor(...a(this,fa));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:e.style.backgroundColor=ue.makeHexColor(...a(this,fa).map(l=>Math.floor(.7*(255-l)+l)))}const t=document.createElement("span");t.className="header";const s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=a(this,Qh),e.append(t),a(this,cc)){const r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:a(this,cc).valueOf()})),t.append(r)}const i=a(this,He,If);if(i)vS.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const r=this._formatContents(a(this,Vi));e.append(r)}a(this,at).append(e)}_formatContents({str:e,dir:t}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;const i=e.split(/(?:\r\n?|\n)/);for(let r=0,o=i.length;r<o;++r){const l=i[r];s.append(document.createTextNode(l)),r<o-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:e,popupContent:t}){var s;a(this,pa)||g(this,pa,{contentsObj:a(this,Vi),richText:a(this,Xi)}),e&&g(this,Wi,null),t&&(g(this,Xi,A(this,He,SS).call(this,t)),g(this,Vi,null)),(s=a(this,Ts))==null||s.remove(),g(this,Ts,null)}resetEdited(){var e;a(this,pa)&&({contentsObj:on(this,Vi)._,richText:on(this,Xi)._}=a(this,pa),g(this,pa,null),(e=a(this,Ts))==null||e.remove(),g(this,Ts,null),g(this,Wi,null))}forceHide(){g(this,ga,this.isVisible),a(this,ga)&&(a(this,at).hidden=!0)}maybeShow(){a(this,ga)&&(a(this,Ts)||A(this,He,Ff).call(this),g(this,ga,!1),a(this,at).hidden=!1)}get isVisible(){return a(this,at).hidden===!1}}ac=new WeakMap,$p=new WeakMap,Hp=new WeakMap,lc=new WeakMap,fa=new WeakMap,at=new WeakMap,Vi=new WeakMap,cc=new WeakMap,Yh=new WeakMap,Kh=new WeakMap,uc=new WeakMap,Gi=new WeakMap,Ts=new WeakMap,Wi=new WeakMap,qh=new WeakMap,Xi=new WeakMap,Qh=new WeakMap,pa=new WeakMap,ga=new WeakMap,He=new WeakSet,If=function(){const e=a(this,Xi),t=a(this,Vi);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&a(this,Xi).html||null},Nv=function(){var e,t,s;return((s=(t=(e=a(this,He,If))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},AS=function(){var e,t,s;return((s=(t=(e=a(this,He,If))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},SS=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:a(this,He,AS),fontSize:a(this,He,Nv)?`calc(${a(this,He,Nv)}px * var(--scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return s},ES=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&a(this,Gi))&&A(this,He,Df).call(this)},_S=function(){if(a(this,Wi)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:r}}}=a(this,Kh);let o=!!a(this,uc),l=o?a(this,uc):a(this,qh);for(const y of a(this,Yh))if(!l||ue.intersect(y.data.rect,l)!==null){l=y.data.rect,o=!0;break}const c=ue.normalizeRect([l[0],e[3]-l[1]+e[1],l[2],e[3]-l[3]+e[1]]),h=o?l[2]-l[0]+5:0,d=c[0]+h,f=c[1];g(this,Wi,[100*(d-i)/t,100*(f-r)/s]);const{style:p}=a(this,at);p.left=`${a(this,Wi)[0]}%`,p.top=`${a(this,Wi)[1]}%`},Df=function(){g(this,Gi,!a(this,Gi)),a(this,Gi)?(A(this,He,Ff).call(this),a(this,at).addEventListener("click",a(this,lc)),a(this,at).addEventListener("keydown",a(this,ac))):(A(this,He,Rv).call(this),a(this,at).removeEventListener("click",a(this,lc)),a(this,at).removeEventListener("keydown",a(this,ac)))},Ff=function(){a(this,Ts)||this.render(),this.isVisible?a(this,Gi)&&a(this,at).classList.add("focused"):(A(this,He,_S).call(this),a(this,at).hidden=!1,a(this,at).style.zIndex=parseInt(a(this,at).style.zIndex)+1e3)},Rv=function(){a(this,at).classList.remove("focused"),!(a(this,Gi)||!this.isVisible)&&(a(this,at).hidden=!0,a(this,at).style.zIndex=parseInt(a(this,at).style.zIndex)-1e3)};class CS extends ft{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Ae.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Zh;class Ok extends ft{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Zh,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:s,height:i}=co(t.rect),r=this.svgFactory.create(s,i,!0),o=g(this,Zh,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Zh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Zh=new WeakMap;var Jh;class jk extends ft{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Jh,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:s,height:i}=co(t.rect),r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,l=g(this,Jh,this.svgFactory.createElement("svg:rect"));return l.setAttribute("x",o/2),l.setAttribute("y",o/2),l.setAttribute("width",s-o),l.setAttribute("height",i-o),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Jh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Jh=new WeakMap;var ed;class zk extends ft{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,ed,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:s,height:i}=co(t.rect),r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,l=g(this,ed,this.svgFactory.createElement("svg:ellipse"));return l.setAttribute("cx",s/2),l.setAttribute("cy",i/2),l.setAttribute("rx",s/2-o/2),l.setAttribute("ry",i/2-o/2),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,ed)}addHighlightArea(){this.container.classList.add("highlightArea")}}ed=new WeakMap;var td;class kS extends ft{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,td,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:r}}=this;if(!s)return this.container;const{width:o,height:l}=co(t),c=this.svgFactory.create(o,l,!0);let u=[];for(let d=0,f=s.length;d<f;d+=2){const p=s[d]-t[0],y=t[3]-s[d+1];u.push(`${p},${y}`)}u=u.join(" ");const h=g(this,td,this.svgFactory.createElement(this.svgElementName));return h.setAttribute("points",u),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),c.append(h),this.container.append(c),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,td)}addHighlightArea(){this.container.classList.add("highlightArea")}}td=new WeakMap;class $k extends kS{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Hk extends ft{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var nd,ma,sd,Mv;class dy extends ft{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,sd);b(this,nd,null);b(this,ma,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Ae.HIGHLIGHT:Ae.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:r,popupRef:o}}=this,{transform:l,width:c,height:u}=A(this,sd,Mv).call(this,s,t),h=this.svgFactory.create(c,u,!0),d=g(this,nd,this.svgFactory.createElement("svg:g"));h.append(d),d.setAttribute("stroke-width",r.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",l);for(let f=0,p=i.length;f<p;f++){const y=this.svgFactory.createElement(this.svgElementName);a(this,ma).push(y),y.setAttribute("points",i[f].join(",")),d.append(y)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:r}=t,o=a(this,nd);if(s>=0&&o.setAttribute("stroke-width",s||1),i)for(let l=0,c=a(this,ma).length;l<c;l++)a(this,ma)[l].setAttribute("points",i[l].join(","));if(r){const{transform:l,width:c,height:u}=A(this,sd,Mv).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${c} ${u}`),o.setAttribute("transform",l)}}getElementsToTriggerPopup(){return a(this,ma)}addHighlightArea(){this.container.classList.add("highlightArea")}}nd=new WeakMap,ma=new WeakMap,sd=new WeakSet,Mv=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class TS extends ft{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Ae.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class Bk extends ft{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Uk extends ft{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Vk extends ft{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class PS extends ft{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Ae.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var id,rd,Lv;class Gk extends ft{constructor(t){var i;super(t,{isRenderable:!0});b(this,rd);b(this,id,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",A(this,rd,Lv).bind(this)),g(this,id,i);const{isMac:r}=pn.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&A(this,rd,Lv).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return a(this,id)}addHighlightArea(){this.container.classList.add("highlightArea")}}id=new WeakMap,rd=new WeakSet,Lv=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var od,va,ya,ad,Ka,NS,Iv,eb;let Wk=(eb=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:o,structTreeLayer:l}){b(this,Ka);b(this,od,null);b(this,va,null);b(this,ya,new Map);b(this,ad,null);this.div=e,g(this,od,t),g(this,va,s),g(this,ad,l||null),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return a(this,ya).size>0}async render(e){var o;const{annotations:t}=e,s=this.div;Wa(s,this.viewport);const i=new Map,r={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new hy,annotationStorage:e.annotationStorage||new cy,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const l of t){if(l.noHTML)continue;const c=l.annotationType===yt.POPUP;if(c){const d=i.get(l.id);if(!d)continue;r.elements=d}else{const{width:d,height:f}=co(l.rect);if(d<=0||f<=0)continue}r.data=l;const u=Pk.create(r);if(!u.isRenderable)continue;if(!c&&l.popupRef){const d=i.get(l.popupRef);d?d.push(u):i.set(l.popupRef,[u])}const h=u.render();l.hidden&&(h.style.visibility="hidden"),await A(this,Ka,NS).call(this,h,l.id),u._isEditable&&(a(this,ya).set(u.data.id,u),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(u))}A(this,Ka,Iv).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Wa(t,{rotation:e.rotation}),A(this,Ka,Iv).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(a(this,ya).values())}getEditableAnnotation(e){return a(this,ya).get(e)}},od=new WeakMap,va=new WeakMap,ya=new WeakMap,ad=new WeakMap,Ka=new WeakSet,NS=async function(e,t){var o,l;const s=e.firstChild||e,i=s.id=`${iy}${t}`,r=await((o=a(this,ad))==null?void 0:o.getAriaAttributes(i));if(r)for(const[c,u]of r)s.setAttribute(c,u);this.div.append(e),(l=a(this,od))==null||l.moveElementInDOM(this.div,e,s,!1)},Iv=function(){if(!a(this,va))return;const e=this.div;for(const[t,s]of a(this,va)){const i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:r}=i;r?r.nodeName==="CANVAS"?r.replaceWith(s):r.classList.contains("annotationContent")?r.after(s):r.before(s):i.append(s)}a(this,va).clear()},eb);const sf=/\r\n?|\n/g;var Ps,jn,ld,wa,zn,vt,RS,MS,LS,Of,or,jf,zf,IS,Fv,DS;const Ue=class Ue extends nt{constructor(t){super({...t,name:"freeTextEditor"});b(this,vt);b(this,Ps);b(this,jn,"");b(this,ld,`${this.id}-editor`);b(this,wa,null);b(this,zn);g(this,Ps,t.color||Ue._defaultColor||nt._defaultLineColor),g(this,zn,t.fontSize||Ue._defaultFontSize)}static get _keyboardManager(){const t=Ue.prototype,s=o=>o.isEmpty(),i=Xa.TRANSLATE_SMALL,r=Xa.TRANSLATE_BIG;return ke(this,"_keyboardManager",new Id([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}]]))}static initialize(t,s){nt.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case Ne.FREETEXT_SIZE:Ue._defaultFontSize=s;break;case Ne.FREETEXT_COLOR:Ue._defaultColor=s;break}}updateParams(t,s){switch(t){case Ne.FREETEXT_SIZE:A(this,vt,RS).call(this,s);break;case Ne.FREETEXT_COLOR:A(this,vt,MS).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Ne.FREETEXT_SIZE,Ue._defaultFontSize],[Ne.FREETEXT_COLOR,Ue._defaultColor||nt._defaultLineColor]]}get propertiesToUpdate(){return[[Ne.FREETEXT_SIZE,a(this,zn)],[Ne.FREETEXT_COLOR,a(this,Ps)]]}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-Ue._internalPadding*t,-(Ue._internalPadding+a(this,zn))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Ae.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),g(this,wa,new AbortController);const t=this._uiManager.combinedSignal(a(this,wa));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",a(this,ld)),this._isDraggable=!0,(t=a(this,wa))==null||t.abort(),g(this,wa,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=a(this,jn),s=g(this,jn,A(this,vt,LS).call(this).trimEnd());if(t===s)return;const i=r=>{if(g(this,jn,r),!r){this.remove();return}A(this,vt,zf).call(this),this._uiManager.rebuild(this),A(this,vt,Of).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),A(this,vt,Of).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Ue._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,s;this.width&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",a(this,ld)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${a(this,zn)}px * var(--scale-factor))`,i.color=a(this,Ps),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),bp(this,this.div,["dblclick","keydown"]),this.width){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:l}=this._initialData;let[c,u]=this.getInitialTranslation();[c,u]=this.pageTranslationToScreen(c,u);const[h,d]=this.pageDimensions,[f,p]=this.pageTranslation;let y,w;switch(this.rotation){case 0:y=t+(l[0]-f)/h,w=s+this.height-(l[1]-p)/d;break;case 90:y=t+(l[0]-f)/h,w=s-(l[1]-p)/d,[c,u]=[u,-c];break;case 180:y=t-this.width+(l[0]-f)/h,w=s-(l[1]-p)/d,[c,u]=[-c,-u];break;case 270:y=t+(l[0]-f-this.height*d)/h,w=s+(l[1]-p-this.width*h)/d,[c,u]=[-u,c];break}this.setAt(y*r,w*o,c,u)}else this.setAt(t*r,s*o,this.width*r,this.height*o);A(this,vt,zf).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,w,_;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const r=A(y=Ue,or,Fv).call(y,s.getData("text")||"").replaceAll(sf,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const l=o.getRangeAt(0);if(!r.includes(`
`)){l.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:c,startOffset:u}=l,h=[],d=[];if(c.nodeType===Node.TEXT_NODE){const m=c.parentElement;if(d.push(c.nodeValue.slice(u).replaceAll(sf,"")),m!==this.editorDiv){let v=h;for(const E of this.editorDiv.childNodes){if(E===m){v=d;continue}v.push(A(w=Ue,or,jf).call(w,E))}}h.push(c.nodeValue.slice(0,u).replaceAll(sf,""))}else if(c===this.editorDiv){let m=h,v=0;for(const E of this.editorDiv.childNodes)v++===u&&(m=d),m.push(A(_=Ue,or,jf).call(_,E))}g(this,jn,`${h.join(`
`)}${r}${d.join(`
`)}`),A(this,vt,zf).call(this);const f=new Range;let p=h.reduce((m,v)=>m+v.length,0);for(const{firstChild:m}of this.editorDiv.childNodes)if(m.nodeType===Node.TEXT_NODE){const v=m.nodeValue.length;if(p<=v){f.setStart(m,p),f.setEnd(m,p);break}p-=v}o.removeAllRanges(),o.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,s,i){var l;let r=null;if(t instanceof CS){const{data:{defaultAppearanceData:{fontSize:c,fontColor:u},rect:h,rotation:d,id:f,popupRef:p},textContent:y,textPosition:w,parent:{page:{pageNumber:_}}}=t;if(!y||y.length===0)return null;r=t={annotationType:Ae.FREETEXT,color:Array.from(u),fontSize:c,value:y.join(`
`),position:w,pageIndex:_-1,rect:h.slice(0),rotation:d,id:f,deleted:!1,popupRef:p}}const o=await super.deserialize(t,s,i);return g(o,zn,t.fontSize),g(o,Ps,ue.makeHexColor(...t.color)),g(o,jn,A(l=Ue,or,Fv).call(l,t.value)),o.annotationElementId=t.id||null,o._initialData=r,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Ue._internalPadding*this.parentScale,i=this.getRect(s,s),r=nt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:a(this,Ps)),o={annotationType:Ae.FREETEXT,color:r,fontSize:a(this,zn),value:A(this,vt,IS).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?o:this.annotationElementId&&!A(this,vt,DS).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(this.deleted)return s;const{style:i}=s;i.fontSize=`calc(${a(this,zn)}px * var(--scale-factor))`,i.color=a(this,Ps),s.replaceChildren();for(const o of a(this,jn).split(`
`)){const l=document.createElement("div");l.append(o?document.createTextNode(o):document.createElement("br")),s.append(l)}const r=Ue._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(r,r),popupContent:a(this,jn)}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Ps=new WeakMap,jn=new WeakMap,ld=new WeakMap,wa=new WeakMap,zn=new WeakMap,vt=new WeakSet,RS=function(t){const s=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-a(this,zn))*this.parentScale),g(this,zn,r),A(this,vt,Of).call(this)},i=a(this,zn);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ne.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},MS=function(t){const s=r=>{g(this,Ps,this.editorDiv.style.color=r)},i=a(this,Ps);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ne.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},LS=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const r of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(A(i=Ue,or,jf).call(i,r)),s=r);return t.join(`
`)},Of=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,l=o.style.display,c=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),i=o.getBoundingClientRect(),o.remove(),o.style.display=l,o.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},or=new WeakSet,jf=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(sf,"")},zf=function(){if(this.editorDiv.replaceChildren(),!!a(this,jn))for(const t of a(this,jn).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},IS=function(){return a(this,jn).replaceAll(""," ")},Fv=function(t){return t.replaceAll(" ","")},DS=function(t){const{value:s,fontSize:i,color:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((l,c)=>l!==r[c])||t.pageIndex!==o},b(Ue,or),V(Ue,"_freeTextDefaultContent",""),V(Ue,"_internalPadding",0),V(Ue,"_defaultColor",null),V(Ue,"_defaultFontSize",10),V(Ue,"_type","freetext"),V(Ue,"_editorType",Ae.FREETEXT);let Dv=Ue;class ie{toSVGPath(){Be("Abstract method `toSVGPath` must be implemented.")}get box(){Be("Abstract getter `box` must be implemented.")}serialize(e,t){Be("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let l=0,c=e.length;l<c;l+=2)o[l]=t+e[l]*i,o[l+1]=s+e[l+1]*r;return o}static _rescaleAndSwap(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let l=0,c=e.length;l<c;l+=2)o[l]=t+e[l+1]*i,o[l+1]=s+e[l]*r;return o}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)i[r]=t+e[r],i[r+1]=s+e[r+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,r){switch(r){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,r,o){return[(e+5*s)/6,(t+5*i)/6,(5*s+r)/6,(5*i+o)/6,(s+r)/2,(i+o)/2]}}V(ie,"PRECISION",1e-4);var $n,Ns,hc,dc,li,Ce,ba,xa,cd,ud,fc,pc,Br,hd,Bp,Up,_t,bu,FS,OS,jS,zS,$S,HS;const Ti=class Ti{constructor({x:e,y:t},s,i,r,o,l=0){b(this,_t);b(this,$n);b(this,Ns,[]);b(this,hc);b(this,dc);b(this,li,[]);b(this,Ce,new Float32Array(18));b(this,ba);b(this,xa);b(this,cd);b(this,ud);b(this,fc);b(this,pc);b(this,Br,[]);g(this,$n,s),g(this,pc,r*i),g(this,dc,o),a(this,Ce).set([NaN,NaN,NaN,NaN,e,t],6),g(this,hc,l),g(this,ud,a(Ti,hd)*i),g(this,cd,a(Ti,Up)*i),g(this,fc,i),a(this,Br).push(e,t)}isEmpty(){return isNaN(a(this,Ce)[8])}add({x:e,y:t}){var L;g(this,ba,e),g(this,xa,t);const[s,i,r,o]=a(this,$n);let[l,c,u,h]=a(this,Ce).subarray(8,12);const d=e-u,f=t-h,p=Math.hypot(d,f);if(p<a(this,cd))return!1;const y=p-a(this,ud),w=y/p,_=w*d,m=w*f;let v=l,E=c;l=u,c=h,u+=_,h+=m,(L=a(this,Br))==null||L.push(e,t);const x=-m/y,C=_/y,P=x*a(this,pc),N=C*a(this,pc);return a(this,Ce).set(a(this,Ce).subarray(2,8),0),a(this,Ce).set([u+P,h+N],4),a(this,Ce).set(a(this,Ce).subarray(14,18),12),a(this,Ce).set([u-P,h-N],16),isNaN(a(this,Ce)[6])?(a(this,li).length===0&&(a(this,Ce).set([l+P,c+N],2),a(this,li).push(NaN,NaN,NaN,NaN,(l+P-s)/r,(c+N-i)/o),a(this,Ce).set([l-P,c-N],14),a(this,Ns).push(NaN,NaN,NaN,NaN,(l-P-s)/r,(c-N-i)/o)),a(this,Ce).set([v,E,l,c,u,h],6),!this.isEmpty()):(a(this,Ce).set([v,E,l,c,u,h],6),Math.abs(Math.atan2(E-c,v-l)-Math.atan2(m,_))<Math.PI/2?([l,c,u,h]=a(this,Ce).subarray(2,6),a(this,li).push(NaN,NaN,NaN,NaN,((l+u)/2-s)/r,((c+h)/2-i)/o),[l,c,v,E]=a(this,Ce).subarray(14,18),a(this,Ns).push(NaN,NaN,NaN,NaN,((v+l)/2-s)/r,((E+c)/2-i)/o),!0):([v,E,l,c,u,h]=a(this,Ce).subarray(0,6),a(this,li).push(((v+5*l)/6-s)/r,((E+5*c)/6-i)/o,((5*l+u)/6-s)/r,((5*c+h)/6-i)/o,((l+u)/2-s)/r,((c+h)/2-i)/o),[u,h,l,c,v,E]=a(this,Ce).subarray(12,18),a(this,Ns).push(((v+5*l)/6-s)/r,((E+5*c)/6-i)/o,((5*l+u)/6-s)/r,((5*c+h)/6-i)/o,((l+u)/2-s)/r,((c+h)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=a(this,li),t=a(this,Ns);if(isNaN(a(this,Ce)[6])&&!this.isEmpty())return A(this,_t,FS).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);A(this,_t,jS).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return A(this,_t,OS).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,r,o){return new BS(e,t,s,i,r,o)}getOutlines(){var d;const e=a(this,li),t=a(this,Ns),s=a(this,Ce),[i,r,o,l]=a(this,$n),c=new Float32Array((((d=a(this,Br))==null?void 0:d.length)??0)+2);for(let f=0,p=c.length-2;f<p;f+=2)c[f]=(a(this,Br)[f]-i)/o,c[f+1]=(a(this,Br)[f+1]-r)/l;if(c[c.length-2]=(a(this,ba)-i)/o,c[c.length-1]=(a(this,xa)-r)/l,isNaN(s[6])&&!this.isEmpty())return A(this,_t,zS).call(this,c);const u=new Float32Array(a(this,li).length+24+a(this,Ns).length);let h=e.length;for(let f=0;f<h;f+=2){if(isNaN(e[f])){u[f]=u[f+1]=NaN;continue}u[f]=e[f],u[f+1]=e[f+1]}h=A(this,_t,HS).call(this,u,h);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){u[h]=u[h+1]=NaN,h+=2;continue}u[h]=t[f+p],u[h+1]=t[f+p+1],h+=2}return A(this,_t,$S).call(this,u,h),this.newFreeDrawOutline(u,c,a(this,$n),a(this,fc),a(this,hc),a(this,dc))}};$n=new WeakMap,Ns=new WeakMap,hc=new WeakMap,dc=new WeakMap,li=new WeakMap,Ce=new WeakMap,ba=new WeakMap,xa=new WeakMap,cd=new WeakMap,ud=new WeakMap,fc=new WeakMap,pc=new WeakMap,Br=new WeakMap,hd=new WeakMap,Bp=new WeakMap,Up=new WeakMap,_t=new WeakSet,bu=function(){const e=a(this,Ce).subarray(4,6),t=a(this,Ce).subarray(16,18),[s,i,r,o]=a(this,$n);return[(a(this,ba)+(e[0]-t[0])/2-s)/r,(a(this,xa)+(e[1]-t[1])/2-i)/o,(a(this,ba)+(t[0]-e[0])/2-s)/r,(a(this,xa)+(t[1]-e[1])/2-i)/o]},FS=function(){const[e,t,s,i]=a(this,$n),[r,o,l,c]=A(this,_t,bu).call(this);return`M${(a(this,Ce)[2]-e)/s} ${(a(this,Ce)[3]-t)/i} L${(a(this,Ce)[4]-e)/s} ${(a(this,Ce)[5]-t)/i} L${r} ${o} L${l} ${c} L${(a(this,Ce)[16]-e)/s} ${(a(this,Ce)[17]-t)/i} L${(a(this,Ce)[14]-e)/s} ${(a(this,Ce)[15]-t)/i} Z`},OS=function(e){const t=a(this,Ns);e.push(`L${t[4]} ${t[5]} Z`)},jS=function(e){const[t,s,i,r]=a(this,$n),o=a(this,Ce).subarray(4,6),l=a(this,Ce).subarray(16,18),[c,u,h,d]=A(this,_t,bu).call(this);e.push(`L${(o[0]-t)/i} ${(o[1]-s)/r} L${c} ${u} L${h} ${d} L${(l[0]-t)/i} ${(l[1]-s)/r}`)},zS=function(e){const t=a(this,Ce),[s,i,r,o]=a(this,$n),[l,c,u,h]=A(this,_t,bu).call(this),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-s)/r,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-s)/r,(t[5]-i)/o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,(t[16]-s)/r,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-s)/r,(t[15]-i)/o],0),this.newFreeDrawOutline(d,e,a(this,$n),a(this,fc),a(this,hc),a(this,dc))},$S=function(e,t){const s=a(this,Ns);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},HS=function(e,t){const s=a(this,Ce).subarray(4,6),i=a(this,Ce).subarray(16,18),[r,o,l,c]=a(this,$n),[u,h,d,f]=A(this,_t,bu).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-r)/l,(s[1]-o)/c,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(i[0]-r)/l,(i[1]-o)/c],t),t+=24},b(Ti,hd,8),b(Ti,Bp,2),b(Ti,Up,a(Ti,hd)+a(Ti,Bp));let Sp=Ti;var gc,Aa,Yi,dd,Hn,fd,ht,Vp,US;class BS extends ie{constructor(t,s,i,r,o,l){super();b(this,Vp);b(this,gc);b(this,Aa,new Float32Array(4));b(this,Yi);b(this,dd);b(this,Hn);b(this,fd);b(this,ht);g(this,ht,t),g(this,Hn,s),g(this,gc,i),g(this,fd,r),g(this,Yi,o),g(this,dd,l),this.lastPoint=[NaN,NaN],A(this,Vp,US).call(this,l);const[c,u,h,d]=a(this,Aa);for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-c)/h,t[f+1]=(t[f+1]-u)/d;for(let f=0,p=s.length;f<p;f+=2)s[f]=(s[f]-c)/h,s[f+1]=(s[f+1]-u)/d}toSVGPath(){const t=[`M${a(this,ht)[4]} ${a(this,ht)[5]}`];for(let s=6,i=a(this,ht).length;s<i;s+=6){if(isNaN(a(this,ht)[s])){t.push(`L${a(this,ht)[s+4]} ${a(this,ht)[s+5]}`);continue}t.push(`C${a(this,ht)[s]} ${a(this,ht)[s+1]} ${a(this,ht)[s+2]} ${a(this,ht)[s+3]} ${a(this,ht)[s+4]} ${a(this,ht)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,r],o){const l=i-t,c=r-s;let u,h;switch(o){case 0:u=ie._rescale(a(this,ht),t,r,l,-c),h=ie._rescale(a(this,Hn),t,r,l,-c);break;case 90:u=ie._rescaleAndSwap(a(this,ht),t,s,l,c),h=ie._rescaleAndSwap(a(this,Hn),t,s,l,c);break;case 180:u=ie._rescale(a(this,ht),i,s,-l,c),h=ie._rescale(a(this,Hn),i,s,-l,c);break;case 270:u=ie._rescaleAndSwap(a(this,ht),i,r,-l,-c),h=ie._rescaleAndSwap(a(this,Hn),i,r,-l,-c);break}return{outline:Array.from(u),points:[Array.from(h)]}}get box(){return a(this,Aa)}newOutliner(t,s,i,r,o,l=0){return new Sp(t,s,i,r,o,l)}getNewOutline(t,s){const[i,r,o,l]=a(this,Aa),[c,u,h,d]=a(this,gc),f=o*h,p=l*d,y=i*h+c,w=r*d+u,_=this.newOutliner({x:a(this,Hn)[0]*f+y,y:a(this,Hn)[1]*p+w},a(this,gc),a(this,fd),t,a(this,dd),s??a(this,Yi));for(let m=2;m<a(this,Hn).length;m+=2)_.add({x:a(this,Hn)[m]*f+y,y:a(this,Hn)[m+1]*p+w});return _.getOutlines()}}gc=new WeakMap,Aa=new WeakMap,Yi=new WeakMap,dd=new WeakMap,Hn=new WeakMap,fd=new WeakMap,ht=new WeakMap,Vp=new WeakSet,US=function(t){const s=a(this,ht);let i=s[4],r=s[5],o=i,l=r,c=i,u=r,h=i,d=r;const f=t?Math.max:Math.min;for(let y=6,w=s.length;y<w;y+=6){if(isNaN(s[y]))o=Math.min(o,s[y+4]),l=Math.min(l,s[y+5]),c=Math.max(c,s[y+4]),u=Math.max(u,s[y+5]),d<s[y+5]?(h=s[y+4],d=s[y+5]):d===s[y+5]&&(h=f(h,s[y+4]));else{const _=ue.bezierBoundingBox(i,r,...s.slice(y,y+6));o=Math.min(o,_[0]),l=Math.min(l,_[1]),c=Math.max(c,_[2]),u=Math.max(u,_[3]),d<_[3]?(h=_[2],d=_[3]):d===_[3]&&(h=f(h,_[2]))}i=s[y+4],r=s[y+5]}const p=a(this,Aa);p[0]=o-a(this,Yi),p[1]=l-a(this,Yi),p[2]=c-o+2*a(this,Yi),p[3]=u-l+2*a(this,Yi),this.lastPoint=[h,d]};var pd,gd,Ur,Rs,mn,VS,$f,GS,WS,jv;class Ov{constructor(e,t=0,s=0,i=!0){b(this,mn);b(this,pd);b(this,gd);b(this,Ur,[]);b(this,Rs,[]);let r=1/0,o=-1/0,l=1/0,c=-1/0;const u=10**-4;for(const{x:_,y:m,width:v,height:E}of e){const x=Math.floor((_-t)/u)*u,C=Math.ceil((_+v+t)/u)*u,P=Math.floor((m-t)/u)*u,N=Math.ceil((m+E+t)/u)*u,I=[x,P,N,!0],L=[C,P,N,!1];a(this,Ur).push(I,L),r=Math.min(r,x),o=Math.max(o,C),l=Math.min(l,P),c=Math.max(c,N)}const h=o-r+2*s,d=c-l+2*s,f=r-s,p=l-s,y=a(this,Ur).at(i?-1:-2),w=[y[0],y[2]];for(const _ of a(this,Ur)){const[m,v,E]=_;_[0]=(m-f)/h,_[1]=(v-p)/d,_[2]=(E-p)/d}g(this,pd,new Float32Array([f,p,h,d])),g(this,gd,w)}getOutlines(){a(this,Ur).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of a(this,Ur))t[3]?(e.push(...A(this,mn,jv).call(this,t)),A(this,mn,GS).call(this,t)):(A(this,mn,WS).call(this,t),e.push(...A(this,mn,jv).call(this,t)));return A(this,mn,VS).call(this,e)}}pd=new WeakMap,gd=new WeakMap,Ur=new WeakMap,Rs=new WeakMap,mn=new WeakSet,VS=function(e){const t=[],s=new Set;for(const o of e){const[l,c,u]=o;t.push([l,c,o],[l,u,o])}t.sort((o,l)=>o[1]-l[1]||o[0]-l[0]);for(let o=0,l=t.length;o<l;o+=2){const c=t[o][2],u=t[o+1][2];c.push(u),u.push(c),s.add(c),s.add(u)}const i=[];let r;for(;s.size>0;){const o=s.values().next().value;let[l,c,u,h,d]=o;s.delete(o);let f=l,p=c;for(r=[l,u],i.push(r);;){let y;if(s.has(h))y=h;else if(s.has(d))y=d;else break;s.delete(y),[l,c,u,h,d]=y,f!==l&&(r.push(f,p,l,p===c?c:u),f=l),p=p===c?u:c}r.push(f,p)}return new Xk(i,a(this,pd),a(this,gd))},$f=function(e){const t=a(this,Rs);let s=0,i=t.length-1;for(;s<=i;){const r=s+i>>1,o=t[r][0];if(o===e)return r;o<e?s=r+1:i=r-1}return i+1},GS=function([,e,t]){const s=A(this,mn,$f).call(this,e);a(this,Rs).splice(s,0,[e,t])},WS=function([,e,t]){const s=A(this,mn,$f).call(this,e);for(let i=s;i<a(this,Rs).length;i++){const[r,o]=a(this,Rs)[i];if(r!==e)break;if(r===e&&o===t){a(this,Rs).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,o]=a(this,Rs)[i];if(r!==e)break;if(r===e&&o===t){a(this,Rs).splice(i,1);return}}},jv=function(e){const[t,s,i]=e,r=[[t,s,i]],o=A(this,mn,$f).call(this,i);for(let l=0;l<o;l++){const[c,u]=a(this,Rs)[l];for(let h=0,d=r.length;h<d;h++){const[,f,p]=r[h];if(!(u<=f||p<=c)){if(f>=c){if(p>u)r[h][1]=u;else{if(d===1)return[];r.splice(h,1),h--,d--}continue}r[h][2]=c,p>u&&r.push([t,u,p])}}}return r};var md,mc;class Xk extends ie{constructor(t,s,i){super();b(this,md);b(this,mc);g(this,mc,t),g(this,md,s),this.lastPoint=i}toSVGPath(){const t=[];for(const s of a(this,mc)){let[i,r]=s;t.push(`M${i} ${r}`);for(let o=2;o<s.length;o+=2){const l=s[o],c=s[o+1];l===i?(t.push(`V${c}`),r=c):c===r&&(t.push(`H${l}`),i=l)}t.push("Z")}return t.join(" ")}serialize([t,s,i,r],o){const l=[],c=i-t,u=r-s;for(const h of a(this,mc)){const d=new Array(h.length);for(let f=0;f<h.length;f+=2)d[f]=t+h[f]*c,d[f+1]=r-h[f+1]*u;l.push(d)}return l}get box(){return a(this,md)}get classNamesForOutlining(){return["highlightOutline"]}}md=new WeakMap,mc=new WeakMap;class zv extends Sp{newFreeDrawOutline(e,t,s,i,r,o){return new Yk(e,t,s,i,r,o)}}class Yk extends BS{newOutliner(e,t,s,i,r,o=0){return new zv(e,t,s,i,r,o)}}var Ms,Sa,vc,At,vd,yc,yd,wd,Vr,Ls,wc,bd,$e,$v,Hv,Bv,Eo,XS,mr;const An=class An{constructor({editor:e=null,uiManager:t=null}){b(this,$e);b(this,Ms,null);b(this,Sa,null);b(this,vc);b(this,At,null);b(this,vd,!1);b(this,yc,!1);b(this,yd,null);b(this,wd);b(this,Vr,null);b(this,Ls,null);b(this,wc);var s;e?(g(this,yc,!1),g(this,wc,Ne.HIGHLIGHT_COLOR),g(this,yd,e)):(g(this,yc,!0),g(this,wc,Ne.HIGHLIGHT_DEFAULT_COLOR)),g(this,Ls,(e==null?void 0:e._uiManager)||t),g(this,wd,a(this,Ls)._eventBus),g(this,vc,(e==null?void 0:e.color)||((s=a(this,Ls))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),a(An,bd)||g(An,bd,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return ke(this,"_keyboardManager",new Id([[["Escape","mac+Escape"],An.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],An.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],An.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],An.prototype._moveToPrevious],[["Home","mac+Home"],An.prototype._moveToBeginning],[["End","mac+End"],An.prototype._moveToEnd]]))}renderButton(){const e=g(this,Ms,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=a(this,Ls)._signal;e.addEventListener("click",A(this,$e,Eo).bind(this),{signal:t}),e.addEventListener("keydown",A(this,$e,Bv).bind(this),{signal:t});const s=g(this,Sa,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=a(this,vc),e.append(s),e}renderMainDropdown(){const e=g(this,At,A(this,$e,$v).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===a(this,Ms)){A(this,$e,Eo).call(this,e);return}const t=e.target.getAttribute("data-color");t&&A(this,$e,Hv).call(this,t,e)}_moveToNext(e){var t,s;if(!a(this,$e,mr)){A(this,$e,Eo).call(this,e);return}if(e.target===a(this,Ms)){(t=a(this,At).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=a(this,At))==null?void 0:t.firstChild)||e.target===a(this,Ms)){a(this,$e,mr)&&this._hideDropdownFromKeyboard();return}a(this,$e,mr)||A(this,$e,Eo).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!a(this,$e,mr)){A(this,$e,Eo).call(this,e);return}(t=a(this,At).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!a(this,$e,mr)){A(this,$e,Eo).call(this,e);return}(t=a(this,At).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=a(this,At))==null||e.classList.add("hidden"),(t=a(this,Vr))==null||t.abort(),g(this,Vr,null)}_hideDropdownFromKeyboard(){var e;if(!a(this,yc)){if(!a(this,$e,mr)){(e=a(this,yd))==null||e.unselect();return}this.hideDropdown(),a(this,Ms).focus({preventScroll:!0,focusVisible:a(this,vd)})}}updateColor(e){if(a(this,Sa)&&(a(this,Sa).style.backgroundColor=e),!a(this,At))return;const t=a(this,Ls).highlightColors.values();for(const s of a(this,At).children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=a(this,Ms))==null||e.remove(),g(this,Ms,null),g(this,Sa,null),(t=a(this,At))==null||t.remove(),g(this,At,null)}};Ms=new WeakMap,Sa=new WeakMap,vc=new WeakMap,At=new WeakMap,vd=new WeakMap,yc=new WeakMap,yd=new WeakMap,wd=new WeakMap,Vr=new WeakMap,Ls=new WeakMap,wc=new WeakMap,bd=new WeakMap,$e=new WeakSet,$v=function(){const e=document.createElement("div"),t=a(this,Ls)._signal;e.addEventListener("contextmenu",Bs,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of a(this,Ls).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",a(An,bd)[s]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=i,r.setAttribute("aria-selected",i===a(this,vc)),r.addEventListener("click",A(this,$e,Hv).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",A(this,$e,Bv).bind(this),{signal:t}),e},Hv=function(e,t){t.stopPropagation(),a(this,wd).dispatch("switchannotationeditorparams",{source:this,type:a(this,wc),value:e})},Bv=function(e){An._keyboardManager.exec(this,e)},Eo=function(e){if(a(this,$e,mr)){this.hideDropdown();return}if(g(this,vd,e.detail===0),a(this,Vr)||(g(this,Vr,new AbortController),window.addEventListener("pointerdown",A(this,$e,XS).bind(this),{signal:a(this,Ls).combinedSignal(a(this,Vr))})),a(this,At)){a(this,At).classList.remove("hidden");return}const t=g(this,At,A(this,$e,$v).call(this));a(this,Ms).append(t)},XS=function(e){var t;(t=a(this,At))!=null&&t.contains(e.target)||this.hideDropdown()},mr=function(){return a(this,At)&&!a(this,At).classList.contains("hidden")},b(An,bd,null);let Ep=An;var bc,xd,Ki,Ea,xc,_n,Ad,Sd,_a,as,Bn,jt,Ac,qi,Zt,Sc,ls,Ed,xe,Uv,Hf,YS,KS,qS,Vv,_o,ps,ol,QS,Bf,xu,ZS,JS,e1,t1,n1;const Ie=class Ie extends nt{constructor(t){super({...t,name:"highlightEditor"});b(this,xe);b(this,bc,null);b(this,xd,0);b(this,Ki);b(this,Ea,null);b(this,xc,null);b(this,_n,null);b(this,Ad,null);b(this,Sd,0);b(this,_a,null);b(this,as,null);b(this,Bn,null);b(this,jt,!1);b(this,Ac,null);b(this,qi);b(this,Zt,null);b(this,Sc,"");b(this,ls);b(this,Ed,"");this.color=t.color||Ie._defaultColor,g(this,ls,t.thickness||Ie._defaultThickness),g(this,qi,t.opacity||Ie._defaultOpacity),g(this,Ki,t.boxes||null),g(this,Ed,t.methodOfCreation||""),g(this,Sc,t.text||""),this._isDraggable=!1,t.highlightId>-1?(g(this,jt,!0),A(this,xe,Hf).call(this,t),A(this,xe,_o).call(this)):a(this,Ki)&&(g(this,bc,t.anchorNode),g(this,xd,t.anchorOffset),g(this,Ad,t.focusNode),g(this,Sd,t.focusOffset),A(this,xe,Uv).call(this),A(this,xe,_o).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=Ie.prototype;return ke(this,"_keyboardManager",new Id([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:a(this,jt)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:a(this,ls),methodOfCreation:a(this,Ed)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;nt.initialize(t,s),Ie._defaultColor||(Ie._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case Ne.HIGHLIGHT_DEFAULT_COLOR:Ie._defaultColor=s;break;case Ne.HIGHLIGHT_THICKNESS:Ie._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return a(this,Ac)}updateParams(t,s){switch(t){case Ne.HIGHLIGHT_COLOR:A(this,xe,YS).call(this,s);break;case Ne.HIGHLIGHT_THICKNESS:A(this,xe,KS).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Ne.HIGHLIGHT_DEFAULT_COLOR,Ie._defaultColor],[Ne.HIGHLIGHT_THICKNESS,Ie._defaultThickness]]}get propertiesToUpdate(){return[[Ne.HIGHLIGHT_COLOR,this.color||Ie._defaultColor],[Ne.HIGHLIGHT_THICKNESS,a(this,ls)||Ie._defaultThickness],[Ne.HIGHLIGHT_FREE,a(this,jt)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(g(this,xc,new Ep({editor:this})),t.addColorPicker(a(this,xc))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(A(this,xe,xu).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,A(this,xe,xu).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){A(this,xe,Vv).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,xe,_o).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?A(this,xe,Vv).call(this):t&&(A(this,xe,_o).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var r,o,l;const{drawLayer:s}=this.parent;let i;a(this,jt)?(t=(t-this.rotation+360)%360,i=A(r=Ie,ps,ol).call(r,a(this,as).box,t)):i=A(o=Ie,ps,ol).call(o,[this.x,this.y,this.width,this.height],t),s.updateProperties(a(this,Bn),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(a(this,Zt),{bbox:A(l=Ie,ps,ol).call(l,a(this,_n).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();a(this,Sc)&&(t.setAttribute("aria-label",a(this,Sc)),t.setAttribute("role","mark")),a(this,jt)?t.classList.add("free"):this.div.addEventListener("keydown",A(this,xe,QS).bind(this),{signal:this._uiManager._signal});const s=g(this,_a,document.createElement("div"));t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=a(this,Ea);const[i,r]=this.parentDimensions;return this.setDims(this.width*i,this.height*r),bp(this,a(this,_a),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,Zt),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,Zt),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:A(this,xe,Bf).call(this,!0);break;case 1:case 3:A(this,xe,Bf).call(this,!1);break}}select(){var t;super.select(),a(this,Zt)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,Zt),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),a(this,Zt)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,Zt),{rootClass:{selected:!1}}),a(this,jt)||A(this,xe,Bf).call(this,!1))}get _mustFixPosition(){return!a(this,jt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(a(this,Bn),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(a(this,Zt),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:r,y:o}){const{x:l,y:c,width:u,height:h}=i.getBoundingClientRect(),d=new AbortController,f=t.combinedSignal(d),p=y=>{d.abort(),A(this,ps,t1).call(this,t,y)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",Kn,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",Bs,{signal:f}),i.addEventListener("pointermove",A(this,ps,e1).bind(this,t),{signal:f}),this._freeHighlight=new zv({x:r,y:o},[l,c,u,h],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var w,_,m,v;let r=null;if(t instanceof TS){const{data:{quadPoints:E,rect:x,rotation:C,id:P,color:N,opacity:I,popupRef:L},parent:{page:{pageNumber:U}}}=t;r=t={annotationType:Ae.HIGHLIGHT,color:Array.from(N),opacity:I,quadPoints:E,boxes:null,pageIndex:U-1,rect:x.slice(0),rotation:C,id:P,deleted:!1,popupRef:L}}else if(t instanceof dy){const{data:{inkLists:E,rect:x,rotation:C,id:P,color:N,borderStyle:{rawWidth:I},popupRef:L},parent:{page:{pageNumber:U}}}=t;r=t={annotationType:Ae.HIGHLIGHT,color:Array.from(N),thickness:I,inkLists:E,boxes:null,pageIndex:U-1,rect:x.slice(0),rotation:C,id:P,deleted:!1,popupRef:L}}const{color:o,quadPoints:l,inkLists:c,opacity:u}=t,h=await super.deserialize(t,s,i);h.color=ue.makeHexColor(...o),g(h,qi,u||1),c&&g(h,ls,t.thickness),h.annotationElementId=t.id||null,h._initialData=r;const[d,f]=h.pageDimensions,[p,y]=h.pageTranslation;if(l){const E=g(h,Ki,[]);for(let x=0;x<l.length;x+=8)E.push({x:(l[x]-p)/d,y:1-(l[x+1]-y)/f,width:(l[x+2]-l[x])/d,height:(l[x+1]-l[x+5])/f});A(w=h,xe,Uv).call(w),A(_=h,xe,_o).call(_),h.rotate(h.rotation)}else if(c){g(h,jt,!0);const E=c[0],x={x:E[0]-p,y:f-(E[1]-y)},C=new zv(x,[0,0,d,f],1,a(h,ls)/2,!0,.001);for(let I=0,L=E.length;I<L;I+=2)x.x=E[I]-p,x.y=f-(E[I+1]-y),C.add(x);const{id:P,clipPathId:N}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);A(m=h,xe,Hf).call(m,{highlightOutlines:C.getOutlines(),highlightId:P,clipPathId:N}),A(v=h,xe,_o).call(v)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),i=nt._colorManager.convert(this.color),r={annotationType:Ae.HIGHLIGHT,color:i,opacity:a(this,qi),thickness:a(this,ls),quadPoints:A(this,xe,ZS).call(this),outlines:A(this,xe,JS).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:A(this,xe,xu).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!A(this,xe,n1).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};bc=new WeakMap,xd=new WeakMap,Ki=new WeakMap,Ea=new WeakMap,xc=new WeakMap,_n=new WeakMap,Ad=new WeakMap,Sd=new WeakMap,_a=new WeakMap,as=new WeakMap,Bn=new WeakMap,jt=new WeakMap,Ac=new WeakMap,qi=new WeakMap,Zt=new WeakMap,Sc=new WeakMap,ls=new WeakMap,Ed=new WeakMap,xe=new WeakSet,Uv=function(){const t=new Ov(a(this,Ki),.001);g(this,as,t.getOutlines()),[this.x,this.y,this.width,this.height]=a(this,as).box;const s=new Ov(a(this,Ki),.0025,.001,this._uiManager.direction==="ltr");g(this,_n,s.getOutlines());const{lastPoint:i}=a(this,_n);g(this,Ac,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},Hf=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var d,f;if(g(this,as,t),g(this,_n,t.getNewOutline(a(this,ls)/2+1.5,.0025)),s>=0)g(this,Bn,s),g(this,Ea,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),g(this,Zt,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:a(this,_n).box,path:{d:a(this,_n).toSVGPath()}},!0));else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(a(this,Bn),{bbox:A(d=Ie,ps,ol).call(d,a(this,as).box,(p-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(a(this,Zt),{bbox:A(f=Ie,ps,ol).call(f,a(this,_n).box,p),path:{d:a(this,_n).toSVGPath()}})}const[o,l,c,u]=t.box;switch(this.rotation){case 0:this.x=o,this.y=l,this.width=c,this.height=u;break;case 90:{const[p,y]=this.parentDimensions;this.x=l,this.y=1-o,this.width=c*y/p,this.height=u*p/y;break}case 180:this.x=1-o,this.y=1-l,this.width=c,this.height=u;break;case 270:{const[p,y]=this.parentDimensions;this.x=1-l,this.y=o,this.width=c*y/p,this.height=u*p/y;break}}const{lastPoint:h}=a(this,_n);g(this,Ac,[(h[0]-o)/c,(h[1]-l)/u])},YS=function(t){const s=(o,l)=>{var c,u;this.color=o,g(this,qi,l),(c=this.parent)==null||c.drawLayer.updateProperties(a(this,Bn),{root:{fill:o,"fill-opacity":l}}),(u=a(this,xc))==null||u.updateColor(o)},i=this.color,r=a(this,qi);this.addCommands({cmd:s.bind(this,t,Ie._defaultOpacity),undo:s.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ne.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},KS=function(t){const s=a(this,ls),i=r=>{g(this,ls,r),A(this,xe,qS).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ne.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},qS=function(t){if(!a(this,jt))return;A(this,xe,Hf).call(this,{highlightOutlines:a(this,as).getNewOutline(t/2)}),this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)},Vv=function(){a(this,Bn)===null||!this.parent||(this.parent.drawLayer.remove(a(this,Bn)),g(this,Bn,null),this.parent.drawLayer.remove(a(this,Zt)),g(this,Zt,null))},_o=function(t=this.parent){a(this,Bn)===null&&({id:on(this,Bn)._,clipPathId:on(this,Ea)._}=t.drawLayer.draw({bbox:a(this,as).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":a(this,qi)},rootClass:{highlight:!0,free:a(this,jt)},path:{d:a(this,as).toSVGPath()}},!1,!0),g(this,Zt,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:a(this,jt)},bbox:a(this,_n).box,path:{d:a(this,_n).toSVGPath()}},a(this,jt))),a(this,_a)&&(a(this,_a).style.clipPath=a(this,Ea)))},ps=new WeakSet,ol=function([t,s,i,r],o){switch(o){case 90:return[1-s-r,t,r,i];case 180:return[1-t-i,1-s-r,i,r];case 270:return[s,1-t-i,r,i]}return[t,s,i,r]},QS=function(t){Ie._keyboardManager.exec(this,t)},Bf=function(t){if(!a(this,bc))return;const s=window.getSelection();t?s.setPosition(a(this,bc),a(this,xd)):s.setPosition(a(this,Ad),a(this,Sd))},xu=function(){return a(this,jt)?this.rotation:0},ZS=function(){if(a(this,jt))return null;const[t,s]=this.pageDimensions,[i,r]=this.pageTranslation,o=a(this,Ki),l=new Float32Array(o.length*8);let c=0;for(const{x:u,y:h,width:d,height:f}of o){const p=u*t+i,y=(1-h)*s+r;l[c]=l[c+4]=p,l[c+1]=l[c+3]=y,l[c+2]=l[c+6]=p+d*t,l[c+5]=l[c+7]=y-f*s,c+=8}return l},JS=function(t){return a(this,as).serialize(t,A(this,xe,xu).call(this))},e1=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},t1=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},n1=function(t){const{color:s}=this._initialData;return t.color.some((i,r)=>i!==s[r])},b(Ie,ps),V(Ie,"_defaultColor",null),V(Ie,"_defaultOpacity",1),V(Ie,"_defaultThickness",12),V(Ie,"_type","highlight"),V(Ie,"_editorType",Ae.HIGHLIGHT),V(Ie,"_freeHighlightId",-1),V(Ie,"_freeHighlight",null),V(Ie,"_freeHighlightClipId","");let _p=Ie;var Ca;class Kk{constructor(){b(this,Ca,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))this.updateProperty(t,s)}updateSVGProperty(e,t){a(this,Ca)[e]=t}toSVGProperties(){const e=a(this,Ca);return g(this,Ca,Object.create(null)),{root:e}}reset(){g(this,Ca,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Be("Not implemented")}}Ca=new WeakMap;var Un,Ec,Rt,ka,Ta,Gr,Wr,Xr,Pa,Me,Wv,Xv,Yv,Au,s1,Uf,Su,al;const oe=class oe extends nt{constructor(t){super(t);b(this,Me);b(this,Un,null);b(this,Ec);V(this,"_drawId",null);g(this,Ec,t.mustBeCommitted||!1),t.drawOutlines&&(A(this,Me,Wv).call(this,t),A(this,Me,Au).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[r,o]of Object.entries(s))i.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){Be("Not implemented")}static get typesMap(){Be("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(a(oe,Rt).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,r]of this.typesMap)t.push([i,s[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,r]of this.constructor.typesMap)t.push([i,s[r]]);return t}_updateProperty(t,s,i){const r=this._drawingOptions,o=r[s],l=c=>{var h;r.updateProperty(s,c);const u=a(this,Un).updateProperty(s,c);u&&A(this,Me,Su).call(this,u),(h=this.parent)==null||h.drawLayer.updateProperties(this._drawId,r.toSVGProperties())};this.addCommands({cmd:l.bind(this,i),undo:l.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,oe._mergeSVGProperties(a(this,Un).getPathResizingSVGProperties(A(this,Me,Uf).call(this)),{bbox:A(this,Me,al).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,oe._mergeSVGProperties(a(this,Un).getPathResizedSVGProperties(A(this,Me,Uf).call(this)),{bbox:A(this,Me,al).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:A(this,Me,al).call(this,t,s)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,oe._mergeSVGProperties(a(this,Un).getPathTranslatedSVGProperties(A(this,Me,Uf).call(this),this.parentDimensions),{bbox:A(this,Me,al).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,a(this,Ec)&&(g(this,Ec,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){A(this,Me,Yv).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,Me,Au).call(this),A(this,Me,Su).call(this,a(this,Un).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),A(this,Me,Yv).call(this)):t&&(this._uiManager.addShouldRescale(this),A(this,Me,Au).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,oe._mergeSVGProperties({bbox:A(this,Me,al).call(this)},a(this,Un).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&A(this,Me,Su).call(this,a(this,Un).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const s=document.createElement("div");t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[i,r]=this.parentDimensions;return this.setDims(this.width*i,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,s,i,r,o){Be("Not implemented")}static startDrawing(t,s,i,r){var _;const{target:o,offsetX:l,offsetY:c,pointerId:u,pointerType:h}=r;if(a(oe,Wr)&&a(oe,Wr)!==h)return;const{viewport:{rotation:d}}=t,{width:f,height:p}=o.getBoundingClientRect(),y=g(oe,ka,new AbortController),w=t.combinedSignal(y);if(a(oe,Gr)||g(oe,Gr,u),a(oe,Wr)??g(oe,Wr,h),window.addEventListener("pointerup",m=>{var v;a(oe,Gr)===m.pointerId?this._endDraw(m):(v=a(oe,Xr))==null||v.delete(m.pointerId)},{signal:w}),window.addEventListener("pointercancel",m=>{var v;a(oe,Gr)===m.pointerId?this._currentParent.endDrawingSession():(v=a(oe,Xr))==null||v.delete(m.pointerId)},{signal:w}),window.addEventListener("pointerdown",m=>{a(oe,Wr)===m.pointerType&&((a(oe,Xr)||g(oe,Xr,new Set)).add(m.pointerId),a(oe,Rt).isCancellable()&&(a(oe,Rt).removeLastElement(),a(oe,Rt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:w}),window.addEventListener("contextmenu",Bs,{signal:w}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:w}),o.addEventListener("touchmove",m=>{m.timeStamp===a(oe,Pa)&&Kn(m)},{signal:w}),t.toggleDrawing(),(_=s._editorUndoBar)==null||_.hide(),a(oe,Rt)){t.drawLayer.updateProperties(this._currentDrawId,a(oe,Rt).startNew(l,c,f,p,d));return}s.updateUIForDefaultProperties(this),g(oe,Rt,this.createDrawerInstance(l,c,f,p,d)),g(oe,Ta,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(a(oe,Ta).toSVGProperties(),a(oe,Rt).defaultSVGProperties),!0,!1)}static _drawMove(t){var o;if(g(oe,Pa,-1),!a(oe,Rt))return;const{offsetX:s,offsetY:i,pointerId:r}=t;if(a(oe,Gr)===r){if(((o=a(oe,Xr))==null?void 0:o.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,a(oe,Rt).add(s,i)),g(oe,Pa,t.timeStamp),Kn(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,g(oe,Rt,null),g(oe,Ta,null),g(oe,Wr,null),g(oe,Pa,NaN)),a(oe,ka)&&(a(oe,ka).abort(),g(oe,ka,null),g(oe,Gr,NaN),g(oe,Xr,null))}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),t&&s.drawLayer.updateProperties(this._currentDrawId,a(oe,Rt).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=a(oe,Rt),r=this._currentDrawId,o=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(r,i.setLastElement(o))},undo:()=>{s.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:Ne.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(Ne.DRAW_STEP),!a(oe,Rt).isEmpty()){const{pageDimensions:[i,r],scale:o}=s,l=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:a(oe,Rt).getOutlines(i*o,r*o,o,this._INNER_MARGIN),drawingOptions:a(oe,Ta),mustBeCommitted:!t});return this._cleanup(!0),l}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,r,o,l){Be("Not implemented")}static async deserialize(t,s,i){var d,f;const{rawDims:{pageWidth:r,pageHeight:o,pageX:l,pageY:c}}=s.viewport,u=this.deserializeDraw(l,c,r,o,this._INNER_MARGIN,t),h=await super.deserialize(t,s,i);return h.createDrawingOptions(t),A(d=h,Me,Wv).call(d,{drawOutlines:u}),A(f=h,Me,Au).call(f),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[s,i]=this.pageTranslation,[r,o]=this.pageDimensions;return a(this,Un).serialize([s,i,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Un=new WeakMap,Ec=new WeakMap,Rt=new WeakMap,ka=new WeakMap,Ta=new WeakMap,Gr=new WeakMap,Wr=new WeakMap,Xr=new WeakMap,Pa=new WeakMap,Me=new WeakSet,Wv=function({drawOutlines:t,drawId:s,drawingOptions:i}){g(this,Un,t),this._drawingOptions||(this._drawingOptions=i),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=A(this,Me,Xv).call(this,t,this.parent),A(this,Me,Su).call(this,t.box)},Xv=function(t,s){const{id:i}=s.drawLayer.draw(oe._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},Yv=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Au=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=A(this,Me,Xv).call(this,a(this,Un),t)}},s1=function([t,s,i,r]){const{parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[s,1-t,i*(l/o),r*(o/l)];case 180:return[1-t,1-s,i,r];case 270:return[1-s,t,i*(l/o),r*(o/l)];default:return[t,s,i,r]}},Uf=function(){const{x:t,y:s,width:i,height:r,parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[1-s,t,i*(o/l),r*(l/o)];case 180:return[1-t,1-s,i,r];case 270:return[s,1-t,i*(o/l),r*(l/o)];default:return[t,s,i,r]}},Su=function(t){if([this.x,this.y,this.width,this.height]=A(this,Me,s1).call(this,t),this.div){this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)}this._onResized()},al=function(){const{x:t,y:s,width:i,height:r,rotation:o,parentRotation:l,parentDimensions:[c,u]}=this;switch((o*4+l)/90){case 1:return[1-s-r,t,r,i];case 2:return[1-t-i,1-s-r,i,r];case 3:return[s,1-t-i,r,i];case 4:return[t,s-i*(c/u),r*(u/c),i*(c/u)];case 5:return[1-s,t,i*(c/u),r*(u/c)];case 6:return[1-t-r*(u/c),1-s,r*(u/c),i*(c/u)];case 7:return[s-i*(c/u),1-t-r*(u/c),i*(c/u),r*(u/c)];case 8:return[t-i,s-r,i,r];case 9:return[1-s,t-i,r,i];case 10:return[1-t,1-s,i,r];case 11:return[s-r,1-t,r,i];case 12:return[t-r*(u/c),s,r*(u/c),i*(c/u)];case 13:return[1-s-i*(c/u),t-r*(u/c),i*(c/u),r*(u/c)];case 14:return[1-t,1-s-i*(c/u),r*(u/c),i*(c/u)];case 15:return[s,1-t,i*(c/u),r*(u/c)];default:return[t,s,i,r]}},V(oe,"_currentDrawId",-1),V(oe,"_currentParent",null),b(oe,Rt,null),b(oe,ka,null),b(oe,Ta,null),b(oe,Gr,NaN),b(oe,Wr,null),b(oe,Xr,null),b(oe,Pa,NaN),V(oe,"_INNER_MARGIN",3);let Gv=oe;var ci,Mt,Lt,Na,_c,cn,zt,cs,Ra,Ma,La,Cc,Vf;class qk{constructor(e,t,s,i,r,o){b(this,Cc);b(this,ci,new Float64Array(6));b(this,Mt);b(this,Lt);b(this,Na);b(this,_c);b(this,cn);b(this,zt,"");b(this,cs,0);b(this,Ra,new Cp);b(this,Ma);b(this,La);g(this,Ma,s),g(this,La,i),g(this,Na,r),g(this,_c,o),[e,t]=A(this,Cc,Vf).call(this,e,t);const l=g(this,Mt,[NaN,NaN,NaN,NaN,e,t]);g(this,cn,[e,t]),g(this,Lt,[{line:l,points:a(this,cn)}]),a(this,ci).set(l,0)}updateProperty(e,t){e==="stroke-width"&&g(this,_c,t)}isEmpty(){return!a(this,Lt)||a(this,Lt).length===0}isCancellable(){return a(this,cn).length<=10}add(e,t){[e,t]=A(this,Cc,Vf).call(this,e,t);const[s,i,r,o]=a(this,ci).subarray(2,6),l=e-r,c=t-o;return Math.hypot(a(this,Ma)*l,a(this,La)*c)<=2?null:(a(this,cn).push(e,t),isNaN(s)?(a(this,ci).set([r,o,e,t],2),a(this,Mt).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(a(this,ci)[0])&&a(this,Mt).splice(6,6),a(this,ci).set([s,i,r,o,e,t],0),a(this,Mt).push(...ie.createBezierPoints(s,i,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(a(this,cn).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,r){g(this,Ma,s),g(this,La,i),g(this,Na,r),[e,t]=A(this,Cc,Vf).call(this,e,t);const o=g(this,Mt,[NaN,NaN,NaN,NaN,e,t]);g(this,cn,[e,t]);const l=a(this,Lt).at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),a(this,Lt).push({line:o,points:a(this,cn)}),a(this,ci).set(o,0),g(this,cs,0),this.toSVGPath(),null}getLastElement(){return a(this,Lt).at(-1)}setLastElement(e){return a(this,Lt)?(a(this,Lt).push(e),g(this,Mt,e.line),g(this,cn,e.points),g(this,cs,0),{path:{d:this.toSVGPath()}}):a(this,Ra).setLastElement(e)}removeLastElement(){if(!a(this,Lt))return a(this,Ra).removeLastElement();a(this,Lt).pop(),g(this,zt,"");for(let e=0,t=a(this,Lt).length;e<t;e++){const{line:s,points:i}=a(this,Lt)[e];g(this,Mt,s),g(this,cn,i),g(this,cs,0),this.toSVGPath()}return{path:{d:a(this,zt)}}}toSVGPath(){const e=ie.svgRound(a(this,Mt)[4]),t=ie.svgRound(a(this,Mt)[5]);if(a(this,cn).length===2)return g(this,zt,`${a(this,zt)} M ${e} ${t} Z`),a(this,zt);if(a(this,cn).length<=6){const i=a(this,zt).lastIndexOf("M");g(this,zt,`${a(this,zt).slice(0,i)} M ${e} ${t}`),g(this,cs,6)}if(a(this,cn).length===4){const i=ie.svgRound(a(this,Mt)[10]),r=ie.svgRound(a(this,Mt)[11]);return g(this,zt,`${a(this,zt)} L ${i} ${r}`),g(this,cs,12),a(this,zt)}const s=[];a(this,cs)===0&&(s.push(`M ${e} ${t}`),g(this,cs,6));for(let i=a(this,cs),r=a(this,Mt).length;i<r;i+=6){const[o,l,c,u,h,d]=a(this,Mt).slice(i,i+6).map(ie.svgRound);s.push(`C${o} ${l} ${c} ${u} ${h} ${d}`)}return g(this,zt,a(this,zt)+s.join(" ")),g(this,cs,a(this,Mt).length),a(this,zt)}getOutlines(e,t,s,i){const r=a(this,Lt).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),a(this,Ra).build(a(this,Lt),e,t,s,a(this,Na),a(this,_c),i),g(this,ci,null),g(this,Mt,null),g(this,Lt,null),g(this,zt,null),a(this,Ra)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}ci=new WeakMap,Mt=new WeakMap,Lt=new WeakMap,Na=new WeakMap,_c=new WeakMap,cn=new WeakMap,zt=new WeakMap,cs=new WeakMap,Ra=new WeakMap,Ma=new WeakMap,La=new WeakMap,Cc=new WeakSet,Vf=function(e,t){return ie._normalizePoint(e,t,a(this,Ma),a(this,La),a(this,Na))};var un,_d,Cd,Vn,ui,hi,kc,Tc,Pc,Bt,_i,i1,r1,o1;const vy=class vy extends ie{constructor(){super(...arguments);b(this,Bt);b(this,un);b(this,_d,0);b(this,Cd);b(this,Vn);b(this,ui);b(this,hi);b(this,kc);b(this,Tc);b(this,Pc)}build(t,s,i,r,o,l,c){g(this,ui,s),g(this,hi,i),g(this,kc,r),g(this,Tc,o),g(this,Pc,l),g(this,Cd,c??0),g(this,Vn,t),A(this,Bt,r1).call(this)}setLastElement(t){return a(this,Vn).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return a(this,Vn).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of a(this,Vn)){if(t.push(`M${ie.svgRound(s[4])} ${ie.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12){t.push(`L${ie.svgRound(s[10])} ${ie.svgRound(s[11])}`);continue}for(let i=6,r=s.length;i<r;i+=6){const[o,l,c,u,h,d]=s.subarray(i,i+6).map(ie.svgRound);t.push(`C${o} ${l} ${c} ${u} ${h} ${d}`)}}return t.join("")}serialize([t,s,i,r],o){const l=[],c=[],[u,h,d,f]=A(this,Bt,i1).call(this);let p,y,w,_,m,v,E,x,C;switch(a(this,Tc)){case 0:C=ie._rescale,p=t,y=s+r,w=i,_=-r,m=t+u*i,v=s+(1-h-f)*r,E=t+(u+d)*i,x=s+(1-h)*r;break;case 90:C=ie._rescaleAndSwap,p=t,y=s,w=i,_=r,m=t+h*i,v=s+u*r,E=t+(h+f)*i,x=s+(u+d)*r;break;case 180:C=ie._rescale,p=t+i,y=s,w=-i,_=r,m=t+(1-u-d)*i,v=s+h*r,E=t+(1-u)*i,x=s+(h+f)*r;break;case 270:C=ie._rescaleAndSwap,p=t+i,y=s+r,w=-i,_=-r,m=t+(1-h-f)*i,v=s+(1-u-d)*r,E=t+(1-h)*i,x=s+(1-u)*r;break}for(const{line:P,points:N}of a(this,Vn))l.push(C(P,p,y,w,_,o?new Array(P.length):null)),c.push(C(N,p,y,w,_,o?new Array(N.length):null));return{lines:l,points:c,rect:[m,v,E,x]}}static deserialize(t,s,i,r,o,{paths:{lines:l,points:c},rotation:u,thickness:h}){const d=[];let f,p,y,w,_;switch(u){case 0:_=ie._rescale,f=-t/i,p=s/r+1,y=1/i,w=-1/r;break;case 90:_=ie._rescaleAndSwap,f=-s/r,p=-t/i,y=1/r,w=1/i;break;case 180:_=ie._rescale,f=t/i+1,p=-s/r,y=-1/i,w=1/r;break;case 270:_=ie._rescaleAndSwap,f=s/r+1,p=t/i+1,y=-1/r,w=-1/i;break}if(!l){l=[];for(const v of c){const E=v.length;if(E===2){l.push(new Float32Array([NaN,NaN,NaN,NaN,v[0],v[1]]));continue}if(E===4){l.push(new Float32Array([NaN,NaN,NaN,NaN,v[0],v[1],NaN,NaN,NaN,NaN,v[2],v[3]]));continue}const x=new Float32Array(3*(E-2));l.push(x);let[C,P,N,I]=v.subarray(0,4);x.set([NaN,NaN,NaN,NaN,C,P],0);for(let L=4;L<E;L+=2){const U=v[L],W=v[L+1];x.set(ie.createBezierPoints(C,P,N,I,U,W),(L-2)*3),[C,P,N,I]=[N,I,U,W]}}}for(let v=0,E=l.length;v<E;v++)d.push({line:_(l[v].map(x=>x??NaN),f,p,y,w),points:_(c[v].map(x=>x??NaN),f,p,y,w)});const m=new vy;return m.build(d,i,r,1,u,h,o),m}get box(){return a(this,un)}updateProperty(t,s){return t==="stroke-width"?A(this,Bt,o1).call(this,s):null}updateParentDimensions([t,s],i){const[r,o]=A(this,Bt,_i).call(this);g(this,ui,t),g(this,hi,s),g(this,kc,i);const[l,c]=A(this,Bt,_i).call(this),u=l-r,h=c-o,d=a(this,un);return d[0]-=u,d[1]-=h,d[2]+=2*u,d[3]+=2*h,d}updateRotation(t){return g(this,_d,t),{path:{transform:this.rotationTransform}}}get viewBox(){return a(this,un).map(ie.svgRound).join(" ")}get defaultProperties(){const[t,s]=a(this,un);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ie.svgRound(t)} ${ie.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=a(this,un);let i=0,r=0,o=0,l=0,c=0,u=0;switch(a(this,_d)){case 90:r=s/t,o=-t/s,c=t;break;case 180:i=-1,l=-1,c=t,u=s;break;case 270:r=-s/t,o=t/s,u=s;break;default:return""}return`matrix(${i} ${r} ${o} ${l} ${ie.svgRound(c)} ${ie.svgRound(u)})`}getPathResizingSVGProperties([t,s,i,r]){const[o,l]=A(this,Bt,_i).call(this),[c,u,h,d]=a(this,un);if(Math.abs(h-o)<=ie.PRECISION||Math.abs(d-l)<=ie.PRECISION){const _=t+i/2-(c+h/2),m=s+r/2-(u+d/2);return{path:{"transform-origin":`${ie.svgRound(t)} ${ie.svgRound(s)}`,transform:`${this.rotationTransform} translate(${_} ${m})`}}}const f=(i-2*o)/(h-2*o),p=(r-2*l)/(d-2*l),y=h/i,w=d/r;return{path:{"transform-origin":`${ie.svgRound(c)} ${ie.svgRound(u)}`,transform:`${this.rotationTransform} scale(${y} ${w}) translate(${ie.svgRound(o)} ${ie.svgRound(l)}) scale(${f} ${p}) translate(${ie.svgRound(-o)} ${ie.svgRound(-l)})`}}}getPathResizedSVGProperties([t,s,i,r]){const[o,l]=A(this,Bt,_i).call(this),c=a(this,un),[u,h,d,f]=c;if(c[0]=t,c[1]=s,c[2]=i,c[3]=r,Math.abs(d-o)<=ie.PRECISION||Math.abs(f-l)<=ie.PRECISION){const m=t+i/2-(u+d/2),v=s+r/2-(h+f/2);for(const{line:E,points:x}of a(this,Vn))ie._translate(E,m,v,E),ie._translate(x,m,v,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ie.svgRound(t)} ${ie.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(i-2*o)/(d-2*o),y=(r-2*l)/(f-2*l),w=-p*(u+o)+t+o,_=-y*(h+l)+s+l;if(p!==1||y!==1||w!==0||_!==0)for(const{line:m,points:v}of a(this,Vn))ie._rescale(m,w,_,p,y,m),ie._rescale(v,w,_,p,y,v);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ie.svgRound(t)} ${ie.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[r,o]=i,l=a(this,un),c=t-l[0],u=s-l[1];if(a(this,ui)===r&&a(this,hi)===o)for(const{line:h,points:d}of a(this,Vn))ie._translate(h,c,u,h),ie._translate(d,c,u,d);else{const h=a(this,ui)/r,d=a(this,hi)/o;g(this,ui,r),g(this,hi,o);for(const{line:f,points:p}of a(this,Vn))ie._rescale(f,c,u,h,d,f),ie._rescale(p,c,u,h,d,p);l[2]*=h,l[3]*=d}return l[0]=t,l[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${ie.svgRound(t)} ${ie.svgRound(s)}`}}}get defaultSVGProperties(){const t=a(this,un);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${ie.svgRound(t[0])} ${ie.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};un=new WeakMap,_d=new WeakMap,Cd=new WeakMap,Vn=new WeakMap,ui=new WeakMap,hi=new WeakMap,kc=new WeakMap,Tc=new WeakMap,Pc=new WeakMap,Bt=new WeakSet,_i=function(t=a(this,Pc)){const s=a(this,Cd)+t/2*a(this,kc);return a(this,Tc)%180===0?[s/a(this,ui),s/a(this,hi)]:[s/a(this,hi),s/a(this,ui)]},i1=function(){const[t,s,i,r]=a(this,un),[o,l]=A(this,Bt,_i).call(this,0);return[t+o,s+l,i-2*o,r-2*l]},r1=function(){const t=g(this,un,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of a(this,Vn)){if(r.length<=12){for(let c=4,u=r.length;c<u;c+=6){const[h,d]=r.subarray(c,c+2);t[0]=Math.min(t[0],h),t[1]=Math.min(t[1],d),t[2]=Math.max(t[2],h),t[3]=Math.max(t[3],d)}continue}let o=r[4],l=r[5];for(let c=6,u=r.length;c<u;c+=6){const[h,d,f,p,y,w]=r.subarray(c,c+6);ue.bezierBoundingBox(o,l,h,d,f,p,y,w,t),o=y,l=w}}const[s,i]=A(this,Bt,_i).call(this);t[0]=Math.min(1,Math.max(0,t[0]-s)),t[1]=Math.min(1,Math.max(0,t[1]-i)),t[2]=Math.min(1,Math.max(0,t[2]+s)),t[3]=Math.min(1,Math.max(0,t[3]+i)),t[2]-=t[0],t[3]-=t[1]},o1=function(t){const[s,i]=A(this,Bt,_i).call(this);g(this,Pc,t);const[r,o]=A(this,Bt,_i).call(this),[l,c]=[r-s,o-i],u=a(this,un);return u[0]-=l,u[1]-=c,u[2]+=2*l,u[3]+=2*c,u};let Cp=vy;var Nc;const yy=class yy extends Kk{constructor(t){super();b(this,Nc);g(this,Nc,t),super.updateProperties({fill:"none",stroke:nt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,s){t==="stroke-width"&&(s??(s=this["stroke-width"]),s*=a(this,Nc).realScale),super.updateSVGProperty(t,s)}clone(){const t=new yy(a(this,Nc));return t.updateAll(this),t}};Nc=new WeakMap;let Kv=yy;var Gp,a1;const xl=class xl extends Gv{constructor(t){super({...t,name:"inkEditor"});b(this,Gp);this._willKeepAspectRatio=!0}static initialize(t,s){nt.initialize(t,s),this._defaultDrawingOptions=new Kv(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return ke(this,"typesMap",new Map([[Ne.INK_THICKNESS,"stroke-width"],[Ne.INK_COLOR,"stroke"],[Ne.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,r,o){return new qk(t,s,i,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,r,o,l){return Cp.deserialize(t,s,i,r,o,l)}static async deserialize(t,s,i){let r=null;if(t instanceof dy){const{data:{inkLists:l,rect:c,rotation:u,id:h,color:d,opacity:f,borderStyle:{rawWidth:p},popupRef:y},parent:{page:{pageNumber:w}}}=t;r=t={annotationType:Ae.INK,color:Array.from(d),thickness:p,opacity:f,paths:{points:l},boxes:null,pageIndex:w-1,rect:c.slice(0),rotation:u,id:h,deleted:!1,popupRef:y}}const o=await super.deserialize(t,s,i);return o.annotationElementId=t.id||null,o._initialData=r,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=xl.getDefaultDrawingOptions({stroke:ue.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i,rect:r}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":l,"stroke-width":c}}=this,u={annotationType:Ae.INK,color:nt._colorManager.convert(o),opacity:l,thickness:c,paths:{lines:s,points:i},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?u:this.annotationElementId&&!A(this,Gp,a1).call(this,u)?null:(u.id=this.annotationElementId,u)}renderAnnotationElement(t){const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s}),null}};Gp=new WeakSet,a1=function(t){const{color:s,thickness:i,opacity:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((l,c)=>l!==s[c])||t.thickness!==i||t.opacity!==r||t.pageIndex!==o},V(xl,"_type","ink"),V(xl,"_editorType",Ae.INK),V(xl,"_defaultDrawingOptions",null);let qv=xl;var et,$t,Yr,Qi,Kr,Rc,di,fi,Gn,Mc,Le,Eu,_u,Gf,Zv,Wf,Jv,Xf,l1;const Fu=class Fu extends nt{constructor(t){super({...t,name:"stampEditor"});b(this,Le);b(this,et,null);b(this,$t,null);b(this,Yr,null);b(this,Qi,null);b(this,Kr,null);b(this,Rc,"");b(this,di,null);b(this,fi,null);b(this,Gn,!1);b(this,Mc,!1);g(this,Qi,t.bitmapUrl),g(this,Kr,t.bitmapFile)}static initialize(t,s){nt.initialize(t,s)}static get supportedTypes(){return ke(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(s=>`image/${s}`))}static get supportedTypesStr(){return ke(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,s){s.pasteEditor(Ae.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:l}=t||this.copyCanvas(null,null,!0).imageData,c=await i.guess({name:"altText",request:{data:r,width:o,height:l,channels:r.length/(o*l)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const u=c.output;return await this.setGuessedAltText(u),s&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var t;a(this,$t)&&(g(this,et,null),this._uiManager.imageManager.deleteId(a(this,$t)),(t=a(this,di))==null||t.remove(),g(this,di,null),a(this,fi)&&(clearTimeout(a(this,fi)),g(this,fi,null))),super.remove()}rebuild(){if(!this.parent){a(this,$t)&&A(this,Le,Gf).call(this);return}super.rebuild(),this.div!==null&&(a(this,$t)&&a(this,di)===null&&A(this,Le,Gf).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(a(this,Yr)||a(this,et)||a(this,Qi)||a(this,Kr)||a(this,$t))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;if(this.width&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),a(this,et)?A(this,Le,Zv).call(this):A(this,Le,Gf).call(this),this.width&&!this.annotationElementId){const[i,r]=this.parentDimensions;this.setAt(t*i,s*r,this.width*i,this.height*r)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;a(this,fi)!==null&&clearTimeout(a(this,fi)),g(this,fi,setTimeout(()=>{g(this,fi,null),A(this,Le,Jv).call(this)},200))}copyCanvas(t,s,i=!1){var p;t||(t=224);const{width:r,height:o}=a(this,et),l=new Km;let c=a(this,et),u=r,h=o,d=null;if(s){if(r>s||o>s){const I=Math.min(s/r,s/o);u=Math.floor(r*I),h=Math.floor(o*I)}d=document.createElement("canvas");const y=d.width=Math.ceil(u*l.sx),w=d.height=Math.ceil(h*l.sy);a(this,Gn)||(c=A(this,Le,Wf).call(this,y,w));const _=d.getContext("2d");_.filter=this._uiManager.hcmFilter;let m="white",v="#cfcfd8";this._uiManager.hcmFilter!=="none"?v="black":(p=window.matchMedia)!=null&&p.call(window,"(prefers-color-scheme: dark)").matches&&(m="#8f8f9d",v="#42414d");const E=15,x=E*l.sx,C=E*l.sy,P=new OffscreenCanvas(x*2,C*2),N=P.getContext("2d");N.fillStyle=m,N.fillRect(0,0,x*2,C*2),N.fillStyle=v,N.fillRect(0,0,x,C),N.fillRect(x,C,x,C),_.fillStyle=_.createPattern(P,"repeat"),_.fillRect(0,0,y,w),_.drawImage(c,0,0,c.width,c.height,0,0,y,w)}let f=null;if(i){let y,w;if(l.symmetric&&c.width<t&&c.height<t)y=c.width,w=c.height;else if(c=a(this,et),r>t||o>t){const v=Math.min(t/r,t/o);y=Math.floor(r*v),w=Math.floor(o*v),a(this,Gn)||(c=A(this,Le,Wf).call(this,y,w))}const m=new OffscreenCanvas(y,w).getContext("2d",{willReadFrequently:!0});m.drawImage(c,0,0,c.width,c.height,0,0,y,w),f={width:y,height:w,data:m.getImageData(0,0,y,w).data}}return{canvas:d,width:u,height:h,imageData:f}}getImageForAltText(){return a(this,di)}static async deserialize(t,s,i){var w;let r=null;if(t instanceof PS){const{data:{rect:_,rotation:m,id:v,structParent:E,popupRef:x},container:C,parent:{page:{pageNumber:P}}}=t,N=C.querySelector("canvas"),I=i.imageManager.getFromCanvas(C.id,N);N.remove();const L=((w=await s._structTree.getAriaAttributes(`${iy}${v}`))==null?void 0:w.get("aria-label"))||"";r=t={annotationType:Ae.STAMP,bitmapId:I.id,bitmap:I.bitmap,pageIndex:P-1,rect:_.slice(0),rotation:m,id:v,deleted:!1,accessibilityData:{decorative:!1,altText:L},isSvg:!1,structParent:E,popupRef:x}}const o=await super.deserialize(t,s,i),{rect:l,bitmap:c,bitmapUrl:u,bitmapId:h,isSvg:d,accessibilityData:f}=t;h&&i.imageManager.isValidId(h)?(g(o,$t,h),c&&g(o,et,c)):g(o,Qi,u),g(o,Gn,d);const[p,y]=o.pageDimensions;return o.width=(l[2]-l[0])/p,o.height=(l[3]-l[1])/y,o.annotationElementId=t.id||null,f&&(o.altTextData=f),o._initialData=r,g(o,Mc,!!r),o}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:Ae.STAMP,bitmapId:a(this,$t),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:a(this,Gn),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=A(this,Le,Xf).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(i.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const c=A(this,Le,l1).call(this,i);if(c.isSame)return null;c.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,s===null)return i;s.stamps||(s.stamps=new Map);const l=a(this,Gn)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(a(this,$t)))s.stamps.set(a(this,$t),{area:l,serialized:i}),i.bitmap=A(this,Le,Xf).call(this,!1);else if(a(this,Gn)){const c=s.stamps.get(a(this,$t));l>c.area&&(c.area=l,c.serialized.bitmap.close(),c.serialized.bitmap=A(this,Le,Xf).call(this,!1))}return i}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};et=new WeakMap,$t=new WeakMap,Yr=new WeakMap,Qi=new WeakMap,Kr=new WeakMap,Rc=new WeakMap,di=new WeakMap,fi=new WeakMap,Gn=new WeakMap,Mc=new WeakMap,Le=new WeakSet,Eu=function(t,s=!1){if(!t){this.remove();return}g(this,et,t.bitmap),s||(g(this,$t,t.id),g(this,Gn,t.isSvg)),t.file&&g(this,Rc,t.file.name),A(this,Le,Zv).call(this)},_u=function(){if(g(this,Yr,null),this._uiManager.enableWaiting(!1),!!a(this,di)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,et)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,et)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Gf=function(){if(a(this,$t)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(a(this,$t)).then(i=>A(this,Le,Eu).call(this,i,!0)).finally(()=>A(this,Le,_u).call(this));return}if(a(this,Qi)){const i=a(this,Qi);g(this,Qi,null),this._uiManager.enableWaiting(!0),g(this,Yr,this._uiManager.imageManager.getFromUrl(i).then(r=>A(this,Le,Eu).call(this,r)).finally(()=>A(this,Le,_u).call(this)));return}if(a(this,Kr)){const i=a(this,Kr);g(this,Kr,null),this._uiManager.enableWaiting(!0),g(this,Yr,this._uiManager.imageManager.getFromFile(i).then(r=>A(this,Le,Eu).call(this,r)).finally(()=>A(this,Le,_u).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Fu.supportedTypesStr;const s=this._uiManager._signal;g(this,Yr,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),A(this,Le,Eu).call(this,r)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>A(this,Le,_u).call(this))),t.click()},Zv=function(){var d;const{div:t}=this;let{width:s,height:i}=a(this,et);const[r,o]=this.pageDimensions,l=.75;if(this.width)s=this.width*r,i=this.height*o;else if(s>l*r||i>l*o){const f=Math.min(l*r/s,l*o/i);s*=f,i*=f}const[c,u]=this.parentDimensions;this.setDims(s*c/r,i*u/o),this._uiManager.enableWaiting(!1);const h=g(this,di,document.createElement("canvas"));h.setAttribute("role","img"),this.addContainer(h),this.width=s/r,this.height=i/o,(d=this._initialOptions)!=null&&d.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),A(this,Le,Jv).call(this),a(this,Mc)||(this.parent.addUndoableEditor(this),g(this,Mc,!0)),this._reportTelemetry({action:"inserted_image"}),a(this,Rc)&&h.setAttribute("aria-label",a(this,Rc))},Wf=function(t,s){const{width:i,height:r}=a(this,et);let o=i,l=r,c=a(this,et);for(;o>2*t||l>2*s;){const u=o,h=l;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),l>2*s&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2));const d=new OffscreenCanvas(o,l);d.getContext("2d").drawImage(c,0,0,u,h,0,0,o,l),c=d.transferToImageBitmap()}return c},Jv=function(){const[t,s]=this.parentDimensions,{width:i,height:r}=this,o=new Km,l=Math.ceil(i*t*o.sx),c=Math.ceil(r*s*o.sy),u=a(this,di);if(!u||u.width===l&&u.height===c)return;u.width=l,u.height=c;const h=a(this,Gn)?a(this,et):A(this,Le,Wf).call(this,l,c),d=u.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(h,0,0,h.width,h.height,0,0,l,c)},Xf=function(t){if(t){if(a(this,Gn)){const r=this._uiManager.imageManager.getSvgUrl(a(this,$t));if(r)return r}const s=document.createElement("canvas");return{width:s.width,height:s.height}=a(this,et),s.getContext("2d").drawImage(a(this,et),0,0),s.toDataURL()}if(a(this,Gn)){const[s,i]=this.pageDimensions,r=Math.round(this.width*s*po.PDF_TO_CSS_UNITS),o=Math.round(this.height*i*po.PDF_TO_CSS_UNITS),l=new OffscreenCanvas(r,o);return l.getContext("2d").drawImage(a(this,et),0,0,a(this,et).width,a(this,et).height,0,0,r,o),l.transferToImageBitmap()}return structuredClone(a(this,et))},l1=function(t){var l;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,r=t.pageIndex===s,o=(((l=t.accessibilityData)==null?void 0:l.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},V(Fu,"_type","stamp"),V(Fu,"_editorType",Ae.STAMP);let Qv=Fu;var Ia,Lc,pi,qr,Zi,us,Qr,Ic,Da,Is,Ji,Jt,er,ce,Zr,Qe,c1,qs,t0,n0,Yf;const xs=class xs{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:o,drawLayer:l,textLayer:c,viewport:u,l10n:h}){b(this,Qe);b(this,Ia);b(this,Lc,!1);b(this,pi,null);b(this,qr,null);b(this,Zi,null);b(this,us,new Map);b(this,Qr,!1);b(this,Ic,!1);b(this,Da,!1);b(this,Is,null);b(this,Ji,null);b(this,Jt,null);b(this,er,null);b(this,ce);const d=[...a(xs,Zr).values()];if(!xs._initialized){xs._initialized=!0;for(const f of d)f.initialize(h,e)}e.registerEditorTypes(d),g(this,ce,e),this.pageIndex=t,this.div=s,g(this,Ia,r),g(this,pi,o),this.viewport=u,g(this,Jt,c),this.drawLayer=l,this._structTree=i,a(this,ce).addLayer(this)}get isEmpty(){return a(this,us).size===0}get isInvisible(){return this.isEmpty&&a(this,ce).getMode()===Ae.NONE}updateToolbar(e){a(this,ce).updateToolbar(e)}updateMode(e=a(this,ce).getMode()){switch(A(this,Qe,Yf).call(this),e){case Ae.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Ae.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Ae.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const s of a(xs,Zr).values())t.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=a(this,Jt))==null?void 0:t.div)}setEditingState(e){a(this,ce).setEditingState(e)}addCommands(e){a(this,ce).addCommands(e)}cleanUndoStack(e){a(this,ce).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=a(this,pi))==null||t.div.classList.toggle("disabled",!e)}async enable(){g(this,Da,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const s of a(this,us).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(a(this,ce).removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!a(this,pi)){g(this,Da,!1);return}const t=a(this,pi).getEditableAnnotations();for(const s of t){if(s.hide(),a(this,ce).isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}g(this,Da,!1)}disable(){var i;g(this,Ic,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const r of a(this,us).values())if(r.disableEditing(),!!r.annotationElementId){if(r.serialize()!==null){e.set(r.annotationElementId,r);continue}else t.set(r.annotationElementId,r);(i=this.getEditableAnnotation(r.annotationElementId))==null||i.show(),r.remove()}if(a(this,pi)){const r=a(this,pi).getEditableAnnotations();for(const o of r){const{id:l}=o.data;if(a(this,ce).isDeletedAnnotationElement(l))continue;let c=t.get(l);if(c){c.resetAnnotationElement(o),c.show(!1),o.show();continue}c=e.get(l),c&&(a(this,ce).addChangedExistingAnnotation(c),c.renderAnnotationElement(o)&&c.show(!1)),o.show()}}A(this,Qe,Yf).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const r of a(xs,Zr).values())s.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),g(this,Ic,!1)}getEditableAnnotation(e){var t;return((t=a(this,pi))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){a(this,ce).getActive()!==e&&a(this,ce).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=a(this,Jt))!=null&&e.div&&!a(this,er)){g(this,er,new AbortController);const t=a(this,ce).combinedSignal(a(this,er));a(this,Jt).div.addEventListener("pointerdown",A(this,Qe,c1).bind(this),{signal:t}),a(this,Jt).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=a(this,Jt))!=null&&e.div&&a(this,er)&&(a(this,er).abort(),g(this,er,null),a(this,Jt).div.classList.remove("highlighting"))}enableClick(){if(a(this,qr))return;g(this,qr,new AbortController);const e=a(this,ce).combinedSignal(a(this,qr));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=a(this,qr))==null||e.abort(),g(this,qr,null)}attach(e){a(this,us).set(e.id,e);const{annotationElementId:t}=e;t&&a(this,ce).isDeletedAnnotationElement(t)&&a(this,ce).removeDeletedAnnotationElement(e)}detach(e){var t;a(this,us).delete(e.id),(t=a(this,Ia))==null||t.removePointerInTextLayer(e.contentDiv),!a(this,Ic)&&e.annotationElementId&&a(this,ce).addDeletedAnnotationElement(e)}remove(e){this.detach(e),a(this,ce).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(a(this,ce).addDeletedAnnotationElement(e.annotationElementId),nt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),a(this,ce).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!a(this,Da)),a(this,ce).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!a(this,Zi)&&(e._focusEventsAllowed=!1,g(this,Zi,setTimeout(()=>{g(this,Zi,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:a(this,ce)._signal}),t.focus())},0))),e._structTreeParentId=(s=a(this,Ia))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getNextId(){return a(this,ce).getId()}combinedSignal(e){return a(this,ce).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=a(this,Qe,qs))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){a(this,ce).updateToolbar(e),a(this,ce).updateMode(e);const{offsetX:s,offsetY:i}=A(this,Qe,n0).call(this),r=this.getNextId(),o=A(this,Qe,t0).call(this,{parent:this,id:r,x:s,y:i,uiManager:a(this,ce),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=a(xs,Zr).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,a(this,ce)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),r=A(this,Qe,t0).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:a(this,ce),isCentered:t,...s});return r&&this.add(r),r}addNewEditor(){this.createAndAddNewEditor(A(this,Qe,n0).call(this),!0)}setSelected(e){a(this,ce).setSelected(e)}toggleSelected(e){a(this,ce).toggleSelected(e)}unselect(e){a(this,ce).unselect(e)}pointerup(e){var s;const{isMac:t}=pn.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&a(this,Qr)&&(g(this,Qr,!1),!((s=a(this,Qe,qs))!=null&&s.isDrawer&&a(this,Qe,qs).supportMultipleDrawings))){if(!a(this,Lc)){g(this,Lc,!0);return}if(a(this,ce).getMode()===Ae.STAMP){a(this,ce).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var i;if(a(this,ce).getMode()===Ae.HIGHLIGHT&&this.enableTextSelection(),a(this,Qr)){g(this,Qr,!1);return}const{isMac:t}=pn.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(g(this,Qr,!0),(i=a(this,Qe,qs))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=a(this,ce).getActive();g(this,Lc,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus(),a(this,Is)){a(this,Qe,qs).startDrawing(this,a(this,ce),!1,e);return}a(this,ce).setCurrentDrawingSession(this),g(this,Is,new AbortController);const t=a(this,ce).combinedSignal(a(this,Is));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(g(this,Ji,null),this.commitOrRemove())},{signal:t}),a(this,Qe,qs).startDrawing(this,a(this,ce),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&g(this,Ji,t);return}a(this,Ji)&&setTimeout(()=>{var t;(t=a(this,Ji))==null||t.focus(),g(this,Ji,null)},0)}endDrawingSession(e=!1){return a(this,Is)?(a(this,ce).setCurrentDrawingSession(null),a(this,Is).abort(),g(this,Is,null),g(this,Ji,null),a(this,Qe,qs).endDrawing(e)):null}findNewParent(e,t,s){const i=a(this,ce).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return a(this,Is)?(this.endDrawingSession(),!0):!1}onScaleChanging(){a(this,Is)&&a(this,Qe,qs).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=a(this,ce).getActive())==null?void 0:e.parent)===this&&(a(this,ce).commitOrRemove(),a(this,ce).setActiveEditor(null)),a(this,Zi)&&(clearTimeout(a(this,Zi)),g(this,Zi,null));for(const s of a(this,us).values())(t=a(this,Ia))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,a(this,us).clear(),a(this,ce).removeLayer(this)}render({viewport:e}){this.viewport=e,Wa(this.div,e);for(const t of a(this,ce).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){a(this,ce).commitOrRemove(),A(this,Qe,Yf).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Wa(this.div,{rotation:s}),t!==s)for(const i of a(this,us).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return a(this,ce).viewParameters.realScale}};Ia=new WeakMap,Lc=new WeakMap,pi=new WeakMap,qr=new WeakMap,Zi=new WeakMap,us=new WeakMap,Qr=new WeakMap,Ic=new WeakMap,Da=new WeakMap,Is=new WeakMap,Ji=new WeakMap,Jt=new WeakMap,er=new WeakMap,ce=new WeakMap,Zr=new WeakMap,Qe=new WeakSet,c1=function(e){a(this,ce).unselectAll();const{target:t}=e;if(t===a(this,Jt).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&a(this,Jt).div.contains(t)){const{isMac:s}=pn.platform;if(e.button!==0||e.ctrlKey&&s)return;a(this,ce).showAllEditors("highlight",!0,!0),a(this,Jt).div.classList.add("free"),this.toggleDrawing(),_p.startHighlighting(this,a(this,ce).direction==="ltr",{target:a(this,Jt).div,x:e.x,y:e.y}),a(this,Jt).div.addEventListener("pointerup",()=>{a(this,Jt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:a(this,ce)._signal}),e.preventDefault()}},qs=function(){return a(xs,Zr).get(a(this,ce).getMode())},t0=function(e){const t=a(this,Qe,qs);return t?new t.prototype.constructor(e):null},n0=function(){const{x:e,y:t,width:s,height:i}=this.div.getBoundingClientRect(),r=Math.max(0,e),o=Math.max(0,t),l=Math.min(window.innerWidth,e+s),c=Math.min(window.innerHeight,t+i),u=(r+l)/2-e,h=(o+c)/2-t,[d,f]=this.viewport.rotation%180===0?[u,h]:[h,u];return{offsetX:d,offsetY:f}},Yf=function(){for(const e of a(this,us).values())e.isEmpty()&&e.remove()},V(xs,"_initialized",!1),b(xs,Zr,new Map([Dv,qv,Qv,_p].map(e=>[e._editorType,e])));let e0=xs;var Ds,kd,hn,Fa,Wp,u1,wi,i0,h1,r0;const Kt=class Kt{constructor({pageIndex:e}){b(this,wi);b(this,Ds,null);b(this,kd,0);b(this,hn,new Map);b(this,Fa,new Map);this.pageIndex=e}setParent(e){if(!a(this,Ds)){g(this,Ds,e);return}if(a(this,Ds)!==e){if(a(this,hn).size>0)for(const t of a(this,hn).values())t.remove(),e.append(t);g(this,Ds,e)}}static get _svgFactory(){return ke(this,"_svgFactory",new hy)}draw(e,t=!1,s=!1){const i=on(this,kd)._++,r=A(this,wi,i0).call(this),o=Kt._svgFactory.createElement("defs");r.append(o);const l=Kt._svgFactory.createElement("path");o.append(l);const c=`path_p${this.pageIndex}_${i}`;l.setAttribute("id",c),l.setAttribute("vector-effect","non-scaling-stroke"),t&&a(this,Fa).set(i,l);const u=s?A(this,wi,h1).call(this,o,c):null,h=Kt._svgFactory.createElement("use");return r.append(h),h.setAttribute("href",`#${c}`),this.updateProperties(r,e),a(this,hn).set(i,r),{id:i,clipPathId:`url(#${u})`}}drawOutline(e,t){const s=on(this,kd)._++,i=A(this,wi,i0).call(this),r=Kt._svgFactory.createElement("defs");i.append(r);const o=Kt._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke");let c;if(t){const d=Kt._svgFactory.createElement("mask");r.append(d),c=`mask_p${this.pageIndex}_${s}`,d.setAttribute("id",c),d.setAttribute("maskUnits","objectBoundingBox");const f=Kt._svgFactory.createElement("rect");d.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=Kt._svgFactory.createElement("use");d.append(p),p.setAttribute("href",`#${l}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const u=Kt._svgFactory.createElement("use");i.append(u),u.setAttribute("href",`#${l}`),c&&u.setAttribute("mask",`url(#${c})`);const h=u.cloneNode();return i.append(h),u.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(i,e),a(this,hn).set(s,i),s}finalizeDraw(e,t){a(this,Fa).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var c;if(!t)return;const{root:s,bbox:i,rootClass:r,path:o}=t,l=typeof e=="number"?a(this,hn).get(e):e;if(l){if(s&&A(this,wi,r0).call(this,l,s),i&&A(c=Kt,Wp,u1).call(c,l,i),r){const{classList:u}=l;for(const[h,d]of Object.entries(r))u.toggle(h,d)}if(o){const h=l.firstChild.firstChild;A(this,wi,r0).call(this,h,o)}}}updateParent(e,t){if(t===this)return;const s=a(this,hn).get(e);s&&(a(t,Ds).append(s),a(this,hn).delete(e),a(t,hn).set(e,s))}remove(e){a(this,Fa).delete(e),a(this,Ds)!==null&&(a(this,hn).get(e).remove(),a(this,hn).delete(e))}destroy(){g(this,Ds,null);for(const e of a(this,hn).values())e.remove();a(this,hn).clear(),a(this,Fa).clear()}};Ds=new WeakMap,kd=new WeakMap,hn=new WeakMap,Fa=new WeakMap,Wp=new WeakSet,u1=function(e,[t,s,i,r]){const{style:o}=e;o.top=`${100*s}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*r}%`},wi=new WeakSet,i0=function(){const e=Kt._svgFactory.create(1,1,!0);return a(this,Ds).append(e),e.setAttribute("aria-hidden",!0),e},h1=function(e,t){const s=Kt._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=Kt._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},r0=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},b(Kt,Wp);let s0=Kt;globalThis.pdfjsTestingUtils={HighlightOutliner:Ov};ye.AbortException;ye.AnnotationEditorLayer;ye.AnnotationEditorParamsType;ye.AnnotationEditorType;ye.AnnotationEditorUIManager;ye.AnnotationLayer;ye.AnnotationMode;ye.ColorPicker;ye.DOMSVGFactory;ye.DrawLayer;ye.FeatureTest;var Qk=ye.GlobalWorkerOptions;ye.ImageKind;ye.InvalidPDFException;ye.MissingPDFException;ye.OPS;ye.OutputScale;ye.PDFDataRangeTransport;ye.PDFDateString;ye.PDFWorker;ye.PasswordResponses;ye.PermissionFlag;ye.PixelsPerInch;ye.RenderingCancelledException;ye.TextLayer;ye.TouchManager;ye.UnexpectedResponseException;ye.Util;ye.VerbosityLevel;ye.XfaLayer;ye.build;ye.createValidAbsoluteUrl;ye.fetchData;var Zk=ye.getDocument;ye.getFilenameFromUrl;ye.getPdfFilenameFromUrl;ye.getXfaPageViewport;ye.isDataScheme;ye.isPdfFile;ye.noContextMenu;ye.normalizeUnicode;ye.setLayerDimensions;ye.shadow;ye.stopEvent;ye.version;Qk.workerSrc="./pdf.worker.min.mjs";const d1="./cmaps/",f1="./standard_fonts/",p1={cMapUrl:d1,cMapPacked:!0,standardFontDataUrl:f1,useSystemFonts:!1,verbosity:0,disableFontFace:!1,fontExtraProperties:!0,enableXfa:!1,useWorkerFetch:!1,isEvalSupported:!1,disableRange:!1,disableStream:!1,maxImageSize:16777216};console.log("PDF.js CMap Configuration:");console.log("- Environment:","production");console.log("- CMap URL:",d1);console.log("- Font URL:",f1);console.log("- Use System Fonts:",p1.useSystemFonts);function za(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Qg(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function $a(n,e){const t=e.getBoundingClientRect();return"touches"in n&&n.touches.length>0?{x:n.touches[0].clientX-t.left,y:n.touches[0].clientY-t.top}:{x:n.clientX-t.left,y:n.clientY-t.top}}function Jk(n){if(n===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(n)/Math.log(e));return parseFloat((n/Math.pow(e,s)).toFixed(2))+" "+t[s]}function kp(n){return n.type==="application/pdf"||n.name.toLowerCase().endsWith(".pdf")}function Bc(n,e,t){return{x:n.x/e,y:n.y/t}}function mi(n,e,t){return{x:n.x*e,y:n.y*t}}function eT(n,e,t){return n.map(s=>Bc(s,e,t))}function g1(n,e,t){return n.map(s=>mi(s,e,t))}class tT{constructor(e,t,s){V(this,"canvas");V(this,"isDrawing",!1);V(this,"currentPath",[]);V(this,"color","#000000");V(this,"baseLineWidth",2);V(this,"onAnnotationComplete");V(this,"MIN_DISTANCE",1.5);V(this,"PRESSURE_SMOOTHING",.3);this.canvas=e,this.onAnnotationComplete=s}setColor(e){this.color=e}setLineWidth(e){this.baseLineWidth=e}getPressure(e){return e.pressure!==void 0&&e.pressure>0?Math.max(.3,Math.min(1,e.pressure)):e.touches&&e.touches[0]&&e.touches[0].force!==void 0?Math.max(.3,Math.min(1,e.touches[0].force)):.7}shouldAddPoint(e){if(this.currentPath.length===0)return!0;const t=this.currentPath[this.currentPath.length-1];return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))>=this.MIN_DISTANCE}smoothPressure(e){if(this.currentPath.length===0)return e;const s=this.currentPath[this.currentPath.length-1].pressure;return s+this.PRESSURE_SMOOTHING*(e-s)}createSmoothPath(){if(this.currentPath.length<3)return this.currentPath;const e=[];e.push(this.currentPath[0]);for(let t=1;t<this.currentPath.length-1;t++){const s=this.currentPath[t-1],i=this.currentPath[t],r=this.currentPath[t+1],o={x:(s.x+i.x+r.x)/3,y:(s.y+i.y+r.y)/3,pressure:(s.pressure+i.pressure+r.pressure)/3,timestamp:i.timestamp};e.push(o)}return e.push(this.currentPath[this.currentPath.length-1]),e}startDrawing(e){const t=e.pointerType||"unknown";console.log(` PenTool.startDrawing - Event type: ${t}, isDrawing: ${this.isDrawing}`),this.isDrawing=!0,this.currentPath=[];const s=$a(e,this.canvas),i=this.getPressure(e);console.log(` PenTool.startDrawing - Point: (${s.x}, ${s.y}), Pressure: ${i}`),this.currentPath.push({x:s.x,y:s.y,pressure:i,timestamp:performance.now()}),console.log(` PenTool.startDrawing - Path length: ${this.currentPath.length}`)}draw(e){const t=e.pointerType||"unknown";if(!this.isDrawing){console.log(` PenTool.draw - NOT DRAWING (Event type: ${t})`);return}const s=$a(e,this.canvas),i=this.getPressure(e),r=this.smoothPressure(i),o={x:s.x,y:s.y,pressure:r,timestamp:performance.now()};this.shouldAddPoint(o)?(this.currentPath.push(o),console.log(` PenTool.draw - Added point (${t}), Path length: ${this.currentPath.length}`)):console.log(` PenTool.draw - Skipped point (${t}), too close`)}stopDrawing(e){if(console.log(` PenTool.stopDrawing - isDrawing: ${this.isDrawing}, Path length: ${this.currentPath.length}, Page: ${e}`),!this.isDrawing){console.log(" PenTool.stopDrawing - NOT DRAWING, returning early");return}if(this.isDrawing=!1,console.log(" PenTool.stopDrawing - Set isDrawing to false"),this.currentPath.length>1&&this.onAnnotationComplete){console.log(` PenTool.stopDrawing - Creating annotation with ${this.currentPath.length} points`);const t=this.createSmoothPath();console.log(` PenTool.stopDrawing - Smoothed path has ${t.length} points`);const s=eT(t.map(r=>({x:r.x,y:r.y})),this.canvas.width,this.canvas.height);console.log(` PenTool.stopDrawing - Normalized points: ${s.length}`);const i={id:za(),type:"pen",points:s,color:this.color,width:this.baseLineWidth,timestamp:Date.now(),pageNumber:e};console.log(` PenTool.stopDrawing - CALLING onAnnotationComplete with annotation ID: ${i.id}`),this.onAnnotationComplete(i),console.log(" PenTool.stopDrawing - onAnnotationComplete CALLED successfully")}else console.log(` PenTool.stopDrawing - NOT creating annotation - Path length: ${this.currentPath.length}, onAnnotationComplete exists: ${!!this.onAnnotationComplete}`);this.currentPath=[],console.log(" PenTool.stopDrawing - Cleared currentPath")}cancel(){console.log(` PenTool.cancel - CANCELLING DRAWING! Path length was: ${this.currentPath.length}`),console.trace(" PenTool.cancel - STACK TRACE:"),this.isDrawing=!1,this.currentPath=[],console.log(" PenTool.cancel - Cancelled and cleared path")}isActive(){return this.isDrawing}getCurrentPath(){if(!this.isDrawing||this.currentPath.length===0)return null;const e=this.createSmoothPath();return{points:e.map(t=>({x:t.x,y:t.y})),color:this.color,lineWidth:this.baseLineWidth,pressurePoints:e}}}class nT{constructor(){V(this,"isPenActive",!1);V(this,"lastPenEventTime",0);V(this,"penCooldownDuration",2e3);V(this,"isAnyToolActive",!1);V(this,"activeToolType",null);this.setupGlobalListeners()}setupGlobalListeners(){const e=s=>{s.pointerType==="pen"&&(console.log(" Global pen event detected:",s.type),s.type==="pointerdown"?this.setPenActive(!0):(s.type==="pointerup"||s.type==="pointerleave")&&this.setPenActive(!1))};document.addEventListener("pointerdown",e,{capture:!0}),document.addEventListener("pointerup",e,{capture:!0}),document.addEventListener("pointerleave",e,{capture:!0}),document.addEventListener("pointermove",s=>{s.pointerType==="pen"&&this.isPenActive&&(this.lastPenEventTime=Date.now())},{capture:!0});const t=s=>{if(s.touches.length===1){const i=s.touches[0];i.force&&i.force>.3&&(console.log(" Stylus-like touch detected with force:",i.force),s.type==="touchstart"?this.setPenActive(!0):s.type==="touchend"&&this.setPenActive(!1))}};document.addEventListener("touchstart",t,{capture:!0}),document.addEventListener("touchend",t,{capture:!0})}setPenActive(e){e?(this.isPenActive=!0,this.lastPenEventTime=Date.now(),console.log(" Pen is now ACTIVE")):setTimeout(()=>{this.isPenActive=!1,console.log(" Pen is now INACTIVE")},300)}isPenCurrentlyActive(){const t=Date.now()-this.lastPenEventTime<this.penCooldownDuration;return this.isPenActive||t}isPenEvent(e){if("pointerType"in e&&e.pointerType==="pen")return console.log(" Confirmed pen event via pointerType"),!0;const t=e.nativeEvent;if(t&&"pointerType"in t&&t.pointerType==="pen")return console.log(" Confirmed pen event via nativeEvent.pointerType"),!0;if(e.type.includes("touch")){const s=e;if(s.touches&&s.touches.length===1){const i=s.touches[0];if(i.force&&i.force>.3)return console.log(" Confirmed stylus-like touch with force:",i.force),!0}}return!1}setToolActive(e,t){t?(this.isAnyToolActive=!0,this.activeToolType=e,console.log(` Tool "${e}" is now ACTIVE`)):setTimeout(()=>{this.isAnyToolActive=!1,this.activeToolType=null,console.log(` Tool "${e}" is now INACTIVE`)},500)}isAnyDrawingToolActive(){return this.isPenCurrentlyActive()||this.isAnyToolActive}getActiveToolType(){return this.isPenCurrentlyActive()?"pen":this.activeToolType}shouldDisableKeyboardShortcuts(){const e=this.isAnyDrawingToolActive();return e&&console.log(` Keyboard shortcuts DISABLED due to ${this.getActiveToolType()} activity`),e}}const Wc=new nT,rf=()=>Wc.isPenCurrentlyActive(),of=n=>Wc.isPenEvent(n),qw=()=>Wc.shouldDisableKeyboardShortcuts(),Ln=(n,e)=>Wc.setToolActive(n,e),m1=()=>Wc.isAnyDrawingToolActive(),sT=()=>Wc.getActiveToolType();class iT{constructor(e,t,s){V(this,"canvas");V(this,"ctx");V(this,"_isErasing",!1);V(this,"eraserSize",20);this.canvas=e,this.ctx=t}get isErasing(){return this._isErasing}set isErasing(e){if(this._isErasing!==e){const t=new Error().stack;console.log(` EraserTool.isErasing - CHANGED from ${this._isErasing} to ${e}`),console.log(" EraserTool.isErasing - STACK TRACE:"),console.log(t),this._isErasing=e}}setEraserSize(e){this.eraserSize=e}startErasing(e){const t=e.pointerType||"unknown";console.log(` EraserTool.startErasing - Event type: ${t}, isErasing: ${this.isErasing}`),this.isErasing=!0,Ln("eraser",!0),console.log(" EraserTool.startErasing - Set isErasing to true and activated tool tracking"),this.erase(e)}erase(e){const t=e.pointerType||"unknown";if(!this.isErasing){console.log(` EraserTool.erase - NOT ERASING (Event type: ${t})`);return}const s=$a(e,this.canvas);console.log(` EraserTool.erase - Erasing at (${s.x}, ${s.y}) with ${t}`),this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(s.x,s.y,this.eraserSize/2,0,Math.PI*2),this.ctx.fill(),this.ctx.restore(),this.showEraserCursor(s)}stopErasing(){console.log(` EraserTool.stopErasing - isErasing: ${this.isErasing}`),console.trace(" EraserTool.stopErasing - STACK TRACE:"),this.isErasing=!1,Ln("eraser",!1),console.log(" EraserTool.stopErasing - Set isErasing to false and deactivated tool tracking"),this.hideEraserCursor()}cancel(){console.log(` EraserTool.cancel - CANCELLING ERASING! isErasing was: ${this.isErasing}`),console.trace(" EraserTool.cancel - STACK TRACE:"),this.isErasing=!1,this.hideEraserCursor(),console.log(" EraserTool.cancel - Cancelled and cleared eraser state")}isActive(){return this.isErasing}checkAnnotationsForErasure(e,t){const s=[],i=this.eraserSize/2;for(const r of t){let o=!1;if(r.type==="pen"){const l=g1(r.points,this.canvas.width,this.canvas.height);for(const c of l)if(Qg(e,c)<=i){o=!0;break}}else if(r.type==="line"){const l=mi(r.start,this.canvas.width,this.canvas.height),c=mi(r.end,this.canvas.width,this.canvas.height),u=[l,c];for(const h of u)if(Qg(e,h)<=i){o=!0;break}}else if(r.type==="text"){const l=mi(r.position,this.canvas.width,this.canvas.height);Qg(e,l)<=i&&(o=!0)}o&&s.push(r.id)}return s}showEraserCursor(e){this.ctx.save(),this.ctx.strokeStyle="rgba(255, 0, 0, 0.5)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,this.eraserSize/2,0,Math.PI*2),this.ctx.stroke(),this.ctx.restore()}hideEraserCursor(){}}class rT{constructor(e,t,s){V(this,"canvas");V(this,"isDrawing",!1);V(this,"hasStartPoint",!1);V(this,"startPoint",null);V(this,"color","#000000");V(this,"lineWidth",2);V(this,"onAnnotationComplete");V(this,"currentEndPoint",null);this.canvas=e,this.onAnnotationComplete=s}setColor(e){this.color=e}setLineWidth(e){this.lineWidth=e}startDrawing(e){const t=$a(e,this.canvas);this.hasStartPoint?this.stopDrawing(e,1):(this.hasStartPoint=!0,this.isDrawing=!0,this.startPoint=t,this.currentEndPoint=t)}draw(e){!this.hasStartPoint||!this.startPoint||(this.currentEndPoint=$a(e,this.canvas))}stopDrawing(e,t){if(!this.hasStartPoint||!this.startPoint)return;const s=$a(e,this.canvas);if(this.hasStartPoint&&this.onAnnotationComplete){const i=Bc(this.startPoint,this.canvas.width,this.canvas.height),r=Bc(s,this.canvas.width,this.canvas.height),o={id:za(),type:"line",start:i,end:r,color:this.color,width:this.lineWidth,timestamp:Date.now(),pageNumber:t};this.onAnnotationComplete(o)}this.hasStartPoint=!1,this.isDrawing=!1,this.startPoint=null,this.currentEndPoint=null}cancel(){this.hasStartPoint=!1,this.isDrawing=!1,this.startPoint=null,this.currentEndPoint=null}isActive(){return this.hasStartPoint||this.isDrawing}updateCanvasSize(e,t){}getCurrentLine(){return!this.hasStartPoint||!this.startPoint||!this.currentEndPoint?null:{start:this.startPoint,end:this.currentEndPoint,color:this.color,lineWidth:this.lineWidth}}}class oT{constructor(e,t,s){V(this,"canvas");V(this,"color","#000000");V(this,"fontSize",16);V(this,"onAnnotationComplete");V(this,"activeInput",null);V(this,"isInputFocused",!1);this.canvas=e,this.onAnnotationComplete=s}setColor(e){this.color=e}setFontSize(e){this.fontSize=e}createTextInput(e,t){this.removeActiveInput();const s=$a(e,this.canvas),i=document.createElement("input");i.type="text",i.className="absolute border-2 border-blue-500 bg-white rounded px-2 py-1 z-50",i.style.left=`${s.x}px`,i.style.top=`${s.y-this.fontSize/2}px`,i.style.fontSize=`${this.fontSize}px`,i.style.color=this.color,i.style.minWidth="150px";const r=this.canvas.parentElement;r&&(r.style.position="relative",r.appendChild(i)),this.activeInput=i,this.isInputFocused=!0,setTimeout(()=>{i.focus(),i.select()},10);const o=()=>{const l=i.value.trim();if(l&&this.onAnnotationComplete){const c=Bc(s,this.canvas.width,this.canvas.height),h=document.createElement("canvas").getContext("2d");let d=.2,f=.03;if(h){h.font=`${this.fontSize}px sans-serif`;const y=h.measureText(l),w=800,_=600,m=y.width,v=this.fontSize*1.5;d=Math.min(.8,m/w),f=Math.min(.2,v/_),d=Math.max(.1,d),f=Math.max(.02,f)}const p={id:za(),type:"text",position:c,content:l,fontSize:this.fontSize,color:this.color,width:d,height:f,timestamp:Date.now(),pageNumber:t};this.onAnnotationComplete(p)}this.removeActiveInput()};i.addEventListener("focus",()=>{this.isInputFocused=!0}),i.addEventListener("keydown",l=>{l.key==="Enter"?(l.preventDefault(),o()):l.key==="Escape"&&(l.preventDefault(),this.removeActiveInput())}),i.addEventListener("blur",()=>{this.isInputFocused=!1,setTimeout(()=>{!this.isInputFocused&&this.activeInput&&o()},200)})}removeActiveInput(){this.activeInput&&(this.activeInput.remove(),this.activeInput=null,this.isInputFocused=!1)}cancel(){this.removeActiveInput()}isActive(){return this.activeInput!==null}}const o0=["#000000","#FF0000","#0000FF","#00FF00","#FFFF00","#FFA500","#800080","#FFC0CB"],aT=[1,2,3,5,8],v1=[10,12,14,16,18,24],lT=[{name:"Small",size:10},{name:"Medium",size:20},{name:"Large",size:40}],cT=[{label:"25%",value:.25},{label:"50%",value:.5},{label:"75%",value:.75},{label:"100%",value:1},{label:"125%",value:1.25},{label:"150%",value:1.5},{label:"200%",value:2},{label:"250%",value:2.5},{label:"300%",value:3},{label:"400%",value:4},{label:"500%",value:5},{label:"600%",value:6},{label:"800%",value:8},{label:"Fit Width",value:"fit-width"},{label:"Fit Page",value:"fit-page"}],uT={enabled:!0,interval:3e4,maxAutoSaves:5,retentionDays:7},hT=({annotation:n,canvasWidth:e,canvasHeight:t,onSave:s,onCancel:i})=>{const[r,o]=k.useState(n.content),[l,c]=k.useState(n.color),[u,h]=k.useState(n.fontSize),d=k.useRef(null);k.useEffect(()=>{var w,_;(w=d.current)==null||w.focus(),(_=d.current)==null||_.select()},[]);const f=()=>{s({content:r,color:l,fontSize:u})},p=w=>{w.key==="Enter"?f():w.key==="Escape"&&i()},y=mi(n.position,e,t);return S.jsxs("div",{className:"absolute bg-gray-800 rounded-lg shadow-xl p-3 z-50 min-w-[200px]",style:{left:`${Math.min(y.x,e-220)}px`,top:`${Math.min(y.y+n.fontSize+10,t-200)}px`},children:[S.jsx("input",{ref:d,type:"text",value:r,onChange:w=>o(w.target.value),onKeyDown:p,className:"w-full px-2 py-1 bg-gray-700 text-white rounded mb-2 text-sm",placeholder:"Enter text..."}),S.jsxs("div",{className:"mb-2",children:[S.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Color"}),S.jsx("div",{className:"flex gap-1 flex-wrap",children:o0.map(w=>S.jsx("button",{onClick:()=>c(w),className:`w-6 h-6 rounded border-2 ${l===w?"border-blue-400":"border-transparent"} hover:border-gray-400 transition-colors`,style:{backgroundColor:w}},w))})]}),S.jsxs("div",{className:"mb-3",children:[S.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Size"}),S.jsx("div",{className:"flex gap-1",children:v1.map(w=>S.jsx("button",{onClick:()=>h(w),className:`px-2 py-1 text-xs rounded ${u===w?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"} transition-colors`,children:w},w))})]}),S.jsxs("div",{className:"flex gap-2",children:[S.jsx("button",{onClick:f,className:"flex-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:"Save"}),S.jsx("button",{onClick:i,className:"flex-1 px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white text-sm rounded transition-colors",children:"Cancel"})]})]})},dT=({annotation:n,canvasWidth:e,canvasHeight:t,isSelected:s,onUpdate:i,onSelect:r,onEdit:o})=>{if(!n||!n.position)return console.error("ResizableText: Invalid annotation",n),null;const[l,c]=k.useState(!1),[u,h]=k.useState(!1),[d,f]=k.useState(null),[p,y]=k.useState({x:0,y:0}),[w,_]=k.useState({x:0,y:0,width:0,height:0}),m=k.useRef(null),v=mi(n.position,e,t),E=n.width?n.width*e:200,x=n.height?n.height*t:n.fontSize*1.5;k.useMemo(()=>{if(n.width&&n.height){const K=document.createElement("canvas").getContext("2d");if(K){let q=16;K.font=`${q}px sans-serif`;const ee=K.measureText(n.content),z=E*.9/ee.width,T=x*.8/q,R=Math.min(z,T);return Math.max(8,Math.min(200,q*R))}}return Math.min(x*.7,n.fontSize)},[n.width,n.height,n.content,n.fontSize,E,x]);const C=k.useCallback((M,K)=>{M.preventDefault(),M.stopPropagation(),c(!0),f(K),y({x:M.clientX,y:M.clientY}),_({x:v.x,y:v.y,width:E,height:x})},[v,E,x]),P=k.useCallback((M,K)=>{M.preventDefault(),M.stopPropagation();const q=M.touches[0];c(!0),f(K),y({x:q.clientX,y:q.clientY}),_({x:v.x,y:v.y,width:E,height:x})},[v,E,x]),N=k.useCallback(M=>{if(!u||!i)return;let K,q;if("touches"in M&&M.touches.length>0)K=M.touches[0].clientX,q=M.touches[0].clientY;else if("clientX"in M)K=M.clientX,q=M.clientY;else return;const ee=K-p.x,z=q-p.y,T={x:w.x+ee,y:w.y+z},R=Bc(T,e,t);i&&i(n.id,{position:R})},[u,p,w,e,t,i,n.id]),I=k.useCallback(M=>{if(!l||!d||!i)return;let K,q;if("touches"in M&&M.touches.length>0)K=M.touches[0].clientX,q=M.touches[0].clientY;else if("clientX"in M)K=M.clientX,q=M.clientY;else return;const ee=K-p.x,z=q-p.y;let T=w.x,R=w.y,$=w.width,D=w.height;switch(d){case"nw":T=w.x+ee,R=w.y+z,$=w.width-ee,D=w.height-z;break;case"ne":R=w.y+z,$=w.width+ee,D=w.height-z;break;case"sw":T=w.x+ee,$=w.width-ee,D=w.height+z;break;case"se":$=w.width+ee,D=w.height+z;break;case"n":R=w.y+z,D=w.height-z;break;case"s":D=w.height+z;break;case"w":T=w.x+ee,$=w.width-ee;break;case"e":$=w.width+ee;break}$=Math.max(50,$),D=Math.max(20,D);const Y=Bc({x:T,y:R},e,t),te=$/e,Z=D/t;i&&i(n.id,{position:Y,width:te,height:Z})},[l,d,p,w,e,t,i,n.id]),L=k.useCallback(()=>{c(!1),f(null),h(!1)},[]);k.useEffect(()=>{if(l||u){const M=q=>{l?I(q):u&&N(q)},K=q=>{l?I(q):u&&N(q)};return document.addEventListener("mousemove",M),document.addEventListener("mouseup",L),document.addEventListener("touchmove",K,{passive:!1}),document.addEventListener("touchend",L),()=>{document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",L),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",L)}}},[l,u,I,N,L]);const U=k.useCallback(M=>{!s||M.target.classList.contains("resize-handle")||(M.preventDefault(),M.stopPropagation(),h(!0),y({x:M.clientX,y:M.clientY}),_({x:v.x,y:v.y,width:E,height:x}))},[s,v,E,x]),W=k.useCallback(M=>{if(!s||M.target.classList.contains("resize-handle"))return;M.preventDefault(),M.stopPropagation();const q=M.touches[0];h(!0),y({x:q.clientX,y:q.clientY}),_({x:v.x,y:v.y,width:E,height:x})},[s,v,E,x]);return S.jsx("div",{ref:m,style:{position:"absolute",left:`${v.x}px`,top:`${v.y}px`,width:`${E}px`,height:`${x}px`,pointerEvents:"auto",cursor:s?u?"grabbing":"grab":"pointer",zIndex:25,background:"transparent"},onClick:r,onDoubleClick:M=>{M.stopPropagation(),o&&o()},onMouseDown:U,onTouchStart:W,onMouseMove:M=>N(M),onTouchMove:M=>N(M),onMouseUp:L,onTouchEnd:L,children:s&&S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"absolute inset-0 border-2 border-blue-500",style:{borderStyle:"dashed",pointerEvents:"none"}}),[{name:"nw",cursor:"nw-resize",top:-4,left:-4},{name:"ne",cursor:"ne-resize",top:-4,right:-4},{name:"sw",cursor:"sw-resize",bottom:-4,left:-4},{name:"se",cursor:"se-resize",bottom:-4,right:-4},{name:"n",cursor:"n-resize",top:-4,left:"50%",transform:"translateX(-50%)"},{name:"s",cursor:"s-resize",bottom:-4,left:"50%",transform:"translateX(-50%)"},{name:"w",cursor:"w-resize",left:-4,top:"50%",transform:"translateY(-50%)"},{name:"e",cursor:"e-resize",right:-4,top:"50%",transform:"translateY(-50%)"}].map(M=>{const{name:K,cursor:q,...ee}=M;return S.jsx("div",{className:"resize-handle absolute w-2 h-2 bg-blue-500",style:{cursor:q,...ee},onMouseDown:z=>C(z,K),onTouchStart:z=>P(z,K)},K)})]})})},fT=({pageNumber:n,annotations:e,currentTool:t,toolSettings:s,canvasWidth:i,canvasHeight:r,onAnnotationAdd:o,onAnnotationRemove:l,onAnnotationUpdate:c,isDisabled:u=!1})=>{const h=k.useRef(null),d=k.useRef(!1),[f,p]=k.useState(0),[y,w]=k.useState(null),[_,m]=k.useState(null),v=k.useRef(null),E=k.useRef(0),[x,C]=k.useState({pen:null,eraser:null,line:null,text:null});k.useEffect(()=>{if(!h.current)return;const T=h.current,R=T.getContext("2d");if(!R)return;const $={pen:new tT(T,R,o),eraser:new iT(T,R,Z=>Z.forEach(l)),line:new rT(T,R,o),text:new oT(T,R,o)};C($);const D=Z=>{if(console.log(" Gesture start detected"),rf()){console.log(" Gesture start - PEN ACTIVE, NOT cancelling drawing"),Z.preventDefault();return}console.log(" Gesture start - preventing non-pen drawing"),Z.preventDefault(),d.current&&$.pen.isActive()&&($.pen.cancel(),d.current=!1,p(me=>me+1)),Ln("eraser",!1),Ln("line",!1)},Y=Z=>{if(console.log(" Gesture change detected"),rf()){console.log(" Gesture change - PEN ACTIVE, NOT cancelling drawing"),Z.preventDefault();return}console.log(" Gesture change - preventing non-pen drawing"),Z.preventDefault(),d.current&&($.pen.isActive()&&$.pen.cancel(),$.eraser.isActive()&&$.eraser.cancel(),d.current=!1,p(me=>me+1)),Ln("eraser",!1),Ln("line",!1)},te=Z=>{console.log(" Gesture end detected"),Z.preventDefault()};return T.addEventListener("gesturestart",D,{passive:!1}),T.addEventListener("gesturechange",Y,{passive:!1}),T.addEventListener("gestureend",te,{passive:!1}),()=>{$.text.cancel(),T.removeEventListener("gesturestart",D),T.removeEventListener("gesturechange",Y),T.removeEventListener("gestureend",te)}},[o,l,p]),k.useEffect(()=>{x.pen&&(x.pen.setColor(s.color),x.pen.setLineWidth(s.lineWidth)),x.eraser&&x.eraser.setEraserSize(s.eraserSize),x.line&&(x.line.setColor(s.color),x.line.setLineWidth(s.lineWidth)),x.text&&(x.text.setColor(s.color),x.text.setFontSize(s.fontSize))},[x,s]),k.useEffect(()=>{const T=h.current;if(!T)return;T.width=i,T.height=r;const R=T.getContext("2d");if(!R)return;if(R.clearRect(0,0,T.width,T.height),e.filter(D=>D.pageNumber===n).forEach(D=>{switch(R.save(),D.type){case"pen":const Y=g1(D.points,T.width,T.height);R.strokeStyle=D.color,R.lineWidth=D.width,R.lineCap="round",R.lineJoin="round",R.beginPath(),Y.forEach((we,rt)=>{rt===0?R.moveTo(we.x,we.y):R.lineTo(we.x,we.y)}),R.stroke();break;case"line":const te=mi(D.start,T.width,T.height),Z=mi(D.end,T.width,T.height);R.strokeStyle=D.color,R.lineWidth=D.width,R.lineCap="round",R.beginPath(),R.moveTo(te.x,te.y),R.lineTo(Z.x,Z.y),R.stroke();break;case"text":const me=mi(D.position,T.width,T.height),Ge=D.width?D.width*T.width:200,_e=D.height?D.height*T.height:D.fontSize*1.2;let he=D.fontSize;if(D.width&&D.height){let we=16;R.font=`${we}px sans-serif`;const rt=R.measureText(D.content),wn=Ge*.9/rt.width,Vs=_e*.8/we,Gs=Math.min(wn,Vs);he=Math.max(8,Math.min(200,we*Gs))}R.font=`${he}px sans-serif`,R.fillStyle=D.color,R.textBaseline="middle",R.textAlign="center",R.fillText(D.content,me.x+Ge/2,me.y+_e/2),R.textAlign="start",R.textBaseline="alphabetic";break}R.restore()}),w(D=>D&&!e.find(Y=>Y.id===D)?null:D),x.pen&&x.pen.isActive()){const D=x.pen.getCurrentPath();if(D&&D.points.length>0){R.save(),R.strokeStyle=D.color,R.lineCap="round",R.lineJoin="round";const Y=D.pressurePoints;if(Y&&Y.length>1){R.beginPath(),R.moveTo(Y[0].x,Y[0].y);for(let te=1;te<Y.length-1;te++){const Z=Y[te],me=Y[te+1],Ge=Math.pow(Z.pressure||.7,.6),_e=Math.max(.5,D.lineWidth*Ge);R.lineWidth=_e;const he=(Z.x+me.x)/2,we=(Z.y+me.y)/2;R.quadraticCurveTo(Z.x,Z.y,he,we)}if(Y.length>1){const te=Y[Y.length-1];R.lineTo(te.x,te.y)}R.stroke()}else{if(R.lineWidth=D.lineWidth,R.beginPath(),D.points.length>2){R.moveTo(D.points[0].x,D.points[0].y);for(let Z=1;Z<D.points.length-1;Z++){const me=D.points[Z],Ge=D.points[Z+1],_e=(me.x+Ge.x)/2,he=(me.y+Ge.y)/2;R.quadraticCurveTo(me.x,me.y,_e,he)}const te=D.points[D.points.length-1];R.lineTo(te.x,te.y)}else D.points.forEach((te,Z)=>{Z===0?R.moveTo(te.x,te.y):R.lineTo(te.x,te.y)});R.stroke()}R.restore()}}if(x.line&&x.line.isActive()){const D=x.line.getCurrentLine();D&&(R.save(),R.strokeStyle=D.color,R.lineWidth=D.lineWidth,R.lineCap="round",R.beginPath(),R.moveTo(D.start.x,D.start.y),R.lineTo(D.end.x,D.end.y),R.stroke(),R.restore())}},[e,i,r,x.pen,x.line,t,n,f]);const P=k.useCallback((T,R)=>{const $=h.current;if(!$)return null;for(const D of e)if(D.type==="text"){const Y=mi(D.position,$.width,$.height),te=D.width?D.width*$.width:200,Z=D.height?D.height*$.height:D.fontSize*1.2,me=4;if(T>=Y.x-me&&T<=Y.x+te+me&&R>=Y.y-me&&R<=Y.y+Z+me)return D}return null},[e,i,r]),N=k.useCallback(T=>{if(T.length<2)return 0;const R=T[0],$=T[1],D=R.clientX-$.clientX,Y=R.clientY-$.clientY;return Math.sqrt(D*D+Y*Y)},[]),I=k.useCallback(T=>{if(of(T))return console.log(" Pen input confirmed, completely skipping multi-finger check"),!1;if(rf())return console.log(" Global pen detection active, skipping multi-finger check"),!1;let R=0,$=null;if(T.touches&&T.touches.length>=2?(R=T.touches.length,$=T.touches,console.log(" React event: 2+ fingers detected:",R)):T.nativeEvent?T.nativeEvent.touches&&T.nativeEvent.touches.length>=2?(R=T.nativeEvent.touches.length,$=T.nativeEvent.touches,console.log(" Native event: 2+ fingers detected:",R)):T.nativeEvent.originalEvent&&T.nativeEvent.originalEvent.touches&&T.nativeEvent.originalEvent.touches.length>=2&&(R=T.nativeEvent.originalEvent.touches.length,$=T.nativeEvent.originalEvent.touches,console.log(" Original event: 2+ fingers detected:",R)):"targetTouches"in T&&T.targetTouches&&T.targetTouches.length>=2&&(R=T.targetTouches.length,$=T.targetTouches,console.log(" Target touches: 2+ fingers detected:",R)),E.current=Math.max(R,E.current),R>=2&&$){const D=N($);if(v.current===null)v.current=D,console.log(" Initial touch distance recorded:",D);else{const Y=Math.abs(D-v.current);Y>10&&console.log(" Pinch gesture detected! Distance change:",Y)}return!0}return T.nativeEvent&&"scale"in T.nativeEvent&&T.nativeEvent.scale!==1?(console.log(" Pinch gesture detected via scale:",T.nativeEvent.scale),!0):(R<2&&(v.current=null,E.current=0),!1)},[N]),L=k.useCallback(T=>{if(u||!x.pen||!x.eraser||!x.line||!x.text)return;const R=of(T.nativeEvent||T);if(R&&console.log(" CONFIRMED PEN INPUT in handlePointerDown - PROCEEDING WITH DRAWING"),R)console.log(" Pen input - bypassing ALL gesture checks");else if(I(T)){console.log(" Multi-finger gesture detected, preventing drawing"),d.current&&(d.current=!1,x.pen&&x.pen.isActive()&&x.pen.cancel(),x.eraser&&x.eraser.isActive()&&(x.eraser.cancel(),Ln("eraser",!1)));return}const $=h.current;if(!$)return;const D=$.getBoundingClientRect(),Y="touches"in T.nativeEvent?T.nativeEvent.touches[0].clientX-D.left:T.nativeEvent.clientX-D.left,te="touches"in T.nativeEvent?T.nativeEvent.touches[0].clientY-D.top:T.nativeEvent.clientY-D.top;if(t==="select"){const Z=P(Y,te);w(Z?Z.id:null);return}switch(t!=="line"&&(d.current=!0),t){case"pen":x.pen.startDrawing(T.nativeEvent);break;case"eraser":console.log(" AnnotationLayer.handlePointerDown - STARTING eraser tool"),Ln("eraser",!0),x.eraser.startErasing(T.nativeEvent);break;case"text":x.text.createTextInput(T.nativeEvent,n);break;case"line":x.line.isActive()?x.line.endLine(T.nativeEvent,n):x.line.startLine(T.nativeEvent);break}},[t,x,n,P,u,I]),U=k.useCallback(T=>{if(u)return;if(of(T.nativeEvent||T))console.log(" Pen input during move - bypassing ALL gesture checks");else if(I(T)){console.log(" Multi-finger gesture detected during move, canceling drawing"),d.current&&(d.current=!1,x.pen&&x.pen.isActive()&&x.pen.cancel(),x.eraser&&x.eraser.isActive()&&(x.eraser.cancel(),Ln("eraser",!1)),p(Z=>Z+1));return}const $=h.current;if(!$)return;const D=$.getBoundingClientRect(),Y="touches"in T.nativeEvent?T.nativeEvent.touches[0].clientX-D.left:T.nativeEvent.clientX-D.left,te="touches"in T.nativeEvent?T.nativeEvent.touches[0].clientY-D.top:T.nativeEvent.clientY-D.top;if(t==="line"&&x.line){x.line.isActive()&&(x.line.draw(T.nativeEvent),p(Z=>Z+1));return}if(!(!x.pen||!x.eraser||!x.line||!d.current))switch(t){case"pen":x.pen.draw(T.nativeEvent),p(Z=>Z+1);break;case"eraser":if(x.eraser.erase(T.nativeEvent),x.eraser.isActive()){const Z={x:Y,y:te};x.eraser.checkAnnotationsForErasure(Z,e).forEach(l)}break;case"line":x.line.draw(T.nativeEvent),p(Z=>Z+1);break}},[t,x,e,l,p,u,I]),W=k.useCallback(T=>{const R=of(T.nativeEvent||T);if(R&&console.log(" CONFIRMED PEN INPUT in handlePointerUp - COMPLETING DRAWING NORMALLY"),R)console.log(" Pen input - bypassing ALL gesture checks, proceeding to complete drawing");else if(I(T)){console.log(" Multi-finger gesture detected during up, canceling drawing"),d.current&&(d.current=!1,x.pen&&x.pen.isActive()&&x.pen.cancel(),x.eraser&&x.eraser.isActive()&&(x.eraser.cancel(),Ln("eraser",!1)),p(Y=>Y+1));return}if(!x.pen||!x.eraser||!x.line)return;d.current=!1;const D=(T.nativeEvent||T).pointerType||"unknown";switch(console.log(` AnnotationLayer.handlePointerUp - Current tool: ${t}, Event type: ${D}`),t){case"pen":console.log(` AnnotationLayer.handlePointerUp - CALLING tools.pen.stopDrawing for ${D} event`),x.pen.stopDrawing(n),console.log(` AnnotationLayer.handlePointerUp - tools.pen.stopDrawing completed for ${D} event`),p(Y=>Y+1);break;case"eraser":console.log(` AnnotationLayer.handlePointerUp - CALLING tools.eraser.stopErasing for ${D} event`),x.eraser.stopErasing(),console.log(" AnnotationLayer.handlePointerUp - STOPPING eraser tool"),Ln("eraser",!1);break;case"line":console.log(` AnnotationLayer.handlePointerUp - Skipping line tool for ${D} event`);break}},[t,x,n,p,I]),M=k.useCallback(T=>{if(u||t!=="select")return;const R=h.current;if(!R)return;const $=R.getBoundingClientRect(),D=T.clientX-$.left,Y=T.clientY-$.top,te=P(D,Y);te&&m(te.id)},[t,P,u]),K=k.useCallback(()=>{if(!(!x.pen||!x.eraser||!x.line)){if(rf()){console.log(" handlePointerLeave - PEN ACTIVE, NOT cancelling drawing");return}console.log(" handlePointerLeave - Cancelling non-pen operations"),d.current=!1,Ln("eraser",!1),Ln("line",!1),x.pen.cancel(),x.eraser.cancel(),x.line.cancel(),p(T=>T+1)}},[x,p]),ee=(()=>{switch(t){case"eraser":case"pen":case"line":return"crosshair";case"text":return"text";case"select":return"pointer";default:return"default"}})(),z=e.find(T=>T.id===_&&T.type==="text");return S.jsxs(S.Fragment,{children:[S.jsx("canvas",{ref:h,className:"annotation-canvas",style:{width:i,height:r,cursor:ee,pointerEvents:t==="select"?"none":"all",position:"absolute",top:0,left:0,zIndex:20,touchAction:"none"},onMouseDown:L,onMouseMove:U,onMouseUp:W,onMouseLeave:K,onPointerDown:L,onPointerMove:U,onPointerUp:W,onTouchStart:L,onTouchMove:U,onTouchEnd:W,onDoubleClick:M}),t==="select"&&e.filter(T=>T&&T.type==="text").map(T=>{const R=T;return!R.position||!R.content?null:S.jsx(dT,{annotation:R,canvasWidth:i,canvasHeight:r,isSelected:y===T.id,onUpdate:c,onSelect:()=>w(T.id),onEdit:()=>m(T.id)},T.id)}),t==="select"&&S.jsx("div",{style:{position:"absolute",top:0,left:0,width:i,height:r,pointerEvents:y?"none":"all",zIndex:19,cursor:"default"},onClick:T=>{const R=T.currentTarget.getBoundingClientRect(),$=T.clientX-R.left,D=T.clientY-R.top,Y=P($,D);w(Y?Y.id:null)},onDoubleClick:M}),z&&c&&S.jsx(hT,{annotation:z,canvasWidth:i,canvasHeight:r,onSave:T=>{c(_,T),m(null),w(null)},onCancel:()=>{m(null)}})]})},kn={name:"PDFMark",version:"1.0.3",buildNumber:Math.floor(Date.now()/1e3),buildDate:"2025-09-23",description:"Study PDF Viewer with Annotation Tools"},y1=k.memo(k.forwardRef(({file:n,currentPage:e,zoomLevel:t,annotations:s,currentTool:i,toolSettings:r,scrollPosition:o,onPageChange:l,onDocumentLoad:c,onAnnotationAdd:u,onAnnotationRemove:h,onAnnotationUpdate:d,onScrollChange:f,onZoomChange:p,onToolChange:y},w)=>{const _=k.useRef(null),m=k.useRef(null),[v,E]=k.useState(null),[x,C]=k.useState({width:0,height:0}),P=k.useRef(!1),N=k.useRef(null),I=k.useRef(null),[L,U]=k.useState(!1),[W,M]=k.useState(""),[K,q]=k.useState(!1),[ee,z]=k.useState({x:0,y:0}),[T,R]=k.useState(!1),[$,D]=k.useState(!1),[Y,te]=k.useState(0),[Z,me]=k.useState(1),[Ge,_e]=k.useState(null),[he,we]=k.useState(1),[rt,wn]=k.useState(null),[Vs,Gs]=k.useState(null),[bi,pr]=k.useState(null),[rn,Ja]=k.useState(!1),[ns,xi]=k.useState(!1),[Ws,H]=k.useState(null);k.useImperativeHandle(w,()=>({containerRef:_,totalPages:(v==null?void 0:v.numPages)||0}),[v]),k.useEffect(()=>{if(!n){E(null);return}let F=!1,ae;return(async()=>{try{if(await new Promise(ot=>{ae=setTimeout(ot,100)}),F)return;const de=await n.arrayBuffer();if(F)return;const kt=await Zk({data:de,...p1}).promise;F||(E(kt),c(kt))}catch(de){F||console.error("Error loading PDF:",de)}})(),()=>{F=!0,ae&&clearTimeout(ae)}},[n==null?void 0:n.name,n==null?void 0:n.size,n==null?void 0:n.lastModified,c]);const Q=k.useCallback(F=>{if(!_.current)return 1;const ae=_.current,ve=ae.clientWidth-48,de=ae.clientHeight-100;if(t==="fit-width")return ve/F.width;if(t==="fit-page"){const be=ve/F.width,kt=de/F.height;return Math.min(be,kt)}else return t},[t]),B=k.useCallback(async()=>{if(!(!v||!m.current)&&!P.current){if(P.current=!0,N.current&&N.current._internalRenderTask)try{N.current.cancel()}catch{}try{const F=await v.getPage(e),ae=F.getViewport({scale:1}),ve=Q({width:ae.width,height:ae.height}),de=F.getViewport({scale:ve}),be=m.current;if(!be)return;const kt=be.getContext("2d");if(!kt)return;(be.width!==de.width||be.height!==de.height)&&(be.width=de.width,be.height=de.height,be.style.width=`${de.width}px`,be.style.height=`${de.height}px`,C({width:de.width,height:de.height}));const ot={canvasContext:kt,viewport:de};N.current=F.render(ot),await N.current.promise}catch(F){F.name!=="RenderingCancelledException"&&console.error("Error rendering page:",F)}finally{P.current=!1}}},[v,e,Q]);k.useEffect(()=>{B()},[B]),k.useEffect(()=>{!_.current||!o||_.current.scrollTo(o.x,o.y)},[o]),k.useEffect(()=>{_.current&&_.current.scrollTo(0,0)},[e]);const j=k.useCallback(()=>{!_.current||!f||(I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{_.current&&f({x:_.current.scrollLeft,y:_.current.scrollTop})},100))},[f]),ne=k.useCallback(F=>{if(F.ctrlKey||F.metaKey){if(F.preventDefault(),F.stopPropagation(),!p)return;const ae=F.deltaY<0?1.1:.9;let ve;typeof t=="number"?ve=Math.max(.25,Math.min(8,t*ae)):ve=1,p(ve)}},[t,p]);k.useEffect(()=>{const F=_.current;if(F)return F.addEventListener("scroll",j),F.addEventListener("wheel",ne,{passive:!1}),()=>{F.removeEventListener("scroll",j),F.removeEventListener("wheel",ne),I.current&&clearTimeout(I.current)}},[j,ne]);const le=k.useCallback(F=>{if(!v)return;const ae=Math.max(1,Math.min(F,v.numPages));l(ae)},[v,l]),fe=k.useCallback(()=>{const F=parseInt(W,10);isNaN(F)||(le(F),U(!1),M(""))},[W,le]),ze=k.useCallback(F=>{if((F.ctrlKey||F.metaKey)&&F.button===0&&p){F.preventDefault(),D(!0),te(F.clientY),me(t);return}if(F.button===2&&_.current){F.preventDefault(),R(!0),z({x:F.clientX,y:F.clientY});return}i==="select"&&F.button===0&&_.current&&(q(!0),z({x:F.clientX,y:F.clientY}),F.preventDefault())},[i,t,p]),ge=k.useCallback(F=>{if($&&p){const ve=1+(Y-F.clientY)/200;let be=Math.max(.25,Math.min(8,(typeof Z=="number"?Z:1)*ve));p(be),F.preventDefault();return}if((K&&i==="select"||T)&&_.current){const ae=ee.x-F.clientX,ve=ee.y-F.clientY;_.current.scrollLeft+=ae,_.current.scrollTop+=ve,z({x:F.clientX,y:F.clientY}),F.preventDefault()}},[K,T,ee,i,$,Y,Z,p]),Pe=k.useCallback(()=>{q(!1),R(!1),D(!1)},[]),De=F=>{if(F.length<2)return null;let ae=0,ve=0;for(let de=0;de<F.length;de++)ae+=F[de].clientX,ve+=F[de].clientY;return{x:ae/F.length,y:ve/F.length}},ct=F=>{if(F.length<4)return null;const ae=De(F);if(!ae)return null;let ve=0;for(let de=0;de<F.length;de++){const be=F[de].clientX-ae.x,kt=F[de].clientY-ae.y;ve+=Math.sqrt(be*be+kt*kt)}return ve/F.length},Ct=k.useCallback(F=>{var be,kt;if(F.target.classList.contains("resize-handle")){Ja(!0);return}const ve=F.touches.length,de=Date.now();if(ve===3){const ot=(be=_.current)==null?void 0:be.getBoundingClientRect();if(ot){const Ai=(kt=De(F.touches))==null?void 0:kt.y;if(Ai&&Vs&&de-Vs.time<300){F.preventDefault();const Fd=Ai-ot.top<ot.height/2;Fd&&e>1?l(e-1):!Fd&&v&&e<v.numPages&&l(e+1),Gs(null)}else{Ai&&Gs({time:de,y:Ai});const Xc=De(F.touches);Xc&&(xi(!0),H(Xc))}}}else if(ve===4&&p){F.preventDefault();const ot=ct(F.touches),Ai=De(F.touches);_e(ot),we(t),wn(Ai)}else if(ve===5)bi&&de-bi.time<300?(F.preventDefault(),p("fit-width"),pr(null)):pr({time:de});else if(ve===1&&i==="select"&&_.current&&!rn){const ot=F.touches[0];q(!0),z({x:ot.clientX,y:ot.clientY})}},[t,p,i,e,v,l,Vs,bi,rn]),O=k.useCallback(F=>{if(rn){F.preventDefault(),F.stopPropagation();return}const ae=F.touches.length;if(ae===3&&ns&&Ws&&_.current){F.preventDefault();const ve=De(F.touches);if(ve){const de=ve.x-Ws.x,be=ve.y-Ws.y;_.current.scrollLeft-=de,_.current.scrollTop-=be,H(ve)}}else if(ae===1&&K&&_.current){const ve=F.touches[0],de=ve.clientX-ee.x,be=ve.clientY-ee.y;_.current.scrollLeft-=de,_.current.scrollTop-=be,z({x:ve.clientX,y:ve.clientY})}else if(ae===4&&Ge&&p&&rt&&_.current){F.preventDefault();const ve=ct(F.touches),de=De(F.touches);if(!ve||!de)return;const be=ve/Ge;let ot=Math.max(.25,Math.min(8,(typeof he=="number"?he:1)*be));if(typeof ot=="number"&&typeof he=="number"){const Ai=_.current.getBoundingClientRect(),Xc=_.current.scrollLeft,Fd=_.current.scrollTop,wy=rt.x-Ai.left,by=rt.y-Ai.top,b1=(Xc+wy)/he,x1=(Fd+by)/he;p(ot),requestAnimationFrame(()=>{_.current&&(_.current.scrollLeft=b1*ot-wy,_.current.scrollTop=x1*ot-by)})}else p(ot)}},[Ge,he,p,K,ee,rt,rn,ns,Ws]),X=k.useCallback(()=>{_e(null),q(!1),wn(null),Ja(!1),xi(!1),H(null)},[]);return n?S.jsxs("div",{className:"relative w-full h-full",children:[S.jsx("div",{ref:_,className:"w-full h-full overflow-auto bg-pdf-bg",style:{cursor:i==="select"&&!K||T?K||T?"grabbing":"grab":"default"},onContextMenu:F=>{F.preventDefault();const ae=m1();if(console.log(` SimplePDFViewer.onContextMenu - isAnyDrawingToolActive: ${ae}`),ae){console.log(" SimplePDFViewer.onContextMenu - Tool switching BLOCKED due to active drawing");return}y&&(console.log(` SimplePDFViewer.onContextMenu - Right-click tool switching from ${i}`),i==="pen"?y("eraser"):i==="eraser"&&y("pen"))},onMouseDown:ze,onMouseMove:ge,onMouseUp:Pe,onMouseLeave:Pe,onTouchStart:Ct,onTouchMove:O,onTouchEnd:X,children:S.jsx("div",{className:"flex min-h-full",style:{padding:typeof t=="number"&&t>2?"100px":"24px"},children:S.jsxs("div",{className:"relative inline-block",children:[S.jsx("canvas",{ref:m,className:"block bg-white shadow-2xl",style:{position:"relative",zIndex:1}}),x.width>0&&x.height>0&&S.jsx(fT,{pageNumber:e,annotations:s,currentTool:i,toolSettings:r,canvasWidth:x.width,canvasHeight:x.height,onAnnotationAdd:u,onAnnotationRemove:h,onAnnotationUpdate:d,isDisabled:T})]})})}),S.jsx("div",{className:"absolute bottom-4 right-4 left-4 flex justify-end gap-2 z-30 pointer-events-none",children:S.jsxs("div",{className:"flex gap-2 pointer-events-auto bg-white/90 backdrop-blur-sm rounded-lg p-2 shadow-lg",children:[S.jsx("button",{onClick:()=>le(e-1),disabled:e<=1,className:"button-secondary disabled:opacity-50 disabled:cursor-not-allowed min-w-[60px] text-sm md:text-base",children:"Prev"}),L?S.jsxs("div",{className:"flex items-center gap-1",children:[S.jsx("input",{type:"number",value:W,onChange:F=>M(F.target.value),onKeyDown:F=>{F.key==="Enter"&&fe(),F.key==="Escape"&&(U(!1),M(""))},onBlur:()=>{U(!1),M("")},className:"w-16 px-2 py-1 bg-gray-700 text-white rounded text-center",min:"1",max:(v==null?void 0:v.numPages)||1,autoFocus:!0}),S.jsxs("span",{className:"text-white",children:["/ ",(v==null?void 0:v.numPages)||0]})]}):S.jsxs("button",{onClick:()=>{U(!0),M(e.toString())},className:"bg-gray-800 text-white px-3 py-2 rounded hover:bg-gray-700 transition-colors text-sm md:text-base",children:[e," / ",(v==null?void 0:v.numPages)||0]}),S.jsx("button",{onClick:()=>le(e+1),disabled:!v||e>=v.numPages,className:"button-secondary disabled:opacity-50 disabled:cursor-not-allowed min-w-[60px] text-sm md:text-base",children:"Next"})]})})]}):S.jsx("div",{className:"flex items-center justify-center h-full bg-pdf-bg text-gray-400",children:S.jsxs("div",{className:"text-center max-w-md",children:[S.jsx("svg",{className:"w-24 h-24 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),S.jsx("h2",{className:"text-xl font-semibold mb-2",children:kn.name}),S.jsx("p",{className:"text-lg mb-2",children:"No PDF loaded in this tab"}),S.jsx("p",{className:"text-sm mb-6",children:"Drag and drop a PDF file or click to select"}),S.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 text-xs space-y-2",children:[S.jsx("div",{className:"border-b border-gray-600 pb-2 mb-2",children:S.jsx("h3",{className:"text-gray-300 font-medium mb-1",children:"Application Information"})}),S.jsxs("div",{className:"flex justify-between",children:[S.jsx("span",{className:"text-gray-400",children:"Tool Name:"}),S.jsx("span",{className:"text-white",children:kn.name})]}),S.jsxs("div",{className:"flex justify-between",children:[S.jsx("span",{className:"text-gray-400",children:"Version:"}),S.jsxs("span",{className:"text-white",children:["v",kn.version]})]}),S.jsxs("div",{className:"flex justify-between",children:[S.jsx("span",{className:"text-gray-400",children:"Build Date:"}),S.jsx("span",{className:"text-white",children:kn.buildDate})]}),S.jsx("div",{className:"text-center pt-2 border-t border-gray-600",children:S.jsx("span",{className:"text-gray-400 text-xs",children:kn.description})})]})]})})}));y1.displayName="SimplePDFViewer";const pT=({activeTab:n,totalPages:e=0,loadedFiles:t=[],onPageChange:s,onZoomChange:i,onFileUpload:r,onFileOpenInNewTab:o,onSaveAnnotations:l,onLoadAnnotations:c,pageInputRef:u,paneId:h})=>{const[d,f]=k.useState(!1),[p,y]=k.useState(""),[w,_]=k.useState(!1),[m,v]=k.useState(!1),E=k.useRef(null),x=k.useRef(null),[C,P]=k.useState({top:0,left:0}),N=k.useCallback(()=>{const M=parseInt(p);M>=1&&M<=e&&(s(M),f(!1),y(""))},[p,e,s]),I=k.useCallback(()=>{n.currentPage>1&&s(n.currentPage-1)},[n.currentPage,s]),L=k.useCallback(()=>{n.currentPage<e&&s(n.currentPage+1)},[n.currentPage,e,s]),U=k.useCallback(M=>{var q;const K=(q=M.target.files)==null?void 0:q[0];K&&kp(K)&&r?r(K):K&&!kp(K)&&alert("Please select a valid PDF file"),E.current&&(E.current.value="")},[r]),W=k.useCallback(()=>{c&&c()},[c]);return S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"bg-gray-800 text-white text-xs border-b border-gray-600 overflow-x-auto relative",children:S.jsxs("div",{className:"flex items-center justify-between px-2 py-1 min-w-fit",children:[S.jsx("input",{ref:E,type:"file",accept:".pdf",onChange:U,className:"hidden"}),S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsx("span",{className:"font-medium text-blue-400",children:n.name}),r&&S.jsxs(S.Fragment,{children:[S.jsx("button",{onClick:()=>{var M;return(M=E.current)==null?void 0:M.click()},className:"px-1 py-0.5 hover:bg-gray-700 rounded text-xs",title:"Open new PDF file",children:""}),t.length>0&&S.jsxs("div",{className:"relative",children:[S.jsx("button",{type:"button",onClick:M=>{M.preventDefault(),M.stopPropagation(),v(K=>!K)},className:"px-1 py-0.5 hover:bg-gray-700 rounded text-xs",title:"Select from loaded files",children:""}),m&&S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>v(!1)}),S.jsxs("div",{className:"absolute left-0 top-full mt-1 bg-gray-700 border border-gray-600 rounded shadow-lg z-50 min-w-48 max-h-48 overflow-y-auto",children:[S.jsx("div",{className:"text-gray-400 text-xs px-2 py-1 border-b border-gray-600",children:" Open PDFs"}),t.map((M,K)=>{const q=M.name===n.fileName;return S.jsxs("button",{type:"button",onClick:ee=>{if(ee.preventDefault(),ee.stopPropagation(),q){v(!1);return}o?o(M):r&&r(M),v(!1)},className:`block w-full px-2 py-1 text-left text-xs flex items-center gap-1 ${q?"bg-blue-600 text-white":"hover:bg-gray-600"}`,style:{cursor:q?"default":"pointer"},title:M.name,children:[q&&S.jsx("span",{className:"text-yellow-300",children:""}),S.jsx("span",{className:"truncate",children:M.name}),q&&S.jsx("span",{className:"text-xs text-blue-200 ml-auto",children:"(current)"})]},K)})]})]})]})]}),l&&S.jsx("button",{onClick:l,className:"px-1 py-0.5 hover:bg-gray-700 rounded text-xs",title:"Save annotations to JSON",children:""}),c&&S.jsx("button",{onClick:W,className:"px-1 py-0.5 hover:bg-gray-700 rounded text-xs",title:"Load annotations from JSON",children:""}),n.fileName&&S.jsxs(S.Fragment,{children:[S.jsx("span",{className:"text-gray-400",children:""}),S.jsx("span",{className:"text-gray-300 truncate max-w-32",title:n.fileName,children:n.fileName})]})]}),S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsxs("div",{className:"flex items-center gap-1",children:[S.jsx("button",{onClick:I,disabled:n.currentPage<=1,className:"px-1 py-0.5 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed rounded text-xs",title:"Previous Page",children:""}),S.jsx("div",{className:"relative",children:d?S.jsxs("div",{className:"flex items-center gap-1",children:[S.jsx("input",{ref:u,type:"number",value:p,onChange:M=>y(M.target.value),onKeyDown:M=>{M.key==="Enter"&&N(),M.key==="Escape"&&(f(!1),y(""))},onBlur:()=>{setTimeout(()=>{f(!1),y("")},200)},className:"w-12 px-1 py-0.5 bg-gray-700 border border-gray-500 rounded text-center text-xs",placeholder:n.currentPage.toString(),min:"1",max:e,autoFocus:!0}),S.jsx("button",{onClick:N,className:"px-1 py-0.5 bg-blue-600 hover:bg-blue-700 rounded text-xs",children:"Go"})]}):S.jsx("button",{onClick:()=>f(!0),className:`px-1 py-0.5 hover:bg-gray-700 rounded text-xs min-w-12 ${h?`page-jump-button-${h}`:""}`,title:"Click to jump to page",children:n.currentPage})}),S.jsx("span",{className:"text-gray-400",children:"/"}),S.jsx("span",{className:"text-gray-300",children:e}),S.jsx("button",{onClick:L,disabled:n.currentPage>=e,className:"px-1 py-0.5 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed rounded text-xs",title:"Next Page",children:""})]}),S.jsx("div",{className:"relative",children:S.jsxs("button",{ref:x,onClick:M=>{if(M.stopPropagation(),x.current){const K=x.current.getBoundingClientRect();P({top:K.bottom+5,left:K.left})}_(!w)},className:"px-2 py-0.5 hover:bg-gray-700 rounded text-xs min-w-16",title:"Zoom Level",children:[typeof n.zoomLevel=="number"?`${Math.round(n.zoomLevel*100)}%`:n.zoomLevel==="fit-width"?"Fit W":"Fit P",""]})})]})]})}),w&&S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>_(!1)}),S.jsx("div",{className:"fixed bg-gray-700 border border-gray-600 rounded shadow-lg z-50 min-w-24",style:{top:`${C.top}px`,left:`${C.left}px`},children:cT.map(M=>S.jsx("button",{onClick:()=>{i(M.value),_(!1)},className:"block w-full px-2 py-1 text-left hover:bg-gray-600 text-xs text-white first:rounded-t last:rounded-b",children:M.label},M.label))})]})]})},gT=({isOpen:n,title:e,message:t,onConfirm:s,onCancel:i,onDiscard:r,confirmText:o="Save",cancelText:l="Cancel",discardText:c="Discard",showDiscard:u=!1})=>n?S.jsx(S.Fragment,{children:S.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",onClick:i,children:S.jsxs("div",{className:"bg-gray-800 text-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4",onClick:h=>h.stopPropagation(),children:[S.jsx("h2",{className:"text-xl font-bold mb-4",children:e}),S.jsx("p",{className:"text-gray-300 mb-6",children:t}),S.jsxs("div",{className:"flex justify-end gap-3",children:[u&&r&&S.jsx("button",{onClick:r,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors",children:c}),S.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors",children:l}),S.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:o})]})]})})}):null,w1=k.forwardRef(({layout:n,pdfFile:e,pdfDoc:t,fileAnnotations:s,toolSettings:i,onLayoutChange:r,onAnnotationAdd:o,onAnnotationRemove:l,onAnnotationUpdate:c,onDocumentLoad:u,onFileUpload:h,onSaveAnnotations:d,onLoadAnnotations:f,hasUnsavedChanges:p,markAsSaved:y,onToolChange:w},_)=>{var ns,xi,Ws;const[m,v]=k.useState([{id:"pane_1",tabs:[{id:"tab_1",name:e?e.name.replace(".pdf","").slice(0,20):"Main",file:e??void 0,fileName:e==null?void 0:e.name,currentPage:1,zoomLevel:"fit-width",lastUpdated:Date.now()}],activeTabId:"tab_1"}]);vr.useEffect(()=>{var Q,B,j;const H=(j=(B=(Q=m[0])==null?void 0:Q.tabs[0])==null?void 0:B.file)==null?void 0:j.name;(e!=null&&e.name||H)&&console.log(` WINDOWMANAGER: pdfFile=${(e==null?void 0:e.name)||"null"}, tabFile=${H||"null"}`)},[e==null?void 0:e.name,(Ws=(xi=(ns=m[0])==null?void 0:ns.tabs[0])==null?void 0:xi.file)==null?void 0:Ws.name]),vr.useEffect(()=>{e&&m.length>0&&m[0].tabs.length>0&&m[0].tabs[0].file!==e&&v(H=>H.map((Q,B)=>B===0?{...Q,tabs:Q.tabs.map((j,ne)=>ne===0?{...j,file:e,fileName:e.name}:j)}:Q))},[e]);const[E,x]=k.useState("pane_1"),[C,P]=k.useState(.5),[N,I]=k.useState(.5),[L,U]=k.useState(!1),[W,M]=k.useState(!1),[K,q]=k.useState({isOpen:!1,paneId:"",tabId:"",fileName:""}),ee=k.useRef(new Map),z=k.useRef(new Map),T=k.useCallback((H,Q,B)=>{v(j=>j.map(ne=>ne.id===H?{...ne,tabs:ne.tabs.map(le=>le.id===Q?{...le,currentPage:B}:le)}:ne))},[]);k.useImperativeHandle(_,()=>({scrollActivePane:(H,Q)=>{var le;const B=m.find(fe=>fe.id===E);if(!B)return;const j=`${B.id}_${B.activeTabId}`,ne=ee.current.get(j);(le=ne==null?void 0:ne.containerRef)!=null&&le.current&&ne.containerRef.current.scrollBy(H,Q)},focusPageInput:()=>{const H=m.find(j=>j.id===E);if(!H)return;const Q="page-jump-button-"+H.id,B=document.querySelector("."+Q);B&&(B.click(),setTimeout(()=>{const j=z.current.get(H.id);j&&(j.focus(),j.select())},50))},navigateNextPage:()=>{const H=n==="single"?"pane_1":E,Q=m.find(fe=>fe.id===H)||m[0];if(!Q)return;const B=Q.tabs.find(fe=>fe.id===Q.activeTabId)||Q.tabs[0];if(!B)return;let j=0;const ne=`${Q.id}_${B.id}`,le=ee.current.get(ne);if(le!=null&&le.totalPages&&(j=le.totalPages),!j&&ee.current.size>0){const fe=Array.from(ee.current.values())[0];fe!=null&&fe.totalPages&&(j=fe.totalPages)}!j&&(t!=null&&t.numPages)&&(j=t.numPages),j>0&&B.currentPage<j&&T(Q.id,B.id,B.currentPage+1)},navigatePrevPage:()=>{const H=n==="single"?"pane_1":E,Q=m.find(j=>j.id===H)||m[0];if(!Q)return;const B=Q.tabs.find(j=>j.id===Q.activeTabId)||Q.tabs[0];B&&B.currentPage>1&&T(Q.id,B.id,B.currentPage-1)}}),[m,E,T,t,n]);const R=vr.useMemo(()=>{const H=new Map;return m.forEach(Q=>{Q.tabs.forEach(B=>{B.file&&H.set(B.fileName||B.file.name,B.file)})}),e&&H.set(e.name,e),Array.from(H.values())},[m,e]),$=k.useCallback(H=>{v(Q=>{const B=Q.find(fe=>fe.id===H);if(!B)return Q;const j=B.tabs.find(fe=>fe.id===B.activeTabId)||B.tabs[0],ne=Date.now(),le={name:`Tab ${B.tabs.length+1}`,file:j.file,fileName:j.fileName,currentPage:j.currentPage,zoomLevel:j.zoomLevel,scrollPosition:j.scrollPosition||{x:0,y:0},lastUpdated:ne};return Q.map(fe=>{if(fe.tabs.length>=10)return fe.id===H&&alert("Maximum 10 tabs per window reached"),fe;const ze={...le,id:`${za()}_${fe.id}`};return{...fe,tabs:[...fe.tabs,ze],activeTabId:fe.id===H?ze.id:fe.activeTabId}})})},[]),D=k.useCallback((H,Q)=>{const B=m.find(ne=>ne.id===H),j=B==null?void 0:B.tabs.find(ne=>ne.id===Q);j!=null&&j.fileName&&p&&p(j.fileName)?q({isOpen:!0,paneId:H,tabId:Q,fileName:j.fileName}):v(ne=>ne.map(le=>{if(le.id===H&&le.tabs.length>1){const fe=le.tabs.filter(ge=>ge.id!==Q),ze=le.activeTabId===Q?fe[0].id:le.activeTabId;return{...le,tabs:fe,activeTabId:ze}}return le}))},[m,p]),Y=k.useCallback((H,Q)=>{v(B=>B.map(j=>j.id===H?{...j,activeTabId:Q}:j))},[]),te=k.useCallback((H,Q,B)=>{v(j=>j.map(ne=>ne.id===H?{...ne,tabs:ne.tabs.map(le=>le.id===Q?{...le,name:B}:le)}:ne))},[]),Z=k.useCallback((H,Q,B)=>{v(j=>j.map(ne=>ne.id===H?{...ne,tabs:ne.tabs.map(le=>le.id===Q?{...le,zoomLevel:B}:le)}:ne))},[]);vr.useEffect(()=>{ee.current.clear(),v(H=>{var ne;let Q=[...H];const B=new Map;H.forEach(le=>{le.tabs.forEach(fe=>{if(fe.fileName){const ze=B.get(fe.fileName);(!ze||fe.lastUpdated>(ze.lastUpdated||0))&&B.set(fe.fileName,fe)}})});const j=Array.from(B.values());switch(n){case"single":const le=j.length>0?j.map((ge,Pe)=>({...ge,id:`tab_single_${Pe}`})):H[0].tabs;Q=[{...H[0],id:"pane_1",tabs:le,activeTabId:le.length>0?le[0].id:"tab_single_0"}];break;case"vertical":case"horizontal":if(H.length<2){const ge=Date.now(),Pe=j.length>0?j:H[0].tabs;Q=[{...H[0],tabs:Pe.map((De,ct)=>({...De,id:`tab_p1_${ct}`,lastUpdated:ge}))},{id:"pane_2",tabs:Pe.map((De,ct)=>({...De,id:`tab_p2_${ct}`,lastUpdated:ge})),activeTabId:"tab_p2_0"}]}else Q=H.slice(0,2).map((ge,Pe)=>({...ge,tabs:j.length>0?j.map((De,ct)=>({...De,id:`tab_p${Pe+1}_${ct}`})):ge.tabs}));break;case"tile":const fe=Date.now(),ze=j.length>0?j:H[0].tabs;Q=[];for(let ge=0;ge<4;ge++){const Pe=`pane_${ge+1}`,De=H[ge]||{id:Pe,activeTabId:""},ct=ze.map((Ct,O)=>({...Ct,id:`tab_p${ge+1}_${O}`,lastUpdated:fe}));Q.push({...De,id:Pe,tabs:ct,activeTabId:((ne=ct[0])==null?void 0:ne.id)||De.activeTabId})}break}return Q}),n==="single"&&x("pane_1")},[n]),k.useCallback((H,Q,B)=>{(H.ctrlKey||H.metaKey)&&(H.preventDefault(),H.stopPropagation(),v(j=>{const ne=j.find(ge=>ge.id===Q),le=ne==null?void 0:ne.tabs.find(ge=>ge.id===B);if(!le)return j;const fe=H.deltaY<0?.1:-.1;let ze;return typeof le.zoomLevel=="number"?ze=Math.max(.25,Math.min(3,le.zoomLevel+fe)):ze=1+fe,j.map(ge=>ge.id===Q?{...ge,tabs:ge.tabs.map(Pe=>Pe.id===B?{...Pe,zoomLevel:ze}:Pe)}:ge)}))},[]),vr.useEffect(()=>{const H=B=>{if(B.ctrlKey||B.metaKey)return B.target.closest(".pdf-viewer"),B.preventDefault(),B.stopPropagation(),!1},Q=B=>{if((B.ctrlKey||B.metaKey)&&(B.key==="+"||B.key==="-"||B.key==="="||B.key==="0"))return B.preventDefault(),B.stopPropagation(),!1};return document.addEventListener("wheel",H,{passive:!1,capture:!0}),document.addEventListener("keydown",Q,{passive:!1,capture:!0}),()=>{document.removeEventListener("wheel",H,!0),document.removeEventListener("keydown",Q,!0)}},[]);const me=(H,Q)=>{const B=H.tabs.find(j=>j.id===H.activeTabId)||H.tabs[0];return S.jsxs("div",{className:`flex flex-col h-full ${Q?"ring-2 ring-blue-500":""}`,onClick:()=>x(H.id),children:[S.jsx(Q_,{tabs:H.tabs,activeTabId:H.activeTabId,onTabChange:j=>Y(H.id,j),onTabAdd:()=>$(H.id),onTabRemove:j=>D(H.id,j),onTabRename:(j,ne)=>te(H.id,j,ne)}),S.jsx(pT,{activeTab:B,totalPages:t==null?void 0:t.numPages,loadedFiles:R,onPageChange:j=>T(H.id,B.id,j),onZoomChange:j=>Z(H.id,B.id,j),onSaveAnnotations:d,onLoadAnnotations:f,pageInputRef:j=>z.current.set(H.id,j),paneId:H.id,onFileOpenInNewTab:j=>{const ne=Date.now();v(le=>{const fe={name:j.name.replace(".pdf","").slice(0,20),file:j,fileName:j.name,currentPage:1,zoomLevel:"fit-width",scrollPosition:{x:0,y:0},lastUpdated:ne};return le.map(ze=>{if(ze.id!==H.id)return ze;if(ze.tabs.length>=10)return alert("Maximum 10 tabs per window reached"),ze;const ge={...fe,id:`${za()}_${ze.id}`};return{...ze,tabs:[...ze.tabs,ge],activeTabId:ge.id}})})},onFileUpload:j=>{console.log(` WindowManager: File uploaded: ${j.name}`),h&&(console.log(` WindowManager: Notifying parent App.tsx about file: ${j.name}`),h(j));const ne=Date.now();v(le=>{const fe={name:j.name.replace(".pdf","").slice(0,20),file:j,fileName:j.name,currentPage:1,zoomLevel:"fit-width",scrollPosition:{x:0,y:0},lastUpdated:ne};return le.map(ge=>{const Pe=ge.tabs.find(Ct=>Ct.id===ge.activeTabId);if(ge.id===H.id&&Pe&&!Pe.file)return{...ge,tabs:ge.tabs.map(Ct=>Ct.id===ge.activeTabId?{...Ct,...fe,id:Ct.id}:Ct)};const De=ge.tabs.find(Ct=>Ct.fileName===j.name);if(De)return{...ge,activeTabId:De.id};if(ge.tabs.length>=10)return ge.id===H.id&&alert("Maximum 10 tabs per window reached"),ge;const ct={...fe,id:`${za()}_${ge.id}`};return{...ge,tabs:[...ge.tabs,ct],activeTabId:ge.id===H.id?ct.id:ge.activeTabId}})})}}),S.jsx("div",{className:"flex-1 overflow-hidden pdf-viewer",children:B&&(()=>{const j=`${H.id}-${B.id}-${B.lastUpdated||Date.now()}`,ne=B.file||e;if(!ne)return S.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:S.jsxs("div",{className:"text-center",children:[S.jsx("p",{children:"No PDF loaded in this tab"}),S.jsx("p",{className:"text-sm mt-2",children:"Use the  button to open a file"})]})});const le=B.fileName||ne.name,fe=s[le]||{},ze=`page_${B.currentPage}`,ge=fe[ze]||[];return S.jsx(y1,{ref:Pe=>{const De=`${H.id}_${B.id}`;Pe?ee.current.set(De,Pe):ee.current.delete(De)},file:ne,currentPage:B.currentPage,zoomLevel:B.zoomLevel,scrollPosition:B.scrollPosition,annotations:ge,currentTool:i.currentTool,toolSettings:i,onPageChange:Pe=>T(H.id,B.id,Pe),onZoomChange:Pe=>Z(H.id,B.id,Pe),onScrollChange:Pe=>{v(De=>De.map(ct=>ct.id===H.id?{...ct,tabs:ct.tabs.map(Ct=>Ct.id===B.id?{...Ct,scrollPosition:Pe}:Ct)}:ct))},onDocumentLoad:u,onAnnotationAdd:Pe=>{o(le,Pe)},onAnnotationRemove:Pe=>{const De=B.currentPage;l(le,Pe,De)},onAnnotationUpdate:(Pe,De)=>{c(le,Pe,De)},onToolChange:w},j)})()})]},H.id)},Ge=k.useCallback(()=>{d&&d();const{paneId:H,tabId:Q}=K;v(B=>B.map(j=>{if(j.id===H&&j.tabs.length>1){const ne=j.tabs.filter(fe=>fe.id!==Q),le=j.activeTabId===Q?ne[0].id:j.activeTabId;return{...j,tabs:ne,activeTabId:le}}return j})),q({isOpen:!1,paneId:"",tabId:"",fileName:""})},[K,d]),_e=k.useCallback(()=>{const{paneId:H,tabId:Q}=K;v(B=>B.map(j=>{if(j.id===H&&j.tabs.length>1){const ne=j.tabs.filter(fe=>fe.id!==Q),le=j.activeTabId===Q?ne[0].id:j.activeTabId;return{...j,tabs:ne,activeTabId:le}}return j})),q({isOpen:!1,paneId:"",tabId:"",fileName:""})},[K]),he=k.useCallback(()=>{q({isOpen:!1,paneId:"",tabId:"",fileName:""})},[]),we=k.useCallback(H=>{H.preventDefault(),U(!0)},[]),rt=k.useCallback(H=>{H.preventDefault(),M(!0)},[]),wn=k.useCallback(H=>{H.preventDefault(),U(!0)},[]),Vs=k.useCallback(H=>{H.preventDefault(),M(!0)},[]),Gs=k.useCallback(H=>{if(!L&&!W)return;const Q=document.querySelector(".window-manager-container");if(!Q)return;const B=Q.getBoundingClientRect();let j;L&&(n==="vertical"||n==="tile"?(j=(H.clientX-B.left)/B.width,P(Math.max(.1,Math.min(.9,j)))):n==="horizontal"&&(j=(H.clientY-B.top)/B.height,P(Math.max(.1,Math.min(.9,j))))),W&&n==="tile"&&(j=(H.clientY-B.top)/B.height,I(Math.max(.1,Math.min(.9,j))))},[L,W,n]),bi=k.useCallback(()=>{U(!1),M(!1)},[]),pr=k.useCallback(H=>{if(!L&&!W||H.touches.length!==1)return;const Q=H.touches[0],B=document.querySelector(".window-manager-container");if(!B)return;const j=B.getBoundingClientRect();let ne;L&&(n==="vertical"||n==="tile"?(ne=(Q.clientX-j.left)/j.width,P(Math.max(.1,Math.min(.9,ne)))):n==="horizontal"&&(ne=(Q.clientY-j.top)/j.height,P(Math.max(.1,Math.min(.9,ne))))),W&&n==="tile"&&(ne=(Q.clientY-j.top)/j.height,I(Math.max(.1,Math.min(.9,ne))))},[L,W,n]),rn=k.useCallback(()=>{U(!1),M(!1)},[]);vr.useEffect(()=>{if(L||W)return document.addEventListener("mousemove",Gs),document.addEventListener("mouseup",bi),document.addEventListener("touchmove",pr,{passive:!1}),document.addEventListener("touchend",rn),document.addEventListener("touchcancel",rn),L?document.body.style.cursor=n==="vertical"||n==="tile"?"col-resize":"row-resize":W&&(document.body.style.cursor="row-resize"),document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",Gs),document.removeEventListener("mouseup",bi),document.removeEventListener("touchmove",pr),document.removeEventListener("touchend",rn),document.removeEventListener("touchcancel",rn),document.body.style.cursor="default",document.body.style.userSelect="auto"}},[L,W,Gs,bi,pr,rn,n]);const Ja=()=>{var H,Q,B,j,ne;switch(n){case"single":return S.jsx("div",{className:"h-full",children:me(m[0],E===m[0].id)});case"vertical":return S.jsxs("div",{className:"h-full flex relative",children:[S.jsx("div",{className:"border-r border-gray-700",style:{width:`${C*100}%`},children:me(m[0],E===m[0].id)}),S.jsx("div",{className:"absolute top-0 bottom-0 w-2 hover:w-3 bg-gray-600 hover:bg-blue-500 cursor-col-resize z-20 transition-all touch-none",style:{left:`calc(${C*100}% - 4px)`,transition:L?"none":"all 0.2s"},onMouseDown:we,onTouchStart:wn,title:"Drag to resize panes",children:S.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:S.jsxs("div",{className:"flex gap-0.5",children:[S.jsx("div",{className:"w-0.5 h-6 bg-gray-400"}),S.jsx("div",{className:"w-0.5 h-6 bg-gray-400"})]})})}),S.jsx("div",{style:{width:`${(1-C)*100}%`},children:m[1]&&me(m[1],E===((H=m[1])==null?void 0:H.id))})]});case"horizontal":return S.jsxs("div",{className:"h-full flex flex-col relative",children:[S.jsx("div",{className:"border-b border-gray-700",style:{height:`${C*100}%`},children:me(m[0],E===m[0].id)}),S.jsx("div",{className:"absolute left-0 right-0 h-2 hover:h-3 bg-gray-600 hover:bg-blue-500 cursor-row-resize z-20 transition-all",style:{top:`calc(${C*100}% - 4px)`,transition:L?"none":"all 0.2s"},onMouseDown:we,onTouchStart:wn,title:"Drag to resize panes",children:S.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:S.jsxs("div",{className:"flex flex-col gap-0.5",children:[S.jsx("div",{className:"h-0.5 w-6 bg-gray-400"}),S.jsx("div",{className:"h-0.5 w-6 bg-gray-400"})]})})}),S.jsx("div",{style:{height:`${(1-C)*100}%`},children:m[1]&&me(m[1],E===((Q=m[1])==null?void 0:Q.id))})]});case"tile":return S.jsxs("div",{className:"h-full flex flex-col relative",children:[S.jsxs("div",{className:"flex",style:{height:`${N*100}%`},children:[S.jsx("div",{className:"border-r border-b border-gray-700",style:{width:`${C*100}%`},children:me(m[0],E===m[0].id)}),S.jsx("div",{className:"border-b border-gray-700",style:{width:`${(1-C)*100}%`},children:m[1]&&me(m[1],E===((B=m[1])==null?void 0:B.id))})]}),S.jsx("div",{className:"absolute left-0 right-0 h-2 hover:h-3 bg-gray-600 hover:bg-blue-500 cursor-row-resize z-20 transition-all",style:{top:`calc(${N*100}% - 4px)`,transition:W?"none":"all 0.2s"},onMouseDown:rt,onTouchStart:Vs,title:"Drag to resize panes",children:S.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:S.jsxs("div",{className:"flex flex-col gap-0.5",children:[S.jsx("div",{className:"h-0.5 w-6 bg-gray-400"}),S.jsx("div",{className:"h-0.5 w-6 bg-gray-400"})]})})}),S.jsx("div",{className:"absolute top-0 bottom-0 w-2 hover:w-3 bg-gray-600 hover:bg-blue-500 cursor-col-resize z-20 transition-all",style:{left:`calc(${C*100}% - 4px)`,transition:L?"none":"all 0.2s"},onMouseDown:we,onTouchStart:wn,title:"Drag to resize panes",children:S.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:S.jsxs("div",{className:"flex gap-0.5",children:[S.jsx("div",{className:"w-0.5 h-6 bg-gray-400"}),S.jsx("div",{className:"w-0.5 h-6 bg-gray-400"})]})})}),S.jsxs("div",{className:"flex",style:{height:`${(1-N)*100}%`},children:[S.jsx("div",{className:"border-r border-gray-700",style:{width:`${C*100}%`},children:m[2]&&me(m[2],E===((j=m[2])==null?void 0:j.id))}),S.jsx("div",{style:{width:`${(1-C)*100}%`},children:m[3]&&me(m[3],E===((ne=m[3])==null?void 0:ne.id))})]})]});default:return null}};return S.jsxs("div",{className:"h-full bg-gray-900 window-manager-container",children:[Ja(),S.jsx(gT,{isOpen:K.isOpen,title:"Unsaved Changes",message:`You have unsaved changes in "${K.fileName}". Do you want to save before closing?`,confirmText:"Save",cancelText:"Cancel",discardText:"Discard",showDiscard:!0,onConfirm:Ge,onCancel:he,onDiscard:_e})]})});w1.displayName="WindowManager";const Qw=({isOpen:n,onClose:e})=>{if(!n)return null;const t=[{category:"Tools",items:[{key:"1",description:"Pen Tool"},{key:"2",description:"Eraser Tool"},{key:"3",description:"Text Tool"},{key:"4",description:"Line Tool"},{key:"5",description:"Select Tool"},{key:"Right Click",description:"Toggle Pen  Eraser"}]},{category:"Navigation",items:[{key:"PageUp / ",description:"Previous Page"},{key:"PageDown / ",description:"Next Page"},{key:"Home",description:"First Page"},{key:"End",description:"Last Page"},{key:"3-finger Double Tap",description:"Page Navigation (Top=Prev, Bottom=Next)"}]},{category:"Zoom",items:[{key:"Ctrl + +",description:"Zoom In"},{key:"Ctrl + -",description:"Zoom Out"},{key:"Ctrl + 0",description:"Reset Zoom"},{key:"4-finger Pinch",description:"Zoom In/Out (Center-based)"},{key:"5-finger Double Tap",description:"Fit to Width"}]},{category:"PDF Movement",items:[{key:"",description:"Scroll"},{key:"Select Tool + Drag",description:"Move PDF"},{key:"3-finger Swipe",description:"Move PDF (Any Mode)"}]},{category:"Edit",items:[{key:"Ctrl + Z",description:"Undo"},{key:"Ctrl + Y",description:"Redo"},{key:"Ctrl + S",description:"Save"},{key:"Ctrl + O",description:"Load"},{key:"Delete",description:"Delete Selected Annotation"}]},{category:"Display",items:[{key:"F11 /  Button",description:"Fullscreen Mode"},{key:"Tab",description:"Focus Page Number Input"}]}];return S.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:S.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl max-h-[80vh] overflow-auto m-4",children:[S.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[S.jsxs("div",{children:[S.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:[kn.name," Help - Keyboard Shortcuts"]}),S.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Version ",kn.version,".",kn.buildNumber,"  Build ",kn.buildDate]})]}),S.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close",children:S.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),S.jsxs("div",{className:"p-6",children:[S.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:t.map(s=>S.jsxs("div",{className:"space-y-3",children:[S.jsx("h3",{className:"text-lg font-medium text-blue-800 border-b border-blue-200 pb-1",children:s.category}),S.jsx("div",{className:"space-y-2",children:s.items.map((i,r)=>S.jsxs("div",{className:"flex items-center justify-between py-1",children:[S.jsx("span",{className:"text-sm text-gray-600 flex-1",children:i.description}),S.jsx("kbd",{className:"ml-4 px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-mono text-gray-800 whitespace-nowrap",children:i.key})]},r))})]},s.category))}),S.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 space-y-4",children:[S.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[S.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:" Stylus Pen Usage Tips"}),S.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[S.jsx("li",{children:" To prevent accidental operations while drawing with a stylus pen, navigation and zoom gestures require 3+ fingers"}),S.jsx("li",{children:" 2-finger pinch is disabled, use 4-finger pinch for zooming instead"}),S.jsx("li",{children:" Right-click to quickly switch between pen and eraser tools"})]})]}),S.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[S.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:" Application Information"}),S.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[S.jsxs("div",{className:"flex justify-between",children:[S.jsx("span",{children:"Tool Name:"}),S.jsx("span",{className:"font-mono",children:kn.name})]}),S.jsxs("div",{className:"flex justify-between",children:[S.jsx("span",{children:"Version:"}),S.jsxs("span",{className:"font-mono",children:["v",kn.version,".",kn.buildNumber]})]}),S.jsxs("div",{className:"flex justify-between",children:[S.jsx("span",{children:"Build Date:"}),S.jsx("span",{className:"font-mono",children:kn.buildDate})]}),S.jsx("div",{className:"pt-2 border-t border-gray-300 text-center",children:S.jsx("span",{className:"text-xs text-gray-500",children:kn.description})})]})]})]})]})]})})},mT=({currentTool:n,color:e,lineWidth:t,fontSize:s,eraserSize:i,windowLayout:r="single",canUndo:o,canRedo:l,isFullscreen:c=!1,onToolChange:u,onColorChange:h,onLineWidthChange:d,onFontSizeChange:f,onEraserSizeChange:p,onWindowLayoutChange:y,onUndo:w,onRedo:_,onSave:m,onLoad:v,onClearAll:E,onToggleFullscreen:x})=>{const[C,P]=k.useState(!1),[N,I]=k.useState(!1),[L,U]=k.useState(!1);k.useEffect(()=>{const M=()=>{U(window.innerWidth<768)};return M(),window.addEventListener("resize",M),()=>window.removeEventListener("resize",M)},[]);const W=[{id:"pen",icon:"",label:"Pen Tool (1)"},{id:"eraser",icon:"",label:"Eraser Tool (2)"},{id:"text",icon:"",label:"Text Tool (3)"},{id:"line",icon:"",label:"Line Tool (4)"},{id:"select",icon:"",label:"Select Tool (5)"}];return c?S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-black/80 backdrop-blur-sm p-2",children:S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsx("div",{className:"flex items-center gap-1",children:W.map(M=>S.jsx("button",{onClick:()=>u(M.id),className:wt("p-1.5 rounded text-xs",{"bg-blue-600 text-white":n===M.id,"text-gray-300 hover:bg-gray-700":n!==M.id}),title:M.label,children:M.icon},M.id))}),S.jsxs("div",{className:"flex items-center gap-1",children:[S.jsx("button",{onClick:()=>I(!0),className:"p-1.5 rounded text-gray-300 hover:bg-gray-700",title:"Help",children:""}),x&&S.jsx("button",{onClick:x,className:"p-1.5 rounded text-gray-300 hover:bg-gray-700",title:"Exit Fullscreen",children:""})]})]})}),S.jsx(Qw,{isOpen:N,onClose:()=>I(!1)})]}):S.jsxs("div",{className:wt("bg-toolbar-bg text-white border-b border-gray-700 overflow-x-auto",{"h-toolbar":!L,"h-12":L}),children:[S.jsxs("div",{className:wt("flex items-center gap-4 min-w-fit h-full",{"px-4":!L,"px-2 gap-2":L}),children:[S.jsx("div",{className:wt("flex items-center border-r border-gray-600",{"gap-2 pr-4":!L,"gap-1 pr-2":L}),children:W.map(M=>S.jsx("button",{onClick:()=>u(M.id),className:wt({"toolbar-button":!L,"p-1.5 rounded text-sm":L,active:n===M.id&&!L,"bg-blue-600":n===M.id&&L}),title:M.label,children:M.icon},M.id))}),(n==="pen"||n==="line"||n==="text")&&S.jsxs("div",{className:wt("flex items-center border-r border-gray-600",{"gap-2 pr-4":!L,"gap-1 pr-2":L}),children:[!L&&S.jsx("span",{className:"text-sm",children:"Color:"}),S.jsx("div",{className:"flex gap-1",children:o0.slice(0,L?4:o0.length).map(M=>S.jsx("button",{onClick:()=>h(M),className:wt({"color-swatch":!L,"w-5 h-5 rounded border-2":L,active:e===M&&!L,"border-white":e===M&&L,"border-transparent":e!==M&&L}),style:{backgroundColor:M},title:M},M))}),S.jsxs("div",{className:"relative",children:[S.jsx("button",{onClick:()=>P(!C),className:"toolbar-button",title:"Custom Color",children:""}),C&&S.jsx("div",{className:"dropdown-menu",children:S.jsx("input",{type:"color",value:e,onChange:M=>{h(M.target.value),P(!1)},className:"w-full h-10"})})]})]}),(n==="pen"||n==="line")&&!L&&S.jsxs("div",{className:"flex items-center gap-2 border-r border-gray-600 pr-4",children:[S.jsx("span",{className:"text-sm",children:"Width:"}),aT.map(M=>S.jsxs("button",{onClick:()=>d(M),className:wt("toolbar-button px-3 py-1",{active:t===M}),children:[M,"px"]},M))]}),n==="text"&&!L&&S.jsxs("div",{className:"flex items-center gap-2 border-r border-gray-600 pr-4",children:[S.jsx("span",{className:"text-sm",children:"Font:"}),S.jsx("select",{value:s,onChange:M=>f(Number(M.target.value)),className:"bg-gray-700 rounded px-2 py-1",children:v1.map(M=>S.jsxs("option",{value:M,children:[M,"px"]},M))})]}),n==="eraser"&&!L&&S.jsxs("div",{className:"flex items-center gap-2 border-r border-gray-600 pr-4",children:[S.jsx("span",{className:"text-sm",children:"Size:"}),lT.map(M=>S.jsx("button",{onClick:()=>p(M.size),className:wt("toolbar-button px-3 py-1",{active:i===M.size}),children:M.name},M.name))]}),S.jsxs("div",{className:wt("flex items-center border-r border-gray-600",{"gap-2 pr-4":!L,"gap-1 pr-2":L}),children:[S.jsx("button",{onClick:w,disabled:!o,className:wt("disabled:opacity-50 disabled:cursor-not-allowed",{"toolbar-button":!L,"p-1.5 rounded text-sm":L}),title:"Undo (Ctrl+Z)",children:""}),S.jsx("button",{onClick:_,disabled:!l,className:wt("disabled:opacity-50 disabled:cursor-not-allowed",{"toolbar-button":!L,"p-1.5 rounded text-sm":L}),title:"Redo (Ctrl+Y)",children:""})]}),y&&!L&&S.jsxs("div",{className:"flex items-center gap-2 border-r border-gray-600 pr-4",children:[S.jsx("span",{className:"text-sm",children:"Layout:"}),S.jsx("button",{onClick:()=>{y(r==="single"?"vertical":r==="vertical"?"horizontal":r==="horizontal"?"tile":"single")},className:`px-3 py-1 rounded text-sm ${r==="single"?"bg-gray-600 text-white":r==="vertical"?"bg-blue-600 text-white":r==="horizontal"?"bg-green-600 text-white":"bg-purple-600 text-white"}`,children:r==="single"?" Single":r==="vertical"?" Vertical":r==="horizontal"?" Horizontal":" Tile"})]}),S.jsx("div",{className:wt("border-r border-gray-600",{"pr-4":!L,"pr-2":L}),children:S.jsx("button",{onClick:()=>I(!0),className:wt({"toolbar-button":!L,"p-1.5 rounded text-sm":L}),title:"Help",children:""})}),x&&S.jsx("div",{className:wt("border-r border-gray-600",{"pr-4":!L,"pr-2":L}),children:S.jsx("button",{onClick:x,className:wt({"toolbar-button":!L,"p-1.5 rounded text-sm":L}),title:"Toggle Fullscreen",children:c?"":""})}),S.jsx("div",{className:"ml-auto",children:S.jsx("button",{onClick:()=>{confirm("Clear all annotations? This cannot be undone.")&&E()},className:wt("bg-red-600 hover:bg-red-700",{"toolbar-button":!L,"p-1.5 rounded text-sm":L}),title:"Clear All Annotations",children:L?"":" Clear All"})})]}),S.jsx(Qw,{isOpen:N,onClose:()=>I(!1)})]})};class vT extends k.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){console.error("Error caught by ErrorBoundary:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?S.jsxs("div",{className:"error-boundary p-8 bg-red-50 border border-red-200 rounded-lg m-4",children:[S.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Something went wrong"}),S.jsxs("details",{className:"whitespace-pre-wrap",children:[S.jsx("summary",{className:"cursor-pointer text-red-700 font-semibold mb-2",children:"Click for error details"}),this.state.error&&S.jsxs("div",{className:"mt-4",children:[S.jsx("p",{className:"font-bold text-red-600",children:"Error:"}),S.jsx("pre",{className:"bg-red-100 p-4 rounded mt-2 overflow-auto",children:this.state.error.toString()}),this.state.error.stack&&S.jsxs(S.Fragment,{children:[S.jsx("p",{className:"font-bold text-red-600 mt-4",children:"Stack trace:"}),S.jsx("pre",{className:"bg-red-100 p-4 rounded mt-2 overflow-auto text-xs",children:this.state.error.stack})]})]}),this.state.errorInfo&&S.jsxs("div",{className:"mt-4",children:[S.jsx("p",{className:"font-bold text-red-600",children:"Component stack:"}),S.jsx("pre",{className:"bg-red-100 p-4 rounded mt-2 overflow-auto text-xs",children:this.state.errorInfo.componentStack})]})]}),S.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reload Page"})]}):this.props.children}}const yT=({isOpen:n,recoveryData:e,availableAutoSaves:t,onRecover:s,onSkip:i,onClose:r})=>{const[o,l]=k.useState((e==null?void 0:e.autoSaveEntry)||(t.length>0?t[0]:null));if(!n||!e)return null;const c=d=>new Date(d).toLocaleString(),u=d=>{const f=Math.floor(d/1e3),p=Math.floor(f/60),y=Math.floor(p/60),w=Math.floor(y/24);return w>0?`${w} day${w>1?"s":""} ago`:y>0?`${y} hour${y>1?"s":""} ago`:p>0?`${p} minute${p>1?"s":""} ago`:`${f} second${f>1?"s":""} ago`},h=()=>{o&&s(o)};return S.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:S.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[S.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:S.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),S.jsxs("div",{children:[S.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Auto-save Recovery"}),S.jsx("p",{className:"text-sm text-gray-600",children:"We found unsaved work for this PDF"})]})]}),S.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:S.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),S.jsxs("div",{className:"p-6",children:[S.jsxs("div",{className:"mb-6",children:[S.jsxs("p",{className:"text-gray-700 mb-4",children:['We found auto-saved annotations for "',e.autoSaveEntry.fileName,'". Would you like to restore your previous work?']}),S.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[S.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Comparison"}),S.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[S.jsxs("div",{children:[S.jsx("span",{className:"text-gray-600",children:"Current annotations:"}),S.jsx("span",{className:"ml-2 font-medium",children:e.currentAnnotationCount})]}),S.jsxs("div",{children:[S.jsx("span",{className:"text-gray-600",children:"Auto-saved annotations:"}),S.jsx("span",{className:"ml-2 font-medium",children:(o==null?void 0:o.annotationCount)||0})]})]})]}),t.length>1&&S.jsxs("div",{className:"mb-4",children:[S.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Available Auto-saves"}),S.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:t.map(d=>S.jsx("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${(o==null?void 0:o.id)===d.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>l(d),children:S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("input",{type:"radio",checked:(o==null?void 0:o.id)===d.id,onChange:()=>l(d),className:"text-blue-600"}),S.jsxs("div",{children:[S.jsx("p",{className:"text-sm font-medium text-gray-900",children:c(d.timestamp)}),S.jsxs("p",{className:"text-xs text-gray-600",children:[u(Date.now()-d.timestamp),"  ",d.annotationCount," annotations"]})]})]}),(o==null?void 0:o.id)===d.id&&S.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]})},d.id))})]}),o&&S.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[S.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-2",children:"Selected Auto-save Details"}),S.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[S.jsxs("div",{children:[S.jsx("span",{className:"text-blue-700",children:"Saved:"}),S.jsx("span",{className:"ml-2 text-blue-900",children:c(o.timestamp)})]}),S.jsxs("div",{children:[S.jsx("span",{className:"text-blue-700",children:"Annotations:"}),S.jsx("span",{className:"ml-2 text-blue-900",children:o.annotationCount})]}),S.jsxs("div",{children:[S.jsx("span",{className:"text-blue-700",children:"Tabs:"}),S.jsx("span",{className:"ml-2 text-blue-900",children:o.tabs.length})]}),S.jsxs("div",{children:[S.jsx("span",{className:"text-blue-700",children:"Age:"}),S.jsx("span",{className:"ml-2 text-blue-900",children:u(Date.now()-o.timestamp)})]})]})]})]}),e.currentAnnotationCount>((o==null?void 0:o.annotationCount)||0)&&S.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:S.jsxs("div",{className:"flex items-start gap-2",children:[S.jsx("svg",{className:"w-5 h-5 text-yellow-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),S.jsxs("div",{children:[S.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Warning"}),S.jsxs("p",{className:"text-sm text-yellow-700",children:["You currently have more annotations (",e.currentAnnotationCount,") than the auto-save (",(o==null?void 0:o.annotationCount)||0,"). Restoring will replace your current work."]})]})]})})]}),S.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50",children:[S.jsx("button",{onClick:i,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Skip Recovery"}),S.jsx("button",{onClick:h,disabled:!o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Restore Auto-save"})]})]})})};function wT(){const[n,e]=k.useState({}),[t,s]=k.useState([{}]),[i,r]=k.useState(0),[o,l]=k.useState({}),c=k.useCallback(v=>{s(E=>{const x=E.slice(0,i+1);return x.push(JSON.parse(JSON.stringify(v))),x.length>50&&x.shift(),x}),r(E=>Math.min(E+1,49))},[i]),u=k.useCallback((v,E,x)=>{var N;const C=`page_${E}`,P={...n,[v]:{...n[v]||{},[C]:[...((N=n[v])==null?void 0:N[C])||[],x]}};e(P),c(P)},[n,c]),h=k.useCallback((v,E,x)=>{const C=`page_${E}`,P=n[v]||{},N=P[C]||[],I={...n,[v]:{...P,[C]:N.filter(L=>L.id!==x)}};e(I),c(I)},[n,c]),d=k.useCallback((v,E,x)=>{const P={...n[v]||{}};let N=!1;for(const I in P){const L=P[I],U=L.findIndex(W=>W.id===E);if(U!==-1){P[I]=[...L.slice(0,U),{...L[U],...x},...L.slice(U+1)],N=!0;break}}if(N){const I={...n,[v]:P};e(I),c(I)}},[n,c]),f=k.useCallback(v=>{e(v),c(v)},[c]),p=k.useCallback(()=>{const v={};e(v),c(v)},[c]),y=k.useCallback(()=>{if(i>0){const v=i-1;r(v),e(JSON.parse(JSON.stringify(t[v])))}},[t,i]),w=k.useCallback(()=>{if(i<t.length-1){const v=i+1;r(v),e(JSON.parse(JSON.stringify(t[v])))}},[t,i]),_=k.useCallback(v=>{const E=n[v]||{},x=o[v]||{};return JSON.stringify(E)!==JSON.stringify(x)},[n,o]),m=k.useCallback(v=>{n[v]&&l(E=>({...E,[v]:JSON.parse(JSON.stringify(n[v]))}))},[n]);return{fileAnnotations:n,setAllAnnotations:f,addAnnotation:u,removeAnnotation:h,updateAnnotation:d,clearAllAnnotations:p,undo:y,redo:w,canUndo:i>0,canRedo:i<t.length-1,hasUnsavedChanges:_,markAsSaved:m}}function bT(n){const e=k.useCallback(t=>{if(qw()){console.log(` Keyboard shortcuts disabled - pen is active, blocking key: "${t.key}"`),t.preventDefault(),t.stopPropagation();return}if(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement)return;const{key:s,ctrlKey:i,metaKey:r,shiftKey:o}=t,l=i||r;if(!l&&/^[1-5]$/.test(s)){if(qw()){console.log(` Tool shortcut key "${s}" pressed, but pen is active - BLOCKING`),t.preventDefault();return}const c=["pen","eraser","text","line","select"],u=parseInt(s)-1;n.onToolChange&&c[u]&&(console.log(` Tool shortcut "${s}" -> ${c[u]}`),t.preventDefault(),n.onToolChange(c[u]));return}if(l){switch(s.toLowerCase()){case"z":t.preventDefault(),o&&n.onRedo?n.onRedo():!o&&n.onUndo&&n.onUndo();break;case"y":n.onRedo&&(t.preventDefault(),n.onRedo());break;case"s":n.onSave&&(t.preventDefault(),n.onSave());break;case"o":n.onOpen&&(t.preventDefault(),n.onOpen());break;case"=":case"+":n.onZoomIn&&(t.preventDefault(),n.onZoomIn());break;case"-":case"_":n.onZoomOut&&(t.preventDefault(),n.onZoomOut());break}return}if(!l)switch(s){case"ArrowLeft":o&&n.onScrollLeft?(t.preventDefault(),n.onScrollLeft()):!o&&n.onPrevPage&&(t.preventDefault(),n.onPrevPage());break;case"ArrowRight":o&&n.onScrollRight?(t.preventDefault(),n.onScrollRight()):!o&&n.onNextPage&&(t.preventDefault(),n.onNextPage());break;case"ArrowUp":n.onScrollUp&&(t.preventDefault(),n.onScrollUp());break;case"ArrowDown":n.onScrollDown&&(t.preventDefault(),n.onScrollDown());break;case"Enter":n.onFocusPageInput&&(t.preventDefault(),n.onFocusPageInput());break}},[n.onToolChange,n.onUndo,n.onRedo,n.onSave,n.onOpen,n.onZoomIn,n.onZoomOut,n.onNextPage,n.onPrevPage,n.onScrollUp,n.onScrollDown,n.onScrollLeft,n.onScrollRight,n.onFocusPageInput]);k.useEffect(()=>(window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}),[e])}const Zg="pdfmark_data",Zw="1.0.0",To=class To{constructor(){V(this,"autoSaveTimer",null)}static getInstance(){return To.instance||(To.instance=new To),To.instance}save(e){try{const t={...e,version:Zw};localStorage.setItem(Zg,JSON.stringify(t))}catch(t){console.error("Failed to save data to localStorage:",t)}}load(){try{const e=localStorage.getItem(Zg);if(!e)return null;const t=JSON.parse(e);return t.version!==Zw&&console.warn("Storage version mismatch, migration may be needed"),t}catch(e){return console.error("Failed to load data from localStorage:",e),null}}clear(){localStorage.removeItem(Zg)}autoSave(e,t=5e3){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(()=>{this.save(e),console.log("Auto-saved annotations")},t)}exportToFile(e){const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download=`pdfmark-annotations-${Date.now()}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}async importFromFile(e){return new Promise((t,s)=>{const i=new FileReader;i.onload=r=>{var o;try{const l=JSON.parse((o=r.target)==null?void 0:o.result);if(!l.version||!l.annotations||!l.pdfInfo)throw new Error("Invalid data format");t(l)}catch{s(new Error("Failed to parse imported file"))}},i.onerror=()=>{s(new Error("Failed to read file"))},i.readAsText(e)})}async generateFileHash(e){try{if(!crypto||!crypto.subtle||!crypto.subtle.digest)return console.warn(" Web Crypto API not available, using fallback hash"),this.generateFallbackHash(e);const t=await e.arrayBuffer(),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(o=>o.toString(16).padStart(2,"0")).join("")}catch(t){return console.warn(" Crypto.subtle.digest failed, using fallback:",t),this.generateFallbackHash(e)}}generateFallbackHash(e){const t=`${e.name}-${e.size}-${e.lastModified}`;let s=0;for(let r=0;r<t.length;r++){const o=t.charCodeAt(r);s=(s<<5)-s+o,s=s&s}const i=Math.abs(s).toString(16).padStart(8,"0");return console.log(` Generated fallback hash: ${i} for ${e.name}`),i}savePageAnnotations(e,t){const s=this.load();s&&(s.annotations[`page_${e}`]=t,this.save(s))}loadPageAnnotations(e){const t=this.load();return t?t.annotations[`page_${e}`]||[]:[]}};V(To,"instance");let a0=To;const Po=class Po{constructor(){V(this,"db",null);V(this,"config",uT);V(this,"autoSaveTimer",null);V(this,"lastAnnotationHash","");V(this,"isInitialized",!1);V(this,"DB_NAME","PDFMarkAutoSave");V(this,"DB_VERSION",1);V(this,"STORE_NAME","autoSaves")}static getInstance(){return Po.instance||(Po.instance=new Po),Po.instance}async initialize(){if(!this.isInitialized)return new Promise((e,t)=>{const s=indexedDB.open(this.DB_NAME,this.DB_VERSION);s.onerror=()=>{console.error("Failed to open IndexedDB for auto-save:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,this.isInitialized=!0,console.log(" AutoSaveManager: IndexedDB initialized successfully"),e()},s.onupgradeneeded=()=>{const i=s.result;if(!i.objectStoreNames.contains(this.STORE_NAME)){const r=i.createObjectStore(this.STORE_NAME,{keyPath:"id"});r.createIndex("fileHash","fileHash",{unique:!1}),r.createIndex("timestamp","timestamp",{unique:!1}),r.createIndex("fileName","fileName",{unique:!1}),console.log(" AutoSaveManager: Created IndexedDB schema")}}})}configure(e){this.config={...this.config,...e},console.log(" AutoSaveManager: Configuration updated",this.config),this.autoSaveTimer&&(this.stopAutoSave(),this.startAutoSave())}generateAnnotationHash(e){const t=Object.keys(e).sort().map(s=>({page:s,annotations:e[s].map(i=>({id:i.id,type:i.type,timestamp:i.timestamp}))}));return btoa(JSON.stringify(t))}generateAutoSaveId(e){const t=Date.now();return`autosave_${e}_${t}`}calculateAnnotationCount(e){return Object.values(e).reduce((t,s)=>t+s.length,0)}async saveAutoSave(e,t,s,i){if(!(!this.db||!this.config.enabled))try{const r=this.generateAnnotationHash(s);if(r===this.lastAnnotationHash){console.log(" AutoSaveManager: No changes detected, skipping auto-save");return}const o={id:this.generateAutoSaveId(e),fileHash:e,fileName:t,timestamp:Date.now(),annotations:s,tabs:i,annotationCount:this.calculateAnnotationCount(s),lastModified:Date.now()},c=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME);await new Promise((u,h)=>{const d=c.put(o);d.onsuccess=()=>{this.lastAnnotationHash=r,console.log(` AutoSaveManager: Auto-saved ${o.annotationCount} annotations for ${t}`),u()},d.onerror=()=>h(d.error)}),await this.cleanupOldAutoSaves(e)}catch(r){console.error(" AutoSaveManager: Failed to save auto-save entry:",r)}}async findAutoSavesForFile(e){if(this.db||await this.initialize(),!this.db)return[];try{const i=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).index("fileHash");return new Promise((r,o)=>{const l=i.getAll(e);l.onsuccess=()=>{const c=l.result;c.sort((u,h)=>h.timestamp-u.timestamp),r(c)},l.onerror=()=>o(l.error)})}catch(t){return console.error(" AutoSaveManager: Failed to find auto-saves for file:",t),[]}}async getLatestAutoSave(e){const t=await this.findAutoSavesForFile(e);return t.length>0?t[0]:null}async deleteAutoSave(e){if(this.db)try{const s=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME);await new Promise((i,r)=>{const o=s.delete(e);o.onsuccess=()=>{console.log(` AutoSaveManager: Deleted auto-save ${e}`),i()},o.onerror=()=>r(o.error)})}catch(t){console.error(" AutoSaveManager: Failed to delete auto-save:",t)}}async cleanupOldAutoSaves(e){if(this.db)try{const t=await this.findAutoSavesForFile(e),i=Date.now()-this.config.retentionDays*24*60*60*1e3,r=t.filter((o,l)=>l>=this.config.maxAutoSaves||o.timestamp<i);for(const o of r)await this.deleteAutoSave(o.id);r.length>0&&console.log(` AutoSaveManager: Cleaned up ${r.length} old auto-saves for ${e}`)}catch(t){console.error(" AutoSaveManager: Failed to cleanup old auto-saves:",t)}}startAutoSave(){!this.config.enabled||this.autoSaveTimer||(this.autoSaveTimer=setInterval(()=>{console.log(" AutoSaveManager: Auto-save timer tick")},this.config.interval),console.log(` AutoSaveManager: Auto-save started with ${this.config.interval}ms interval`))}stopAutoSave(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null,console.log(" AutoSaveManager: Auto-save stopped"))}shouldTriggerAutoSave(e){return this.config.enabled?this.generateAnnotationHash(e)!==this.lastAnnotationHash:!1}getConfig(){return{...this.config}}destroy(){this.stopAutoSave(),this.db&&(this.db.close(),this.db=null),this.isInitialized=!1,console.log(" AutoSaveManager: Destroyed")}};V(Po,"instance");let l0=Po;const bo=l0.getInstance();function xT(){const[n,e]=k.useState(null),[t,s]=k.useState(null),[i,r]=k.useState([{id:"tab_1",name:"Main",currentPage:1,zoomLevel:"fit-width"}]),[o,l]=k.useState("tab_1"),[c,u]=k.useState("single"),[h,d]=k.useState(!1),[f,p]=k.useState({currentTool:"pen",color:"#000000",lineWidth:2,fontSize:16,eraserSize:20}),[y,w]=k.useState(!1),[_,m]=k.useState(null),[v,E]=k.useState([]),[x,C]=k.useState(null),[P,N]=k.useState(0),I=k.useCallback((O,X)=>{console.log(` handleToolChange - Attempting to change tool to "${O}" from ${X}`),console.log(` handleToolChange - Current tool: "${f.currentTool}"`);const F=m1(),ae=sT();if(F&&ae===f.currentTool){console.log(` handleToolChange - BLOCKED! ${ae} is active, refusing to change from ${f.currentTool} to ${O}`);return}console.log(` handleToolChange - Changing tool from "${f.currentTool}" to "${O}" (source: ${X})`),p(ve=>({...ve,currentTool:O}))},[f.currentTool]),L=a0.getInstance(),U=k.useRef(null),W=k.useRef(null),M=k.useRef(null),K=k.useRef(null),q=k.useRef(null);k.useEffect(()=>((async()=>{try{await bo.initialize(),bo.startAutoSave(),console.log(" AutoSaveManager initialized successfully")}catch(X){console.error(" Failed to initialize AutoSaveManager:",X)}})(),q.current=setInterval(async()=>{console.log(" Periodic auto-save check triggered (30s interval)"),await wn()},3e4),console.log(" Auto-save system initialized: 30s intervals + change-based triggers"),()=>{q.current&&clearInterval(q.current),bo.destroy()}),[]);const ee=k.useMemo(()=>i.find(O=>O.id===o)||i[0],[i,o]),{fileAnnotations:z,setAllAnnotations:T,addAnnotation:R,removeAnnotation:$,updateAnnotation:D,clearAllAnnotations:Y,undo:te,redo:Z,canUndo:me,canRedo:Ge,hasUnsavedChanges:_e,markAsSaved:he}=wT(),we=k.useMemo(()=>{var O;return(n==null?void 0:n.name)||((O=ee==null?void 0:ee.file)==null?void 0:O.name)||(ee==null?void 0:ee.fileName)||null},[n,ee]),rt=k.useMemo(()=>we?_e(we):!1,[we,_e]);k.useEffect(()=>{(n!=null&&n.name||x||we)&&console.log(` APP STATE: pdfFile=${(n==null?void 0:n.name)||"null"}, fileHash=${(x==null?void 0:x.substring(0,8))||"null"}, fileName=${we||"null"}, hasChanges=${rt}`)},[n==null?void 0:n.name,x,we,rt]),k.useEffect(()=>{const O=X=>{if(console.log(` beforeunload triggered: hasUnsavedChanges=${rt} for file=${we}`),rt&&we){console.log(` Showing leave warning for ${we}`);const F="You have unsaved changes. Are you sure you want to leave?";return X.returnValue=F,F}};return window.addEventListener("beforeunload",O),()=>{window.removeEventListener("beforeunload",O)}},[rt,we]);const wn=k.useCallback(async()=>{const O=(x==null?void 0:x.substring(0,8))||"null";if(console.log(` Auto-save check: fileHash=${O}..., fileName=${we||"none"}`),!x||!we){console.log(` Skipping auto-save: missing fileHash(${!!x}) or fileName(${!!we})`);return}try{const X=z[we]||{},F=Object.values(X).reduce((ve,de)=>ve+de.length,0);console.log(` Current annotations: ${F} total for ${we}`);const ae=bo.shouldTriggerAutoSave(X);console.log(` Should trigger auto-save: ${ae}`),ae?(await bo.saveAutoSave(x,we,X,i),N(Date.now()),console.log(`  Auto-saved ${F} annotations for ${we}`)):console.log("  No changes detected, skipping auto-save")}catch(X){console.error(" Auto-save failed:",X)}},[x,we,z,i]);k.useEffect(()=>{if(console.log(` Annotation change detected: hasUnsavedChanges=${rt} for ${we}, lastAutoSave=${P?new Date(P).toLocaleTimeString():"never"}`),rt&&we&&Date.now()-P>5e3){console.log(" Scheduling auto-save in 2 seconds...");const O=setTimeout(()=>{console.log(" Change-triggered auto-save executing now"),wn()},2e3);return()=>{console.log(" Cancelled scheduled auto-save (new changes detected)"),clearTimeout(O)}}},[rt,we,wn,P]);const Vs=k.useCallback(async O=>{try{const X=await L.generateFileHash(O);C(X);const F=await bo.findAutoSavesForFile(X);if(F.length>0){const ae=F[0],ve=z[O.name]||{},de=Object.values(ve).reduce((kt,ot)=>kt+ot.length,0),be={autoSaveEntry:ae,currentAnnotationCount:de,timeDifference:Date.now()-ae.timestamp};return m(be),E(F),w(!0),console.log(` Found ${F.length} auto-save(s) for ${O.name}`),!0}return console.log(` No auto-saves found for ${O.name}`),!1}catch(X){return console.error(" Failed to check for auto-save recovery:",X),!1}},[L,z]),Gs=k.useCallback(async O=>{try{console.log(" Starting auto-save restoration..."),console.log(" AutoSave entry:",JSON.stringify(O,null,2));const X=(n==null?void 0:n.name)||O.fileName;console.log(` Target fileName: "${X}"`),console.log(` pdfFile?.name: "${n==null?void 0:n.name}"`),console.log(` autoSaveEntry.fileName: "${O.fileName}"`),console.log(" Auto-save annotations structure:",JSON.stringify(O.annotations,null,2));const F=z[X]||{},ae=Object.values(F).reduce((de,be)=>de+be.length,0);console.log(` Current annotations count before restore: ${ae}`),console.log(" Current annotations structure:",JSON.stringify(F,null,2)),console.log(" Calling setAllAnnotations with proper structure...");const ve={...z,[X]:O.annotations};if(console.log(" Final annotations structure for setAllAnnotations:",JSON.stringify(ve,null,2)),T(ve),setTimeout(()=>{const de=z[X]||{},be=Object.values(de).reduce((kt,ot)=>kt+ot.length,0);console.log(` Annotations count after restore: ${be}`),console.log(" Restored annotations structure:",JSON.stringify(de,null,2)),be===0?(console.error(" RESTORATION FAILED: No annotations found after setAllAnnotations call!"),console.error(` Expected ${O.annotationCount} annotations but got ${be}`)):console.log(` RESTORATION SUCCESS: ${be} annotations restored`)},100),console.log(` Restoring ${O.tabs.length} tabs...`),r(O.tabs),O.tabs.length>0&&(console.log(` Setting active tab to: ${O.tabs[0].id}`),l(O.tabs[0].id)),console.log(` Restored auto-save from ${new Date(O.timestamp).toLocaleString()}`),console.log(` Restored ${O.annotationCount} annotations`),w(!1),m(null),E([]),x&&n){const de={version:"1.0.0",pdfInfo:{fileName:n.name,fileHash:x,totalPages:0},annotations:O.annotations,tabs:O.tabs,viewSettings:{splitMode:"none",splitRatio:.5}};L.save(de),console.log(` Updated storage with restored data for ${n.name}`)}console.log(`  Deleting auto-save entry with ID: ${O.id}`),await bo.deleteAutoSave(O.id),console.log(" Cleaned up auto-save entry after successful restoration"),he(X),console.log(` Marked ${X} as saved after auto-save restoration`)}catch(X){console.error(" Failed to restore auto-save:",X),console.error(" Error details:",X.stack||X),alert("Failed to restore auto-save. Please try again.")}},[n,T,x,L,he,z]),bi=k.useCallback(async()=>{if(w(!1),m(null),E([]),console.log(" User skipped auto-save recovery"),n){console.log(" Continuing normal file loading process after skipping recovery");const O={id:"tab_1",name:"Main",file:n,fileName:n.name,currentPage:1,zoomLevel:"fit-width"};if(r([O]),l("tab_1"),x){const X={version:"1.0.0",pdfInfo:{fileName:n.name,fileHash:x,totalPages:0},annotations:{},tabs:[O],viewSettings:{splitMode:"none",splitRatio:.5}};L.save(X),console.log(` Initialized storage for ${n.name} after skipping recovery`),he(n.name),console.log(` Marked ${n.name} as saved after skipping auto-save recovery`)}}},[n,x,L,he]),pr=k.useCallback(()=>{w(!1),m(null),E([])},[]),rn=k.useCallback(async(O,X)=>{if(console.log(` handleFileUpload called with file: ${O.name}, targetTabId: ${X}`),!kp(O)){alert("Please select a valid PDF file");return}if(O.size>50*1024*1024){alert("File size exceeds 50MB limit");return}const F=await L.generateFileHash(O);C(F),console.log(` Generated file hash: ${F.substring(0,8)}... for ${O.name}`);const ae=await Vs(O);if(console.log(` Auto-save recovery check result: ${ae}`),ae){console.log(" Auto-save dialog shown, waiting for user decision..."),e(O);return}if(console.log(` Normal file loading process - targetTabId: ${X}`),X)console.log(` Updating existing tab ${X} with file ${O.name}`),r(i.map(de=>de.id===X?{...de,file:O,fileName:O.name,currentPage:1,zoomLevel:"fit-width"}:de));else{const de=i.some(be=>be.file);if(console.log(` hasFiles: ${de}, tabs count: ${i.length}`),de){console.log(` Creating new tab for file ${O.name}`);const be={id:za(),name:`Tab ${i.length+1}`,file:O,fileName:O.name,currentPage:1,zoomLevel:"fit-width"};r([...i,be]),l(be.id),console.log(" Created new tab:",be)}else{console.log(" Setting as main PDF file and creating main tab"),e(O);const be={id:"tab_1",name:"Main",file:O,fileName:O.name,currentPage:1,zoomLevel:"fit-width"};r([be]),l("tab_1"),console.log(" Created main tab:",be)}}const ve={version:"1.0.0",pdfInfo:{fileName:O.name,fileHash:F,totalPages:0},annotations:{},tabs:i,viewSettings:{splitMode:"none",splitRatio:.5}};L.save(ve),console.log(` Initialized storage for ${O.name}`),he(O.name),console.log(` Marked ${O.name} as saved (initial load)`)},[L,i,Vs,he]),Ja=k.useCallback(O=>{s(O);const X=L.load();X&&n&&(X.pdfInfo.totalPages=O.numPages,L.save(X))},[n,L]);k.useCallback(O=>{r(i.map(X=>X.id===o?{...X,currentPage:O}:X))},[i,o]);const ns=k.useCallback(O=>{r(i.map(X=>X.id===o?{...X,zoomLevel:O}:X))},[i,o]),xi=k.useCallback(()=>{if(!(Object.keys(z).length>0)){alert("No annotations to save");return}let X=Object.keys(z)[0];X||(n?X=n.name:ee.file?X=ee.file.name:ee.fileName?X=ee.fileName:X="annotations.json");const F={version:"1.0.0",pdfInfo:{fileName:X,fileHash:"",totalPages:(t==null?void 0:t.numPages)||1},annotations:z,tabs:i,viewSettings:{splitMode:"none",splitRatio:.5}};L.exportToFile(F),Object.keys(z).forEach(ae=>{he(ae)})},[L,i,z,n,t,ee.file,ee.fileName,he]),Ws=k.useCallback(async()=>{var O;(O=W.current)==null||O.click()},[]),H=k.useCallback(async O=>{var F;const X=(F=O.target.files)==null?void 0:F[0];if(X){try{const ae=await L.importFromFile(X);ae.annotations&&T(ae.annotations),ae.tabs&&ae.tabs.length>0&&(r(ae.tabs),l(ae.tabs[0].id)),L.save(ae),alert("Annotations loaded successfully")}catch(ae){alert("Failed to import file: "+ae.message)}W.current&&(W.current.value="")}},[L,T]),Q=k.useCallback(()=>{var O;document.fullscreenElement?(document.exitFullscreen(),d(!1)):((O=K.current)==null||O.requestFullscreen(),d(!0))},[]);vr.useEffect(()=>{const O=()=>{d(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",O),()=>document.removeEventListener("fullscreenchange",O)},[]);const B=k.useCallback(()=>{const O=ee.zoomLevel;ns(typeof O=="number"?Math.min(O+.25,3):1.25)},[ee.zoomLevel,ns]),j=k.useCallback(()=>{const O=ee.zoomLevel;ns(typeof O=="number"?Math.max(O-.25,.25):.75)},[ee.zoomLevel,ns]),ne=k.useCallback(()=>{M.current&&M.current.navigateNextPage()},[]),le=k.useCallback(()=>{M.current&&M.current.navigatePrevPage()},[]),fe=k.useCallback(()=>{M.current&&M.current.scrollActivePane(0,-100)},[]),ze=k.useCallback(()=>{M.current&&M.current.scrollActivePane(0,100)},[]),ge=k.useCallback(()=>{M.current&&M.current.scrollActivePane(-100,0)},[]),Pe=k.useCallback(()=>{M.current&&M.current.scrollActivePane(100,0)},[]),De=k.useCallback(()=>{M.current&&M.current.focusPageInput()},[]);bT({onUndo:te,onRedo:Z,onSave:xi,onOpen:()=>{var O;return(O=U.current)==null?void 0:O.click()},onToolChange:O=>I(O,"keyboard"),onZoomIn:B,onZoomOut:j,onNextPage:ne,onPrevPage:le,onScrollUp:fe,onScrollDown:ze,onScrollLeft:ge,onScrollRight:Pe,onFocusPageInput:De});const ct=k.useCallback(O=>{O.preventDefault(),O.stopPropagation()},[]),Ct=k.useCallback(O=>{console.log(" DROP EVENT DETECTED!"),O.preventDefault(),O.stopPropagation();const X=Array.from(O.dataTransfer.files);console.log(` Dropped files count: ${X.length}`,X.map(ae=>ae.name));const F=X.find(ae=>kp(ae));console.log(` PDF file found: ${(F==null?void 0:F.name)||"none"}`),F&&(console.log(` Calling handleFileUpload with: ${F.name}`),rn(F))},[rn]);return S.jsx(vT,{children:S.jsxs("div",{ref:K,className:"flex flex-col h-screen bg-gray-900",onDragOver:ct,onDrop:Ct,children:[S.jsx("input",{ref:U,type:"file",accept:".pdf",onChange:O=>{var F;console.log(" FILE INPUT CHANGE EVENT!");const X=(F=O.target.files)==null?void 0:F[0];console.log(` Selected file: ${(X==null?void 0:X.name)||"none"}`),X&&(console.log(` Calling handleFileUpload with: ${X.name}`),rn(X))},className:"hidden"}),S.jsx("input",{ref:W,type:"file",accept:".json",onChange:H,className:"hidden"}),S.jsx(mT,{currentTool:f.currentTool,color:f.color,lineWidth:f.lineWidth,fontSize:f.fontSize,eraserSize:f.eraserSize,windowLayout:c,canUndo:me,canRedo:Ge,isFullscreen:h,onToolChange:O=>I(O,"toolbar"),onColorChange:O=>p(X=>({...X,color:O})),onLineWidthChange:O=>p(X=>({...X,lineWidth:O})),onFontSizeChange:O=>p(X=>({...X,fontSize:O})),onEraserSizeChange:O=>p(X=>({...X,eraserSize:O})),onWindowLayoutChange:u,onUndo:te,onRedo:Z,onSave:xi,onLoad:Ws,onClearAll:Y,onToggleFullscreen:Q}),S.jsx("div",{className:"flex-1 overflow-hidden",children:S.jsx(w1,{ref:M,layout:c,pdfFile:n,pdfDoc:t,fileAnnotations:z,toolSettings:f,onLayoutChange:u,onSaveAnnotations:xi,onLoadAnnotations:Ws,onAnnotationAdd:(O,X)=>{O&&R(O,X.pageNumber,X)},onAnnotationRemove:(O,X,F)=>{O&&$(O,F,X)},onAnnotationUpdate:(O,X,F)=>{O&&D(O,X,F)},onDocumentLoad:Ja,onFileUpload:rn,hasUnsavedChanges:_e,markAsSaved:he,onToolChange:O=>I(O,"windowManager")})}),S.jsxs("div",{className:"status-bar",children:[S.jsx("div",{className:"flex items-center gap-4",children:n&&S.jsxs(S.Fragment,{children:[S.jsx("span",{className:"truncate max-w-xs",children:n.name}),S.jsx("span",{className:"text-gray-400",children:"|"}),S.jsx("span",{children:Jk(n.size)}),S.jsx("span",{className:"text-gray-400",children:"|"}),S.jsxs("span",{children:["Page ",ee.currentPage," of ",(t==null?void 0:t.numPages)||0]}),c!=="single"&&S.jsxs(S.Fragment,{children:[S.jsx("span",{className:"text-gray-400",children:"|"}),S.jsxs("span",{className:"text-yellow-400",children:["Layout: ",c]})]}),P>0&&S.jsxs(S.Fragment,{children:[S.jsx("span",{className:"text-gray-400",children:"|"}),S.jsxs("span",{className:"text-green-400",children:["Auto-saved: ",new Date(P).toLocaleTimeString()]})]})]})}),S.jsxs("div",{className:"flex items-center gap-4",children:[S.jsxs("span",{children:["Tab: ",ee.name]}),S.jsx("span",{className:"text-gray-400",children:"|"}),S.jsxs("span",{children:["Zoom: ",typeof ee.zoomLevel=="number"?`${Math.round(ee.zoomLevel*100)}%`:ee.zoomLevel]})]})]}),S.jsx(yT,{isOpen:y,recoveryData:_,availableAutoSaves:v,onRecover:Gs,onSkip:bi,onClose:pr})]})})}Jg.createRoot(document.getElementById("root")).render(S.jsx(vr.StrictMode,{children:S.jsx(xT,{})}));
